[{"id":"9b61ce87.2ae62","type":"tab","label":"Worldmap","disabled":false,"info":""},{"id":"679df911.24a188","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"99f7fccc.6df2f","type":"tab","label":"myUI Demo","disabled":true,"info":""},{"id":"833d7b75.5dd878","type":"tab","label":"Homie Test","disabled":false,"info":""},{"id":"897fdb2a.109f68","type":"tab","label":"Homematic","disabled":false,"info":""},{"id":"afaa0885.ad2718","type":"tab","label":"Heating Controller","disabled":false,"info":""},{"id":"dd3f4b52.8a4468","type":"tab","label":"Heating Periods","disabled":false,"info":""},{"id":"309a0a3e.c49326","type":"tab","label":"System","disabled":false,"info":""},{"id":"45367253.8faa7c","type":"tab","label":"Rooms","disabled":false,"info":""},{"id":"4635654.3abb19c","type":"tab","label":"Lights Hardware","disabled":false,"info":""},{"id":"9831cab2.382058","type":"tab","label":"Light Devices","disabled":false,"info":""},{"id":"9848cbbf.0bdd68","type":"tab","label":"Light Groups","disabled":false,"info":""},{"id":"b66f2c73.9297e","type":"tab","label":"Light Scenes","disabled":false,"info":""},{"id":"fe9fd924.188388","type":"tab","label":"Light UI","disabled":false,"info":""},{"id":"6ed67795.6a6c28","type":"tab","label":"Beleuchtung","disabled":false,"info":""},{"id":"25cbe481.e10bec","type":"tab","label":"Homie","disabled":false,"info":""},{"id":"5b6fa421.88b5bc","type":"tab","label":"Homekit","disabled":false,"info":""},{"id":"1e193208.71985e","type":"tab","label":"ui-table","disabled":false,"info":"# ui-table with ui_controll and command transmission\n## ui_control\npress the inject button on either \n- payload or\n- ui_controll\n\n## msg.payload.command / msg.payload.arguments\nsend commands to ui-table. ui-table by default expects an array with the complete table data as msg.payload. If you send an object containing:\n- `msg.payload.command` _[string]_ the command\n- `msg.payload.arguments` _[array]_ an array of arguments for the command\nit is possible to send commands to the table to i.e. update single rowas or add data"},{"id":"d1227ddb.952f7","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"afe0bd06.1f05","type":"tab","label":"Esszimmer","disabled":false,"info":""},{"id":"c4a7cd6c.2a0c1","type":"subflow","name":"setGroup","info":"","category":"myUI","in":[{"x":40,"y":80,"wires":[{"id":"3404a4d4.23919c"}]}],"out":[{"x":360,"y":120,"wires":[{"id":"3404a4d4.23919c","port":1}]}],"env":[{"name":"host","type":"str","value":"","ui":{"icon":"font-awesome/fa-object-group","label":{"en-US":"Host"},"type":"input","opts":{"types":["str","env"]}}},{"name":"property","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Property"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3caa8e","inputLabels":["uiDropdon"],"outputLabels":["update"],"icon":"node-red-dashboard/ui_dropdown.png","status":{"x":360,"y":40,"wires":[{"id":"3404a4d4.23919c","port":0}]}},{"id":"d4a0d961.b11238","type":"subflow","name":"deleteGroup","info":"","category":"myUI","in":[{"x":40,"y":80,"wires":[{"id":"6a775fab.082ab"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"6a775fab.082ab","port":1}]}],"env":[{"name":"cancel","type":"str","value":"cancel"}],"color":"#a1decf","icon":"font-awesome/fa-minus-square","status":{"x":340,"y":40,"wires":[{"id":"6a775fab.082ab","port":0}]}},{"id":"dfa4352b.bdc548","type":"subflow","name":"saveData","info":"# Save Data to global store\n\n## parameters\n\nparamter | Description\n- | -\nhost | path to object hosting the list entry\nparameter | name of the parameter containing the list","category":"myUI","in":[{"x":60,"y":80,"wires":[{"id":"1ff3f5ad.ab0eca"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"1ff3f5ad.ab0eca","port":1}]}],"env":[{"name":"host","type":"str","value":"","ui":{"icon":"font-awesome/fa-object-group","label":{"en-US":"Host"},"type":"input","opts":{"types":["str","env"]}}},{"name":"property","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Property"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3caa8e","inputLabels":["uiElement(s)"],"outputLabels":["update"],"icon":"font-awesome/fa-database","status":{"x":340,"y":40,"wires":[{"id":"1ff3f5ad.ab0eca","port":0}]}},{"id":"e0e53645.d85fd8","type":"subflow","name":"addItemToList","info":"","category":"myUI","in":[{"x":60,"y":80,"wires":[{"id":"51c4d926.279bc8"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"51c4d926.279bc8","port":1}]}],"env":[{"name":"defaults","type":"json","value":"","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["json"]},"label":{}}}],"color":"#3caa8e","inputLabels":["add Button"],"outputLabels":["update Link"],"icon":"font-awesome/fa-plus-square","status":{"x":340,"y":40,"wires":[{"id":"51c4d926.279bc8","port":0}]}},{"id":"e0e09953.42b938","type":"subflow","name":"InitializeUi","info":"Initialize the UI Elemnets and fill the drop down list","category":"myUI","in":[{"x":60,"y":80,"wires":[{"id":"ea0578f.f595788"}]}],"out":[{"x":320,"y":120,"wires":[{"id":"ea0578f.f595788","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings"},{"name":"baseObject","type":"str","value":"heating.periods"},{"name":"uiElement","type":"str","value":"uiDropdown"},{"name":"filterProperty","type":"str","value":"","ui":{"icon":"font-awesome/fa-filter","label":{"en-US":"Filter"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"filterValue","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Value"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#3caa8e","icon":"node-red/arrow-in.png","status":{"x":320,"y":40,"wires":[{"id":"ea0578f.f595788","port":0}]}},{"id":"30d3b36b.8d171c","type":"subflow","name":"updateUi","info":"","category":"myUI","in":[{"x":54,"y":85,"wires":[{"id":"7745479f.ddca48"}]}],"out":[{"x":326,"y":85,"wires":[{"id":"7745479f.ddca48","port":1}]},{"x":326,"y":136,"wires":[{"id":"7745479f.ddca48","port":2}]}],"env":[{"name":"uiControl","type":"json","value":"{\"type\":{\"switch\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":false},\"defaultColor\":{\"enable\":false}},\"dimmer\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":false}},\"rgb\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":true}},\"rgbw\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":true}},\"rgb-w\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":true}}}}","ui":{"icon":"font-awesome/fa-check-square-o","type":"input","opts":{"types":["json"]},"label":{}}}],"color":"#a1decf","inputLabels":["updateLink"],"outputLabels":["updateGroup","updateElements"],"status":{"x":326,"y":34,"wires":[{"id":"7745479f.ddca48","port":0}]}},{"id":"8ba1eff6.75a11","type":"subflow","name":"fillDropdown","info":"","category":"myUI","in":[{"x":40,"y":80,"wires":[{"id":"9d13774f.8dc838"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"9d13774f.8dc838","port":1}]}],"env":[{"name":"customTopic","type":"str","value":"","ui":{"icon":"font-awesome/fa-tasks","label":{"en-US":"Topic"},"type":"input","opts":{"types":["str","env"]}}},{"name":"filterProperty","type":"str","value":"","ui":{"icon":"font-awesome/fa-filter","label":{"en-US":"Filter"},"type":"input","opts":{"types":["str","env"]}}},{"name":"filterValue","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Value"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#a1decf","inputLabels":["update"],"outputLabels":["dropdownUi"],"status":{"x":343,"y":51,"wires":[{"id":"9d13774f.8dc838","port":0}]}},{"id":"6e9d1a04.cba814","type":"subflow","name":"buildChart","info":"","category":"myHeating","in":[{"x":54,"y":85,"wires":[{"id":"7e7bc1cc.55ff6"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"7e7bc1cc.55ff6","port":1}]}],"env":[],"color":"#a1decf","inputLabels":["select"],"outputLabels":["chart"],"icon":"font-awesome/fa-area-chart","status":{"x":343,"y":51,"wires":[{"id":"7e7bc1cc.55ff6","port":0}]}},{"id":"bbaf0ff1.1a532","type":"subflow","name":"buildSchedule","info":"","category":"myHeating","in":[{"x":122,"y":119,"wires":[{"id":"1a64ae43.a9bc52"}]}],"out":[{"x":394,"y":170,"wires":[{"id":"1a64ae43.a9bc52","port":1}]}],"env":[],"color":"#a1decf","inputLabels":["select"],"outputLabels":["schedule"],"icon":"font-awesome/fa-calendar-o","status":{"x":394,"y":68,"wires":[{"id":"1a64ae43.a9bc52","port":0}]}},{"id":"7bb9b47f.834f5c","type":"subflow","name":"updateChart","info":"","category":"","in":[{"x":88,"y":102,"wires":[{"id":"5f802c34.c65794"}]}],"out":[{"x":360,"y":136,"wires":[{"id":"5f802c34.c65794","port":1}]}],"env":[],"color":"#a1decf","inputLabels":["newTempReading"],"outputLabels":["updatedChart"],"icon":"node-red-dashboard/ui_chart.png","status":{"x":360,"y":68,"wires":[{"id":"5f802c34.c65794","port":0}]}},{"id":"7fd0d8ec.569998","type":"subflow","name":"initHeater","info":"* datapoint: datapoint provideing the catual temperatur (measuement)\n* room (optional): if input does not provide msg.room it could be set here","category":"","in":[{"x":54,"y":85,"wires":[{"id":"176161.c40d2e9f"}]}],"out":[{"x":343,"y":102,"wires":[{"id":"176161.c40d2e9f","port":1}]},{"x":343,"y":153,"wires":[{"id":"176161.c40d2e9f","port":2}]},{"x":343,"y":204,"wires":[{"id":"176161.c40d2e9f","port":3}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings"},{"name":"roomsContext","type":"str","value":"rooms"},{"name":"roomContext","type":"str","value":"heating.rooms"},{"name":"periodsContext","type":"str","value":"heating.periods"},{"name":"datapoint","type":"str","value":"ACTUAL_TEMPERATURE","ui":{"icon":"font-awesome/fa-thermometer-1","type":"input","opts":{"types":["str","json","env"]},"label":{}}},{"name":"room","type":"str","value":"","ui":{"icon":"font-awesome/fa-bed","type":"input","opts":{"types":["str"]},"label":{}}}],"color":"#a1decf","icon":"node-red/arrow-in.svg","status":{"x":343,"y":34,"wires":[{"id":"176161.c40d2e9f","port":0}]}},{"id":"2f4c5529.6abcba","type":"subflow","name":"buildTable","info":"","category":"","in":[{"x":68,"y":85,"wires":[{"id":"6a2bfd9e.ce1944"}]}],"out":[{"x":343,"y":136,"wires":[{"id":"6a2bfd9e.ce1944","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings","ui":{"type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"dataContext","type":"str","value":"heating.devices","ui":{"type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"dataSelection","type":"json","value":"[{\"title\":\"Device\",\"value\":\"name\"},{\"title\":\"Raum\",\"value\":\"room\"}]"},{"name":"config","type":"json","value":"{\"columnResized\":\"function(column){     var newColumns={};     var percentFactor=1;     var totalWidth=0;     var lastWidth=0;     var widthUnit='px';     column._column.table.columnManager.columns.forEach(function (aColumn) {          totalWidth += aColumn.width;         if (aColumn.definition.width.includes('%')) widthUnit='%';     });     if (widthUnit=='%') percentFactor=100/totalWidth;     totalWidth=0;      column._column.table.columnManager.columns.forEach(function (aColumn) {         lastWidth=Math.floor(aColumn.width*percentFactor);         newColumns[aColumn.field]=lastWidth+widthUnit;         totalWidth+= lastWidth;     });     if (widthUnit=='%' && totalWidth!=100 ) {         var keys=Object.keys(newColumns);         newColumns[keys[keys.length-1]].widthStyled=(lastWidth+(100-totalWidth))+widthUnit;     }     this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumns}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\"}","ui":{"icon":"font-awesome/fa-retweet","label":{"en-US":"config"},"type":"input","opts":{"types":["json"]}}},{"name":"layout","type":"str","value":"fitData","ui":{"type":"select","opts":{"opts":[{"l":{"en-US":"fitData"},"v":"fitData"},{"l":{"en-US":"fitDataFill"},"v":"fitDataFill"},{"l":{"en-US":"fitColumns"},"v":"fitColumns"}]},"label":{}}},{"name":"movableColumns","type":"bool","value":"true","ui":{"type":"input","opts":{"types":["bool"]},"label":{}}},{"name":"groupBy","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"customHeight","type":"num","value":"10","ui":{"icon":"font-awesome/fa-align-justify","label":{"en-US":"height"},"type":"spinner","opts":{}}}],"color":"#3caa8e","inputLabels":["trigger"],"outputLabels":["table"],"icon":"font-awesome/fa-table","status":{"x":343,"y":34,"wires":[{"id":"6a2bfd9e.ce1944","port":0}]}},{"id":"f8262c22.ca30c","type":"subflow","name":"tableCallback","info":"","category":"myUI","in":[{"x":34,"y":85,"wires":[{"id":"38e848c.4a875b8"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"38e848c.4a875b8","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings"},{"name":"dataContext","type":"str","value":""}],"color":"#3caa8e","icon":"font-awesome/fa-database","status":{"x":343,"y":51,"wires":[{"id":"38e848c.4a875b8","port":0}]}},{"id":"65174702.902988","type":"subflow","name":"setValue","info":"","category":"myHome","in":[{"x":71,"y":85,"wires":[{"id":"f5750d2d.53017"}]}],"out":[{"x":411,"y":119,"wires":[{"id":"f5750d2d.53017","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings","ui":{"icon":"font-awesome/fa-globe","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"dataContext","type":"str","value":"heating.devices","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"datapointName","type":"str","value":"SET_TEMPERATURE","ui":{"icon":"font-awesome/fa-arrows-v","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"groupContext","type":"str","value":"heating.rooms","ui":{"icon":"font-awesome/fa-group","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"sourceKey","type":"str","value":"name","ui":{"icon":"font-awesome/fa-arrow-circle-right","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"targetKey","type":"str","value":"room","ui":{"icon":"font-awesome/fa-arrow-circle-left","type":"input","opts":{"types":["str","env"]},"label":{}}}],"color":"#3caa8e","icon":"font-awesome/fa-lightbulb-o","status":{"x":411,"y":51,"wires":[{"id":"f5750d2d.53017","port":0}]}},{"id":"288b8cb6.42ac94","type":"subflow","name":"preUI","info":"","category":"myHeating","in":[{"x":51,"y":85,"wires":[{"id":"f2614149.ecb88"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"f2614149.ecb88","port":1}]}],"env":[{"name":"datapoint","type":"str","value":"BOOST_STATE"}],"color":"#a1decf","icon":"node-red/timer.svg","status":{"x":343,"y":34,"wires":[{"id":"f2614149.ecb88","port":0}]}},{"id":"77ddfba9.23c614","type":"subflow","name":"postUI","info":"","category":"","in":[{"x":54,"y":85,"wires":[{"id":"374c9f22.55b41"}]}],"out":[{"x":326,"y":119,"wires":[{"id":"374c9f22.55b41","port":1}]},{"x":326,"y":170,"wires":[{"id":"374c9f22.55b41","port":2}]},{"x":326,"y":221,"wires":[{"id":"374c9f22.55b41","port":3}]}],"env":[{"name":"room","type":"str","value":"Dusche","ui":{"icon":"font-awesome/fa-bed","label":{"en-US":"Raum"},"type":"input","opts":{"types":["str","env"]}}},{"name":"datapoint","type":"str","value":"BOOST_MODE","ui":{"icon":"font-awesome/fa-bolt","type":"input","opts":{"types":["str","env"]}}},{"name":"topic","type":"str","value":"mySettings.heating.devices","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["str","env"]}}}],"color":"#a1decf","outputLabels":["toController","uiFeedback",""],"status":{"x":326,"y":68,"wires":[{"id":"374c9f22.55b41","port":0}]}},{"id":"bbf5d78f.c16998","type":"subflow","name":"filter Room","info":"","category":"myHome","in":[{"x":71,"y":85,"wires":[{"id":"40e23834.6b3c78"}]}],"out":[{"x":360,"y":119,"wires":[{"id":"40e23834.6b3c78","port":1}]}],"env":[{"name":"room","type":"str","value":"Arbeitszimmer","ui":{"icon":"font-awesome/fa-bed","type":"input","opts":{"types":["str","env"]},"label":{}}}],"color":"#3caa8e","status":{"x":360,"y":51,"wires":[{"id":"40e23834.6b3c78","port":0}]}},{"id":"459559af.3bd1b8","type":"subflow","name":"enableUI","info":"","category":"","in":[{"x":51,"y":85,"wires":[{"id":"5a59342e.f0f39c"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"5a59342e.f0f39c","port":1}]}],"env":[],"color":"#a1decf","icon":"font-awesome/fa-check-square-o","status":{"x":343,"y":51,"wires":[{"id":"5a59342e.f0f39c","port":0}]}},{"id":"653c3a89.08f864","type":"subflow","name":"fill ui-list","info":"","category":"","in":[{"x":88,"y":85,"wires":[{"id":"7d44685b.569b28"}]}],"out":[{"x":326,"y":119,"wires":[{"id":"7d44685b.569b28","port":1}]}],"env":[{"name":"groups","type":"str","value":"light.groups","ui":{"icon":"font-awesome/fa-object-ungroup","label":{"en-US":"Host"},"type":"input","opts":{"types":["str","env"]}}},{"name":"devProperty","type":"str","value":"groupMembers","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Property"},"type":"input","opts":{"types":["str","env"]}}},{"name":"listSources","type":"json","value":"[{\"type\":\"device\",\"source\":\"light.devices\",\"icon\":\"fa-lightbulb-o\"},{\"type\":\"group\",\"source\":\"light.groups\",\"icon\":\"fa-object-group\"}]","ui":{"icon":"font-awesome/fa-bars","label":{"en-US":"Sources"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#3caa8e","icon":"font-awesome/fa-align-justify","status":{"x":326,"y":51,"wires":[{"id":"7d44685b.569b28","port":0}]}},{"id":"274dc61a.3c17aa","type":"subflow","name":"groupSend","info":"","category":"myLights","in":[{"x":68,"y":85,"wires":[{"id":"b99ddb18.33f108"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"b99ddb18.33f108","port":1}]}],"env":[{"name":"devices","type":"str","value":"light.devices","ui":{"icon":"font-awesome/fa-lightbulb-o","label":{"en-US":"Devices"},"type":"input","opts":{"types":["str","env"]}}},{"name":"groupTopic","type":"str","value":"groups","ui":{"icon":"font-awesome/fa-tasks","label":{"en-US":"Group"},"type":"input","opts":{"types":["str","env"]}}},{"name":"groupMembers","type":"str","value":"groupMembers","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Group Property"},"type":"input","opts":{"types":["str","env"]}}},{"name":"sceneTopic","type":"str","value":"scenes","ui":{"icon":"font-awesome/fa-tasks","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"sceneMembers","type":"str","value":"sceneMembers","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Scene"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3caa8e","icon":"font-awesome/fa-object-group","status":{"x":343,"y":51,"wires":[{"id":"b99ddb18.33f108","port":0}]}},{"id":"33d1b88e.5b1368","type":"subflow","name":"saveChecklist","info":"# save data from ui-list node\n\n## decription\n\n - processes data from a ui-list note. \n - creates new objects in list on demand\n - delets unchecked objects\n - triggers uiUpdate\n\n## imput\n`msg.payload.uuid` | to identify changed item\n`msg.payload.isChecked` | create new objects if _true_\n | delete object if _false_\n\n## output\n#1 | standard message\n#2 | trigger to updateUI node","category":"myHome","in":[{"x":51,"y":85,"wires":[{"id":"5065a60e.ef53a8"}]}],"out":[{"x":394,"y":85,"wires":[{"id":"5065a60e.ef53a8","port":1}]},{"x":394,"y":136,"wires":[{"id":"5065a60e.ef53a8","port":2}]}],"env":[{"name":"defaults","type":"json","value":"","ui":{"icon":"font-awesome/fa-sliders","label":{"en-US":"Defaults"},"type":"input","opts":{"types":["json"]}}}],"color":"#3caa8e","inputLabels":["ui-List"],"outputLabels":["","update UI"],"status":{"x":394,"y":34,"wires":[{"id":"5065a60e.ef53a8","port":0}]}},{"id":"991e8cc1.0c169","type":"subflow","name":"validateList","info":"","category":"","in":[{"x":54,"y":119,"wires":[{"id":"642ac148.46602"}]}],"out":[{"x":292,"y":170,"wires":[{"id":"642ac148.46602","port":1}]}],"env":[{"name":"globalStore","type":"str","value":"mySettings","ui":{"icon":"font-awesome/fa-database","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"listObject","type":"str","value":"","ui":{"icon":"font-awesome/fa-align-justify","label":{"en-US":"List"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"targetObject","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Target"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#DDAA99","status":{"x":292,"y":68,"wires":[{"id":"642ac148.46602","port":0}]}},{"id":"868280d8.dfda9","type":"subflow","name":"saveUiControl","info":"# save uiControl setting\n\n## description\nthis subflow saves settings to flow context store+\n\n## properties\n - `uiName` enter the name of the ui node to load the ui_control objects if available\n - `maxRows` default values for maximum Rows to be stored in context (defaults to 100 if empty)\n - `tempColumnOrder` true if column order should obly \"per session\"\n - `filterProperty` property to filter. A list of possible options will be sent on 2nd output\n - `context` json string configuring where to store the data:\n\n```\n {\n     \"storeName\": \"uiControl\",\n     \"storeProvider\": \"file\",\n     \"storeTempName\": \"uiControlTemp\"\n }\n```\n\n## input\n\n - msg Object containing data provided by dashboard nodes\n - `msg.ui_control.callback` messages for ui-table\n\n## output\n\n - passes msg object\n","category":"","in":[{"x":37,"y":119,"wires":[{"id":"f1ca2f97.e3436"}]}],"out":[{"x":360,"y":119,"wires":[{"id":"f1ca2f97.e3436","port":1}]},{"x":360,"y":187,"wires":[{"id":"f1ca2f97.e3436","port":2}]}],"env":[{"name":"uiNode","type":"str","value":"","ui":{"icon":"font-awesome/fa-mouse-pointer","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"maxRowLines","type":"str","value":"100","ui":{"icon":"font-awesome/fa-sort-numeric-asc","label":{"en-US":"maxRows"},"type":"input","opts":{"types":["str","env"]}}},{"name":"tempColumnOrder","type":"bool","value":"false","ui":{"icon":"font-awesome/fa-sort-amount-asc","label":{"en-US":"tempOrder"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"filterProperty","type":"str","value":"hostname","ui":{"icon":"font-awesome/fa-filter","label":{"en-US":"Filter"},"type":"input","opts":{"types":["str","env"]}}},{"name":"context","type":"json","value":"{\"storeName\":\"uiControl\",\"storeProvider\":\"file\",\"storeTempName\":\"uiControlTemp\"}","ui":{"icon":"font-awesome/fa-database","label":{"en-US":"Context"},"type":"input","opts":{"types":["json","env"]}}}],"color":"#3FADB5","icon":"font-awesome/fa-database","status":{"x":360,"y":51,"wires":[{"id":"f1ca2f97.e3436","port":0}]}},{"id":"e8fd2fc9.509e","type":"subflow","name":"loadUiControl","info":"# load uiControl setting\n\n## description\nthis subflow loads default settings defined in the subflow properties and adds runtime settings stored by the saveUiControl subflow\n\nit uses settings for individual ip adrsses if possible and usefull\n\n## properties\n - `uiName` enter the name of the ui node to load the ui_control objects if available\n - `ui_Control` default values for `ui_control` object\n - `Table` name of the dashboard tab. if provided it only send messages to dashboard nodes if tab is opened. if empty it will update when a new client connects\n - `Context` json string configuring where to store the data:\n\n```\n {\n     \"storeName\": \"uiControl\",\n     \"storeProvider\": \"file\",\n     \"storeTempName\": \"uiControlTemp\"\n }\n```\n\n \n## input\n\nconnect a ui control node to initalize ui node if a client connects\n\nconnect dashboard nodes if you like to store settings\n\n## output\n\n - passes msg object\n - Adds ui_control default object\n - Adds stored settings if available\n - Adds tableData if available\n \non the second output it send `msg.state` **\"online\"** or **\"offline\"** depending if the table is visible or not. Link to your formating function to bypass ui-table and store messages instead.\n","category":"","in":[{"x":54,"y":153,"wires":[{"id":"f7b608bf.20f908"}]}],"out":[{"x":360,"y":119,"wires":[{"id":"f7b608bf.20f908","port":1}]},{"x":360,"y":187,"wires":[{"id":"f7b608bf.20f908","port":2}]},{"x":360,"y":255,"wires":[{"id":"f7b608bf.20f908","port":3}]}],"env":[{"name":"uiNode","type":"str","value":"","ui":{"icon":"font-awesome/fa-mouse-pointer","type":"input","opts":{"types":["str","env"]}}},{"name":"ui_control","type":"json","value":"","ui":{"icon":"font-awesome/fa-arrow-circle-right","type":"input","opts":{"types":["json"]}}},{"name":"tabName","type":"str","value":"","ui":{"icon":"font-awesome/fa-file-o","label":{"en-US":"Table"},"type":"input","opts":{"types":["str","env"]}}},{"name":"context","type":"json","value":"{\"storeName\":\"uiControl\",\"storeProvider\":\"file\",\"storeTempName\":\"uiControlTemp\"}","ui":{"icon":"font-awesome/fa-database","label":{"en-US":"Context"},"type":"input","opts":{"types":["json","env"]}}},{"name":"tempColumnOrder","type":"bool","value":"false","ui":{"icon":"font-awesome/fa-sort-amount-asc","label":{"en-US":"tempOrder"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"maxDisplayLines","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-sort-numeric-asc","label":{"en-US":"maxDisplay"},"type":"input","opts":{"types":["num","env"]}}}],"color":"#3FADB5","icon":"font-awesome/fa-database","status":{"x":360,"y":51,"wires":[{"id":"f7b608bf.20f908","port":0}]}},{"id":"6389f524.8a4e3c","type":"mqtt-broker","z":"","name":"lol-server","broker":"192.168.2.14","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3840d6b5.4291da","type":"homie-convention-broker-config","z":"","mqtt-host":"192.168.2.14","mqtt-port":"1883","name":"mosquitto@home","homieName":"Node-RED","homieRoot":"homie","storeGlobal":true},{"id":"e6a23911.f60378","type":"homie-convention-broker-config","z":"","mqtt-host":"AH-BERLIN-0148","mqtt-port":"8883","name":"localhost@hp-spectre-360","homieName":"Node-RED","homieRoot":"homie","storeGlobal":true},{"id":"24d8d6bd.a1ea4a","type":"ui_tab","z":"","name":"Homie Test","icon":"dashboard","order":11,"disabled":false,"hidden":false},{"id":"8f5ef88a.50ced8","type":"ui_group","z":"","name":"[any] device & [any] node","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"21cf364a.624f6a","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":5,"cy":5,"px":2,"py":2}}},{"id":"2e70a2b0.61ff8e","type":"ui_group","z":"","name":"$datatype=enum","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"6aae0b37.682c24","type":"ui_group","z":"","name":"Bulb 02","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"e36cc654.810d88","type":"ui_group","z":"","name":"Bulb 01","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"33bced7f.d78002","type":"ui_group","z":"","name":"$datatype=float","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"306569d5.649c16","type":"ui_group","z":"","name":"Programm","tab":"831d491a.c7a7e8","order":1,"disp":true,"width":12,"collapse":true},{"id":"3e5d4543.e67aaa","type":"ui_group","z":"","name":"Räume","tab":"831d491a.c7a7e8","order":2,"disp":true,"width":"8","collapse":true},{"id":"831d491a.c7a7e8","type":"ui_tab","z":"","name":"Heizung","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"4ac97505.03ae4c","type":"ui_group","z":"","name":"Wochentage","tab":"831d491a.c7a7e8","order":4,"disp":true,"width":"8","collapse":true},{"id":"1727a207.b3522e","type":"ui_group","z":"","name":"Zeitabschnitt","tab":"831d491a.c7a7e8","order":3,"disp":true,"width":"8","collapse":false},{"id":"450f9708.9afe08","type":"ui_tab","z":"","name":"ui_Test","icon":"dashboard","order":9,"disabled":false,"hidden":false},{"id":"d11141a.b59afc","type":"ui_group","z":"","name":"Test Period","tab":"450f9708.9afe08","disp":true,"width":"8","collapse":false},{"id":"160939b7.e94c96","type":"ui_tab","z":"","name":"Worldmap","icon":"pin_drop","order":6,"disabled":false,"hidden":false},{"id":"234ff31e.1bc3cc","type":"ui_group","z":"","name":"Map","tab":"160939b7.e94c96","disp":false,"width":"15","collapse":false},{"id":"7ef5ea17.178a64","type":"mqtt-broker","z":"","name":"ah-berlin-0148","broker":"ah-berlin-0148","port":"8883","tls":"224962c.03df19e","clientid":"","usetls":true,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"50ef20f5.7d4f8","type":"ui_group","z":"","name":"uptime","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"571ba74f.fd87f8","type":"ui_tab","z":"","name":"Homie debug","icon":"dashboard","order":10,"disabled":false,"hidden":false},{"id":"61b56b5f.f16754","type":"ui_group","z":"","name":"debug","tab":"571ba74f.fd87f8","disp":true,"width":"6","collapse":false},{"id":"9ce06846.951a68","type":"ui_group","z":"","name":"Arbeitszimmer","tab":"61a83671.30e428","order":1,"disp":false,"width":"8","collapse":false},{"id":"dcd63e8.d157fc","type":"ccu-connection","z":"","d":true,"name":"ccu2","host":"192.168.2.5","regaEnabled":true,"bcrfEnabled":true,"iprfEnabled":true,"virtEnabled":false,"bcwiEnabled":false,"cuxdEnabled":false,"regaPoll":false,"regaInterval":"30","rpcPingTimeout":"60","rpcInitAddress":"","rpcServerHost":"192.168.2.14","rpcBinPort":"2059","rpcXmlPort":"2060","queueTimeout":"5000","queuePause":"250","contextStore":"file"},{"id":"e1cac84f.fefdd8","type":"ui_group","z":"","name":"Thermostate","tab":"7a65a7c7.108478","order":2,"disp":true,"width":"15","collapse":true},{"id":"b353f4cb.6e6ff8","type":"ui_spacer","name":"spacer","group":"306569d5.649c16","order":3,"width":2,"height":1},{"id":"d9f713b7.8622a","type":"ui_spacer","name":"spacer","group":"306569d5.649c16","order":6,"width":2,"height":1},{"id":"3e1c95a4.0e104a","type":"ui_tab","z":"","name":"Lights","icon":"lightbulb_outline","order":12,"disabled":false,"hidden":false},{"id":"c04d8bda.8dad98","type":"ui_group","z":"","name":"Leuchten","tab":"3e1c95a4.0e104a","disp":true,"width":"8","collapse":true},{"id":"ceeb11f0.8bfba","type":"ui_group","z":"","name":"Gruppen","tab":"3e1c95a4.0e104a","disp":true,"width":"8","collapse":false},{"id":"6a28c45b.c2fe1c","type":"ui_group","z":"","name":"Szenen","tab":"3e1c95a4.0e104a","disp":true,"width":"8","collapse":false},{"id":"7e22101c.03087","type":"ui_group","z":"","name":"Arbeitszimmer","tab":"61a83671.30e428","order":2,"disp":true,"width":"7","collapse":true},{"id":"370a54c3.841eac","type":"ui_spacer","name":"spacer","group":"c04d8bda.8dad98","order":16,"width":4,"height":1},{"id":"5f00499d.f4add8","type":"ui_spacer","name":"spacer","group":"ceeb11f0.8bfba","order":8,"width":4,"height":1},{"id":"3a14f0a5.039ee","type":"ui_spacer","name":"spacer","group":"6a28c45b.c2fe1c","order":12,"width":4,"height":1},{"id":"78ce343c.3cb0cc","type":"ui_spacer","name":"spacer","group":"6a28c45b.c2fe1c","order":29,"width":4,"height":1},{"id":"cde25ae.eff1aa8","type":"ui_group","z":"","name":"Wohnzimmer","tab":"bbb7e304.9ef9e","order":1,"disp":true,"width":"7","collapse":false},{"id":"690fd1cc.b1b87","type":"ui_spacer","name":"spacer","group":"7e22101c.03087","order":4,"width":3,"height":1},{"id":"7341c8b3.0e9088","type":"ui_spacer","name":"spacer","group":"cde25ae.eff1aa8","order":4,"width":3,"height":1},{"id":"97f7df1d.bb18a","type":"tls-config","z":"","name":"1st Test","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"ca.crt","servername":"AH-BERLIN-0148","verifyservercert":true},{"id":"224962c.03df19e","type":"tls-config","z":"","name":"Localhost ca.crt","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"ca.crt","servername":"ah-berlin-0148","verifyservercert":false},{"id":"51ce6aa1.620754","type":"ui_group","z":"","name":"Syslog Server","tab":"7653f2c6.4b174c","order":1,"disp":true,"width":"22","collapse":false},{"id":"37eeda5a.799966","type":"ui_group","z":"","name":"Switch","tab":"24d8d6bd.a1ea4a","disp":true,"width":"6","collapse":false},{"id":"1b90cb05.60c0a5","type":"ui_group","z":"","name":"Sonne","tab":"23f4d58e.4acb7a","order":4,"disp":false,"width":"7","collapse":false},{"id":"43e7dd36.28fbe4","type":"ui_group","z":"","name":"Pumpe","tab":"23f4d58e.4acb7a","order":7,"disp":false,"width":"7","collapse":false},{"id":"5ffa92f6.040b6c","type":"ui_group","z":"","name":"Gewächshaus","tab":"23f4d58e.4acb7a","order":1,"disp":false,"width":"7","collapse":false},{"id":"763687d.660d278","type":"ui_group","z":"","name":"Energie Chart","tab":"97c2c784.50f0a8","order":6,"disp":true,"width":"8","collapse":true},{"id":"9ee1b18d.51ece","type":"ui_group","z":"","name":"Boden","tab":"23f4d58e.4acb7a","order":2,"disp":false,"width":"8","collapse":false},{"id":"4723b9bd.fb3598","type":"ui_group","z":"","name":"Regen","tab":"23f4d58e.4acb7a","order":3,"disp":false,"width":"8","collapse":false},{"id":"fa42e847.06d618","type":"ui_group","z":"","name":"Teich","tab":"23f4d58e.4acb7a","order":5,"disp":true,"width":"8","collapse":false},{"id":"1f012f45.a13f31","type":"homekit-bridge","z":"5b6fa421.88b5bc","bridgeName":"myBridge","pinCode":"111-11-111","port":"","allowInsecureRequest":false,"manufacturer":"Default Manufacturer","model":"Default Model","serialNo":"Default Serial Number","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true},{"id":"23f4d58e.4acb7a","type":"ui_tab","z":"","name":"Garten","icon":"dashboard","order":8,"disabled":false,"hidden":false},{"id":"ad62250a.2e3ba8","type":"influxdb","z":"833d7b75.5dd878","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"openhab","name":"Openhab","usetls":false,"tls":""},{"id":"30064ba2.1a2874","type":"influxdb","z":"","hostname":"192.168.2.14","port":"8086","protocol":"http","database":"openhab","name":"","usetls":false,"tls":"97f7df1d.bb18a"},{"id":"61a83671.30e428","type":"ui_tab","z":"","name":"Arbeitszimmer","icon":"desktop_mac","order":1,"disabled":false,"hidden":false},{"id":"7a65a7c7.108478","type":"ui_tab","z":"","name":"Thermostate","icon":"fa-thermometer-half ","order":5,"disabled":false,"hidden":false},{"id":"bbb7e304.9ef9e","type":"ui_tab","z":"","name":"Wohnzimmer","icon":"music_video","order":4,"disabled":false,"hidden":false},{"id":"97c2c784.50f0a8","type":"ui_tab","z":"","name":"Energie","icon":"power","order":13,"disabled":false,"hidden":false},{"id":"9e9264f6.16e7e8","type":"ui_tab","z":"","name":"Home","icon":"track_changes","order":3,"disabled":false,"hidden":false},{"id":"7653f2c6.4b174c","type":"ui_tab","z":"","name":"ui-table example","icon":"table","order":14,"disabled":false,"hidden":false},{"id":"fe4aa0cd.8767f","type":"ui_tab","z":"","name":"ui-table demo","icon":"dashboard","order":15,"disabled":true,"hidden":false},{"id":"86d6c4d3.f4e698","type":"ui_group","z":"","name":"ui-table demo","tab":"fe4aa0cd.8767f","disp":true,"width":"6","collapse":false},{"id":"c8b19aad.8fb698","type":"ui_tab","z":"","name":"Esszimmer","icon":"fa-cutlery","order":2,"disabled":false,"hidden":false},{"id":"dad2c6ff.66acf8","type":"ui_group","z":"","name":"Weihnachtsbaum","tab":"c8b19aad.8fb698","disp":true,"width":"7","collapse":false},{"id":"9914a8a8.6c95e8","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"[any]","propertyID":"rssi","topic":"[any]/[any]/rssi","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":165,"y":544,"wires":[["1f89b01d.03705","973ff9a3.1c5b98"],[]]},{"id":"973ff9a3.1c5b98","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":510,"y":569,"wires":[]},{"id":"1f89b01d.03705","type":"ui_chart","z":"833d7b75.5dd878","name":"","group":"8f5ef88a.50ced8","order":1,"width":0,"height":0,"label":"RSSI","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":510,"y":529,"wires":[[]]},{"id":"80476272.93daa","type":"ui_dropdown","z":"833d7b75.5dd878","name":"","label":"","tooltip":"","place":"Select option","group":"2e70a2b0.61ff8e","order":2,"width":"10","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":927,"y":544,"wires":[[]]},{"id":"a83a2a4.90993d8","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"Bewaesserung-3","nodeID":"BME280","propertyID":"Temperature","topic":"Bewaesserung-3/BME280/Temperature","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"mame","labelTopic":false,"labelPayload":false,"labelName":"Custom Label","uiPlaceName":"Select Valve","uiNode":"uiText","uiControlDropdown":true,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":true,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":228,"y":833,"wires":[["554b2339.dac8fc","8f16b001.58fb"],["b9501903.8a5e98"]]},{"id":"554b2339.dac8fc","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":510,"y":840,"wires":[]},{"id":"331b158d.5a539a","type":"ui_text","z":"833d7b75.5dd878","group":"2e70a2b0.61ff8e","order":1,"width":"4","height":"1","name":"Label","label":"{{msg.property}}","format":"","layout":"row-spread","x":917,"y":510,"wires":[]},{"id":"a7718823.ea4a38","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-01","nodeID":"Bulb","propertyID":"switch","topic":"RGBW-Bulb-01/Bulb/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Switch","uiPlaceName":"","uiNode":"uiButtonSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#4eba1f","uiColorOFF":"#f33f3f","uiColorPredicted":"#20791e","uiUseColorPredicted":true,"uiColorPredictedOff":"#9b2424","uiUseColorPredictedOff":true,"uiFormat":false,"uiTooltip":"3 state Button as Switch (off - predicted - on - predicted - off)","uiIcon1":"fa-bolt","uiIconON":"fa-lightbulb-o","uiIconOFF":"fa-bolt","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":true,"x":239,"y":1547,"wires":[["fbd87771.0d8828","f709fbe6.8bcbe8"],[]]},{"id":"fbd87771.0d8828","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":1547,"wires":[]},{"id":"7cc5fc41.5b94f4","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":679,"y":1479,"wires":[]},{"id":"f709fbe6.8bcbe8","type":"ui_button","z":"833d7b75.5dd878","name":"","group":"e36cc654.810d88","order":1,"width":"7","height":"1","passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"","payload":"","payloadType":"str","topic":"","x":509,"y":1479,"wires":[["7cc5fc41.5b94f4","a7718823.ea4a38"]]},{"id":"79a8da8c.382984","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-02","nodeID":"Bulb","propertyID":"dimmer","topic":"RGBW-Bulb-02/Bulb/dimmer","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Dimmer","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","settable":true,"x":239,"y":1241,"wires":[["e62cb7fb.c742e8","53ecce0d.af71b"],[]]},{"id":"53ecce0d.af71b","type":"ui_slider","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","tooltip":"","group":"6aae0b37.682c24","order":4,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":10,"step":1,"x":509,"y":1173,"wires":[["f305a68d.980598","79a8da8c.382984"]]},{"id":"e62cb7fb.c742e8","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":1241,"wires":[]},{"id":"f305a68d.980598","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":679,"y":1173,"wires":[]},{"id":"9d86a20c.f6cd2","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-01","nodeID":"Bulb","propertyID":"eventHSV","topic":"RGBW-Bulb-01/Bulb/eventHSV","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Light Color","uiPlaceName":"","uiNode":"uiColor","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":true,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"nodeRedObject","settable":false,"x":249,"y":1785,"wires":[["246560a9.8196","e2840e78.b783c"],[]]},{"id":"246560a9.8196","type":"ui_colour_picker","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","group":"e36cc654.810d88","format":"hsv","outformat":"object","showSwatch":true,"showPicker":true,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":4,"width":"10","height":"1","passthru":false,"topic":"","x":529,"y":1717,"wires":[["9d86a20c.f6cd2"]]},{"id":"fe5b1dd3.7804d","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"ESP_Homie_Test","nodeID":"BME280","propertyID":"Temperature","topic":"ESP_Homie_Test/BME280/Temperature","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"BME280 Temp","uiPlaceName":"","uiNode":"uiText","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":true,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":true,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","settable":false,"x":240,"y":2200,"wires":[["3792c830.e9a628","2da37b44.05e694"],["d127042f.2ef948"]]},{"id":"3792c830.e9a628","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":510,"y":2200,"wires":[]},{"id":"2da37b44.05e694","type":"ui_text","z":"833d7b75.5dd878","group":"33bced7f.d78002","order":1,"width":0,"height":0,"name":"","label":"{{msg.label}}","format":"{{msg.payload}} °C","layout":"row-spread","x":510,"y":2160,"wires":[]},{"id":"811cdd9.977c92","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"System_Info","propertyID":"freeheap","topic":"[any]/System_Info/freeheap","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":200,"y":660,"wires":[["333f3981.18f326","fb0894d9.a1b7f8"],[]]},{"id":"fb0894d9.a1b7f8","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":510,"y":680,"wires":[]},{"id":"333f3981.18f326","type":"ui_chart","z":"833d7b75.5dd878","name":"","group":"8f5ef88a.50ced8","order":1,"width":0,"height":0,"label":"Free Stack","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":530,"y":640,"wires":[[]]},{"id":"5292e96.5be9f18","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-01","nodeID":"Bulb","propertyID":"dimmer","topic":"RGBW-Bulb-01/Bulb/dimmer","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"2nd Bulb","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","settable":true,"x":239,"y":1666,"wires":[["24f5355c.c2541a","c37b907f.61923"],[]]},{"id":"24f5355c.c2541a","type":"ui_slider","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","tooltip":"","group":"e36cc654.810d88","order":3,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":10,"step":1,"x":509,"y":1598,"wires":[["5292e96.5be9f18"]]},{"id":"b9c07e15.72b63","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-02","nodeID":"Bulb","propertyID":"switch","topic":"RGBW-Bulb-02/Bulb/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Switch","uiPlaceName":"","uiNode":"uiButtonSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#66dd33","uiColorOFF":"#f33f3f","uiColorPredicted":"#20791e","uiUseColorPredicted":true,"uiColorPredictedOff":"#9b2424","uiUseColorPredictedOff":true,"uiFormat":false,"uiTooltip":"3 state Button as Switch (off - predicted - on - predicted - off)","uiIcon1":"fa-bolt","uiIconON":"fa-lightbulb-o","uiIconOFF":"fa-bolt","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":true,"x":239,"y":1122,"wires":[["5bb67a31.216244","fff82904.260238"],[]]},{"id":"fff82904.260238","type":"ui_button","z":"833d7b75.5dd878","name":"","group":"6aae0b37.682c24","order":1,"width":"7","height":"1","passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"","payload":"","payloadType":"str","topic":"","x":509,"y":1054,"wires":[["b9c07e15.72b63","ee4926a1.436498"]]},{"id":"5bb67a31.216244","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":512,"y":1122,"wires":[]},{"id":"ee4926a1.436498","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":679,"y":1054,"wires":[]},{"id":"1b262c23.00dc14","type":"ui_button","z":"afaa0885.ad2718","name":"zurück","group":"306569d5.649c16","order":10,"width":1,"height":1,"passthru":false,"label":"","tooltip":"vorheriger Zeitpunkt","color":"","bgcolor":"","icon":"chevron_left","payload":"-1","payloadType":"num","topic":"mySettings.heating.periods.uiBack","x":186,"y":884,"wires":[["121f0029.37417"]]},{"id":"ccd7c6ba.ed0be8","type":"ui_button","z":"afaa0885.ad2718","name":"vor","group":"306569d5.649c16","order":11,"width":1,"height":1,"passthru":false,"label":"","tooltip":"nächster Zeitpunkt","color":"","bgcolor":"","icon":"chevron_right","payload":"1","payloadType":"num","topic":"mySettings.heating.periods.uiForward","x":186,"y":935,"wires":[["121f0029.37417"]]},{"id":"1c7f5200.379bae","type":"ui_numeric","z":"afaa0885.ad2718","name":"temp","label":"","tooltip":"","group":"306569d5.649c16","order":8,"width":2,"height":1,"wrap":false,"passthru":false,"topic":"mySettings.heating.periods.uiTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":220,"y":714,"wires":[["a7992ce4.43c1b","57ad0440.5441cc"]]},{"id":"57ad0440.5441cc","type":"ui_slider","z":"afaa0885.ad2718","name":"temp","label":"","tooltip":"","group":"306569d5.649c16","order":9,"width":2,"height":7,"passthru":false,"outs":"all","topic":"mySettings.heating.periods.uiTemp","min":"10","max":"32","step":"0.5","x":220,"y":663,"wires":[["a7992ce4.43c1b","1c7f5200.379bae"]]},{"id":"5268d302.225c3c","type":"ui_chart","z":"afaa0885.ad2718","name":"","group":"306569d5.649c16","order":7,"width":10,"height":8,"label":"{{msg.label}}","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#bc165c","#4bc2ef","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1206,"y":544,"wires":[["7d726f92.5ad68"]]},{"id":"dda96c22.e479b","type":"ui_dropdown","z":"afaa0885.ad2718","name":"Tag","label":"","tooltip":"","place":"Periode auswählen","group":"306569d5.649c16","order":5,"width":8,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.heating.periods.uiList","x":509,"y":391,"wires":[["f16908b5.8911a8"]]},{"id":"3deb5b65.175bc4","type":"ui_dropdown","z":"afaa0885.ad2718","name":"roomList","label":"","tooltip":"","place":"Raum auswählen","group":"306569d5.649c16","order":2,"width":8,"height":1,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"mySettings.heating.rooms.uiRoomList","x":519,"y":323,"wires":[["5c233d43.925de4"]]},{"id":"e3464ffd.e30ce","type":"ui_button","z":"afaa0885.ad2718","name":"delete","group":"306569d5.649c16","order":15,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"","payloadType":"str","topic":"mySettings.heating.periods.uiDelete","x":186,"y":833,"wires":[["f1c74f66.718cc"]]},{"id":"5fdcdfed.62831","type":"function","z":"afaa0885.ad2718","name":"room changed","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled]\n\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature curves\"};\ncUI=cUI.tempCurveEdit;\n\ncUI.roomUuid=msg.payload;\nnode.warn(msg.pathToRooms)\ncUI.roomsEntry=currentObject.getEntry(msg.pathToRooms,msg.payload);\nnode.warn(msg.topic)\ncUI.roomEntry=currentObject.getEntry(msg.topic,cUI.roomsEntry.uuid,\"roomUuid\");\nif (!cUI.roomEntry) { // room not in List\n    cUI.roomEntry=currentObject.newEntry(msg.topic,cUI.roomsEntry.name);\n    cUI.roomEntry.roomUuid=cUI.roomsEntry.uuid;\n}\n\nif (cUI.period === undefined) cUI.period=0;\nmsg.payload= cUI.period;\n\nif (cUI.roomEntry) {\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomEntry.name});\n    msg.enabled= true;\n    return [msg,ui.enabled];\n} else {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n    return[null,ui.disabled];\n}\n","outputs":2,"noerr":0,"x":879,"y":323,"wires":[["dda96c22.e479b"],[]],"outputLabels":["DayOfWeek","enabled"]},{"id":"b86b21db.c2b68","type":"function","z":"afaa0885.ad2718","name":"update chart","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload=== undefined) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nvar statusText = \"\"\nif (cUI.chart===undefined)\n    cUI.chart = [{\n    \"series\":[\"soll\",\"\",\"\"],\n    \"data\":[[],[],[]],\n    \"labels\":[\"soll\",\"cursor\",\"standard\"]\n    }];\n\nstatusText+= cUI.roomEntry.name;\nnode.status({fill:\"red\",shape:\"ring\",text:statusText});\nvar timeStamp = 0; //new Date();\nvar temp=0;\nvar time=0;\nvar timeBefore=0;\n\n// timeStamp.setHours(0,0,0);\n\nif (cUI.roomEntry && \n    cUI.periodEntry &&\n    cUI.periodEntry.list &&\n    cUI.periodEntry.list.length>0) {\n        \n    statusText+= \":\"+cUI.periodsEntry.name;\n    //sort periods by time\n    if (cUI.periodEntry.list!==undefined) {\n        cUI.periodEntry.list.sort(function(a,b) {\n            if (a.time > b.time) return 1;\n            if (a.time < b.time) return -1;\n            return 0;\n        });\n    }\n    \n    // write time array for chart\n    cUI.chart[0].data[1]=[];\n    cUI.periodEntry.list.forEach(function (period) {\n        temp=period.temp;\n        cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(timeBefore*60*1000),\"y\":temp}));\n        time=Number(period.time);\n        cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp}));\n        timeBefore=time;\n    });\n    \n    temp= cUI.periodEntry.list[0].temp;\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp,\"note\":\"end\"}));\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":temp,\"note\":\"end\"}));\n  \n    // draw default temp\n    try{\n        cUI.chart[0].data[2]=[]; // clear old data\n        cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n        cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    } catch (err) {\n        statusText+=\" no default temp\"\n        node.status({fill:\"red\",shape:\"ring\",text:statusText}); \n        return;\n    }\n    \n} else {\n    statusText+= \" no settings\";\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    node.status({fill:\"red\",shape:\"dot\",text:statusText}); \n    msg.payload = cUI.chart;\n    return msg;\n}\nmsg.payload = cUI.chart;\nmsg.label= cUI.roomEntry.name;\nvar msgUpdate={\n    \"payload\": \"update\",\n    \"room\": cUI.roomEntry.name,\n    \"period\": cUI.periodsEntry.name\n}\n\n\nnode.status({fill:\"green\",shape:\"dot\",text:statusText}); \nreturn [msgUpdate,msg];","outputs":2,"noerr":0,"x":801,"y":544,"wires":[["974d4be9.b36dd8"],["47938a1d.dadc94"]],"outputLabels":["update","toCursor"],"icon":"node-red-dashboard/ui_chart.png"},{"id":"47938a1d.dadc94","type":"function","z":"afaa0885.ad2718","name":"draw cursor","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled,ui.disabled]\n}\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) return [null,ui.disabled,ui.disabled];\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nif (typeof msg.payload != \"object\") cUI.tempPoint=Number(msg.payload);\nvar statusText= cUI.roomEntry.name;\nnode.status({fill:\"red\",shape:\"ring\",text:statusText});\nif (!cUI.roomEntry.name) return null;\nvar temp=0;\nvar tempB=0;\nvar timeA=0;\nvar timeB=0;\nvar msgEnablePrev={\"enabled\":false};\nvar msgEnableNext={\"enabled\":false};\nvar msgEnableDelete={\"enabled\":false};\n\nstatusText+= \":\"+cUI.periodsEntry.name+\":\"+cUI.tempPoint;\nnode.status({fill:\"yellow\",shape:\"ring\",text:statusText});\n\n// find cursor values\ntemp=cUI.periodEntry.list[cUI.tempPoint].temp;\nif (cUI.tempPoint===0) { // first\n    timeA=0;\n    timeB=cUI.periodEntry.list[cUI.tempPoint].time;\n    if (cUI.periodEntry.list[cUI.tempPoint+1]) \n        tempB=cUI.periodEntry.list[cUI.tempPoint+1].temp;\n    else \n        tempB=temp;\n} else if (cUI.tempPoint<cUI.periodEntry.list.length-1) {\n    if (cUI.tempPoint>0)\n        timeA=cUI.periodEntry.list[cUI.tempPoint-1].time;\n    else\n        timeA=0;\n    timeB=cUI.periodEntry.list[cUI.tempPoint].time;\n    tempB=cUI.periodEntry.list[cUI.tempPoint+1].temp;\n} else {\n    timeA=cUI.periodEntry.list[cUI.tempPoint-1].time;\n    timeB=cUI.periodEntry.list[cUI.tempPoint].time;\n    tempB=cUI.periodEntry.list[0].temp;\n}\n\n// control UI elements enabale/disable\nif (cUI.tempPoint>0) msgEnablePrev=ui.enabled;\nif (cUI.tempPoint<cUI.periodEntry.list.length-1) msgEnableNext= ui.enabled;\nif (cUI.periodEntry.list.length>1) msgEnableDelete= ui.enabled;\n\n// draw cursor\ncUI.chart[0].data[0]=[];\nnode.status({fill:\"yellow\",shape:\"dot\",text:\"debug:\"+statusText}); \n\ncUI.chart[0].data[0].push(currentObject.adjustTime(-1,{\"x\":(timeA*60*1000),\"y\":temp,\"note\":\"cursorA\"}));\ncUI.chart[0].data[0].push(currentObject.adjustTime(-1,{\"x\":(timeB*60*1000),\"y\":temp,\"note\":\"cursorB\"}));\nif (tempB>0) cUI.chart[0].data[0].push(currentObject.adjustTime(-1,{\"x\":(timeB*60*1000),\"y\":tempB,\"note\":\"cursorC\"}));\nmsg.payload = cUI.chart;\n\nnode.status({fill:\"green\",shape:\"dot\",text:statusText}); \nreturn [msg,msgEnablePrev,msgEnableNext,msgEnableDelete];\n","outputs":4,"noerr":0,"x":801,"y":663,"wires":[["5136c3e.e30683c"],["d899ded4.f9dff"],["52fc0b87.338624"],["e2233c7d.53701"]],"outputLabels":["","enablePrev","enableNext","enableDelete"],"icon":"node-red-dashboard/ui_chart.png"},{"id":"d4a83ce3.99bc7","type":"function","z":"afaa0885.ad2718","name":"update","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"expect cursor pos as payload\"});\n    return [null,ui.disabled];\n}\n\nif (!msg.settingsContext) msg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature curves\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry{\n    var msgOut = {\"topic\":msg.topic,\"socketid\":msg.socketid,\"settingsContext\":msg.settingsContext}; // create new message because it will be cloned (split of paths)\n\n    if (cUI.tempPoint>cUI.periodEntry.list.length-1) cUI.tempPoint=cUI.periodEntry.list.length-1;\n    msgOut.payload=cUI.tempPoint;\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomEntry.name+\"/\"+cUI.periodEntry.name+\" (\"+ cUI.tempPoint +\"/\"+ (cUI.periodEntry.list.length-1) +\")\"});\n    return [msgOut,ui.enabled];\n}\ncatch (err) {\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"no periods defined\"});\n}","outputs":1,"noerr":0,"x":577,"y":782,"wires":[["b86b21db.c2b68","a70c51b5.99fd4","aa4dedd.2c2011"]]},{"id":"aa4dedd.2c2011","type":"function","z":"afaa0885.ad2718","name":"updateTemp","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled];\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) return null;\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry {\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n\n    msg.payload= currentEntry.temp;\n    msg.ui_control={\"min\":cUI.roomsEntry.minTemp,\"max\":cUI.roomsEntry.maxTemp};\n\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.periodEntry.name+\"=\"+currentEntry.temp+\" °C\"});\n    return msg;\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"updateTemp failed (\"+cUI.tempPoint+\")\"});\n    node.error(\"updateTemp failed\")\n}","outputs":1,"noerr":0,"x":801,"y":833,"wires":[["3276e425.a62e7c"]]},{"id":"121f0029.37417","type":"function","z":"afaa0885.ad2718","name":"move cursor","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\n\ntry{\n    cUI.tempPoint=cUI.tempPoint+Number(msg.payload);\n    if (cUI.tempPoint<0) \n        cUI.tempPoint=0;\n    if (cUI.tempPoint>cUI.periodEntry.list.length-1)\n        cUI.tempPoint=cUI.periodEntry.list.length-1\n    msg.payload=cUI.tempPoint;\n    node.status({fill:\"green\",shape:\"dot\",text:\"move to pos=\"+cUI.tempPoint});\n    return msg;\n} catch (err) {\n    node.error(\"moveCursor failed\");\n    node.status({fill:\"red\",shape:\"dot\",text:\"moveCursor failed\"});\n}","outputs":1,"noerr":0,"x":359,"y":884,"wires":[["d4a83ce3.99bc7"]]},{"id":"f9d7b245.0bff4","type":"link in","z":"afaa0885.ad2718","name":"uiDelete","links":["e2233c7d.53701","fc5cf126.b689a"],"x":100,"y":833,"wires":[["e3464ffd.e30ce"]]},{"id":"a70c51b5.99fd4","type":"function","z":"afaa0885.ad2718","name":"updateTime","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return null;\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) return null;\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry {\n    var timeBefore=0;\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint-1)\n    if (currentEntry) timeBefore= currentEntry.time || 0;\n\n    var timeNext=1440;\n    currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint+1)\n    if (currentEntry) timeNext= currentEntry.time || 1440;\n    \n    currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint)\n\n    if (currentEntry) {\n        msg.payload= currentEntry.time;\n        msg.ui_control={min: timeBefore, max: timeNext};\n    \n        node.status({fill:\"green\",shape:\"dot\",text:cUI.periodEntry.name+\" \"+currentEntry.time+\" min (\"+cUI.tempPoint+\")\"});\n        if (cUI.periodEntry.list.length>1) msg.enabled= true;\n            else msg.enabled= false;\n            \n        return msg;\n    } else {\n        node.status({fill:\"red\",shape:\"dot\",text:cUI.periodEntry.name+\":\"+cUI.tempPoint+\" undefined\"});\n    }\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"updateTime failed (\"+cUI.tempPoint+\")\"});\n}","outputs":1,"noerr":0,"x":801,"y":782,"wires":[["73dbe81a.6afdf8"]],"outputLabels":["hour"]},{"id":"f1c74f66.718cc","type":"function","z":"afaa0885.ad2718","name":"delete schedule","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nvar statusText= cUI.roomsEntry.name;\nnode.status({fill:\"yellow\",shape:\"dot\",text:statusText});\n\nif (cUI.periodEntry.list.length>1)\n    currentObject.deleteEntry(cUI.periodEntry, cUI.tempPoint);\nif (cUI.tempPoint>cUI.periodEntry.list.length-1) cUI.tempPoint=cUI.periodEntry.list.length-1;\nif (cUI.periodEntry.list.length==1) cUI.periodEntry.list[0].time=1440;\n\nstatusText+=\"=\"+cUI.periodEntry.list.length+\" periods\";\nnode.status({fill:\"green\",shape:\"dot\",text:statusText});\nreturn msg;","outputs":1,"noerr":0,"x":369,"y":833,"wires":[["d4a83ce3.99bc7"]]},{"id":"e622d8ea.78e168","type":"ui_slider","z":"afaa0885.ad2718","name":"moveTime","label":"","tooltip":"","group":"306569d5.649c16","order":12,"width":6,"height":1,"passthru":true,"outs":"all","topic":"mySettings.heating.periods.uiTimeSlider","min":"0","max":"1440","step":"5","x":206,"y":544,"wires":[["7f497259.95751c","b6acc0d6.952bd"]]},{"id":"7f497259.95751c","type":"function","z":"afaa0885.ad2718","name":"newTime","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\n\ntry {\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n    if (currentEntry.time!=Number(msg.payload)) {\n        currentEntry.time= Number(msg.payload);\n\n        node.status({fill:\"green\",shape:\"dot\",text:currentEntry.time+\" min\"});\n        return msg;\n    } else {\n        node.status({fill:\"yellow\",shape:\"dot\",text:currentEntry.time+\" min unchanged\"});\n    }\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"updateTime failed\"});\n}","outputs":1,"noerr":0,"x":400,"y":544,"wires":[["b86b21db.c2b68"]],"outputLabels":["minutes"],"icon":"font-awesome/fa-clock-o"},{"id":"8335dee3.41e66","type":"ui_button","z":"afaa0885.ad2718","name":"insert","group":"306569d5.649c16","order":14,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"add_box","payload":"1","payloadType":"num","topic":"mySettings.heating.periods.uiInsert","x":186,"y":782,"wires":[["5b7a086c.f4e288"]]},{"id":"7e57e861.993338","type":"link in","z":"afaa0885.ad2718","name":"Enable Details","links":["67ba3ed2.70bad"],"x":100,"y":782,"wires":[["8335dee3.41e66"]]},{"id":"5b7a086c.f4e288","type":"function","z":"afaa0885.ad2718","name":"insert schedule","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry {\n    var timeBefore=0;\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint-1)\n    if (currentEntry) timeBefore= currentEntry.time || 0;\n   \n    currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n    var temp= currentEntry.temp;\n    var time= currentEntry.time;\n    var entry= currentObject.insertItemLeft(cUI.periodEntry,cUI.tempPoint);\n    entry.time= timeBefore+Math.floor((time-timeBefore)/2);\n    entry.temp= temp;\n    \n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomsEntry.name+\"=\"+cUI.periodEntry.list.length+\" periods\"});\n    return msg;\n} catch (err) {\n    node.error(\"moveCursor failed\");\n    node.status({fill:\"red\",shape:\"dot\",text:\"moveCursor failed\"});\n}","outputs":1,"noerr":0,"x":369,"y":782,"wires":[["d4a83ce3.99bc7"]]},{"id":"a7992ce4.43c1b","type":"function","z":"afaa0885.ad2718","name":"newTemp","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nvar currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n\nif (currentEntry && currentEntry.temp) {\n    if (currentEntry.temp!= Number(msg.payload)) {\n        currentEntry.temp= Number(msg.payload);\n        node.status({fill:\"green\",shape:\"dot\",text:cUI.tempPoint+\"=\"+msg.payload+\"°C\"});\n        msg.payload=cUI.tempPoint;\n        return msg;\n    }\n} else {\n    node.error(\"newTemp failed\");\n    node.status({fill:\"red\",shape:\"dot\",text:\"newTemp failed\"});\n}","outputs":1,"noerr":0,"x":400,"y":663,"wires":[["b86b21db.c2b68"]]},{"id":"f29c0d3d.112fa","type":"link in","z":"afaa0885.ad2718","name":"new Room","links":["8dd67254.ead3a","f64f8db5.e2ea"],"x":440,"y":731,"wires":[["d4a83ce3.99bc7"]]},{"id":"b6acc0d6.952bd","type":"function","z":"afaa0885.ad2718","name":"hh:mm","func":"var minutes=msg.payload;\nvar hourString=\"00\"+Math.floor(minutes/60);\nvar minuteString=\"00\"+minutes % 60;\nmsg.payload=hourString.substr(-2)+\":\"+minuteString.substr(-2);\nnode.status({fill:\"green\",shape:\"dot\",text: minutes+\"=\"+msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":595,"wires":[["bf96e9aa.4cea28"]],"inputLabels":["minutes"],"outputLabels":["h"],"icon":"font-awesome/fa-clock-o"},{"id":"bf96e9aa.4cea28","type":"ui_text","z":"afaa0885.ad2718","group":"306569d5.649c16","order":13,"width":2,"height":1,"name":"hh:mm","label":"","format":"{{msg.payload}}","layout":"col-center","x":509,"y":595,"wires":[]},{"id":"1f0cbb5.81b0045","type":"function","z":"afaa0885.ad2718","name":"Periods changed","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic+\"/\"+msg.payload});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) {\n    node.status({fill:\"red\",shape:\"dot\",text: \" UI not initialized\"});\n    return [null,ui.disabled]\n}\ncUI=cUI.tempCurveEdit;\n\ncUI.periodUuid=msg.payload;\ncUI.periodsEntry=currentObject.getEntry(msg.pathToPeriods,cUI.periodUuid); // get period entry for selected period\ncUI.periodEntry=currentObject.getEntry(cUI.roomEntry,cUI.periodsEntry.uuid,\"periodUuid\"); // get period entry for this room\nif (!cUI.periodEntry) { // period not in List - create new entry\n    cUI.periodEntry=currentObject.newEntry(cUI.roomEntry,cUI.periodsEntry.uuid);\n    cUI.periodEntry.periodUuid=cUI.periodsEntry.uuid;\n}\n\ncUI.periodEntry.name=cUI.periodsEntry.name;\n\n// set first point in temp curve to default if not existant\nif (!cUI.periodEntry.list) cUI.periodEntry.list=[];\nif (cUI.periodEntry.list.length<1) {\n    cUI.periodEntry.list.push({\"time\":1440,\"temp\":cUI.roomsEntry.defaultTemp});\n}\ncUI.tempPoint=0;\n\nif (cUI.periodEntry) {\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomEntry.name + \"/\" + cUI.periodEntry.name});\n    return [msg,ui.enabled];\n} else {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n    return [null,ui.disabled];\n}","outputs":2,"noerr":0,"x":889,"y":391,"wires":[["f64f8db5.e2ea","b1a8e1f2.ea1e5"],[]],"outputLabels":["DayOfWeek","enabled"]},{"id":"f64f8db5.e2ea","type":"link out","z":"afaa0885.ad2718","name":"update Chart","links":["f29c0d3d.112fa"],"x":1035,"y":357,"wires":[]},{"id":"5136c3e.e30683c","type":"function","z":"afaa0885.ad2718","name":"label & limits","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.settingsContext});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature curves\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry{\n    msg.label=cUI.roomEntry.name+\" (\"+cUI.periodEntry.name+\")\";\n    msg.room=cUI.roomEntry.name;\n    msg.roomID=cUI.roomEntry.uuid;\n    msg.period=cUI.periodEntry.name;\n    msg.periodID=cUI.periodEntry.uuid;\n    msg.ui_control={};\n    msg.ui_control.ymin=cUI.roomsEntry.minTemp;\n    msg.ui_control.ymax=cUI.roomsEntry.maxTemp;\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not find temp limits\"});\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1022,"y":595,"wires":[["5268d302.225c3c"]],"outputLabels":["minutes"],"icon":"font-awesome/fa-clock-o"},{"id":"3404a4d4.23919c","type":"function","z":"c4a7cd6c.2a0c1","name":"set editPeriod","func":"if (!msg.payload) return;\nvar topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\n\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n}\n\n    if (currentObject.isUuid(msg.payload)) {\n        var currentEntry=currentObject.getEntry(currentProperty,msg.payload);\n        if (currentEntry && currentEntry.hasOwnProperty(\"name\")) {\n            currentProperty.uiPointer=currentObject.getIndexOfEntry(currentProperty,msg.payload);\n            currentProperty.uiPointerUuid=msg.payload;\n            msg.index=currentProperty.uiPointer;\n            return [{payload:{fill:\"green\",shape:\"dot\",text:currentEntry.name+\" (\"+currentProperty.uiPointer+\" by uuid)\"}},msg];\n        } else {\n            return [{payload:{fill:\"red\",shape:\"dot\",text:\"uuid not found\"}},currentEntry];\n        }\n    } else {\n        currentProperty.uiPointer=Number(msg.payload);\n        currentProperty.uiPointerUuid=currentObject.getUuidByName(currentProperty,msg.payload);\n        msg.index=Number(msg.payload);\n        return [{payload:{fill:\"green\",shape:\"dot\",text:currentProperty.list[currentProperty.uiPointer].name+\" (\"+msg.payload+\")\"}},msg];\n    }\ntry {\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"}},null];\n} ","outputs":2,"noerr":0,"x":200,"y":80,"wires":[[],[]],"outputLabels":["status","standard"]},{"id":"1ff3f5ad.ab0eca","type":"function","z":"dfa4352b.bdc548","name":"save Data","func":"var currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar currentProperty=currentObject.getCurrentEntry(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text: msg.topic+\" not found\"}},null];\n}\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\n\ntry {\n    // make shure your topic is set correctly in your ui nodes(s): objectName.propertyName\n    msg.property=currentProperty;\n    if (!currentProperty.hasOwnProperty(propertyName) || currentProperty[propertyName]!=msg.payload) {\n        currentProperty[propertyName]=msg.payload;\n        msg.action=\"updateUI\";\n        return [{payload:{fill:\"green\",shape:\"dot\",text:propertyName+\"=\"+msg.payload+\"!\"}},msg];\n    } else {\n        return [{payload:{fill:\"yellow\",shape:\"dot\",text:propertyName+\" unchanged (\"+msg.payload+\")\"}},null];\n    }\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"}},null];\n} ","outputs":2,"noerr":0,"x":200,"y":80,"wires":[[],[]],"outputLabels":["status","update"],"icon":"font-awesome/fa-database"},{"id":"6a775fab.082ab","type":"function","z":"d4a0d961.b11238","name":"delete period","func":"if (msg.payload==env.get(\"cancel\")) return;\nnode.status({});\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar currentProperty=currentObject.getCurrentEntry(msg.topic);\nif (!currentProperty) {\n    return[{payload:{fill:\"red\",shape:\"dot\",text: msg.topic+\" not found\"}},null];\n}\nvar name=currentProperty.name;\n\ntry {\n    if (currentObject.deleteEntry(msg.topic)) {\n        return [{payload:{fill:\"green\",shape:\"dot\",text:name+\" deleted\"}},msg];\n    } else {\n        return [{payload:{fill:\"green\",shape:\"dot\",text:name+\" NOT deleted\"}},null];\n    }\n    return msg;\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, something gone wrong.\"}},null];\n} ","outputs":2,"noerr":0,"x":190,"y":80,"wires":[[],[]],"outputLabels":["status","standard"]},{"id":"7745479f.ddca48","type":"function","z":"30d3b36b.8d171c","name":"updateUi","func":"var msgDropdown={};\nvar msgName={};\nvar msgList={};\nvar msgParameter=[];\n\nvar topicParts=msg.topic.split('.');\n\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return [{payload:{fill:\"red\",shape:\"dot\",text:topicParts[0]+\" not found\"}},null,null];\nvar keyword = topicParts.pop();\nmsg.item=keyword;\nvar propertyTopic = msg.topic.slice(0,msg.topic.lastIndexOf('.'));\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null,null];\n}\n\nmsgDropdown.topic=msg.topic;\n\n//try {\n    \n    // get uiControl config\n    var uiControlJson= env.get(\"uiControl\");\n    var uiControl={};\n    if (uiControlJson) {\n//        node.warn(\"step 1\");\n//        node.warn(uiControl);\n        for (var criteria in uiControlJson) { \n//            node.warn(currentProperty.list[currentProperty.uiPointer]);\n//            node.warn(currentProperty.list[currentProperty.uiPointer].hasOwnProperty(criteria));\n            if (currentProperty.list[currentProperty.uiPointer].hasOwnProperty(criteria)) {\n                currentObject.merge(uiControl,uiControlJson[criteria][currentProperty.list[currentProperty.uiPointer][criteria]])\n            }\n        }\n//        node.warn(uiControl)\n    }\n\n    // fill an array for all parameters in list if existing\n    if (currentProperty.list) {\n//        node.warn(\"step 2\");\n//        node.warn(uiControl);\n        for (var item in currentProperty.list[currentProperty.uiPointer]) {\n            if (!item.startsWith('ui'))\n                if (uiControl.hasOwnProperty(item)) { // add uiControl if matches criteria\n                    currentObject.merge(uiControl[item],{\"payload\":currentProperty.list[currentProperty.uiPointer][item], \"topic\": propertyTopic+'.'+item, \"item\": item});\n                    msgParameter.push(uiControl[item]);\n                } else {\n                    msgParameter.push({\"payload\":currentProperty.list[currentProperty.uiPointer][item], \"topic\": propertyTopic+'.'+item, \"item\": item});\n                }\n        }\n//        node.warn(uiControl)\n//        node.warn(msgParameter)\n    }\n \n    switch (keyword) {\n        case \"uiDropdown\":\n            // update all parameters\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"Dropdown updated!\"}},null,msgParameter];\n        case \"uiAdd\":\n            msgDropdown.payload=currentProperty.uiPointer;\n            // update only dropdown, parametes will follow next call\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"new entry nr=\"+currentProperty.uiPointer}},msgDropdown,null];\n        case \"uiDelete\":\n            msgDropdown.payload=\"init\"; \n            // update only dropdown, parametes will follow next call\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"entry deleted\"}},msgDropdown,null];\n        case \"name\":\n            msgDropdown.payload=currentProperty.uiPointer;\n            // update only dropdown\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"entry renamed!\"}},msgDropdown,null];\n    }\n    if (msg.action && msg.action==\"updateUI\") {\n//        node.warn(msg.item);\n        if (uiControlJson.hasOwnProperty(msg.item)) { // add uiControl if changed value matches criteria\n            return [{payload:{fill:\"green\",shape:\"dot\",text:msg.item+\"=\"+msg.payload}},null,msgParameter];\n        } else {\n            return [{payload:{fill:\"green\",shape:\"dot\",text:msg.item+\"=\"+msg.payload}},null,msg];\n        }\n    } else\n        return [{payload:{fill:\"gray\",shape:\"dot\",text:msg.topic+\"=\"+msg.payload}},null,null];\n/*} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong. (\"+keyword+\")\"}},null,null];\n} \n*/","outputs":3,"noerr":0,"x":179,"y":85,"wires":[[],[],[]],"outputLabels":["status","updateDropdown","updateElements"]},{"id":"9d13774f.8dc838","type":"function","z":"8ba1eff6.75a11","name":"fillDropdown","func":"var customTopic=env.get(\"customTopic\");\nif (customTopic) msg.topic= customTopic;\n\n// prepare filter: 1) node.store 2) send by msg 3) set by config\nvar filter= context.get(\"filter\");\nif (msg.hasOwnProperty(\"filterProperty\") && msg.hasOwnProperty(\"filterValue\")) {\n    filter= {\n        \"property\": msg.filterProperty,\n        \"value\": msg.filterValue\n    }\n    //if (filter.property!==\"\") node.warn(\"filter from msg\");\n} else if (env.get(\"filterPropety\") && env.get(\"filterValue\")) {\n    filter= {\n        \"property\": env.get(\"filterProperty\"),\n        \"value\": env.get(\"filterValue\")\n    }\n    //if (filter.property!==\"\") node.warn(\"filter from node Context\");\n} else {\n    filter= {\n        \"property\": \"\",\n        \"value\": \"\"\n    }\n    //node.warn(\"no Filter\");\n}\ncontext.set(\"filter\",filter)\n//if (filter.property!==\"\") node.warn(filter);\n\nvar topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\nvar keyword = topicParts.pop();\n//node.warn(msg.topic);\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n}\n\n//node.warn(currentProperty)\n\n    if (currentProperty.list!==undefined) {\n\n        var sortedList=currentObject.saveSort(currentProperty.list);\n        msg.options=[];\n        sortedList.forEach(function(item){\n            // node.warn(item);\n            if ((filter.property===\"\" && filter.value===\"\") || (item[filter.property]===filter.value)) {\n                if (item.hasOwnProperty(\"name\") &&\n                    item.hasOwnProperty(\"uuid\")) msg.options.push({[item.name]:item.uuid});\n            }\n        })\n        \n        if (msg.payload===\"\") {\n            \n        } else if (currentObject.isUuid(msg.payload)) { // select entry provided by msg.payload (uuid)\n            if (!currentObject.entryExists(currentProperty,msg.payload)) {\n                delete msg.payload; // item not in list\n            } else {\n                currentProperty.uiPointerUuid=msg.payload;  \n            }\n        } else if (typeof msg.payload===\"number\" && msg.payload<currentProperty.list.length) { // by msg payload (index)\n            currentProperty.uiPointerUuid=currentProperty.list[msg.payload].uuid;\n            msg.payload=currentProperty.uiPointerUuid;\n        } else if (!currentProperty.list[currentProperty.uiPointer]) {\n            if (currentProperty.list.length>0){ // or first Entry\n                currentProperty.uiPointer=0; // reset to first\n                currentProperty.uiPointerUuid=currentProperty.list[0].uuid;\n                msg.payload=currentProperty.uiPointerUuid;\n            } else { // item not in List, give up\n                delete msg.payload;\n            }\n        } else { // by uiPointer \n            // send uuid instead index\n            currentProperty.uiPointerUuid=currentProperty.list[currentProperty.uiPointer].uuid;\n            msg.payload=currentProperty.uiPointerUuid;\n        }\n        return [{payload:{fill:\"green\",shape:\"dot\",text:\"done!\"}},msg];\n    } else {\n        return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"object.list empty\"}},null];\n    }\ntry {\n} catch (err) {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"No list entry\"}},null];\n}","outputs":2,"noerr":0,"x":190,"y":80,"wires":[[],[]],"outputLabels":["status","dropdownUi"]},{"id":"c50c7cfb.369ab","type":"link in","z":"afaa0885.ad2718","name":"Raumliste","links":["3e96545a.6496cc","2d70dbd3.249b94","c42ef6ca.d72a58","7501fdd.b420b04","8ee11259.a6efb"],"x":236,"y":323,"wires":[["a4cb6fd6.eb046"]]},{"id":"cee4b8dd.5e4678","type":"link in","z":"afaa0885.ad2718","name":"Periodenliste","links":["21638ecb.172702","8ca231d8.0d419"],"x":236,"y":391,"wires":[["927bddbd.48dca"]]},{"id":"4eef4b8f.b402d4","type":"ui_text","z":"afaa0885.ad2718","group":"306569d5.649c16","order":1,"width":2,"height":1,"name":"Raum:","label":"Raum:","format":"{{msg.payload}}","layout":"row-spread","x":138,"y":322,"wires":[]},{"id":"15a32a2b.41e616","type":"ui_text","z":"afaa0885.ad2718","group":"306569d5.649c16","order":4,"width":2,"height":1,"name":"Periode:","label":"Periode:","format":"{{msg.payload}}","layout":"row-spread","x":145,"y":391,"wires":[]},{"id":"ea0578f.f595788","type":"function","z":"e0e09953.42b938","name":"initializeUi","func":"let globalContext= env.get(\"globalContext\");\nlet baseObject= env.get(\"baseObject\");\nlet uiElement= env.get(\"uiElement\");\n\nmsg.topic= globalContext+'.'+baseObject+'.'+uiElement;\nmsg.filterProperty= env.get(\"filterProperty\");\nmsg.filterValue= env.get(\"filterValue\");\nvar topicParts= \"\";\n\ntry {\n    topicParts=msg.topic.split('.');\n} catch (err) {\n    return [null,{payload: {fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"}}];\n}\nif (topicParts.length<3) {\n    return [null,{payload: {fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"}}];\n}\n\n// get or initalize root for global store\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text:\"could not find: \"+globalContext}},null];\n}\n\n// get or initialize base Object\ncurrentObject= currentObject.getObject(msg.topic);\nif (!currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic}},null];\n} else {\n    return [{payload: {fill:\"green\",shape:\"dot\",text:baseObject}},msg];\n}\n","outputs":2,"noerr":0,"x":180,"y":80,"wires":[[],[]],"outputLabels":["status","standard"]},{"id":"51c4d926.279bc8","type":"function","z":"e0e53645.d85fd8","name":"add new","func":"var currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar defaults=env.get(\"defaults\");\nif (!defaults) {\n    node.error(\"sub[add new] failed, no defaults defined \"+msg.payload+\" to: \"+ msg.topic);\n    return [{payload:{fill:\"red\",shape:\"dot\",text: \"defaults not defined!\"}},null];\n}\n\n// create a new List Entry\nif (!currentObject.entryExists(msg.topic,msg.payload,\"name\")) {\n    var currentEntry= currentObject.newEntry(msg.topic,msg.payload);\n    if (currentEntry) {\n        currentObject.merge(currentEntry,defaults); // merge defaults from subflow config\n        if (msg.hasOwnProperty(\"defaults\")) currentObject.merge(currentEntry,msg.defaults); // merge defaults from msg\n        msg.payload=currentEntry.uuid;\n    \n        return [{payload:{fill:\"green\",shape:\"dot\",text:currentEntry.name+\" saved\"}},msg];\n    } else {\n        node.error(\"sub[add new] failed to add \"+msg.payload+\" to: \"+ msg.topic);\n        return [{payload:{fill:\"red\",shape:\"dot\",text:\"failed to add \"+msg.payload+\" to: \"+ msg.topic}},null];\n    }\n} else {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text:msg.payload+\" allready exists\"}},null];\n}","outputs":2,"noerr":0,"x":200,"y":80,"wires":[[],[]],"outputLabels":["status","standard"],"icon":"font-awesome/fa-plus-square"},{"id":"5c233d43.925de4","type":"change","z":"afaa0885.ad2718","name":"pathToRooms","rules":[{"t":"set","p":"pathToRooms","pt":"msg","to":"mySettings.rooms.name","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":692,"y":323,"wires":[["5fdcdfed.62831"]]},{"id":"927bddbd.48dca","type":"change","z":"afaa0885.ad2718","name":"del payload","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":359,"y":391,"wires":[["dda96c22.e479b"]]},{"id":"a4cb6fd6.eb046","type":"change","z":"afaa0885.ad2718","name":"del payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":359,"y":323,"wires":[["3deb5b65.175bc4"]]},{"id":"b1a8e1f2.ea1e5","type":"debug","z":"afaa0885.ad2718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":391,"wires":[]},{"id":"f16908b5.8911a8","type":"change","z":"afaa0885.ad2718","name":"pathToRooms","rules":[{"t":"set","p":"pathToRoom","pt":"msg","to":"mySettings.heating.rooms.name","tot":"str"},{"t":"set","p":"pathToPeriods","pt":"msg","to":"mySettings.heating.periods.name","tot":"str"},{"t":"set","p":"pathToRooms","pt":"msg","to":"mySettings.rooms.name","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":692,"y":391,"wires":[["1f0cbb5.81b0045"]]},{"id":"4eea0d2d.491f14","type":"ui_worldmap","z":"9b61ce87.2ae62","group":"234ff31e.1bc3cc","order":0,"width":"15","height":"11","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"hide","layers":"hide","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"true","coords":"none","showgrid":"false","path":"/worldmap","x":400,"y":140,"wires":[]},{"id":"73dbe81a.6afdf8","type":"link out","z":"afaa0885.ad2718","name":"newTime","links":["cfa0b157.c2ba8"],"x":967,"y":782,"wires":[]},{"id":"cfa0b157.c2ba8","type":"link in","z":"afaa0885.ad2718","name":"newTime","links":["73dbe81a.6afdf8","7c671be4.4c5d04"],"x":100,"y":544,"wires":[["e622d8ea.78e168"]]},{"id":"c87c4075.3cbcb","type":"link in","z":"afaa0885.ad2718","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":831,"y":493,"wires":[["a11f3381.e27d8"]]},{"id":"2c5f476c.d63d28","type":"function","z":"afaa0885.ad2718","name":"delete tempCurveEdit","func":"node.status({});\nvar currentSettings = flow.get(\"currentSettings\");\nif (!currentSettings || !currentSettings.tempCurveEdit){\n    node.status({fill:\"red\",shape:\"dot\",text:\"currentSettings.tempCurveEdit missing!\"});\n    return null;   \n}\ntry {\n    delete currentSettings.tempCurveEdit;\n    node.status({fill:\"green\",shape:\"dot\",text:\"currentSettings.tempCurveEdit deleted!\"});\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not delete currentSettings.tempCurveEdit!\"});\n}\nreturn msg;","outputs":1,"noerr":0,"x":389,"y":255,"wires":[[]]},{"id":"e1a3f1e7.b946f","type":"link in","z":"afaa0885.ad2718","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":236,"y":255,"wires":[["2c5f476c.d63d28","2bd077d3.9f45c8"]]},{"id":"a11f3381.e27d8","type":"function","z":"afaa0885.ad2718","name":"clear UI","func":"msg.label=\"Temperaturverlauf\"\nmsg.payload=[];\n\nreturn msg;","outputs":1,"noerr":0,"x":1012,"y":493,"wires":[["5268d302.225c3c"]]},{"id":"2bd077d3.9f45c8","type":"debug","z":"afaa0885.ad2718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":339,"y":204,"wires":[]},{"id":"54e7856d.fb36ec","type":"file in","z":"679df911.24a188","name":"","filename":"C:\\\\Users\\\\cmeinert\\\\Documents\\\\GitHub\\\\node-red-contrib-homie-convention-debug\\\\dumps\\\\dump.txt","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":480,"y":140,"wires":[["aacd3eef.d0d16"]]},{"id":"4f989710.939d18","type":"debug","z":"679df911.24a188","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1050,"y":200,"wires":[]},{"id":"3d84def.665ce22","type":"inject","z":"679df911.24a188","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":80,"wires":[["54e7856d.fb36ec"]]},{"id":"aacd3eef.d0d16","type":"function","z":"679df911.24a188","name":"split","func":"var posSpace= msg.payload.indexOf(\" \");\nmsg.topic= msg.payload.substr(0,posSpace);\nmsg.payload= msg.payload.substr(posSpace+1);\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":140,"wires":[["4f989710.939d18","bda34faa.57ead"]]},{"id":"bda34faa.57ead","type":"mqtt out","z":"679df911.24a188","name":"","topic":"","qos":"2","retain":"true","broker":"7ef5ea17.178a64","x":1050,"y":140,"wires":[]},{"id":"39ae9afa.4bf6b6","type":"homie-convention-device","z":"679df911.24a188","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"[any]","propertyID":"uptime","topic":"[any]/[any]/uptime","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":true,"uiControlMinMax":false,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":130,"y":360,"wires":[["10171cd7.050b33"],[]]},{"id":"3596694a.e9f8d6","type":"homie-convention-device","z":"679df911.24a188","broker":"e6a23911.f60378","name":"","deviceID":"a4cf12250ffc","nodeID":"doser","propertyID":"dose","topic":"a4cf12250ffc/doser/dose","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device/node/property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiText","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":true,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":410,"y":500,"wires":[["dab41f33.6649b","a46f524.6bed8b"],["44ce44b4.f5218c"]]},{"id":"dab41f33.6649b","type":"debug","z":"679df911.24a188","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":440,"wires":[]},{"id":"44ce44b4.f5218c","type":"debug","z":"679df911.24a188","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":540,"wires":[]},{"id":"13044583.6a38da","type":"inject","z":"679df911.24a188","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":500,"wires":[["3596694a.e9f8d6"]]},{"id":"10171cd7.050b33","type":"ui_chart","z":"679df911.24a188","name":"","group":"50ef20f5.7d4f8","order":0,"width":0,"height":0,"label":"Uptime","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":332,"y":340,"wires":[[]]},{"id":"a46f524.6bed8b","type":"ui_text","z":"679df911.24a188","group":"61b56b5f.f16754","order":0,"width":0,"height":0,"name":"","label":"{{msg.label}}","format":"{{msg.payload}}","layout":"row-spread","x":650,"y":480,"wires":[]},{"id":"d127042f.2ef948","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":510,"y":2240,"wires":[]},{"id":"c37b907f.61923","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":1666,"wires":[]},{"id":"e2840e78.b783c","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":1785,"wires":[]},{"id":"b615ecab.41005","type":"link in","z":"afaa0885.ad2718","name":"uiBack","links":["d899ded4.f9dff"],"x":100,"y":884,"wires":[["1b262c23.00dc14"]]},{"id":"4264471a.b28b38","type":"link in","z":"afaa0885.ad2718","name":"uiNext","links":["52fc0b87.338624"],"x":100,"y":935,"wires":[["ccd7c6ba.ed0be8"]]},{"id":"d899ded4.f9dff","type":"link out","z":"afaa0885.ad2718","name":"msgEnablePrev","links":["b615ecab.41005"],"x":967,"y":629,"wires":[]},{"id":"52fc0b87.338624","type":"link out","z":"afaa0885.ad2718","name":"msgEnableNext","links":["4264471a.b28b38"],"x":967,"y":663,"wires":[]},{"id":"21bb58f8.ca7b08","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-02","nodeID":"Bulb","propertyID":"eventHSV","topic":"RGBW-Bulb-02/Bulb/eventHSV","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Light Color","uiPlaceName":"","uiNode":"uiColor","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":true,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"nodeRedObject","settable":false,"x":249,"y":1360,"wires":[["9124023b.3c87f","7935a593.dc18bc"],[]]},{"id":"9124023b.3c87f","type":"ui_colour_picker","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","group":"6aae0b37.682c24","format":"hsv","outformat":"object","showSwatch":true,"showPicker":true,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":4,"width":"10","height":"1","passthru":false,"topic":"","x":529,"y":1292,"wires":[["21bb58f8.ca7b08"]]},{"id":"7935a593.dc18bc","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":1360,"wires":[]},{"id":"e2233c7d.53701","type":"link out","z":"afaa0885.ad2718","name":"msgEnableDelete","links":["f9d7b245.0bff4"],"x":967,"y":697,"wires":[]},{"id":"9211ec38.5bb63","type":"ui_chart","z":"afaa0885.ad2718","name":"","group":"9ce06846.951a68","order":6,"width":8,"height":"6","label":"{{msg.label}}","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#f3bb12","#4bc2ef","#92877c","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":866,"y":1122,"wires":[[]]},{"id":"7d726f92.5ad68","type":"debug","z":"afaa0885.ad2718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1325,"y":544,"wires":[]},{"id":"7e7bc1cc.55ff6","type":"function","z":"6e9d1a04.cba814","name":"buildChart","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nmsg.currentObject= global.get(msg.globalContext,\"file\");\nif (!msg.currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.globalContext}},ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\nvar statusText = \"\"\n\nvar cRoom=msg.roomEntry;\nvar cPeriod=msg.periodEntry;\n\nif (cRoom.chart===undefined)\n    cRoom.chart = [{\n    \"series\":[\"ist\",\"soll\",\"\"],\n    \"data\":[[],[],[]],\n    \"labels\":[\"ist\",\"soll\",\"standard\"]\n    }];\n\nstatusText+= msg.roomEntry.name;\n\nvar timeStamp = 0; //new Date();\nvar temp=0;\nvar time=0;\nvar timeBefore=0;\n\n// timeStamp.setHours(0,0,0);\n\nif (cRoom && \n    cPeriod &&\n    cPeriod.list &&\n    cPeriod.list.length>0) {\n        \n    statusText+= \":\"+cPeriod.name;\n    //sort periods by time\n    if (cPeriod.list!==undefined) {\n        cPeriod.list.sort(function(a,b) {\n            if (a.time > b.time) return 1;\n            if (a.time < b.time) return -1;\n            return 0;\n        });\n    }\n    \n    // write time array for chart\n    cRoom.chart[0].data[1]=[];\n    cPeriod.list.forEach(function (period) {\n        temp=period.temp;\n        cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(timeBefore*60*1000),\"y\":temp}));\n        time=Number(period.time);\n        cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp}));\n        timeBefore=time;\n    });\n    \n    temp= cPeriod.list[0].temp;\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp,\"note\":\"end\"}));\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":temp,\"note\":\"end\"}));\n  \n    // draw default temp\n    try{\n        cRoom.chart[0].data[2]=[]; // clear old data\n        cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n        cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    } catch (err) {\n        statusText+=\" no default temp\"\n        return [{payload: {fill:\"red\",shape:\"ring\",text:statusText}},null];\n    }\n    \n} else {\n    statusText+= \" no settings\";\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    msg.payload = cRoom.chart;\n    return [{payload: {fill:\"yellow\",shape:\"ring\",text:statusText}},msg];\n}\nmsg.payload = cRoom.chart;\nmsg.label= msg.periodEntry.name;\nmsg.ui_control={};\nmsg.ui_control.ymin=msg.roomsEntry.minTemp;\nmsg.ui_control.ymax=msg.roomsEntry.maxTemp;\nreturn [{payload: {fill:\"green\",shape:\"dot\",text:statusText}},msg];","outputs":2,"noerr":0,"x":206,"y":85,"wires":[[],[]],"icon":"node-red-dashboard/ui_chart.png"},{"id":"1c7e54e8.36570b","type":"subflow:6e9d1a04.cba814","z":"afaa0885.ad2718","name":"buildChart","env":[{"name":"heating.rooms","value":"heating.rooms","type":"str"}],"x":682,"y":1071,"wires":[["9211ec38.5bb63","3a4aabd3.986f04"]]},{"id":"1a64ae43.a9bc52","type":"function","z":"bbaf0ff1.1a532","name":"buildSchedule","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nconst dow = [\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\",\"Sunday\"];\n\nmsg.currentObject= global.get(msg.globalContext,\"file\");\nif (!msg.currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.globalContext}},ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\nmsg.roomEntry=msg.currentObject.getEntry(msg.globalContext+\".heating.rooms.null\",msg.roomID,\"roomUuid\");\nif (!msg.roomEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"no room found!\"}},ui.disabled]\n\nmsg.roomsEntry=msg.currentObject.getEntry(msg.globalContext+\".rooms.null\",msg.roomID);\nif (!msg.roomsEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"no rooms found!\"}},ui.disabled]\n\nmsg.periodsObject=msg.currentObject.getObject(msg.globalContext+\".heating.periods.null\");\nif (!msg.periodsObject) return [{payload: {fill:\"red\",shape:\"dot\",text: \"no periods found!\"}},ui.disabled]\n\nvar statusText = msg.roomEntry.name;\n\nvar timeStamp = new Date();\nmsg.payload={};\n\nif (msg.roomEntry.list) {\n        \n    var day =0;\n    \n    var formatMinutes2String = function (minutes) {\n        var hourString=\"00\"+Math.floor(minutes/60);\n        var minuteString=\"00\"+minutes % 60;\n        return hourString.substr(-2)+\":\"+minuteString.substr(-2);\n    }\n    \n    var addSchedule = function (time, temp) {\n        msg.payload[dow[day]][formatMinutes2String(time)]=temp;\n    }\n    \n    var addDay = function (period) {\n            //node.warn(period);\n            periodDef=msg.currentObject.getEntry(msg.globalContext+\".heating.periods.null\",period.periodUuid);\n             if (periodDef.days[day].isChecked) {\n                msg.payload[dow[day]][formatMinutes2String(0)]=period.list[0].temp; // start @ 00:00\n                for (var i=0; i<period.list.length-1; i++) {\n                    addSchedule(period.list[i].time,period.list[i+1].temp);\n                }\n                addSchedule(period.list[i].time,period.list[0].temp);\n                msg.payload[dow[day]][formatMinutes2String(1439)]=period.list[0].temp; // end @ 23:59\n            }\n        }\n        \n    for (day=0; day<7; day++) {\n        msg.payload[dow[day]]= {};\n        msg.roomEntry.list.forEach(addDay);\n    }\n  \n} else {\n    statusText+= \" no settings\";\n    return [{payload: {fill:\"yellow\",shape:\"ring\",text:statusText}},msg];\n}\nmsg.topic= \"setCalendar\";\nreturn [{payload: {fill:\"green\",shape:\"dot\",text:statusText}},msg];","outputs":2,"noerr":0,"x":250,"y":119,"wires":[[],[]],"icon":"node-red-dashboard/ui_chart.png"},{"id":"3a4aabd3.986f04","type":"subflow:bbaf0ff1.1a532","z":"afaa0885.ad2718","name":"","env":[],"x":896,"y":1071,"wires":[["380d6165.def24e","1f1d7c0d.edf184"]]},{"id":"a9b14d57.af05a","type":"subflow:7bb9b47f.834f5c","z":"afaa0885.ad2718","name":"","env":[{"name":"roomID","value":"73188484-c593-2c8c-ef96-f766623c513f","type":"str"}],"x":682,"y":1122,"wires":[["9211ec38.5bb63"]]},{"id":"5f802c34.c65794","type":"function","z":"7bb9b47f.834f5c","name":"updateChart","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nif (!msg.roomID ||\n    !msg.globalContext ||\n    !msg.roomContext ||\n    !msg.roomsContext) {\n        return [{payload: {fill:\"red\",shape:\"dot\",text: \"check configuration\"}},ui.disabled];\n    }\n\nmsg.currentObject= global.get(msg.globalContext,\"file\");\nif (!msg.currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.globalContext}},ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\nmsg.roomEntry=msg.currentObject.getEntry(msg.globalContext+\".\"+msg.roomContext+\".null\",msg.roomID,\"roomUuid\");\nmsg.roomsEntry=msg.currentObject.getEntry(msg.globalContext+\".\"+msg.roomsContext+\".null\",msg.roomID);\n\nvar cRoom=msg.roomEntry;\nnode.warn(cRoom);\nvar statusText = \"\"\nif (cRoom.chart===undefined)\n    cRoom.chart = [{\n    \"series\":[\"ist\",\"soll\",\"\"],\n    \"data\":[[],[],[]],\n    \"labels\":[\"ist\",\"soll\",\"standard\"]\n    }];\n\nstatusText+= msg.roomEntry.name;\n\nvar temp=Number(msg.payload);\nvar timeMidnight = new Date();\ntimeMidnight.setHours(0,0,0);\nvar time=new Date();\nvar timeOffset=time.getTimezoneOffset()/60;\n\nvar timePoint=msg.currentObject.adjustTime(timeOffset,{\"x\":time.getTime()-timeMidnight.getTime(),\"y\":temp})\n\n// delete old datapoints\ncRoom.chart[0].data[0].forEach(function (dataPoint,index) {\n    if (dataPoint.x>timePoint.x) {\n        cRoom.chart[0].data[0].splice(index,1);\n    }\n});\n\n// add new datapoint\ncRoom.chart[0].data[0].push(timePoint);\nmsg.payload = cRoom.chart;\nmsg.label= msg.periodEntry.name;\nreturn [{payload: {fill:\"green\",shape:\"dot\",text:statusText}},msg];","outputs":2,"noerr":0,"x":223,"y":102,"wires":[[],[]],"icon":"node-red-dashboard/ui_chart.png"},{"id":"176161.c40d2e9f","type":"function","z":"7fd0d8ec.569998","name":"initHeater","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nlet datapoint = env.get(\"datapoint\")\nif (msg.payload!==\"update\") {\n    if (typeof datapoint == \"object\") { // multiple Datapoints\n        if (!datapoint.includes(msg.datapoint)) return;\n    } else {\n        if (msg.datapoint!=datapoint) return;\n    }\n}\nvar statusText=\"\";\nlet globalContext = env.get(\"globalContext\");\nlet thisRoom = (!msg.room) ? env.get(\"room\") : msg.room;\nmsg.pathToRooms = globalContext +\".\"+ env.get(\"roomsContext\") + \".homematic\";\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+globalContext}},null,null]\n}\n\n\n// --------------- end of UI header ---------------------\nnode.warn(msg.room)\nif (msg.room) {\n    if (msg.room === thisRoom) {\n        \n        var roomContext= env.get(\"roomContext\");\n        var roomsContext= env.get(\"roomsContext\");\n        var periodsContext= env.get(\"periodsContext\")\n        \n        var msgValue={\n            \"globalContext\": globalContext,\n            \"roomContext\": roomContext,\n            \"roomsContext\": roomsContext,\n            \"periodsContext\": periodsContext,\n            \"topic\":msg.topic,\n            \"room\":msg.room,\n            \"payload\": msg.payload\n        };\n        \n        var msgHeater={\n            \"topic\": \"currentTemp\",\n            \"payload\": msg.payload\n        };\n        var msgInit={\n            \"globalContext\": globalContext,\n            \"roomContext\": roomContext,\n            \"roomsContext\": roomsContext,\n            \"periodsContext\": periodsContext,\n            \"topic\":msg.topic,\n            \"room\":msg.room,\n            \"payload\": msg.payload\n        };\n\n        msgInit.roomID= currentObject.getUuidByName(msg.pathToRooms,msg.room);\n        msgValue.roomID= msgInit.roomID;\n        if (!msgInit.roomID) {\n            statusText= msg.room+\" not found (\"+msg.pathToRooms+\")\";\n            return [{payload: {fill:\"red\",shape:\"dot\",text: statusText}},null,null,null];\n        } else {\n            node.warn(msgInit.roomID)\n            msg.roomEntry=currentObject.getEntry(globalContext+\".\"+roomContext+\".null\",msgInit.roomID,\"roomUuid\");\n            node.warn(msg.roomEntry)\n            msg.roomsEntry=currentObject.getEntry(globalContext+\".\"+roomsContext+\".null\",msgInit.roomID);\n            node.warn(msg.roomsEntry)\n            if (!msg.roomsEntry || !msg.roomEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not find room \"+msgInit.roomID}},ui.disabled];\n\n\n            var date = new Date();\n            var day = (date.getDay()-1 > 0) ? date.getDay()-1 : 6; // shift dow to monday=0\n            statusText+= '('+day+')';\n            var pathToPeriods = globalContext+\".\"+periodsContext+\".null\";\n            \n                var checkDay = function (period) {\n                        msg.periodsEntry=currentObject.getEntry(pathToPeriods,period.periodUuid);\n                        node.warn(msg.periodsEntry);\n                         if (msg.periodsEntry && msg.periodsEntry.days[day].isChecked) {\n                            msg.periodID=period.uuid;\n                            return;\n                        }\n                    }\n            msg.roomEntry.list.forEach(checkDay);\n            node.warn(msg.periodID);\n            if (!msg.periodID) return [{payload: {fill:\"red\",shape:\"dot\",text: \"periodID \"+msg.periodID}},ui.disabled];\n            msg.periodEntry=currentObject.getEntry(msg.roomEntry,msg.periodID); // get period entry for this room\n            if (!msg.periodEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not find period \"+msg.periodID}},ui.disabled];\n            msgValue.roomEntry= msg.roomEntry;\n            msgInit.roomEntry=msg.roomEntry;\n            msgValue.roomsEntry= msg.roomsEntry;\n            msgInit.roomsEntry=msg.roomsEntry;\n            msgValue.periodEntry= msg.periodEntry;\n            msgInit.periodEntry=msg.periodEntry;\n            \n            if (msg.payload !== \"update\") {\n                switch(msg.datapoint){\n                    case 'VALVE_STATE':\n                        msgHeater.topic=\"currentValve\"\n                        statusText=msg.room+\" (\"+msg.payload+\"%)\";\n                        return [{payload: {fill:\"green\",shape:\"dot\",text: statusText}},msgHeater,null,null];\n                    case 'ACTUAL_TEMPERATURE':\n                        msgHeater.topic=\"currentTemp\"\n                        statusText=msg.room+\" (\"+msg.payload+\"°C)\";\n                        return [{payload: {fill:\"green\",shape:\"dot\",text: statusText}},msgHeater,msgValue,msgInit];\n                }\n            } else {\n                return [{payload: {fill:\"green\",shape:\"dot\",text: statusText}},null,msgValue,null];\n            }\n        }\n    } \n}","outputs":4,"noerr":0,"x":162,"y":85,"wires":[[],[],[],[]],"inputLabels":["thermostate"],"outputLabels":["state","update","build","chart"]},{"id":"94bfa7d7.5b8398","type":"subflow:7fd0d8ec.569998","z":"afaa0885.ad2718","name":"Temperature Chart","env":[{"name":"datapoint","value":"[\"ACTUAL_TEMPERATURE\",\"VALVE_STATE\"]","type":"json"}],"x":464,"y":1054,"wires":[["380d6165.def24e"],["1c7e54e8.36570b"],["a9b14d57.af05a","36542b63.916a34"]]},{"id":"99b23ac3.2c7b08","type":"ui_text_input","z":"99f7fccc.6df2f","name":"name","label":"","tooltip":"","group":"d11141a.b59afc","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.heating.test.name","x":679,"y":272,"wires":[["38e0e6af.b7834a"]]},{"id":"66509821.89aa58","type":"ui_button","z":"99f7fccc.6df2f","name":"uiDelete","group":"d11141a.b59afc","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Do you really like to delete this entry?","payloadType":"str","topic":"mySettings.heating.test.uiDelete","x":689,"y":212,"wires":[["87ad832b.0f59e"]]},{"id":"4f32a762.51c228","type":"ui_date_picker","z":"99f7fccc.6df2f","name":"start","label":"","group":"d11141a.b59afc","order":7,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.test.start","x":679,"y":312,"wires":[["38e0e6af.b7834a"]]},{"id":"542a80fb.3d2bb","type":"ui_date_picker","z":"99f7fccc.6df2f","name":"end","label":"","group":"d11141a.b59afc","order":9,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.test.end","x":679,"y":352,"wires":[["38e0e6af.b7834a"]]},{"id":"e95c2be4.9ea798","type":"ui_text","z":"99f7fccc.6df2f","group":"d11141a.b59afc","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":272,"wires":[]},{"id":"55e6bdd1.caa9d4","type":"ui_text","z":"99f7fccc.6df2f","group":"d11141a.b59afc","order":6,"width":2,"height":1,"name":"Start:","label":"Begin:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":332,"wires":[]},{"id":"3d8b0903.25f7e6","type":"ui_text","z":"99f7fccc.6df2f","group":"d11141a.b59afc","order":8,"width":2,"height":1,"name":"End:","label":"End:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":392,"wires":[]},{"id":"49ee9243.bc36bc","type":"ui_dropdown","z":"99f7fccc.6df2f","name":"uiDropdown","label":"","tooltip":"","place":"select period","group":"d11141a.b59afc","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.heating.test.uiDropdown","x":699,"y":92,"wires":[["f4172b16.eeb348"]]},{"id":"8c1d91ef.92703","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":272,"wires":[]},{"id":"2d5c77a.660c488","type":"link in","z":"99f7fccc.6df2f","name":"updatePeriod","links":["8c1d91ef.92703","af64a243.aa02c","480be8a7.ca3858","b814ae11.09716","55011644.db5958"],"x":168,"y":187,"wires":[["5b2ccb43.bd59f4"]]},{"id":"af64a243.aa02c","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":92,"wires":[]},{"id":"1f109766.2438b9","type":"function","z":"99f7fccc.6df2f","name":"fill dropdown","func":"var topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\nvar keyword = topicParts.pop();\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"});\n    return;\n}\n\ntry {\n    if (currentProperty.list!==undefined) {\n        msg.options=[];\n        var listEntry={};\n        currentProperty.list.forEach(function(item,index){\n            listEntry={};\n            listEntry[item.name]=String(index);\n            msg.options.push(listEntry);\n        })\n        msg.options.sort();\n     \n        if (!currentProperty.list[currentProperty.uiPointer]) {\n            if (currentProperty.list.length>0){\n                currentProperty.uiPointer=0; // reset to first\n                msg.payload=currentProperty.uiPointer;\n            } else { // no list existing\n                delete msg.payload;\n            }\n        } else msg.payload=currentProperty.uiPointer;\n            \n        node.status({fill:\"green\",shape:\"dot\",text:\"done!\"});\n    } else {\n        node.status({fill:\"yellow\",shape:\"dot\",text:\"object.list empty\"});\n    }\n    return msg;\n\n} catch (err) {\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"No list entry\"});\n    return msg;\n}","outputs":1,"noerr":0,"x":499,"y":92,"wires":[["49ee9243.bc36bc"]]},{"id":"b814ae11.09716","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":212,"wires":[]},{"id":"cf0daed0.447a6","type":"ui_button","z":"99f7fccc.6df2f","name":"uiAdd","group":"d11141a.b59afc","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unnamed","payloadType":"str","topic":"mySettings.heating.test.uiAdd","x":674,"y":147,"wires":[["48e37f92.34826"]]},{"id":"55011644.db5958","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":152,"wires":[]},{"id":"47e71fbc.8fed5","type":"switch","z":"99f7fccc.6df2f","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.heating.test.name","vt":"str"},{"t":"eq","v":"mySettings.heating.test.start","vt":"str"},{"t":"eq","v":"mySettings.heating.test.end","vt":"str"},{"t":"eq","v":"mySettings.heating.test.monday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.tuesday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.wednesday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.thursday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.friday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.saturday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.sunday","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":459,"y":332,"wires":[["99b23ac3.2c7b08"],["4f32a762.51c228"],["542a80fb.3d2bb"],["c715800e.f7e3b"],["4d7b3e1c.38bf6"],["34a1f17e.69729e"],["eb6abb25.752688"],["2f4d11e1.dd1bae"],["5da96133.bfaa7"],["957355cf.98c598"]]},{"id":"87ad832b.0f59e","type":"ui_toast","z":"99f7fccc.6df2f","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":829,"y":212,"wires":[["9b8fc84f.5bf548"]]},{"id":"c715800e.f7e3b","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Monday","tooltip":"","group":"d11141a.b59afc","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.monday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":392,"wires":[["38e0e6af.b7834a"]]},{"id":"4d7b3e1c.38bf6","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Tuesday","tooltip":"","group":"d11141a.b59afc","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.tuesday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":452,"wires":[["38e0e6af.b7834a"]]},{"id":"34a1f17e.69729e","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Wednesday","tooltip":"","group":"d11141a.b59afc","order":12,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.wednesday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":699,"y":512,"wires":[["38e0e6af.b7834a"]]},{"id":"eb6abb25.752688","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Thursday","tooltip":"","group":"d11141a.b59afc","order":13,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.thursday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":572,"wires":[["38e0e6af.b7834a"]]},{"id":"2f4d11e1.dd1bae","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Friday","tooltip":"","group":"d11141a.b59afc","order":14,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.friday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":679,"y":632,"wires":[["38e0e6af.b7834a"]]},{"id":"5da96133.bfaa7","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Saturday","tooltip":"","group":"d11141a.b59afc","order":15,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.saturday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":692,"wires":[["38e0e6af.b7834a"]]},{"id":"957355cf.98c598","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Sunday","tooltip":"","group":"d11141a.b59afc","order":16,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.sunday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":692,"wires":[["38e0e6af.b7834a"]]},{"id":"8d6c628b.def81","type":"function","z":"99f7fccc.6df2f","name":"initialize","func":"if (!msg.payload) return;\n\nvar topicParts=\"\";\n\ntry {\n    topicParts=msg.topic.split('.');\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"});\n    return;\n}\nif (topicParts.length<3) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"});\n    return;\n}\n\n// get or initalize root for global store\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic});\n    return null;\n}\n\n// get or initialize base Object\ncurrentObject= currentObject.getObject(msg.topic);\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic});\n} else {\n    node.status({fill:\"green\",shape:\"dot\",text:\"done!\"});\n    return msg;\n}\n","outputs":1,"noerr":0,"x":289,"y":92,"wires":[["1f109766.2438b9"]]},{"id":"b7d8835f.d797e","type":"link in","z":"99f7fccc.6df2f","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":64,"y":92,"wires":[["37850e1b.2c6062"]]},{"id":"37850e1b.2c6062","type":"change","z":"99f7fccc.6df2f","name":"init","rules":[{"t":"set","p":"topic","pt":"msg","to":"mySettings.heating.test.uiDropdown","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":159,"y":92,"wires":[["8d6c628b.def81"]]},{"id":"48e37f92.34826","type":"change","z":"99f7fccc.6df2f","name":"defaults","rules":[{"t":"set","p":"start","pt":"msg","to":"","tot":"date"},{"t":"set","p":"end","pt":"msg","to":"","tot":"date"},{"t":"set","p":"monday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"tuesday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"wednesday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"thursday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"friday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"saturday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"sunday","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":147,"wires":[["1c4cc57f.2b277b"]]},{"id":"f4172b16.eeb348","type":"subflow:c4a7cd6c.2a0c1","z":"99f7fccc.6df2f","name":"","env":[],"x":973,"y":96,"wires":[["af64a243.aa02c"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"9b8fc84f.5bf548","type":"subflow:d4a0d961.b11238","z":"99f7fccc.6df2f","name":"","x":979,"y":212,"wires":[["b814ae11.09716"]]},{"id":"38e0e6af.b7834a","type":"subflow:dfa4352b.bdc548","z":"99f7fccc.6df2f","name":"","env":[],"x":969,"y":272,"wires":[["8c1d91ef.92703"]]},{"id":"1c4cc57f.2b277b","type":"subflow:e0e53645.d85fd8","z":"99f7fccc.6df2f","name":"","x":973,"y":147,"wires":[["55011644.db5958"]]},{"id":"e74b0ec5.c9454","type":"ccu-rpc-event","z":"897fdb2a.109f68","name":"Termostate","iface":"","ccuConfig":"dcd63e8.d157fc","rooms":"","roomsRx":"str","functions":"","functionsRx":"str","device":"","deviceRx":"str","deviceName":"","deviceNameRx":"str","deviceType":"","deviceTypeRx":"str","channel":"","channelRx":"str","channelName":"","channelNameRx":"str","channelType":"","channelTypeRx":"str","channelIndex":"","channelIndexRx":"str","datapoint":"","datapointRx":"str","change":true,"working":false,"cache":true,"topic":"${room}/${channelName}/${datapoint}","x":128,"y":374,"wires":[["ab7e0d9.92789f","b22fa377.375a3"]]},{"id":"673d1103.fd2fe","type":"link out","z":"897fdb2a.109f68","name":"updateRoom","links":["604d5679.2820a8","7617b0dc.9c27a","e2b6f8c3.598888","49404117.0231f","2a7781f8.d8451e","43d9e00d.06c2e","47ade8d3.fa85c8","d107ebd4.5f0418","a30de23c.d157e","3902144d.81ab8c"],"x":899,"y":272,"wires":[]},{"id":"ab7e0d9.92789f","type":"change","z":"897fdb2a.109f68","name":"settings","rules":[{"t":"set","p":"settingsContext","pt":"msg","to":"mySettings","tot":"str"},{"t":"set","p":"roomsContext","pt":"msg","to":"rooms","tot":"str"},{"t":"set","p":"roomContext","pt":"msg","to":"heating.rooms","tot":"str"},{"t":"set","p":"periodsContext","pt":"msg","to":"heating.periods","tot":"str"},{"t":"set","p":"deviceContext","pt":"msg","to":"{\"HM-CC-RT-DN\":\"heating.devices\",\"HM-Sec-SCo\":\"windows.devices\",\"HMIP-PS\":\"sockets.devices\",\"HMIP-PSM\":\"sockets.devices\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":298,"y":374,"wires":[["43c3f57f.c210bc","9050990b.5553c8"]]},{"id":"7723d235.db067c","type":"subflow:e0e53645.d85fd8","z":"897fdb2a.109f68","name":"add new Room","env":[{"name":"defaults","value":"{\"type\":\"room\",\"defaultTemp\":20,\"minTemp\":16,\"maxTemp\":24,\"winTemp\":10}","type":"json"}],"x":760,"y":272,"wires":[["673d1103.fd2fe"]]},{"id":"43c3f57f.c210bc","type":"function","z":"897fdb2a.109f68","name":"filter new devices","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.room === undefined) return [null,null,ui.disabled];\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,null,ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\n// check for new Room\nvar msgNewRoom= null;\nvar roomEntry=currentObject.entryExists(msg.settingsContext+'.'+msg.roomsContext+'.homematic',msg.room,\"name\");\nif (!roomEntry) {\n    msgNewRoom= {\n        \"topic\": msg.settingsContext+\".\"+msg.roomsContext+\".uiAdd\",\n        \"payload\": msg.room,\n        \"defaults\": {\n            \"source\": \"device\",\n            \"deviceType\": \"homatic\"\n        }\n    };\n    node.status({fill:\"green\",shape:\"dot\",text: msg.room+\" new\"});\n}\n\n// check for new device\n//node.warn(msg.deviceContext);\n//node.warn(msg.deviceContext.hasOwnProperty(msg.deviceType))\nvar msgNewDevice= null;\nif (msg.deviceContext.hasOwnProperty(msg.deviceType)) {\n//    node.warn(msg.settingsContext+'.'+msg.deviceContext[msg.deviceType]+'.homematic');\n    var deviceEntry=currentObject.entryExists(msg.settingsContext+'.'+msg.deviceContext[msg.deviceType]+'.homematic',msg.device,\"name\");\n//    node.warn(deviceEntry);\n    if (!deviceEntry && roomEntry) { // only if room exits\n        msgNewDevice= {\n            \"topic\": msg.settingsContext+\".\"+msg.deviceContext[msg.deviceType]+\".uiAdd\",\n            \"payload\": msg.device,\n            \"defaults\": {\n                \"source\": \"device\",\n                \"deviceName\": msg.deviceName,\n                \"deviceType\": msg.deviceType,\n                \"room\": msg.room,\n                \"roomUuid\": roomEntry.uuid\n            }\n        };\n        node.status({fill:\"green\",shape:\"dot\",text: msg.device+\" new\"});\n    }\n    if (deviceEntry) {\n        deviceEntry[msg.datapoint]= {\n            \"datapoint\": msg.datapoint,\n            \"datapointName\": msg.datapointName,\n            \"datapointMin\": msg.datapointMin,\n            \"datapointMax\": msg.datapointMax,\n            \"datapointDefault\": msg.datapointDefault,\n            \"datapointType\": msg.datapointType,\n            \"value\": msg.value\n        }\n    }\n    \n    return [msgNewRoom,msgNewDevice,msg,ui.enabled];\n} else {\n    node.status({fill:\"yellow\",shape:\"dot\",text: msg.deviceType+\" undefined\"});\n    return;\n}","outputs":4,"noerr":0,"x":481,"y":374,"wires":[["7723d235.db067c","39ef0ec4.5686d2"],["a5ab64be.9cfa48","41b0a88c.eb29d8"],["c0e3b6b0.78ffa8","2c347f7a.6efd1"],[]],"outputLabels":["newRoom","newDevice","message","enabled"]},{"id":"5b2ccb43.bd59f4","type":"subflow:30d3b36b.8d171c","z":"99f7fccc.6df2f","name":"","env":[],"x":281,"y":187,"wires":[["1f109766.2438b9"],["47e71fbc.8fed5"]]},{"id":"59328d01.19fe44","type":"comment","z":"897fdb2a.109f68","name":"Handle incomming messages for homematic devices","info":"the homematic ccu sends room names with every new value.\nif the room does not exits it will be automatically added to the database\nNew reedings will send with a modified topic and other data","x":258,"y":238,"wires":[]},{"id":"380d6165.def24e","type":"ui_heater_controller","z":"afaa0885.ad2718","name":"heater","group":"9ce06846.951a68","unit":"C","order":1,"width":8,"height":4,"topic":"Arbeitszimmer","sliderMinValue":10,"sliderMaxValue":35,"sliderStep":0.5,"thresholdRising":0.5,"thresholdFalling":0.5,"calendar":"{\n    \"Monday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Tuesday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Wednesday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Thursday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Friday\": {\n        \"00:00\": 19,\n        \"06:20\": 23,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Saturday\": {\n        \"00:00\": 19,\n        \"08:00\": 20,\n        \"20:00\": 22,\n        \"23:59\": 19\n    },\n    \"Sunday\": {\n        \"00:00\": 19,\n        \"08:00\": 20,\n        \"20:00\": 22,\n        \"23:59\": 19\n    }\n}","x":1138,"y":1037,"wires":[["92b35afb.a03f08"]]},{"id":"c23e076c.76b9a8","type":"link in","z":"afaa0885.ad2718","name":"update Chart","links":["5c9ea701.d1a758","2f827c46.e6e414","36d32a91.d1b4f6","bd444756.1d08e8","834d27dd.abd968","1dba0bcd.2d9d54"],"x":576,"y":493,"wires":[["b86b21db.c2b68"]]},{"id":"bf2fec97.c6463","type":"link in","z":"afaa0885.ad2718","name":"newTemp","links":["3276e425.a62e7c"],"x":100,"y":663,"wires":[["57ad0440.5441cc"]]},{"id":"3276e425.a62e7c","type":"link out","z":"afaa0885.ad2718","name":"newTemp","links":["bf2fec97.c6463"],"x":967,"y":833,"wires":[]},{"id":"974d4be9.b36dd8","type":"link out","z":"afaa0885.ad2718","name":"updateUiCharts","links":["43e416d.9fdc9e8"],"x":967,"y":544,"wires":[]},{"id":"43e416d.9fdc9e8","type":"link in","z":"afaa0885.ad2718","name":"updateUiCharts","links":["974d4be9.b36dd8"],"x":83,"y":1020,"wires":[["a0a1b0ea.47894"]]},{"id":"1f1d7c0d.edf184","type":"debug","z":"afaa0885.ad2718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1138,"y":1071,"wires":[]},{"id":"b22fa377.375a3","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":288,"y":442,"wires":[]},{"id":"a5ab64be.9cfa48","type":"subflow:e0e53645.d85fd8","z":"897fdb2a.109f68","name":"add new device","env":[{"name":"defaults","value":"{\"type\":\"homematicDevice\"}","type":"json"}],"x":760,"y":374,"wires":[["b276c5e9.8a1ac8"]]},{"id":"b276c5e9.8a1ac8","type":"link out","z":"897fdb2a.109f68","name":"updateThermostats","links":["5df47bd2.481764"],"x":899,"y":374,"wires":[]},{"id":"3924e72c.ffb7d8","type":"inject","z":"897fdb2a.109f68","name":"initalize","topic":"mySettings","payload":"uiInit","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":475,"y":952,"wires":[["3ac3a2ea.8778be"]]},{"id":"c1390f83.17151","type":"ui_table","z":"897fdb2a.109f68","group":"e1cac84f.fefdd8","name":"","order":1,"width":"15","height":"10","columns":[{"field":"name","title":"Device","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"deviceType","title":"Type","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"room","title":"Raum","width":"40%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"ACTUAL_TEMPERATURE-value","title":"Temp","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"VALVE_STATE-value","title":"Ventil","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"BATTERY_STATE-value","title":"Batt","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":883,"y":901,"wires":[["e011f241.e3854","de90c4c8.7db9d8"]]},{"id":"6a2bfd9e.ce1944","type":"function","z":"2f4c5529.6abcba","name":"buildTable","func":"var statusText= \"\";\nvar topicParts= (msg.topic)? msg.topic.split('.') : [\"\"];\n\n// get globalContext out of A) msg.globalContext B) env.globalContext C) msg.topic\nvar globalContext = (msg.globalContext) ? msg.globalContext : env.get(\"globalContext\");\nif (!globalContext || globalContext===\"\") globalContext=topicParts[0];\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar dataContext = (msg.dataContext) ? msg.dataContext : env.get(\"dataContext\");\nif ((!dataContext || dataContext===\"\") && topicParts.length>1) \n    dataContext=msg.topic.slice(msg.topic.indexOf('.'),msg.topic.lastIndexOf('.'));\n\nvar msgOut={};    \n// rebuild msg.topic (could be from differen sources)\nmsgOut.topic=globalContext+\".\"+dataContext+\".uiTable\";\n\n// aquire data\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    statusText=globalContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\nvar currentProperty=currentObject.getObject(msgOut.topic);\nif (!currentProperty) {\n    statusText=dataContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\n\nvar lineObj={};\nvar dataSelection=(msg.dataSelection)? msg.dataSelection : env.get(\"dataSelection\");\n\n// --------------------------------------\n// build list of used columns\n// --------------------------------------\nvar buildList = function (source,target,property,index) {\n    for (let sourceItem in source) {\n        if (source[sourceItem].columns) {\n            buildList(source[sourceItem].columns,target,property,index);\n        } else {\n            if (index<0) target.push(source[sourceItem][property]);\n            else target.push(source[sourceItem][property].split('.')[index]);\n        }\n    }\n}\n\nvar itemList=[];\nbuildList(dataSelection,itemList,\"field\",0);\n\n// --------------------------------------\n// function to get a value form a list object\n// --------------------------------------\nvar getValue= function(element, property) {\n    var propertySplitted=property.split('.');\n    for (var i=0; i<propertySplitted.length; i++) {\n        if (element && element.hasOwnProperty(propertySplitted[i])) {\n            element=element[propertySplitted[i]];\n        } else {\n//            node.warn(property)\n//            node.warn(element)\n            return undefined;\n        }\n    }\n    return element;\n}\n\n\n// --------------------------------------\n// function to a matching item\n// --------------------------------------\nvar getByName= function(anArray,aProperty,aValue) {\n    var result;\n    anArray.forEach(function (item) {\n        if (item[aProperty].replace(/\\./g,\"-\") == aValue.replace(/\\./g,\"-\")) {\n            result = item;\n            return;\n        }\n    })\n    return result;\n}\n\n// --------------------------------------\n// function to sort column to match a given array\n// --------------------------------------\nvar addedColumns = 0;\nvar sortColumnsByLayout = function (sortColumns, columnsLayout, targetColumns) {\n    for (var layoutColumn=0;  layoutColumn<columnsLayout.length; layoutColumn++) {\n        for (var sortColumn in sortColumns) {\n            if (sortColumns[sortColumn].columns) {\n                targetColumns.push({\"title\":sortColumns[sortColumn].title, \"columns\":[]});\n                sortColumnsByLayout(sortColumns[sortColumn].columns,columnsLayout,targetColumns[targetColumns.length-1].columns);\n                layoutColumn=addedColumns;\n            } else {\n                if (columnsLayout[layoutColumn].field===sortColumns[sortColumn].field){\n                    targetColumns.push(sortColumns[sortColumn]);\n                    addedColumns++;\n                    break;\n                }\n            }\n        }\n    }\n}\n\n\nvar fieldNoDots=\"\";\nswitch (msg.payload) {\n    case 'uiInit':\n        var config=env.get(\"config\");\n        msgOut.ui_control={\"tabulator\": (config) ? config : {}};\n\n        // ui_control add column definition\n        var addColumn = function (destination,element,source) {\n            switch (element) {\n                case 'field' : \n//                    fieldList.push(source);\n                    source=source.replace(/\\./g,\"-\");\n                    fieldNoDots= source;\n                    break;\n                case 'width' :\n                    if (currentProperty.layout && \n                        currentProperty.layout.columnWidths &&\n                        currentProperty.layout.columnWidths[fieldNoDots])\n                            source = currentProperty.layout.columnWidths[fieldNoDots].width;\n                    break; \n                case 'min' :\n                case 'max' :\n                    if (typeof source === \"string\") source=getValue(currentProperty.list[0],source);\n                    break;\n                    \n            }\n            \n            destination[element]=source;\n            return;\n        } \n        \n        var addColumns = function (destination,source) {\n            //node.warn(source);\n            for (var element in source) {\n                if (!destination[element]) destination[element]=(Array.isArray(source[element])) ? [] : {\"formatterParams\": {\"target\": \"_blank\"}}\n                if (typeof source[element] === \"object\") {\n                    addColumns(destination[element],source[element])\n                    //node.warn(destination[element]);\n                } else {\n                    addColumn(destination,element,source[element]);\n                }\n            }\n        }\n        \n        msgOut.ui_control.tabulator.columns = [];\n        addColumns(msgOut.ui_control.tabulator.columns,dataSelection);\n        //node.warn(msgOut.ui_control.tabulator.columns)\n        if (env.get(\"movableColumns\")) {\n            if (currentProperty.layout && Array.isArray(currentProperty.layout.columns)) { // && checkColumns(currentProperty, dataSelection)\n                try {\n                    var newConfig=[];\n                    addedColumns = 0;\n                    sortColumnsByLayout(msgOut.ui_control.tabulator.columns,currentProperty.layout.columns,newConfig);\n                    if (newConfig)\n                        msgOut.ui_control.tabulator.columns=newConfig;\n                    else \n                        node.warn(\"column sorting gave an empty list!\");\n                } catch(error) {\n                    node.error(\"an error accured when sorting columns (\"+error+\")\");\n                    delete currentProperty.layout.columns;\n                }\n            }\n        }\n        // get additional data from subflow config\n        msgOut.ui_control.tabulator.layout= env.get(\"layout\");\n        msgOut.ui_control.tabulator.movableColumns= env.get(\"movableColumns\");\n        msgOut.ui_control.tabulator.groupBy= env.get(\"groupBy\");\n        msgOut.ui_control.customHeight= env.get(\"customHeight\");\n        statusText= \"ui_control send \"+itemList.length + \" columns\";\n        \n    default:\n        if (msg.payload!=\"uiInit\" && itemList.indexOf(msg.datapoint)<0) {\n            statusText=msg.datapoint+\" not in Table\";\n            return [{payload:{fill:\"yellow\",shape:\"dot\",text: statusText}},null];\n        } else {\n            var fieldList=[];\n            buildList (dataSelection,fieldList,\"field\",-1);\n            \n            msgOut.payload=[];\n            // loop through lines\n            currentProperty.list.forEach(function (lineElement,lineIndex) {\n                // add Data to payload\n                lineObj={};\n                var addLine = function (column) {\n                    lineObj[column.replace(/\\./g,\"-\")]= getValue(lineElement,column);\n                }\n                fieldList.forEach(addLine);\n                \n                msgOut.payload.push(lineObj);\n            });\n            statusText= \"Data send \"+msgOut.payload.length + \" lines\";\n        }\n        break;\n}\n\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msgOut];","outputs":2,"noerr":0,"x":196,"y":85,"wires":[[],[]],"inputLabels":["trigger"],"outputLabels":["status","tableData"]},{"id":"3ac3a2ea.8778be","type":"subflow:2f4c5529.6abcba","z":"897fdb2a.109f68","name":"heating.devices","env":[{"name":"dataSelection","value":"[{\"title\":\"Raum\",\"field\":\"room\",\"width\":100,\"frozen\":true},{\"title\":\"Messungen\",\"columns\":[{\"title\":\"soll\",\"field\":\"SET_TEMPERATURE.value\",\"formatter\":\"function(cell, formatterParams, onRendered){return cell.getValue()+'°C';}\",\"topCalc\":\"avg\",\"width\":100},{\"title\":\"ist\",\"field\":\"ACTUAL_TEMPERATURE.value\",\"formatter\":\"progress\",\"topCalc\":\"avg\",\"formatterParams\":{\"min\":10,\"max\":25,\"color\":[\"blue\",\"green\",\"red\"],\"legend\":\"function (value) {return '&nbsp;&nbsp;'+value+'°C';}\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"left\"},\"width\":100},{\"title\":\"Ventil\",\"field\":\"VALVE_STATE.value\",\"formatter\":\"progress\",\"topCalc\":\"max\",\"formatterParams\":{\"min\":\"VALVE_STATE.datapointMin\",\"max\":\"VALVE_STATE.datapointMax\",\"color\":[\"gray\",\"orange\",\"red\"],\"legend\":\"function (value) {return (value>0)? '&nbsp;&nbsp;'+value+' %' : '-';}\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"width\":100},{\"title\":\"Batt\",\"field\":\"BATTERY_STATE.value\",\"formatter\":\"progress\",\"topCalc\":\"min\",\"formatterParams\":{\"min\":\"BATTERY_STATE.datapointMin\",\"max\":\"BATTERY_STATE.datapointMax\",\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {return value+' V';}\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"width\":100}]},{\"title\":\"Einstellungen\",\"columns\":[{\"title\":\"Boost\",\"field\":\"BOOST_STATE.value\",\"formatter\":\"progress\",\"formatterParams\":{\"min\":\"BOOST_STATE.datapointMin\",\"max\":\"BOOST_STATE.datapointMax\",\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" min</span>\\\";     else         return \\\"<span style='color:#A0A0A0;'>aus</span>\\\"; }\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"width\":100},{\"title\":\"Auto\",\"field\":\"AUTO_MODE.value\",\"formatter\":\"tickCross\",\"formatterParams\":{\"allowEmpty\":true,\"allowTruthy\":true,\"tickElement\":\"<i class='fa fa-clock-o'></i>\",\"crossElement\":\"<i class='fa fa-ban'></i>\"},\"width\":100,\"align\":\"center\"},{\"title\":\"Mode\",\"field\":\"CONTROL_MODE.value\",\"formatter\":\"function(cell, formatterParams, onRendered){     var html=\\\"<i class=\\\\\\\"\\\";     switch(cell.getValue()) {         case 0: html+=\\\"fa fa-calendar-check-o\\\"; break;         case 1: html+=\\\"fa fa-hand-o-up\\\"; break;         case 2: html+=\\\"fa fa-suitcase\\\"; break;         case 3: html+=\\\"fa fa-spinner fa-spin fa-fw\\\"; break;     }     html+='\\\\\\\"></i>';     return html; }\",\"width\":100,\"align\":\"center\"}]}]","type":"json"},{"name":"config","value":"{\"columnResized\":\"function(column){     var newColumn = {         field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\"}","type":"json"},{"name":"layout","value":"fitColumns","type":"str"},{"name":"customHeight","value":"12","type":"num"},{"name":"groupHeader","value":"function (value, count, data, group) {return value + \"<span style='color:#d00; margin-left:10px;'>(\" + count + \" Termostat\"+((count>1) ? \"e\" : \"\") + \")</span>\";}","type":"str"},{"name":"callbacks","value":"{\"columnMoved\":\"columnMoved = function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"columnResized\":\"columnResized = function(column){     var newColumns={};     var percentFactor=1;     var totalWidth=0;     var lastWidth=0;     var widthUnit='px';     column._column.table.columnManager.columns.forEach(function (aColumn) {          totalWidth += aColumn.width;         if (aColumn.definition.width.includes('%')) widthUnit='%';     });     if (widthUnit=='%') percentFactor=100/totalWidth;     totalWidth=0;      column._column.table.columnManager.columns.forEach(function (aColumn) {         lastWidth=Math.floor(aColumn.width*percentFactor);         newColumns[aColumn.field]=lastWidth+widthUnit;         totalWidth+= lastWidth;     });     if (widthUnit=='%' && totalWidth!=100 ) {         var keys=Object.keys(newColumns);         newColumns[keys[keys.length-1]].widthStyled=(lastWidth+(100-totalWidth))+widthUnit;     }     this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumns}}); };\"}","type":"json"}],"x":709,"y":901,"wires":[["c1390f83.17151","8fc4b51e.3d3718"]],"info":"# prepare data for ui-table node\n\n## callbacks\n```\ncolumnMoved = function(column, columns) {\n    var newColumns=[];\n    columns.forEach(function (column) {\n        newColumns.push({'field': column._column.field});\n    });\n    $scope.send({topic:$scope.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}});\n}\n```\n\n```\ncolumnResized = function(column){\n    var newColumns={};\n    var percentFactor=1;\n    var totalWidth=0;\n    var lastWidth=0;\n    var widthUnit='px';\n    column._column.table.columnManager.columns.forEach(function (aColumn) { \n        totalWidth += aColumn.width;\n        if (aColumn.definition.width.includes('%')) widthUnit='%';\n    });\n    if (widthUnit=='%') percentFactor=100/totalWidth;\n    totalWidth=0;\n                \n    column._column.table.columnManager.columns.forEach(function (aColumn) {\n        lastWidth=Math.floor(aColumn.width*percentFactor);\n        newColumns[aColumn.field]=lastWidth+widthUnit;\n        totalWidth+= lastWidth;\n    });\n    if (widthUnit=='%' && totalWidth!=100 ) {\n        var keys=Object.keys(newColumns);\n        newColumns[keys[keys.length-1]].widthStyled=(lastWidth+(100-totalWidth))+widthUnit;\n    }\n    $scope.send({topic:$scope.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumns}});\n};\n```\n"},{"id":"38e848c.4a875b8","type":"function","z":"f8262c22.ca30c","name":"table callback","func":"if (!msg.ui_control || !msg.ui_control.callback) return;\n\nvar statusText= \"\";\nvar topicParts= (msg.topic)? msg.topic.split('.') : [\"\"];\n\n// get globalContext out of A) msg.globalContext B) env.globalContext C) msg.topic\nvar globalContext = (msg.globalContext) ? msg.globalContext : env.get(\"globalContext\");\nif (!globalContext || globalContext===\"\") globalContext=topicParts[0];\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar dataContext = (msg.dataContext) ? msg.dataContext : env.get(\"dataContext\");\nif ((!dataContext || dataContext===\"\") && topicParts.length>1) \n    dataContext=msg.topic.slice(msg.topic.indexOf('.'),msg.topic.lastIndexOf('.'));\n    \n// rebuild msg.topic (could be from differen sources)\nmsg.topic=globalContext+\".\"+dataContext+\".uiTable\";\n\n// aquire data\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    statusText=globalContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    statusText=dataContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\n\n// -------------- store layout updates -----------------\n\nif (!currentProperty.layout) currentProperty.layout={};\nif (!currentProperty.layout.columns) currentProperty.layout.columns={};\nif (!currentProperty.layout.columnWidths) currentProperty.layout.columnWidths={};\nswitch(msg.ui_control.callback) {\n    case 'columnResized':\n        currentProperty.layout.columnWidths[msg.ui_control.columnWidths.field]=msg.ui_control.columnWidths;\n        statusText=\"width stored\"\n        break;\n    case 'columnMoved':\n        currentProperty.layout.columns=msg.ui_control.columns;\n        statusText=\"columns stored\"\n        break;\n}\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},null];\n","outputs":2,"noerr":0,"x":199,"y":85,"wires":[[],[]]},{"id":"e011f241.e3854","type":"subflow:f8262c22.ca30c","z":"897fdb2a.109f68","name":"","env":[{"name":"dataContext","value":"heating.devices","type":"str"}],"x":1049,"y":901,"wires":[[]]},{"id":"f5750d2d.53017","type":"function","z":"65174702.902988","name":"setValue by Group","func":"var statusText= \"\";\n \nvar msgsOut=[];\nvar topicParts= (msg.topic)? msg.topic.split('.') : [\"\"];\n\n// get globalContext out of A) msg.globalContext B) env.globalContext C) msg.topic\nvar globalContext = (msg.globalContext) ? msg.globalContext : env.get(\"globalContext\");\nif (!globalContext || globalContext===\"\") globalContext=topicParts[0];\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar dataContext = (msg.dataContext) ? msg.dataContext : env.get(\"dataContext\");\nif ((!dataContext || dataContext===\"\") && topicParts.length>1) \n    dataContext=msg.topic.slice(msg.topic.indexOf('.'),msg.topic.lastIndexOf('.'));\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar groupContext = (msg.groupContext) ? msg.groupContext : env.get(\"groupContext\");\n\n// aquire data\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    statusText=globalContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\nvar currentData=currentObject.getObject(globalContext+\".\"+dataContext+\".uiTable\");\nif (!currentData) { statusText=dataContext+\" not found\"; return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];}\n\nvar currentGroup=currentObject.getObject(globalContext+\".\"+groupContext+\".setValue\");\nif (!currentGroup) { statusText=groupContext+\" not found\"; return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];}\n\nvar targetKey=env.get(\"targetKey\");\nvar sourceKey=env.get(\"sourceKey\");\nfor (var dataItem of currentData.list) {\n    if (dataItem[targetKey]==msg.payload[targetKey]) {\n        let msgOut={\n            \"topic\":globalContext+\".\"+dataContext+\".uiTable\",\n            \"room\": msg.payload.room,\n            \"datapointName\": env.get(\"datapointName\"),\n            \"payload\": msg.payload.targetValue,\n            \"groupContext\": globalContext+\".\"+groupContext+\".setValue\",\n            \"deviceName\": dataItem.deviceName,\n            \"roomID\": dataItem.roomId\n        };\n        statusText=msg.room;\n        msgsOut.push(msgOut);\n    }\n}\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msgsOut];","outputs":2,"noerr":0,"x":243,"y":85,"wires":[[],[]]},{"id":"50a20eeb.2b705","type":"link in","z":"897fdb2a.109f68","name":"systemStarted","links":["4db6721d.45de6c","15f2ac84.d7a7b3"],"x":508,"y":850,"wires":[["3ac3a2ea.8778be"]]},{"id":"699fa730.275918","type":"subflow:65174702.902988","z":"afaa0885.ad2718","name":"","env":[],"x":1488,"y":1071,"wires":[["d93a4627.4e4118"]]},{"id":"55af5083.9c7ef","type":"inject","z":"afaa0885.ad2718","name":"initalize","topic":"","payload":"{\"room\":\"Wohnzimmer\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1291,"y":1122,"wires":[["699fa730.275918"]]},{"id":"92b35afb.a03f08","type":"change","z":"afaa0885.ad2718","name":"add room","rules":[{"t":"set","p":"payload.room","pt":"msg","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1301,"y":1071,"wires":[["699fa730.275918"]]},{"id":"26b6adab.2176a2","type":"ui_button","z":"afaa0885.ad2718","name":"","group":"9ce06846.951a68","order":2,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"timer","payload":"true","payloadType":"bool","topic":"","x":645,"y":1207,"wires":[["c21d3752.fc2028"]]},{"id":"d66c2850.277c38","type":"ui_button","z":"afaa0885.ad2718","name":"high","group":"9ce06846.951a68","order":3,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"fa-thermometer-full fa-2x","payload":"true","payloadType":"bool","topic":"","x":645,"y":1275,"wires":[["292fb76e.8ec348"]]},{"id":"760c9a9f.5cff64","type":"ui_button","z":"afaa0885.ad2718","name":"low","group":"9ce06846.951a68","order":4,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"fa-thermometer-half fa-2x","payload":"true","payloadType":"bool","topic":"","x":645,"y":1377,"wires":[["e46441fd.cedc6"]]},{"id":"59d3d239.da2ccc","type":"ui_button","z":"afaa0885.ad2718","name":"Boost","group":"9ce06846.951a68","order":5,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"timelapse","payload":"true","payloadType":"bool","topic":"{{msg.topic}}","x":645,"y":1479,"wires":[["bc75e252.d90c9"]]},{"id":"2660d137.ac350e","type":"link out","z":"897fdb2a.109f68","name":"homematicThermotstat","links":["14ca55d8.90760a"],"x":933,"y":527,"wires":[]},{"id":"f2614149.ecb88","type":"function","z":"288b8cb6.42ac94","name":"preUI","func":"var statusText=\"\"\nif (msg.datapoint===env.get(\"datapoint\")) {\n    var msgUI={\"payload\":\"\"};\n    if (typeof msg.payload==\"boolean\") {\n        if (msg.payload) {\n            msgUI.ui_control={\"bgcolor\":\"#eb9534\"};\n            statusText=\"ein\";\n        } else {\n            msgUI.ui_control={\"bgcolor\":\"\"};\n            statusText=\"aus\";\n        }\n    } else {\n        if (msg.payload>0) {\n            msgUI.label=msg.payload+\"min\";\n            msgUI.ui_control={\"bgcolor\":\"#eb9534\"};\n        } else {\n            msgUI.label=\"aus\";\n            msgUI.ui_control={\"bgcolor\":\"\"};\n        }\n        statusText=msgUI.label;\n    }\n    return [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msgUI];\n}","outputs":2,"noerr":0,"x":186,"y":85,"wires":[[],[]]},{"id":"5bbb1b98.ca3604","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"BOOST_STATE","env":[{"name":"room","value":"Dusche","type":"str"}],"x":454,"y":1479,"wires":[["59d3d239.da2ccc"]]},{"id":"2fdefbc3.19e354","type":"ui_ui_control","z":"897fdb2a.109f68","name":"","events":"all","x":128,"y":969,"wires":[["59c024d4.156bfc"]]},{"id":"59c024d4.156bfc","type":"switch","z":"897fdb2a.109f68","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"connect","vt":"str"},{"t":"eq","v":"change","vt":"str"},{"t":"eq","v":"lost","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":289,"y":969,"wires":[["e486e65b.a94ce8"],["e486e65b.a94ce8"],["6096176e.2d1d88"]]},{"id":"e486e65b.a94ce8","type":"change","z":"897fdb2a.109f68","name":"uiInit","rules":[{"t":"set","p":"payload","pt":"msg","to":"uiInit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":475,"y":901,"wires":[["3ac3a2ea.8778be"]]},{"id":"6096176e.2d1d88","type":"function","z":"897fdb2a.109f68","name":"close socket","func":"var myUI=global.get(\"myUI\");\nif (myUI.hasOwnProperty(msg.socketid)) {\n    delete myUI[msg.socketid];\n    node.status({fill:\"green\",shape:\"dot\",text:\"socket closed!\"});\n} else {\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"socket unknown!\"});\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1000,"wires":[[]]},{"id":"374c9f22.55b41","type":"function","z":"77ddfba9.23c614","name":"postUI","func":"msg.room=env.get(\"room\");\nmsg.datapoint=env.get(\"datapoint\");\nmsg.topic=env.get(\"topic\");\n\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))}},null,null];\n}\nvar devices=currentObject.getObject(msg.topic);\nfor(var device in devices.list) {\n    if (devices.list[device].room==msg.room) {\n        msg.payload=!devices.list[device][msg.datapoint].value;\n        devices.list[device][msg.datapoint].value=msg.payload;\n    }\n}\nvar statusText= msg.room+\":\"+msg.datapoint+\"=\"+msg.payload;\nvar msgUI=(msg.payload)? \n    {\"ui_control\": {\"color\":\"#ffffff\",\"bgcolor\":\"#b87d2a\"}}:\n    {\"ui_control\": {\"color\":\"\",\"bgcolor\":\"\"}};\nmsgUI.payload=\"\";\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msg,msgUI,{\"payload\":false}];","outputs":4,"noerr":0,"x":169,"y":85,"wires":[[],[],[],[]],"outputLabels":["state","toController","uiFeedback",""]},{"id":"bc75e252.d90c9","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"topic","value":"mySettings.heating.devices.list","type":"str"}],"x":886,"y":1513,"wires":[["d0c8a047.0030d"],["59d3d239.da2ccc"],[]]},{"id":"d8deca34.d729f8","type":"link in","z":"897fdb2a.109f68","name":"setHomematic","links":["d0c8a047.0030d","d93a4627.4e4118"],"x":151,"y":578,"wires":[["33b98145.f2f30e","881e8a94.e84cb8"]]},{"id":"d0c8a047.0030d","type":"link out","z":"afaa0885.ad2718","name":"setHomematic","links":["d8deca34.d729f8"],"x":1120,"y":1343,"wires":[]},{"id":"33b98145.f2f30e","type":"function","z":"897fdb2a.109f68","name":"sendByRoom","func":"node.status({});\nif (msg.payload === undefined) return [null]\n\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nvar devices=currentObject.getObject(msg.topic);\n\nmsgOut=[];\nfor(var device in devices.list) {\n    if (devices.list[device].room==msg.room) {\n        msgOut.push({\n            \"topic\":devices.list[device][msg.datapointName].datapointName,\n            \"payload\":msg.payload});\n    }\n}\nnode.status({fill:\"green\",shape:\"dot\",text: msg.datapointName+\"=\"+msg.payload});\nreturn msgOut;","outputs":1,"noerr":0,"x":319,"y":578,"wires":[["ee30b845.4157a8","ca6f4c89.711eb"]]},{"id":"ca6f4c89.711eb","type":"ccu-value","z":"897fdb2a.109f68","name":"","iface":"BidCos-RF","channel":"","datapoint":"","mode":"","start":true,"change":true,"cache":true,"queue":false,"on":0,"onType":"undefined","ramp":0,"rampType":"undefined","working":false,"ccuConfig":"dcd63e8.d157fc","topic":"${CCU}/${Interface}/${channel}/${datapoint}","x":526,"y":578,"wires":[[]]},{"id":"881e8a94.e84cb8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":288,"y":646,"wires":[]},{"id":"ee30b845.4157a8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":526,"y":646,"wires":[]},{"id":"d97e19b5.87a038","type":"ui_text_input","z":"dd3f4b52.8a4468","name":"name","label":"","tooltip":"","group":"1727a207.b3522e","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.heating.periods.name","x":560,"y":289,"wires":[["c9039c74.f2a3d"]]},{"id":"5439ed5.7be8814","type":"ui_button","z":"dd3f4b52.8a4468","name":"uiDelete","group":"1727a207.b3522e","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.heating.periods.uiDelete","x":570,"y":204,"wires":[["91115979.ce6ef8"]]},{"id":"d8b4dc09.39b6","type":"ui_date_picker","z":"dd3f4b52.8a4468","name":"start","label":"","group":"1727a207.b3522e","order":7,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.periods.start","x":560,"y":349,"wires":[["c9039c74.f2a3d"]]},{"id":"a23010ff.ec49c","type":"ui_date_picker","z":"dd3f4b52.8a4468","name":"end","label":"","group":"1727a207.b3522e","order":9,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.periods.end","x":560,"y":409,"wires":[["c9039c74.f2a3d"]]},{"id":"fa2b5d01.652dd","type":"ui_text","z":"dd3f4b52.8a4468","group":"1727a207.b3522e","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":164,"y":275,"wires":[]},{"id":"ead1e965.aa3f68","type":"ui_text","z":"dd3f4b52.8a4468","group":"1727a207.b3522e","order":6,"width":2,"height":1,"name":"Start:","label":"Anfang:","format":"{{msg.payload}}","layout":"row-spread","x":164,"y":335,"wires":[]},{"id":"e9936df2.ea103","type":"ui_text","z":"dd3f4b52.8a4468","group":"1727a207.b3522e","order":8,"width":2,"height":1,"name":"End:","label":"Ende:","format":"{{msg.payload}}","layout":"row-spread","x":164,"y":395,"wires":[]},{"id":"6a84f2d4.226abc","type":"ui_dropdown","z":"dd3f4b52.8a4468","name":"uiDropdown","label":"","tooltip":"","place":"Tage auswählen","group":"1727a207.b3522e","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.heating.periods.uiDropdown","x":580,"y":85,"wires":[["16747f89.5a9e6"]]},{"id":"f30d4ae0.421b58","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1005,"y":349,"wires":[]},{"id":"e5b0ccf8.8cbf9","type":"link in","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["f30d4ae0.421b58","aa9da778.95b658","480be8a7.ca3858","c3518fa6.aeb8c","286c7f51.fb355"],"x":66,"y":204,"wires":[["7ce76bdb.c899a4"]]},{"id":"aa9da778.95b658","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1001,"y":102,"wires":[]},{"id":"baf525eb.f5de78","type":"function","z":"dd3f4b52.8a4468","name":"save List","func":"node.status({});\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar currentProperty=currentObject.getCurrentEntry(msg.topic);\nif (!currentProperty) {\n    node.status({fill:\"red\",shape:\"dot\",text: msg.topic+\" not found\"});\n    return;\n}\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\n\ntry {\n    currentProperty.days.forEach(function (item,index) {\n        if (item.title.includes(msg.payload.title)) {\n            item.isChecked=msg.payload.isChecked;\n            node.status({fill:\"green\",shape:\"dot\",text:msg.payload.title+\"=\"+msg.payload.isChecked});\n            return msg;\n        }\n    });\n //   node.status({fill:\"yellow\",shape:\"dot\",text:msg.payload.title+\" not found\"});\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n} ","outputs":1,"noerr":0,"x":876,"y":459,"wires":[[]]},{"id":"c3518fa6.aeb8c","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1009,"y":215,"wires":[]},{"id":"43ac6074.ce415","type":"ui_button","z":"dd3f4b52.8a4468","name":"uiAdd","group":"1727a207.b3522e","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.heating.periods.uiAdd","x":564,"y":155,"wires":[["8efca346.1bc4e"]]},{"id":"286c7f51.fb355","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1009,"y":155,"wires":[]},{"id":"5d2f0dd.1fe12f4","type":"switch","z":"dd3f4b52.8a4468","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.heating.periods.name","vt":"str"},{"t":"eq","v":"mySettings.heating.periods.start","vt":"str"},{"t":"eq","v":"mySettings.heating.periods.end","vt":"str"},{"t":"eq","v":"mySettings.heating.periods.days","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":360,"y":389,"wires":[["d97e19b5.87a038"],["d8b4dc09.39b6"],["a23010ff.ec49c"],["378844f7.a04c1c"]]},{"id":"91115979.ce6ef8","type":"ui_toast","z":"dd3f4b52.8a4468","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":740,"y":204,"wires":[["e52a49d0.5016a8"]]},{"id":"8ca231d8.0d419","type":"link out","z":"dd3f4b52.8a4468","name":"Periodenliste","links":["cee4b8dd.5e4678"],"x":525,"y":34,"wires":[]},{"id":"c9080f67.e24a6","type":"link in","z":"dd3f4b52.8a4468","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":66,"y":85,"wires":[["1fb940b1.6cff6f"]]},{"id":"16747f89.5a9e6","type":"subflow:c4a7cd6c.2a0c1","z":"dd3f4b52.8a4468","name":"","env":[],"x":876,"y":85,"wires":[["aa9da778.95b658"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"e52a49d0.5016a8","type":"subflow:d4a0d961.b11238","z":"dd3f4b52.8a4468","name":"","env":[],"x":886,"y":204,"wires":[["c3518fa6.aeb8c"]]},{"id":"c9039c74.f2a3d","type":"subflow:dfa4352b.bdc548","z":"dd3f4b52.8a4468","name":"","env":[],"x":870,"y":349,"wires":[["f30d4ae0.421b58"]]},{"id":"8efca346.1bc4e","type":"subflow:e0e53645.d85fd8","z":"dd3f4b52.8a4468","name":"addPeriod","env":[{"name":"defaults","value":"{\"note\":\"\",\"start\":0,\"end\":0,\"days\":[{\"title\":\"Montag\",\"description\":\"1. Tag der Woche\",\"isChecked\":false},{\"title\":\"Dienstag\",\"isChecked\":false},{\"title\":\"Mittwoch\",\"isChecked\":false},{\"title\":\"Donnerstag\",\"isChecked\":false},{\"title\":\"Freitag\",\"isChecked\":false},{\"title\":\"Samstag\",\"isChecked\":false},{\"title\":\"Sonntag\",\"isChecked\":false}]}","type":"json"}],"x":886,"y":153,"wires":[["286c7f51.fb355"]]},{"id":"1fb940b1.6cff6f","type":"subflow:e0e09953.42b938","z":"dd3f4b52.8a4468","name":"","env":[],"x":172,"y":85,"wires":[["a7df1d89.5a2f8","3cc8a52e.5c819a"]]},{"id":"7ce76bdb.c899a4","type":"subflow:30d3b36b.8d171c","z":"dd3f4b52.8a4468","name":"","env":[],"x":162,"y":204,"wires":[["a7df1d89.5a2f8"],["5d2f0dd.1fe12f4"]]},{"id":"a7df1d89.5a2f8","type":"subflow:8ba1eff6.75a11","z":"dd3f4b52.8a4468","name":"","env":[],"x":376,"y":85,"wires":[["8ca231d8.0d419","6a84f2d4.226abc","9180f1da.c0222"]]},{"id":"1f21ccbe.1ceb73","type":"ui_slider","z":"45367253.8faa7c","name":"defaultTemp","label":"","tooltip":"Standard Temperatur","group":"3e5d4543.e67aaa","order":7,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.defaultTemp","min":"10","max":"32","step":"0.5","x":563,"y":357,"wires":[["e8dd3ddb.3e972"]]},{"id":"681af0a6.9dd9c","type":"ui_numeric","z":"45367253.8faa7c","name":"defaultTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":8,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.defaultTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":563,"y":408,"wires":[["e8dd3ddb.3e972"]]},{"id":"59d8425e.6cb33c","type":"ui_slider","z":"45367253.8faa7c","name":"minTemp","label":"","tooltip":"minTemperatur","group":"3e5d4543.e67aaa","order":10,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.minTemp","min":"10","max":"32","step":"0.5","x":553,"y":459,"wires":[["e8dd3ddb.3e972"]]},{"id":"409b5ee3.734e7","type":"ui_numeric","z":"45367253.8faa7c","name":"minTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":11,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.minTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":553,"y":510,"wires":[["e8dd3ddb.3e972"]]},{"id":"bce7494b.8bcb38","type":"ui_slider","z":"45367253.8faa7c","name":"maxTemp","label":"","tooltip":"max Temperatur","group":"3e5d4543.e67aaa","order":13,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.maxTemp","min":"10","max":"32","step":"0.5","x":553,"y":561,"wires":[["e8dd3ddb.3e972"]]},{"id":"7f990308.4b3c6c","type":"ui_numeric","z":"45367253.8faa7c","name":"maxTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":14,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.maxTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":553,"y":612,"wires":[["e8dd3ddb.3e972"]]},{"id":"7657836a.dcf97c","type":"ui_slider","z":"45367253.8faa7c","name":"winTemp","label":"","tooltip":"Lüftungs Temperatur","group":"3e5d4543.e67aaa","order":16,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.winTemp","min":"10","max":"32","step":"0.5","x":553,"y":663,"wires":[["e8dd3ddb.3e972"]]},{"id":"81865311.1028b","type":"ui_numeric","z":"45367253.8faa7c","name":"winTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":17,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.winTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":553,"y":714,"wires":[["e8dd3ddb.3e972"]]},{"id":"bd444756.1d08e8","type":"link out","z":"45367253.8faa7c","name":"update Chart","links":["3bdaaf3a.acde6","c23e076c.76b9a8"],"x":967,"y":357,"wires":[]},{"id":"9c56db.a9d81928","type":"ui_text_input","z":"45367253.8faa7c","name":"name","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.rooms.name","x":543,"y":306,"wires":[["e8dd3ddb.3e972"]]},{"id":"5c4901c3.c6544","type":"ui_button","z":"45367253.8faa7c","name":"uiDelete","group":"3e5d4543.e67aaa","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.rooms.uiDelete","x":553,"y":238,"wires":[["9f147b0d.831038"]]},{"id":"3b6634d0.2b351c","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":135,"y":306,"wires":[]},{"id":"47076641.09ba38","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":6,"width":2,"height":1,"name":"standard Temp","label":"standard:","format":"{{msg.payload}}","layout":"row-spread","x":165,"y":357,"wires":[]},{"id":"38794688.f7dafa","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":9,"width":2,"height":1,"name":"min Temp","label":"min:","format":"{{msg.payload}}","layout":"row-spread","x":145,"y":459,"wires":[]},{"id":"fcf56307.1a039","type":"ui_dropdown","z":"45367253.8faa7c","name":"uiDropdown","label":"","tooltip":"","place":"Raum auswählen","group":"3e5d4543.e67aaa","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.rooms.uiDropdown","x":563,"y":119,"wires":[["bf84f42d.48d7a8"]]},{"id":"e4ebc040.ea23a","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":306,"wires":[]},{"id":"7617b0dc.9c27a","type":"link in","z":"45367253.8faa7c","name":"updateRoom","links":["e4ebc040.ea23a","f5b51a0c.2d40f8","2184abed.0f3854","85b3a82f.196ff8","673d1103.fd2fe"],"x":49,"y":204,"wires":[["879210e4.df1dc"]]},{"id":"85b3a82f.196ff8","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":119,"wires":[]},{"id":"f5b51a0c.2d40f8","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":238,"wires":[]},{"id":"222984a5.3bf3ec","type":"ui_button","z":"45367253.8faa7c","name":"uiAdd","group":"3e5d4543.e67aaa","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.rooms.uiAdd","x":543,"y":187,"wires":[["aa9631f1.58127"]]},{"id":"2184abed.0f3854","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":187,"wires":[]},{"id":"3801ce78.21bff2","type":"switch","z":"45367253.8faa7c","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.rooms.name","vt":"str"},{"t":"eq","v":"mySettings.rooms.defaultTemp","vt":"str"},{"t":"eq","v":"mySettings.rooms.minTemp","vt":"str"},{"t":"eq","v":"mySettings.rooms.maxTemp","vt":"str"},{"t":"eq","v":"mySettings.rooms.winTemp","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":339,"y":374,"wires":[["9c56db.a9d81928"],["1f21ccbe.1ceb73","681af0a6.9dd9c"],["59d8425e.6cb33c","409b5ee3.734e7"],["bce7494b.8bcb38","7f990308.4b3c6c"],["7657836a.dcf97c","81865311.1028b"]]},{"id":"9f147b0d.831038","type":"ui_toast","z":"45367253.8faa7c","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":706,"y":238,"wires":[["baca714f.0d771"]]},{"id":"c84c6ede.eac3a","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":12,"width":2,"height":1,"name":"max Temp","label":"max:","format":"{{msg.payload}}","layout":"row-spread","x":155,"y":561,"wires":[]},{"id":"65c3aa3.01ad954","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":15,"width":2,"height":1,"name":"Fenster Temp","label":"Fenster:","format":"{{msg.payload}}","layout":"row-spread","x":165,"y":663,"wires":[]},{"id":"b2a258b.6903ca8","type":"link in","z":"45367253.8faa7c","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":49,"y":119,"wires":[["5f370c3b.990b24"]]},{"id":"a22aab5f.173ae8","type":"change","z":"45367253.8faa7c","name":"defaults","rules":[{"t":"set","p":"defaultTemp","pt":"msg","to":"23","tot":"num"},{"t":"set","p":"minTemp","pt":"msg","to":"16","tot":"num"},{"t":"set","p":"maxTemp","pt":"msg","to":"28","tot":"num"},{"t":"set","p":"winTemp","pt":"msg","to":"10","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":689,"y":153,"wires":[[]]},{"id":"bf84f42d.48d7a8","type":"subflow:c4a7cd6c.2a0c1","z":"45367253.8faa7c","name":"","env":[],"x":842,"y":119,"wires":[["85b3a82f.196ff8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"baca714f.0d771","type":"subflow:d4a0d961.b11238","z":"45367253.8faa7c","name":"","env":[],"x":852,"y":238,"wires":[["f5b51a0c.2d40f8"]]},{"id":"e8dd3ddb.3e972","type":"subflow:dfa4352b.bdc548","z":"45367253.8faa7c","name":"","env":[],"x":842,"y":306,"wires":[["e4ebc040.ea23a"]]},{"id":"aa9631f1.58127","type":"subflow:e0e53645.d85fd8","z":"45367253.8faa7c","name":"newRoom","env":[{"name":"defaults","value":"{\"type\":\"room\",\"note\":\"\",\"defaultTemp\":20,\"minTemp\":10,\"maxTemp\":26,\"winTemp\":10}","type":"json"}],"x":842,"y":187,"wires":[["2184abed.0f3854"]]},{"id":"5f370c3b.990b24","type":"subflow:e0e09953.42b938","z":"45367253.8faa7c","name":"","env":[{"name":"baseObject","value":"rooms","type":"str"}],"x":155,"y":119,"wires":[["43cbaf37.99f38"]]},{"id":"879210e4.df1dc","type":"subflow:30d3b36b.8d171c","z":"45367253.8faa7c","name":"","env":[],"x":145,"y":204,"wires":[["43cbaf37.99f38"],["3801ce78.21bff2"]]},{"id":"43cbaf37.99f38","type":"subflow:8ba1eff6.75a11","z":"45367253.8faa7c","name":"","env":[],"x":359,"y":119,"wires":[["fcf56307.1a039","2d70dbd3.249b94"]]},{"id":"2d70dbd3.249b94","type":"link out","z":"45367253.8faa7c","name":"Raumliste","links":["c50c7cfb.369ab"],"x":508,"y":68,"wires":[]},{"id":"4f125157.b64ed","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"LOWERING_MODE","env":[{"name":"dataPoint","value":"LOWERING_MODE","type":"str"},{"name":"room","value":"Dusche","type":"str"}],"x":474,"y":1377,"wires":[["760c9a9f.5cff64"]]},{"id":"e46441fd.cedc6","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"parameter","value":"LOWERING_MODE","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"}],"x":886,"y":1411,"wires":[["d0c8a047.0030d"],["760c9a9f.5cff64"],["59d3d239.da2ccc","d66c2850.277c38"]]},{"id":"d5c15893.96aca8","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"COMFORT_MODE","env":[{"name":"dataPoint","value":"COMFORT_MODE","type":"str"},{"name":"room","value":"Dusche","type":"str"}],"x":464,"y":1275,"wires":[["d66c2850.277c38"]]},{"id":"292fb76e.8ec348","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"parameter","value":"COMFORT_MODE","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"}],"x":886,"y":1309,"wires":[["d0c8a047.0030d"],["d66c2850.277c38"],["760c9a9f.5cff64","59d3d239.da2ccc"]]},{"id":"c21d3752.fc2028","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"parameter","value":"AUTO_MODE","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"}],"x":886,"y":1241,"wires":[["d0c8a047.0030d"],["26b6adab.2176a2"],["59d3d239.da2ccc"]]},{"id":"92adb69e.7aed88","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"AUTO_MODE","env":[{"name":"dataPoint","value":"AUTO_MODE","type":"str"},{"name":"room","value":"Dusche","type":"str"}],"x":454,"y":1207,"wires":[["26b6adab.2176a2"]]},{"id":"b6b74615.0add68","type":"ui_toast","z":"897fdb2a.109f68","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"New Room?","x":1010,"y":160,"wires":[["1559bf45.0da0c1"]]},{"id":"d3a1410.d6faac","type":"function","z":"897fdb2a.109f68","name":"pre","func":"msg.oiginalMsg=RED.util.cloneMessage(msg)\nmsg.topic=msg.payload\nmsg.payload=\"Neuer Raum erkannt, soll dieser hinzugefügt werden\";\nnode.status({fill:\"yellow\",shape:\"dot\",text: \"neu:\"+msg.room});\nreturn msg;","outputs":1,"noerr":0,"x":854,"y":160,"wires":[["b6b74615.0add68"]]},{"id":"1559bf45.0da0c1","type":"function","z":"897fdb2a.109f68","name":"post","func":"if (msg.payload==\"OK\"){\n    msg=msg.oiginalMsg;\n    node.status({fill:\"green\",shape:\"dot\",text: \"add: \"+msg.room});\n    return msg;\n} else {\n    node.status({fill:\"red\",shape:\"dot\",text: \"calcel: \"+msg.room});\n}\n    ","outputs":1,"noerr":0,"x":1143,"y":160,"wires":[[]]},{"id":"c0e3b6b0.78ffa8","type":"switch","z":"897fdb2a.109f68","name":"deviceType","property":"deviceType","propertyType":"msg","rules":[{"t":"eq","v":"HM-CC-RT-DN","vt":"str"},{"t":"eq","v":"HM-Sec-SCo","vt":"str"},{"t":"eq","v":"HMIP-PSM","vt":"str"},{"t":"eq","v":"HMIP-PS","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":750,"y":629,"wires":[["2660d137.ac350e"],["c9fec9ca.06c768"],["3b16819b.b112ee"],[]],"outputLabels":["Thermostat","Window","measuring Socket","Socket"]},{"id":"2c347f7a.6efd1","type":"link out","z":"897fdb2a.109f68","name":"ui-Table","links":["c6ef1a3f.b313c8"],"x":695,"y":440,"wires":[]},{"id":"c6ef1a3f.b313c8","type":"link in","z":"897fdb2a.109f68","name":"ui-table","links":["2c347f7a.6efd1"],"x":304,"y":799,"wires":[["e2184403.303c08"]]},{"id":"e2184403.303c08","type":"switch","z":"897fdb2a.109f68","name":"deviceType","property":"deviceType","propertyType":"msg","rules":[{"t":"eq","v":"HM-CC-RT-DN","vt":"str"},{"t":"eq","v":"HM-Sec-SCo","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":442,"y":799,"wires":[["3ac3a2ea.8778be"],[]]},{"id":"9cddbe0f.c49aa","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1274,"y":595,"wires":[]},{"id":"d93a4627.4e4118","type":"link out","z":"afaa0885.ad2718","name":"setHomematic","links":["d8deca34.d729f8"],"x":1596,"y":1071,"wires":[]},{"id":"c9fec9ca.06c768","type":"switch","z":"897fdb2a.109f68","name":"Fenterkontakt (dataPoint)","property":"datapoint","propertyType":"msg","rules":[{"t":"eq","v":"STATE","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1028,"y":595,"wires":[["9cddbe0f.c49aa"]]},{"id":"3b16819b.b112ee","type":"switch","z":"897fdb2a.109f68","name":"Steckdose messend (dataPoint)","property":"datapoint","propertyType":"msg","rules":[{"t":"eq","v":"STATE","vt":"str"},{"t":"eq","v":"FREQUENCY","vt":"str"},{"t":"eq","v":"VOLTAGE","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1048,"y":680,"wires":[["997ce432.b8f658"],["615e37c1.ce5ce8"],["994d1ce.0deabe"]]},{"id":"eb1d6c8d.22fee","type":"comment","z":"897fdb2a.109f68","name":"Handle outgoing messages for homematic devices","info":"","x":258,"y":527,"wires":[]},{"id":"40e23834.6b3c78","type":"function","z":"bbf5d78f.c16998","name":"filter Room","func":"if (msg.room==env.get(\"room\")) {\n    return [{payload:{fill:\"green\",shape:\"dot\",text: msg.room}},msg];\n} else {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text: msg.room}},null];\n}","outputs":2,"noerr":0,"x":206,"y":85,"wires":[[],[]]},{"id":"a0a1b0ea.47894","type":"subflow:bbf5d78f.c16998","z":"afaa0885.ad2718","name":"Arbeitszimmer","env":[],"x":206,"y":1054,"wires":[["5bbb1b98.ca3604","4f125157.b64ed","d5c15893.96aca8","92adb69e.7aed88","94bfa7d7.5b8398","dfd31a4e.2d22d8"]]},{"id":"14ca55d8.90760a","type":"link in","z":"afaa0885.ad2718","name":"homematicThermotstat","links":["2660d137.ac350e"],"x":83,"y":1088,"wires":[["a0a1b0ea.47894"]]},{"id":"5d20737b.4da22c","type":"inject","z":"309a0a3e.c49326","name":"initalize","topic":"mySettings","payload":"uiInit","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":111,"y":85,"wires":[["92438ce.e26927"]]},{"id":"92438ce.e26927","type":"function","z":"309a0a3e.c49326","name":"initMethods","func":"// expect global context name in msg.topic\n\nnode.status({});\n\n// get or initalize root for global store\nvar currentObject= global.get(msg.topic,\"file\");\nif (!currentObject) {\n    currentObject={};\n    global.set(msg.topic,currentObject,\"file\")\n}\n\n// generate UUID\ncurrentObject.uuid = function () {\n  function chr4(){\n    return Math.random().toString(16).slice(-4);\n  }\n  return chr4() + chr4() +\n    '-' + chr4() +\n    '-' + chr4() +\n    '-' + chr4() +\n    '-' + chr4() + chr4() + chr4();\n}\n\n// adjust x coordinate by sytem time zone\n// zone     : hours from GMT (-1 for CET / Berlin)\n\ncurrentObject.isUuid = function(payload) {\n    if (typeof payload == \"string\")\n        return (\n            payload.substr(8,1)=='-' &&\n            payload.substr(13,1)=='-'&&\n            payload.substr(18,1)=='-' &&\n            payload.substr(23,1)=='-')\n    return false;\n}\n\n// deep merge one object (source) into a target\ncurrentObject.merge = function (target,source) {\n//    node.warn(\"merge source\")\n//    node.warn(source);\n    for (var item in source) {\n        if (typeof source[item] === \"object\") {\n            if (Array.isArray(source[item])) { // because arrays are objects too!\n                if (typeof target[item] === \"object\" && !Array.isArray(target[item])) { // already existing?\n                    target[item]= []; // right type (array)?\n                } else {\n                    if (!Array.isArray(target[item])) target[item]= [];\n                }\n            } else { \n                if (target.hasOwnProperty(item) && typeof target[item] === \"object\") { // already existing?\n                    // keep existing\n                } else {\n                    target[item]= {};\n                }\n            }\n            this.merge(target[item],source[item])\n        } else {\n            if (target[item]===undefined) target[item]=source[item]; // do not overwrite\n        }\n    }\n//    node.warn(\"merge target\");\n//    node.warn(target);\n}\n\ncurrentObject.adjustTime = function (zone,point) {\n  point.x=point.x+(zone*3600000);\n  return point;\n}\n\n// sort a copy of an array of objects by name and keep the index\n// use for display purose or one time use ony\n//\n// originalArray : array of objects (must include name property)\n//\n// return       : sorted array as copy\n\ncurrentObject.saveSort = function(originalArray) {\n    var sortedArray=[]; // make a copy to not mess up the index for later use\n    originalArray.forEach(function(item,index){ \n        sortedArray.push(item);\n    });\n    // sorting should be save because it only sorts for display purpose\n    sortedArray.sort(function(a,b) {\n        if (a.name > b.name) return 1;\n        if (a.name < b.name) return -1;\n        return 0;\n    });\n    return sortedArray;\n}\n// store current settings in flow for durther use\ncurrentObject.getUI = function (socketid) {\n    var myUI=global.get(\"myUI\");\n    if (!myUI) {\n        myUI={\"version\":\"0.0.1\"}\n        global.set(\"myUI\",myUI);\n    }\n    if (!myUI[socketid]) {\n        myUI[socketid]= {\"socketid\":socketid};\n    }\n    return myUI[socketid];\n}\n\n// function to create object for specific topic\ncurrentObject.newObject = function(topic) {\n    var topicParts = topic.split('.');\n    var keyword=topicParts.pop();\n    if (keyword!='uiAdd') return undefined;\n    if (topicParts.length<2) return undefined;\n    var objectPtr=global.get(topicParts[0],\"file\");\n    for (var i=1; i<topicParts.length; i++) {\n        if (!objectPtr[topicParts[i]]) objectPtr[topicParts[i]]={}; // object not found so initialize it\n        objectPtr=objectPtr[topicParts[i]];\n    }\n    if (!objectPtr.list) objectPtr.list=[]; // initialize list if not existing\n    objectPtr.list.push({}); // add new object into list\n    objectPtr.list[objectPtr.list.length-1].uuid=this.uuid();\n    return objectPtr;\n};\n\n// function to get object holding the list array for specific topic or initialize the object\ncurrentObject.getObject = function(topic) {\n    if (!topic) return undefined;\n    if (typeof topic === \"object\") return topic; // topic is already object\n    var topicParts = topic.split('.');\n    if (topicParts.length<2) return undefined;\n    var objectPtr=global.get(topicParts[0],\"file\");\n    if (!objectPtr) {\n        node.error(\"getObject(\"+topic+\") global context '\"+topicParts[0]+\"' not found\");\n        return;\n    }\n    for (var i=1; i<topicParts.length-1; i++) { // ignore the last/entry identifier\n//        node.warn(\"getObject: \"+topicParts[i]);\n//        node.warn(objectPtr)\n        if (i<topicParts.length-2 && (objectPtr[topicParts[i]] && objectPtr[topicParts[i]].hasOwnProperty(\"list\"))) {\n            // select item the uiPointer points at\n            // ToDo: Make it multi user compatible using session id\n//            node.warn(\"getObject(\"+topic+\") \"+topicParts[i]+\" list[\"+objectPtr[topicParts[i]].uiPointer+\"]!\")\n            objectPtr=objectPtr[topicParts[i]].list[objectPtr[topicParts[i]].uiPointer];\n        } else {\n            if (!objectPtr[topicParts[i]]){ \n                node.warn(\"getObject(\"+topic+\") \"+topicParts[i]+\" initialized!\")\n                objectPtr[topicParts[i]]={}; // object not found so initialize it\n            }\n            objectPtr=objectPtr[topicParts[i]];\n        }\n//        node.warn(objectPtr)\n    }\n    if (!objectPtr.uiPointer) objectPtr.uiPointer= 0;\n    if (!objectPtr.list) objectPtr.list= [];\n    return objectPtr;\n};\n\n// function to get child object holding the list array for parententry or initialize a new\ncurrentObject.getSubObject = function(parent,childName) {\n    if (!parent || !childName) return undefined;\n    \n    // create child if not existing\n    if (!parent.hasOwnProperty(childName)) {\n        parent[childName]={\n            \"name\": childName,\n            \"uiPointer\": 0,\n            \"list\": []\n        }\n    }\n    \n    return parent[childName];\n};\n\n// function to get object for current entry ot of list[] where the uiPointer points to \n// topic    : path to object context/object/.../entryName OR object of list location\n//\n// return   : found or new object\n\ncurrentObject.getCurrentEntry = function(topic) {\n    var objectPrt;\n    try {\n        if (typeof topic !== \"object\") objectPtr= this.getObject(topic);\n            else objectPtr= topic;\n        if (objectPtr.uiPointer>=objectPtr.list.length) {\n            // node.warn(\"getCurrentEntry() corrected uiPointer!\")\n            objectPtr.uiPointer= objectPtr.list.length-1;\n        }\n        return objectPtr.list[objectPtr.uiPointer];\n    } catch (err) {\n        if (typeof topic === \"string\") node.warn(\"getCurrentEntry(\"+topic+\") failed!\")\n            else node.warn(\"getCurrentEntry(\"+objectPrt.name+\") failed!\")\n        return undefined;\n    }\n};\n\n// function to get entry UUID by name out of list defined by topic or object. Returns first match\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name to search for\n//\n// return   : uuid of found entry or undefined\n\ncurrentObject.getUuidByName = function (topic,name) {\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    // node.warn(objectPtr);\n    if (!objectPtr) return;\n    var uuid;\n    \n    objectPtr.list.forEach(function (item) {\n        if (item.name === name) {\n            uuid= item.uuid;\n            // node.warn(uuid);\n            return;\n        }\n    })\n    if (uuid) return uuid;\n        else return undefined;\n};\n\n// function to return entry by name or uuid out of list defined by topic\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name or\n// uuid     : uuid to search for\n//\n// return   : entry or undefined\n\ncurrentObject.entryExists = function(topic,uuid,target) {\n    if (!target && !this.isUuid(uuid)) { // to make function backwards compatible\n        node.error(\"entryExists(\"+topic+\",\"+uuid+\") uuid is not a valid uuid\")\n        return;\n    }\n    if (!target) target=\"uuid\" // use own uuid\n    \n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr || !objectPtr.list) return;\n\n    for (var i=0; i<objectPtr.list.length; i++) {\n        if (objectPtr.list[i][target]===uuid) {\n            return objectPtr.list[i];\n        }\n    }\n}\n\n// function to return index of Entry by name or uuid out of list defined by topic\n// topic    : path to object context/object/.../entryName OR object of list location\n// id       : name OG uuid to search for\n//\n// return   : entry or undefined\n\ncurrentObject.getIndexOfEntry = function(topic,id) {\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr || !objectPtr.list) return;\n    \n    var name,uuid;\n    if (this.isUuid(id)) uuid=id;\n    else name=id;\n\n    for (var i=0; i<objectPtr.list.length; i++) {\n        if ((name && objectPtr.list[i].name===name) ||\n            (uuid && objectPtr.list[i].uuid===uuid)) {\n            return i;\n        }\n    }\n    return 0;\n}\n\n// function to get object for current entry by name out of list defined by topic\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name to search for\n// uuid     : uuid to search for amd to set if new entry is created\n//\n// return   : found or new object\n\ncurrentObject.getEntry = function(topic,uuid,target) {\n    if (!this.isUuid(uuid)) { // to make function backwards compatible\n        node.error(\"getEntry(\"+topic+\",\"+uuid+\") uuid is not a valid uuid\")\n        return;\n    }\n    if (!target) target=\"uuid\" // use own uuid\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr) {\n        node.error(\"[getEntry] base object could not be found: \"+topic)\n        return;\n    }\n\n    var entryPtr;\n    if (!objectPtr.list) {\n        node.error(\"[getEntry] no list property found: \"+topic)\n        return;\n    } else {\n        entryPtr= this.entryExists(objectPtr,uuid,target);\n        if (entryPtr && !entryPtr.hasOwnProperty(\"uuid\")) entryPtr.uuid=this.uuid();\n    }\n\n    if (!entryPtr) { // define new entry in list\n        node.error(\"[getEntry] entry not found: \"+uuid+\" (\"+target+\")\");\n        return;\n    }\n    return entryPtr;\n};\n\n// function to create a new entry object\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name of the name to search for\n//\n// return   : new object\n\ncurrentObject.newEntry = function(topic,name) {\n\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr){\n        node.error(\"[newEntry] base object could not be found: \"+topic)\n        return;\n    }\n\n    if (!objectPtr.list) {\n        objectPtr.list=[]; // initialize list if not existing\n        objectPtr.uiPointer= 0;\n        objectPtr.uiPointerUuid= \"\";\n    }\n\n    objectPtr.list.push({}); // add new object into list\n    entryPtr= objectPtr.list[objectPtr.list.length-1];\n    entryPtr.name= name;\n    entryPtr.uuid= this.uuid();\n    node.warn(\"New list Entry created: \"+objectPtr.name+\":\"+entryPtr.name);\n    objectPtr.uiPointer=objectPtr.list.length-1;\n    objectPtr.uiPointerUuid=entryPtr.uuid;\n    return entryPtr;\n};\n\n// function to get object for current entry by index number out of list defined by topic\ncurrentObject.getEntryByIndex = function(topic,index) {\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n\n    if (objectPtr && objectPtr.list) {\n        return objectPtr.list[index];\n    } else return undefined;\n};\n\n// function to delete current entry out of list\n// topic        :   path to objtypeof topicect context/object/.../entryName OR object of list location\n// index        :   uuid or\n//                  index of entry to delete (uiPointer if undefined)\n\ncurrentObject.deleteEntry = function(topic,index) {\n    var objectPrt;\n    try {\n        if (typeof topic !== \"object\") objectPtr=this.getObject(topic);\n            else objectPtr= topic;\n        node.warn(\"[deleteEntry]\");\n        node.warn(objectPtr);\n        if (this.isUuid(index)) { // find index id uuid is given\n            index=this.getIndexOfEntry(objectPtr,index);\n        }\n        if (index === undefined) index=objectPtr.uiPointer;\n        if (index<objectPtr.list.length){\n            var returnObj= objectPtr.list.splice(index,1);\n            node.warn(\"[deleteEntry] Index :\"+index+\"(\"+returnObj.name+\") deleted (\"+objectPtr.list.length+\" items left)\");\n            if (returnObj) objectPtr.uiPointer=0;\n            return returnObj;\n        } else return undefined;\n    } catch (err) {\n        if (typeof topic === \"string\") node.warn(\"deleteEntry(\"+topic+\") failed!\")\n            else node.warn(\"deleteEntry(\"+objectPrt.name+\") failed!\")\n        return undefined;\n    }\n};\n\n// function to insert a list entry left from uiPointer and gives back the new Object\n// entryObject  : path to object context/object/.../entryName OR object of list location\n// index        : index of entry to delete (uiPointer if undefined)\ncurrentObject.insertItemLeft = function(topic,index) {\n    var objectPrt;\n    try {\n        if (typeof topic !== \"object\") objectPtr=this.getObject(topic);\n            else objectPrt= topic;\n        if (index === undefined) index= objectPtr.uiPointer;\n        objectPrt.list.splice(index,0,{});\n        return objectPrt.list[index];\n    } catch (err) {\n        if (typeof topic === \"string\") node.warn(\"insertItemLeft(\"+topic+\") failed!\")\n            else node.warn(\"insertItemLeft(\"+objectPrt.name+\") failed!\")\n        return undefined;\n    }\n}\n\n/*\n\n// (re)build Object Tree\ncurrentObject= currentObject.getObject(msg.topic);\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic});\n}\n*/\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"done!\"});\nmsg.payload=\"OK\";\nreturn msg;\n","outputs":1,"noerr":0,"x":291,"y":85,"wires":[["614cbda8.934e84","15f2ac84.d7a7b3"]],"info":"# Functions defined here\n\n## uuid()\n### generate a uuid to identifiy elements\n\n#### parameter\n- none\n\n#### returns\n**uuid** _string_\n\n## isUuid(string)\n### check if a string is a valid uuid\n#### paramter\n- **string** to be tested\n\n#### returns\n**result** _boolean_"},{"id":"15f2ac84.d7a7b3","type":"link out","z":"309a0a3e.c49326","name":"systemStarted","links":["ad801e81.ee1dd","d1841267.e09a","63cdea8e.1d3a14","dc819b4e.c75fe8","c87c4075.3cbcb","e1a3f1e7.b946f","75144ced.ca12e4","b7d8835f.d797e","50a20eeb.2b705","c9080f67.e24a6","b2a258b.6903ca8","b0a62377.bb602","ff00a80a.192d38","9404d95d.fa6508","2ce7837b.02bc0c","21d36cb5.8ba4f4","cb81a114.a5004","fe243d47.7c894"],"x":440,"y":85,"wires":[]},{"id":"22a0c3e.f70223c","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":272,"wires":[["b09ca54e.d77f88"]]},{"id":"b09ca54e.d77f88","type":"function","z":"309a0a3e.c49326","name":"delete something","func":"var currentObject= global.get(\"mySettings\",\"file\");\ndelete currentObject.heating.list;\ndelete currentObject.rooms.heating;\ndelete currentObject.windows;\ndelete currentObject.undefined;\ndelete currentObject.list;\ndelete currentObject.uiPointer;\ndelete currentObject.uiDropdown;\ndelete currentObject.groupMembers;\ndelete currentObject.light.devices.uiDropdown;\ndelete currentObject.light.groups.groupMembers;\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":272,"wires":[[]]},{"id":"614cbda8.934e84","type":"debug","z":"309a0a3e.c49326","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":475,"y":136,"wires":[]},{"id":"fa1ce257.9f07b","type":"comment","z":"309a0a3e.c49326","name":"initialize golbal store & methods","info":"","x":165,"y":37,"wires":[]},{"id":"3a6597b5.ca00c8","type":"comment","z":"309a0a3e.c49326","name":"tools","info":"","x":84,"y":204,"wires":[]},{"id":"a735300.f2772d","type":"ui_slider","z":"9831cab2.382058","name":"defaultDimmer","label":"","tooltip":"standard Dimmer","group":"c04d8bda.8dad98","order":18,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.devices.defaultDimmer","min":"0","max":"100","step":"1","x":624,"y":612,"wires":[["352cbb35.06d0d4"]]},{"id":"802dba90.2141f8","type":"ui_numeric","z":"9831cab2.382058","name":"defaultDimmer","label":"","tooltip":"","group":"c04d8bda.8dad98","order":19,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.devices.defaultDimmer","format":"","min":"0","max":"100","step":"1","x":624,"y":663,"wires":[["352cbb35.06d0d4"]]},{"id":"5ccaf23a.be91ac","type":"ui_text_input","z":"9831cab2.382058","name":"name","label":"","tooltip":"","group":"c04d8bda.8dad98","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.devices.name","x":594,"y":306,"wires":[["352cbb35.06d0d4"]]},{"id":"1e8fd4c0.df8beb","type":"ui_button","z":"9831cab2.382058","name":"uiDelete","group":"c04d8bda.8dad98","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.light.devices.uiDelete","x":604,"y":238,"wires":[["72c3dbc.c92f324"]]},{"id":"185cb6b5.1b0569","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":135,"y":306,"wires":[]},{"id":"2bfad25b.276b9e","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":17,"width":2,"height":1,"name":"standard Dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":175,"y":612,"wires":[]},{"id":"618f944e.278a8c","type":"ui_dropdown","z":"9831cab2.382058","name":"uiDropdown","label":"","tooltip":"","place":"Leuchtmittel auswählen","group":"c04d8bda.8dad98","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.devices.uiDropdown","x":614,"y":119,"wires":[["7a2bafc7.a25a"]]},{"id":"a3ea0d5e.05044","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1052,"y":476,"wires":[]},{"id":"49404117.0231f","type":"link in","z":"9831cab2.382058","name":"updateLightDevices","links":["276f613a.6a947e","5c47b568.ebd50c","673d1103.fd2fe","a3ea0d5e.05044","f2e67c30.a5a3f"],"x":49,"y":187,"wires":[["dc74b72e.539cd8"]]},{"id":"f2e67c30.a5a3f","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1035,"y":119,"wires":[]},{"id":"276f613a.6a947e","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1035,"y":238,"wires":[]},{"id":"cf0cae35.3ca73","type":"ui_button","z":"9831cab2.382058","name":"uiAdd","group":"c04d8bda.8dad98","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.light.devices.uiAdd","x":594,"y":187,"wires":[["a8dee692.284158"]]},{"id":"5c47b568.ebd50c","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1035,"y":187,"wires":[]},{"id":"8683c82c.0ab1b8","type":"switch","z":"9831cab2.382058","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.devices.name","vt":"str"},{"t":"eq","v":"mySettings.light.devices.note","vt":"str"},{"t":"eq","v":"mySettings.light.devices.room","vt":"str"},{"t":"eq","v":"mySettings.light.devices.system","vt":"str"},{"t":"eq","v":"mySettings.light.devices.type","vt":"str"},{"t":"eq","v":"mySettings.light.devices.defaultSwitch","vt":"str"},{"t":"eq","v":"mySettings.light.devices.defaultDimmer","vt":"str"},{"t":"eq","v":"mySettings.light.devices.defaultColor","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":339,"y":340,"wires":[["5ccaf23a.be91ac"],["9052f83a.94a2d8"],["14e5aee6.c84bb1"],["359d7857.f33c98"],["73aa3271.12cf0c"],["fdd2bd54.a1e0a"],["802dba90.2141f8","a735300.f2772d"],["b01ad5ad.1debd8"]]},{"id":"72c3dbc.c92f324","type":"ui_toast","z":"9831cab2.382058","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"cancel","raw":false,"topic":"","name":"Delete?","x":757,"y":238,"wires":[["d51abd93.5310e"]]},{"id":"ff00a80a.192d38","type":"link in","z":"9831cab2.382058","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":49,"y":119,"wires":[["e3b27cfc.9d2c9"]]},{"id":"66a509df.7640d8","type":"change","z":"9831cab2.382058","name":"defaults","rules":[{"t":"set","p":"system","pt":"msg","to":"milight","tot":"str"},{"t":"set","p":"type","pt":"msg","to":"rgb-w","tot":"str"},{"t":"set","p":"defaultDimmer","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"defaultColor","pt":"msg","to":"hsv","tot":"str"},{"t":"set","p":"defaultSwitch","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"note","pt":"msg","to":"","tot":"str"},{"t":"set","p":"room","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":51,"wires":[[]]},{"id":"7a2bafc7.a25a","type":"subflow:c4a7cd6c.2a0c1","z":"9831cab2.382058","name":"setDevice","env":[],"x":910,"y":119,"wires":[["f2e67c30.a5a3f"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"d51abd93.5310e","type":"subflow:d4a0d961.b11238","z":"9831cab2.382058","name":"","env":[],"x":920,"y":238,"wires":[["276f613a.6a947e"]]},{"id":"352cbb35.06d0d4","type":"subflow:dfa4352b.bdc548","z":"9831cab2.382058","name":"","env":[],"x":927,"y":493,"wires":[["a3ea0d5e.05044","1581eb1f.859c75"]]},{"id":"a8dee692.284158","type":"subflow:e0e53645.d85fd8","z":"9831cab2.382058","name":"newDevice","env":[{"name":"defaults","value":"{\"type\":\"\",\"system\":\"\",\"room\":\"\",\"note\":\"\",\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1},\"defaultswitch\":false}","type":"json"}],"x":920,"y":187,"wires":[["5c47b568.ebd50c"]]},{"id":"e3b27cfc.9d2c9","type":"subflow:e0e09953.42b938","z":"9831cab2.382058","name":"light.devices","env":[{"name":"baseObject","value":"light.devices","type":"str"},{"name":"filterProperty","value":"","type":"str"},{"name":"filterValue","value":"","type":"str"}],"x":155,"y":119,"wires":[["35796416.49e6bc","14e5aee6.c84bb1"]]},{"id":"dc74b72e.539cd8","type":"subflow:30d3b36b.8d171c","z":"9831cab2.382058","name":"","env":[{"name":"uiControl","value":"{\"type\":{\"switch\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":false},\"defaultColor\":{\"enabled\":false}},\"dimmer\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":false}},\"rgb\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":true}},\"rgbw\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":true}},\"rgb-w\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":true}}}}","type":"json"}],"x":145,"y":187,"wires":[["35796416.49e6bc"],["8683c82c.0ab1b8"]]},{"id":"35796416.49e6bc","type":"subflow:8ba1eff6.75a11","z":"9831cab2.382058","name":"","env":[],"x":359,"y":119,"wires":[["618f944e.278a8c","a55589e2.8611b8"]]},{"id":"359d7857.f33c98","type":"ui_dropdown","z":"9831cab2.382058","name":"system","label":"","tooltip":"","place":"System auswählen","group":"c04d8bda.8dad98","order":11,"width":6,"height":1,"passthru":false,"options":[{"label":"milight","value":"milight","type":"str"},{"label":"zigbee","value":"zigbee","type":"str"},{"label":"Selbstgebaut","value":"homie","type":"str"}],"payload":"","topic":"mySettings.light.devices.system","x":604,"y":459,"wires":[["352cbb35.06d0d4"]]},{"id":"73aa3271.12cf0c","type":"ui_dropdown","z":"9831cab2.382058","name":"type","label":"","tooltip":"","place":"System auswählen","group":"c04d8bda.8dad98","order":13,"width":6,"height":1,"passthru":false,"options":[{"label":"RGB","value":"rgb","type":"str"},{"label":"RGBW","value":"rgbw","type":"str"},{"label":"RGB oder W","value":"rgb-w","type":"str"},{"label":"Dimmer","value":"dimmer","type":"str"},{"label":"Schalter","value":"switch","type":"str"}],"payload":"","topic":"mySettings.light.devices.type","x":594,"y":510,"wires":[["352cbb35.06d0d4"]]},{"id":"78e54211.d0990c","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":10,"width":2,"height":1,"name":"System:","label":"System:","format":"{{msg.payload}}","layout":"row-spread","x":145,"y":459,"wires":[]},{"id":"7b502723.428028","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":12,"width":2,"height":1,"name":"Typ:","label":"Typ:","format":"{{msg.payload}}","layout":"row-spread","x":135,"y":510,"wires":[]},{"id":"5a59342e.f0f39c","type":"function","z":"459559af.3bd1b8","name":"enableUI","func":"var topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\nvar keyword = topicParts.pop();\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n}\n\nvar statusText=\"\";\nvar msgOut={};\nif (!currentProperty.list || currentProperty.list.length===0) {\n    msgOut.enabled=false\n    statusText=\"disabled\";\n} else {\n    if (msg.hasOwnProperty(\"enabled\")) {\n        statusText= (msg.enabled)? \"enabled\" : \"disabled\";\n        msgOut.enabled=msg.enabled;\n    } else {\n        statusText=\"enabled\";\n        msgOut.enabled=true;\n    }\n}\n\nreturn [{payload:{fill:\"green\",shape:\"dot\",statusText}},msgOut];","outputs":2,"noerr":0,"x":197,"y":85,"wires":[[],[]]},{"id":"b01ad5ad.1debd8","type":"ui_colour_picker","z":"9831cab2.382058","name":"","label":"","group":"c04d8bda.8dad98","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":21,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.devices.defaultColor","x":614,"y":714,"wires":[["352cbb35.06d0d4"]]},{"id":"73579303.2ebd0c","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":20,"width":2,"height":1,"name":"standard Farbe","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":165,"y":714,"wires":[]},{"id":"7d44685b.569b28","type":"function","z":"653c3a89.08f864","name":"fill ui-list","func":"if (!msg.topic) msg.topic=env.get(\"topic\");\nvar topicParts=msg.topic.split('.');\nvar myStore = topicParts[0];\n// get Base from global store\nvar baseObject= global.get(myStore,\"file\");\nif (!baseObject) return [{payload:{fill:\"red\",shape:\"dot\",text:\"store: \"+myStore+\" not found\"}},null];\n// get groups object\nvar keyword = topicParts.pop();\nvar groups=baseObject.getObject(msg.topic);\nif (!groups) return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n// get current group selected\nvar group= baseObject.getCurrentEntry(groups);\n// get devices in current group\nvar devProperty = env.get(\"devProperty\");\nvar groupDevices= baseObject.getSubObject(group,devProperty);\n\nvar listSources=env.get(\"listSources\");\nvar listEntry= {};\nmsg.payload=[];\n\nlistSources.forEach(function (currentSource){\n\n    // get devices list object\n    var devices= baseObject.getObject(myStore+\".\"+currentSource.source+\".uiList\");\n    \n    if (devices.list !== undefined) {\n        var sortedDevices=baseObject.saveSort(devices.list);\n        // loop through all devices\n        sortedDevices.forEach(function(device){\n            listEntry={};\n            listEntry.title=device.name;\n            listEntry.type=currentSource.type;\n            listEntry.uuid=device.uuid;\n            listEntry.icon_name= currentSource.icon;\n            listEntry.isChecked= false;\n            // loop throug devices defined in group\n            for (var groupDevice of groupDevices.list) {\n                if (groupDevice.elementUuid === device.uuid) { // match by uuid\n                    listEntry.isChecked= groupDevice.isChecked;\n                    break;\n                }\n            }\n            msg.payload.push(listEntry);\n        });\n    }\n});\n\nif (msg.payload.length>0){\n    return [{payload:{fill:\"green\",shape:\"dot\",text:msg.payload.length+\" items\"}},msg];\n} else {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"list is empty\"}},null];\n}\n\n\ntry {\n\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"No list entry\"}},null];\n}","outputs":2,"noerr":0,"x":196,"y":85,"wires":[[],[]]},{"id":"a55589e2.8611b8","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["321364bf.d6ae6c","284e5776.5b72b8","528a0ee.43886f"],"x":559,"y":85,"wires":[]},{"id":"fdd2bd54.a1e0a","type":"ui_switch","z":"9831cab2.382058","name":"","label":"","tooltip":"","group":"c04d8bda.8dad98","order":15,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.devices.defaultSwitch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":594,"y":561,"wires":[["352cbb35.06d0d4"]]},{"id":"c2ad1135.5249c","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":14,"width":2,"height":1,"name":"standard Schalter","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":175,"y":561,"wires":[]},{"id":"120e96ed.3b4ec9","type":"MiLight","z":"4635654.3abb19c","name":"Schreibtischleuchte","bridgetype":"legacy","bulbtype":"rgbw","zone":"4","ip":"192.168.2.20","broadcast":false,"x":974,"y":204,"wires":[]},{"id":"31915d49.c1d6a2","type":"link in","z":"4635654.3abb19c","name":"setLight","links":["1581eb1f.859c75","f669e0e2.6f196","c07b76a5.fce788","9194a4d8.035d58","511d94e8.4e555c","2310ff72.1a31c","8e4d3523.343658"],"x":66,"y":238,"wires":[["1cd2078f.2c4918","20fbf6c1.9052aa"]]},{"id":"b0eb9abe.196d58","type":"switch","z":"4635654.3abb19c","name":"System","property":"property.system","propertyType":"msg","rules":[{"t":"eq","v":"milight","vt":"str"},{"t":"eq","v":"homie","vt":"str"},{"t":"eq","v":"zigbee","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":332,"y":238,"wires":[["2ab2dbb3.063354","37d98b1.2f2cf74"],[],[]]},{"id":"768f72f8.3f213c","type":"switch","z":"4635654.3abb19c","name":"uuid","property":"uuid","propertyType":"msg","rules":[{"t":"eq","v":"df82b86d-4049-0301-7ee4-356c5f732edb","vt":"str"},{"t":"eq","v":"5c419b11-2f76-cde4-8e06-47c6ff2f9624","vt":"str"},{"t":"eq","v":"0f479716-2c21-f26b-670e-531627174c6c","vt":"str"},{"t":"eq","v":"1a767852-8b36-b012-0dbf-2c2a1fecfe8d","vt":"str"},{"t":"eq","v":"cd0d8b36-0bb6-9a1c-491c-0064a084a38c","vt":"str"},{"t":"eq","v":"e68f9371-f21c-2d7f-2926-fecf93c12f2f","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":764,"y":187,"wires":[["cb162cff.aaf0b"],["e487706f.bcd42"],["1bf4c321.058e4d"],["120e96ed.3b4ec9"],["862f84f3.326078"],["4b8af7ad.587268","8ff02f5b.a940f"]]},{"id":"1581eb1f.859c75","type":"link out","z":"9831cab2.382058","name":"setLight","links":["31915d49.c1d6a2"],"x":1052,"y":510,"wires":[]},{"id":"2ab2dbb3.063354","type":"function","z":"4635654.3abb19c","name":"prepareMilight","func":"var msgOut= {\n    \"name\": msg.property.name,\n    \"uuid\": msg.property.uuid\n};\n\nvar command= msg.topic.slice(msg.topic.lastIndexOf('.')+1);\n\nfunction hsvToRgb(hsv) {\n  var h=hsv.h/360;\n  var s=hsv.s;\n  var v=hsv.v;\n  var r, g, b;\n\n  var i = Math.floor(h * 6);\n  var f = h * 6 - i;\n  var p = v * (1 - s);\n  var q = v * (1 - f * s);\n  var t = v * (1 - (1 - f) * s);\n\n  switch (i % 6) {\n    case 0: r = v; g = t; b = p; break;\n    case 1: r = q; g = v; b = p; break;\n    case 2: r = p; g = v; b = t; break;\n    case 3: r = p; g = q; b = v; break;\n    case 4: r = t; g = p; b = v; break;\n    case 5: r = v; g = p; b = q; break;\n  }\n\n  return \"rgb(\"+Math.floor(r * 255)+\",\"+Math.floor(g * 255)+\",\"+Math.floor(b * 255)+\")\";\n}\n\nswitch (command) {\n    case \"defaultSwitch\":\n        msgOut.payload= (msg.property.defaultSwitch)? \"on\" : \"off\";\n        break;\n    case \"defaultDimmer\":\n        msgOut.payload= msg.property.defaultDimmer;\n        msgOut.topic= \"brightness\"\n        break;\n    case \"defaultColor\":\n        msgOut=[];\n        if (msg.property.defaultColor.s<0.05) {\n           msgOut.push({\n                \"name\": msg.property.name,\n                \"uuid\": msg.property.uuid,\n                \"payload\":\"white\"});\n           msgOut.push({\n                \"name\": msg.property.name, \n                \"uuid\": msg.property.uuid,\n                \"topic\":\"brightness\", \n                \"payload\":Math.floor(msg.property.defaultColor.v*100)});\n        } else {\n            msgOut.push({\n                \"name\": msg.property.name, \n                \"uuid\": msg.property.uuid,\n                \"topic\":\"brightness\", \n                \"payload\":Math.floor(msg.property.defaultColor.v*100)});\n//           msgOut.push({\"name\": msg.property.name, \"topic\":\"color\", \"payload\":255-Math.floor(msg.property.defaultColor.h*(255/360))});\n            msgOut.push({\n                \"name\": msg.property.name, \n                \"uuid\": msg.property.uuid,\n                \"topic\":\"rgb\", \n                \"payload\":hsvToRgb(msg.property.defaultColor)});\n        }\n        node.status({fill:\"green\",shape:\"dot\",text:msgOut.name+\"=color\"});\n        return [msgOut];\n}\n\nif (msgOut.payload) {\n    node.status({fill:\"green\",shape:\"dot\",text:msgOut.name+\"=\"+msgOut.payload});\n    return msgOut;\n}\nnode.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});","outputs":1,"noerr":0,"x":556,"y":187,"wires":[["768f72f8.3f213c","46b5afd2.1a88c"]]},{"id":"cb162cff.aaf0b","type":"MiLight","z":"4635654.3abb19c","name":"Kugel Leinwand links","bridgetype":"legacy","bulbtype":"rgbw","zone":"1","ip":"192.168.2.20","broadcast":false,"x":984,"y":102,"wires":[]},{"id":"37d98b1.2f2cf74","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":526,"y":136,"wires":[]},{"id":"e487706f.bcd42","type":"MiLight","z":"4635654.3abb19c","name":"Kugel Fenster links","bridgetype":"legacy","bulbtype":"rgbw","zone":"2","ip":"192.168.2.20","broadcast":false,"x":974,"y":136,"wires":[]},{"id":"1bf4c321.058e4d","type":"MiLight","z":"4635654.3abb19c","name":"Stehleuchte","bridgetype":"legacy","bulbtype":"rgbw","zone":"3","ip":"192.168.2.20","broadcast":false,"x":954,"y":170,"wires":[]},{"id":"862f84f3.326078","type":"MiLight","z":"4635654.3abb19c","name":"Nachttischleuchte Jomo","bridgetype":"legacy","bulbtype":"rgbw","zone":"2","ip":"192.168.2.21","broadcast":false,"x":994,"y":238,"wires":[]},{"id":"4b8af7ad.587268","type":"MiLight","z":"4635654.3abb19c","name":"Nachttischleuchte Christian","bridgetype":"legacy","bulbtype":"rgbw","zone":"1","ip":"192.168.2.21","broadcast":false,"x":1004,"y":272,"wires":[]},{"id":"b99ddb18.33f108","type":"function","z":"274dc61a.3c17aa","name":"Group","func":"var groupTopic= env.get(\"groupTopic\");\nvar groupMembers=env.get(\"groupMembers\");\nvar sceneTopic=env.get(\"sceneTopic\");\nvar sceneMembers=env.get(\"sceneMembers\");\n\nif (!msg.topic) msg.topic=env.get(\"topic\");\nvar topicParts=msg.topic.split('.');\nvar myStore = topicParts[0];\n// get Base from global store\nvar baseObject= global.get(myStore,\"file\");\nvar devices= baseObject.getObject(myStore+\".\"+env.get(\"devices\")+\".uiList\");\nvar device= {};\nvar msgOut=[];\n\nswitch (topicParts[topicParts.length-2]) {\n    case sceneTopic : // control scene \n        if (msg.property.hasOwnProperty(sceneMembers)) {\n            msg.property[sceneMembers].list.forEach(function (light) {\n                if (light.isChecked) {\n                   device=baseObject.getEntry(devices,light.lightUuid)\n                   msgOut.push({\n                       \"topic\": msg.topic,\n                       \"property\": {\n                           \"name\": light.name,\n                           \"system\": device.system,\n                           \"type\": device.type,\n                           \"defaultSwitch\": (topicParts[topicParts.length-1]===\"switch\") ? msg.payload : light.switch,\n                           \"defaultDimmer\": (topicParts[topicParts.length-1]===\"dimmer\") ? light.dimmer*(msg.payload/100) : light.dimmer,\n                           \"defaultColor\": (topicParts[topicParts.length-1]===\"tint\") ? light.color : msg.property.defaultColor\n                       }\n                   });\n               }\n            });\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"scene: \"+msg.property.name}},msgOut];\n        }\n        break;\n    case sceneMembers : // control scene members\n        if (msg.property.hasOwnProperty(sceneMembers)) {\n            msg.property[sceneMembers].list.forEach(function (light) {\n                if (light.isChecked) {\n                   device=baseObject.getEntry(devices,light.lightUuid)\n                   msgOut.push({\n                       \"topic\": msg.topic,\n                       \"property\": {\n                           \"name\": light.name,\n                           \"system\": device.system,\n                           \"type\": device.type,\n                           \"defaultSwitch\": (topicParts[topicParts.length-1]===\"defaultSwitch\") ? msg.payload : light.switch,\n                           \"defaultDimmer\": (topicParts[topicParts.length-1]===\"defaultDimmer\") ? light.dimmer*(msg.payload/100) : light.dimmer,\n                           \"defaultColor\": light.color\n                       }\n                   });\n               }\n            });\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"scene: \"+msg.property.name}},msgOut];\n        }\n        break;\n    case groupTopic : // control group members;\n        if (msg.property.hasOwnProperty(groupMembers)) {\n            msg.property[groupMembers].list.forEach(function (light) {\n               if (light.isChecked) {\n                   device=baseObject.getEntry(devices,light.uuid)\n                   if (device===undefined) { // device does not exist any more so delete link\n                        var erasedEntry = baseObject.deleteEntry(msg.property[groupMembers],light.uuid);\n                        if (erasedEntry) node.warn(\"sub[groupSend] success: \"+erasedEntry.name+\" deleted\")\n                        else node.error(\"sub[groupSend] failed to delete non existing device: \"+light.name+\" \"+light.uuid);\n                   } else {\n                       msgOut.push({\n                           \"topic\": msg.topic,\n                           \"property\": {\n                               \"name\": light.name,\n                               \"uuid\": light.uuid,\n                               \"system\": device.system,\n                               \"type\": device.type,\n                               \"defaultSwitch\": msg.property.defaultSwitch,\n                               \"defaultDimmer\": msg.property.defaultDimmer,\n                               \"defaultColor\": msg.property.defaultColor\n                           }\n                       });\n                   }\n               }\n            });\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"group: \"+msg.property.name}},msgOut];\n        }\n        break;\n    default :\n        return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"single device\"}},msg];\n        break;\n}\n","outputs":2,"noerr":0,"x":203,"y":85,"wires":[[],[]]},{"id":"1cd2078f.2c4918","type":"subflow:274dc61a.3c17aa","z":"4635654.3abb19c","name":"","env":[{"name":"sceneControl","value":"sceneMembers","type":"str"},{"name":"groupProperty","value":"groups","type":"str"}],"x":179,"y":238,"wires":[["b0eb9abe.196d58","b3a4ef66.0ea08"]]},{"id":"842280d1.71514","type":"http in","z":"4635654.3abb19c","name":"Lights","url":"/lights","method":"put","upload":false,"swaggerDoc":"","x":170,"y":408,"wires":[["21649ad0.b262a6","df1057ea.990088"]]},{"id":"21649ad0.b262a6","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":339,"y":459,"wires":[]},{"id":"df1057ea.990088","type":"http response","z":"4635654.3abb19c","name":"","statusCode":"","headers":{},"x":339,"y":408,"wires":[]},{"id":"6cd5f93f.c42ac8","type":"function","z":"9848cbbf.0bdd68","name":"save List","func":"node.status({});\nvar baseObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\nif (!baseObject) return;\nvar currentObject= baseObject.getCurrentEntry(msg.topic);\nvar currentGroup= baseObject.getSubObject(currentObject,propertyName);\n\ntry {\n    var currentEntry= baseObject.getEntry(currentGroup,msg.payload.uuid);\n    currentEntry.isChecked=msg.payload.isChecked;\n    currentEntry.name=msg.payload.title;\n    node.status({fill:\"green\",shape:\"dot\",text:currentObject.name+\": \"+msg.payload.title+\"=\"+msg.payload.isChecked});\n    return msg;\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n} ","outputs":1,"noerr":0,"x":774,"y":510,"wires":[[]]},{"id":"616ec306.1ee08c","type":"subflow:653c3a89.08f864","z":"9848cbbf.0bdd68","name":"","env":[{"name":"listSources","value":"[{\"source\":\"light.devices\",\"icon\":\"lightbulb_outline\"}]","type":"json"}],"x":434,"y":510,"wires":[["3d08e03a.a8722","66c5ebf.74f0b14"]]},{"id":"85c6dad8.203e68","type":"debug","z":"9848cbbf.0bdd68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":764,"y":561,"wires":[]},{"id":"f160fc2b.9fce1","type":"ui_slider","z":"9848cbbf.0bdd68","name":"defaultDimmer","label":"","tooltip":"standard Dimmer","group":"ceeb11f0.8bfba","order":10,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.groups.defaultDimmer","min":"0","max":"100","step":"1","x":624,"y":357,"wires":[["cd630682.9c0b08"]]},{"id":"77f72e8.ab5d6d","type":"ui_numeric","z":"9848cbbf.0bdd68","name":"defaultDimmer","label":"","tooltip":"","group":"ceeb11f0.8bfba","order":11,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.groups.defaultDimmer","format":"","min":"0","max":"100","step":"1","x":624,"y":408,"wires":[["cd630682.9c0b08"]]},{"id":"85ae12e7.de203","type":"ui_text_input","z":"9848cbbf.0bdd68","name":"name","label":"","tooltip":"","group":"ceeb11f0.8bfba","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.groups.name","x":594,"y":255,"wires":[["cd630682.9c0b08"]]},{"id":"85af380f.768348","type":"ui_button","z":"9848cbbf.0bdd68","name":"uiDelete","group":"ceeb11f0.8bfba","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.light.groups.uiDelete","x":604,"y":187,"wires":[["e3e5ccaa.594e5"]]},{"id":"d9ad01b3.7ea9f","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":186,"y":255,"wires":[]},{"id":"c4be6731.b42308","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":9,"width":2,"height":1,"name":"standard Dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":226,"y":357,"wires":[]},{"id":"c47db1b3.19356","type":"ui_dropdown","z":"9848cbbf.0bdd68","name":"uiDropdown","label":"","tooltip":"","place":"Gruppe auswählen","group":"ceeb11f0.8bfba","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.groups.uiDropdown","x":614,"y":68,"wires":[["6f691c7e.4b7c24","8393ba63.84f3c8"]]},{"id":"81813d03.04566","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":238,"wires":[]},{"id":"43d9e00d.06c2e","type":"link in","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["81813d03.04566","c4eedb06.193328","673d1103.fd2fe","9f49f524.a5ab28","4eb2691a.86f7e8"],"x":100,"y":136,"wires":[["2a2d3f8d.a5686"]]},{"id":"4eb2691a.86f7e8","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":68,"wires":[]},{"id":"9f49f524.a5ab28","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":187,"wires":[]},{"id":"d9481c11.8e89c","type":"ui_button","z":"9848cbbf.0bdd68","name":"uiAdd","group":"ceeb11f0.8bfba","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.light.groups.uiAdd","x":594,"y":136,"wires":[["b9b20930.263498"]]},{"id":"c4eedb06.193328","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":136,"wires":[]},{"id":"7215d6df.f42878","type":"switch","z":"9848cbbf.0bdd68","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.groups.name","vt":"str"},{"t":"eq","v":"mySettings.light.groups.defaultSwitch","vt":"str"},{"t":"eq","v":"mySettings.light.groups.defaultDimmer","vt":"str"},{"t":"eq","v":"mySettings.light.groups.defaultColor","vt":"str"},{"t":"eq","v":"mySettings.light.groups.groupMembers","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":390,"y":289,"wires":[["85ae12e7.de203"],["cac70d3a.7430f"],["77f72e8.ab5d6d","f160fc2b.9fce1"],["2d5501ae.16dcbe"],["616ec306.1ee08c","6ad0bae2.005634"]]},{"id":"e3e5ccaa.594e5","type":"ui_toast","z":"9848cbbf.0bdd68","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":757,"y":187,"wires":[["e33eebe2.253908"]]},{"id":"2ce7837b.02bc0c","type":"link in","z":"9848cbbf.0bdd68","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":100,"y":68,"wires":[["55f88a42.fd86c4"]]},{"id":"7d53c565.2686ac","type":"change","z":"9848cbbf.0bdd68","name":"defaults","rules":[{"t":"set","p":"system","pt":"msg","to":"milight","tot":"str"},{"t":"set","p":"type","pt":"msg","to":"rgb-w","tot":"str"},{"t":"set","p":"defaultDimmer","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"defaultColor","pt":"msg","to":"hsv","tot":"str"},{"t":"set","p":"groupMembers","pt":"msg","to":"{\"name\":\"groupMembers\",\"uiPointer\":0,\"list\":[]}","tot":"json"},{"t":"set","p":"defaultSwitch","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":119,"wires":[[]]},{"id":"6f691c7e.4b7c24","type":"subflow:c4a7cd6c.2a0c1","z":"9848cbbf.0bdd68","name":"","env":[],"x":893,"y":68,"wires":[["4eb2691a.86f7e8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"e33eebe2.253908","type":"subflow:d4a0d961.b11238","z":"9848cbbf.0bdd68","name":"","env":[],"x":903,"y":187,"wires":[["9f49f524.a5ab28"]]},{"id":"cd630682.9c0b08","type":"subflow:dfa4352b.bdc548","z":"9848cbbf.0bdd68","name":"","env":[],"x":893,"y":255,"wires":[["81813d03.04566","c07b76a5.fce788"]]},{"id":"b9b20930.263498","type":"subflow:e0e53645.d85fd8","z":"9848cbbf.0bdd68","name":"addGroup","env":[{"name":"defaults","value":"{\"type\":\"group\",\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1},\"defaultswitch\":false,\"groupMembers\":{\"name\":\"sceneMembers\",\"uiPointer\":0,\"list\":[]}}","type":"json"}],"x":893,"y":136,"wires":[["c4eedb06.193328"]]},{"id":"55f88a42.fd86c4","type":"subflow:e0e09953.42b938","z":"9848cbbf.0bdd68","name":"light.groups","env":[{"name":"baseObject","value":"light.groups","type":"str"},{"name":"filterProperty","value":"","type":"str"},{"name":"filterValue","value":"","type":"str"}],"x":206,"y":68,"wires":[["f60c5313.bda62"]]},{"id":"2a2d3f8d.a5686","type":"subflow:30d3b36b.8d171c","z":"9848cbbf.0bdd68","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":196,"y":136,"wires":[["f60c5313.bda62"],["7215d6df.f42878","10c2a962.a1fc97"]]},{"id":"f60c5313.bda62","type":"subflow:8ba1eff6.75a11","z":"9848cbbf.0bdd68","name":"","env":[],"x":410,"y":68,"wires":[["c47db1b3.19356"]]},{"id":"2d5501ae.16dcbe","type":"ui_colour_picker","z":"9848cbbf.0bdd68","name":"","label":"","group":"ceeb11f0.8bfba","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":13,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.groups.defaultColor","x":614,"y":459,"wires":[["cd630682.9c0b08"]]},{"id":"bfdaff3f.29d7d","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":12,"width":2,"height":1,"name":"standard Farbe","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":216,"y":459,"wires":[]},{"id":"284e5776.5b72b8","type":"link in","z":"9848cbbf.0bdd68","name":"updateLightDevices","links":["a55589e2.8611b8"],"x":253,"y":510,"wires":[["616ec306.1ee08c","4b2af7b8.dd8128"]]},{"id":"4b2af7b8.dd8128","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":424,"y":595,"wires":[]},{"id":"6ad0bae2.005634","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":424,"y":561,"wires":[]},{"id":"3d08e03a.a8722","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":594,"y":561,"wires":[]},{"id":"cac70d3a.7430f","type":"ui_switch","z":"9848cbbf.0bdd68","name":"","label":"","tooltip":"","group":"ceeb11f0.8bfba","order":7,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.groups.defaultSwitch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":594,"y":306,"wires":[["cd630682.9c0b08"]]},{"id":"58628360.01c88c","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":6,"width":2,"height":1,"name":"standard Schalter","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":226,"y":306,"wires":[]},{"id":"c07b76a5.fce788","type":"link out","z":"9848cbbf.0bdd68","name":"setLight","links":["31915d49.c1d6a2"],"x":1018,"y":272,"wires":[]},{"id":"5065a60e.ef53a8","type":"function","z":"33d1b88e.5b1368","name":"save List","func":"var status={};\nvar baseObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\nif (!baseObject) return;\nvar currentObject= baseObject.getCurrentEntry(msg.topic);\nvar currentGroup= baseObject.getSubObject(currentObject,propertyName);\nnode.warn(currentGroup)\n    if (!msg.payload.isChecked) { // delete entry from list if unchecked\n        baseObject.deleteEntry(currentGroup,msg.payload.uuid,\"elementUuid\")\n        status= {fill:\"green\",shape:\"dot\",text:currentObject.name+\": \"+msg.payload.title+\" removed\"};\n    } else {\n        var currentEntry= baseObject.getEntry(currentGroup,msg.payload.uuid,\"elementUuid\");\n        if (!currentEntry) currentEntry= baseObject.newEntry(currentGroup,msg.payload.title);\n        \n        node.warn(currentEntry)\n        baseObject.merge(currentEntry,env.get(\"defaults\"));\n        currentEntry.elementUuid=msg.payload.uuid;\n        currentEntry.isChecked=msg.payload.isChecked;\n        currentEntry.type=msg.payload.type;\n        currentEntry.name=msg.payload.title;\n        status= {fill:\"green\",shape:\"dot\",text:currentObject.name+\": \"+msg.payload.title+\"=\"+msg.payload.isChecked};\n    }\n    var msgDropdown={\"options\":[]};\n    for (var device of currentGroup.list) {\n        if (device.isChecked) msgDropdown.options.push({[device.name]: device.uuid});\n    }\n    return [{\"payload\":status},msg,msgDropdown];\ntry {\n} catch (err) {\n    return [{\"payload\":{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"}},null,null];\n} ","outputs":3,"noerr":0,"x":196,"y":85,"wires":[[],[],[]]},{"id":"78458350.bcc2dc","type":"subflow:653c3a89.08f864","z":"b66f2c73.9297e","name":"","env":[{"name":"groups","value":"light.scenes","type":"str"},{"name":"devProperty","value":"sceneMembers","type":"str"},{"name":"listSources","value":"[{\"source\":\"light.groups\",\"icon\":\"logout\"},{\"source\":\"light.devices\",\"icon\":\"lightbulb_outline\"}]","type":"json"},{"name":"addGroups","value":"light.groups","type":"str"},{"name":"scenes","value":"light.scenes","type":"str"}],"x":485,"y":714,"wires":[["3b425306.f3caec"]]},{"id":"43d17279.2750cc","type":"ui_slider","z":"b66f2c73.9297e","name":"sceneDimmer","label":"","tooltip":"standard Dimmer","group":"6a28c45b.c2fe1c","order":18,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.defaultDimmer","min":"0","max":"100","step":"1","x":675,"y":561,"wires":[["fa5b665a.fd6078","1751bfe.a87f04"]]},{"id":"36ec32e6.018e5e","type":"ui_numeric","z":"b66f2c73.9297e","name":"sceneDimmer","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":19,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.scenes.defaultDimmer","format":"","min":"0","max":"100","step":"1","x":675,"y":612,"wires":[["fa5b665a.fd6078"]]},{"id":"a1dd93aa.1ff5b","type":"ui_text_input","z":"b66f2c73.9297e","name":"name","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.name","x":645,"y":255,"wires":[["fa5b665a.fd6078"]]},{"id":"2a22337a.fd90cc","type":"ui_button","z":"b66f2c73.9297e","name":"uiDelete","group":"6a28c45b.c2fe1c","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.light.scenes.uiDelete","x":655,"y":187,"wires":[["613f1b44.1b7f74"]]},{"id":"ec781acf.2387b8","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":255,"wires":[]},{"id":"6ea78752.8cf458","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":17,"width":2,"height":1,"name":"scene dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":561,"wires":[]},{"id":"d95a24b7.329688","type":"ui_dropdown","z":"b66f2c73.9297e","name":"uiDropdown","label":"","tooltip":"","place":"Szene auswählen","group":"6a28c45b.c2fe1c","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.uiDropdown","x":665,"y":68,"wires":[["ed42ea1f.4c56f8"]]},{"id":"f756c281.5f1e9","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":238,"wires":[]},{"id":"47ade8d3.fa85c8","type":"link in","z":"b66f2c73.9297e","name":"updateLightScenes","links":["3cdf4653.ce30aa","52f723c4.c5accc","673d1103.fd2fe","da3bd253.8f899","f756c281.5f1e9"],"x":151,"y":136,"wires":[["58f6e3ff.cb086c"]]},{"id":"52f723c4.c5accc","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":68,"wires":[]},{"id":"3cdf4653.ce30aa","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":187,"wires":[]},{"id":"cf500f43.216b8","type":"ui_button","z":"b66f2c73.9297e","name":"uiAdd","group":"6a28c45b.c2fe1c","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.light.scenes.uiAdd","x":645,"y":136,"wires":[["76f3a56e.1e3ecc"]]},{"id":"da3bd253.8f899","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":136,"wires":[]},{"id":"1abaf620.87881a","type":"switch","z":"b66f2c73.9297e","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.name","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.room","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.label","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.note","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.http","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.defaultSwitch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.defaultDimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.defaultColor","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.sceneMembers","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":441,"y":459,"wires":[["a1dd93aa.1ff5b"],["5d59ea52.a36d94","77945c10.de8f74"],["e0ad94fc.db3b08"],["bc831fec.5e8bb"],["afd09637.da57b8"],["9c7fcb88.57d8d8"],["36ec32e6.018e5e","43d17279.2750cc"],["847f1ceb.9665"],["78458350.bcc2dc","3cb73867.558b98","d96aa565.00e108"]]},{"id":"613f1b44.1b7f74","type":"ui_toast","z":"b66f2c73.9297e","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"cancel","raw":false,"topic":"","name":"Delete?","x":808,"y":187,"wires":[["3a623a29.219616"]]},{"id":"21d36cb5.8ba4f4","type":"link in","z":"b66f2c73.9297e","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":151,"y":68,"wires":[["d194eaba.a74a98"]]},{"id":"ed42ea1f.4c56f8","type":"subflow:c4a7cd6c.2a0c1","z":"b66f2c73.9297e","name":"","env":[],"x":961,"y":68,"wires":[["52f723c4.c5accc"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"3a623a29.219616","type":"subflow:d4a0d961.b11238","z":"b66f2c73.9297e","name":"","env":[],"x":971,"y":187,"wires":[["3cdf4653.ce30aa"]]},{"id":"fa5b665a.fd6078","type":"subflow:dfa4352b.bdc548","z":"b66f2c73.9297e","name":"","env":[],"x":961,"y":255,"wires":[["f756c281.5f1e9","9194a4d8.035d58"]]},{"id":"76f3a56e.1e3ecc","type":"subflow:e0e53645.d85fd8","z":"b66f2c73.9297e","name":"newScene","env":[{"name":"defaults","value":"{\"room\":\"\",\"label\":\"\",\"note\":\"\",\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1},\"defaultswitch\":false,\"sceneMembers\":{\"name\":\"sceneMembers\",\"uiPointer\":0,\"list\":[]}}","type":"json"}],"x":971,"y":136,"wires":[["da3bd253.8f899"]]},{"id":"d194eaba.a74a98","type":"subflow:e0e09953.42b938","z":"b66f2c73.9297e","name":"light.scenes","env":[{"name":"baseObject","value":"light.scenes","type":"str"},{"name":"filterProperty","value":"","type":"str"},{"name":"filterValue","value":"","type":"str"}],"x":257,"y":68,"wires":[["3a5df967.450b06","5d59ea52.a36d94"]]},{"id":"58f6e3ff.cb086c","type":"subflow:30d3b36b.8d171c","z":"b66f2c73.9297e","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":247,"y":136,"wires":[["3a5df967.450b06"],["1abaf620.87881a"]]},{"id":"3a5df967.450b06","type":"subflow:8ba1eff6.75a11","z":"b66f2c73.9297e","name":"","env":[],"x":461,"y":68,"wires":[["d95a24b7.329688"]]},{"id":"847f1ceb.9665","type":"ui_colour_picker","z":"b66f2c73.9297e","name":"sceneColor","label":"","group":"6a28c45b.c2fe1c","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":21,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.scenes.defaultColor","x":665,"y":663,"wires":[["fa5b665a.fd6078","38003863.d59a68"]]},{"id":"f7f3dd70.4e1e2","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":20,"width":2,"height":1,"name":"scene color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":257,"y":646,"wires":[]},{"id":"528a0ee.43886f","type":"link in","z":"b66f2c73.9297e","name":"updateLightDevices","links":["a55589e2.8611b8"],"x":304,"y":714,"wires":[["78458350.bcc2dc"]]},{"id":"9c7fcb88.57d8d8","type":"ui_switch","z":"b66f2c73.9297e","name":"","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":11,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.defaultSwitch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":645,"y":510,"wires":[["fa5b665a.fd6078"]]},{"id":"66216b67.7f7a14","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":10,"width":2,"height":1,"name":"scene switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":257,"y":510,"wires":[]},{"id":"9194a4d8.035d58","type":"link out","z":"b66f2c73.9297e","name":"setLight","links":["31915d49.c1d6a2"],"x":1086,"y":272,"wires":[]},{"id":"be0c1772.ba5a88","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":22,"width":8,"height":1,"name":"Elemente in Szene","label":"Elemente in Szene","format":"{{msg.payload}}","layout":"row-spread","x":277,"y":680,"wires":[]},{"id":"99079aaf.e7fd58","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":24,"width":8,"height":1,"name":"Einstellungen","label":"Einstellungen","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":799,"wires":[]},{"id":"a526798f.662f08","type":"ui_dropdown","z":"b66f2c73.9297e","name":"uiDropdown","label":"","tooltip":"","place":"Element auswählen","group":"6a28c45b.c2fe1c","order":26,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.sceneMembers.uiDropdown","x":665,"y":816,"wires":[["e2c8ebad.ccad48"]]},{"id":"4fa1e7d2.43ae78","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":25,"width":2,"height":1,"name":"Element:","label":"Element:","format":"{{msg.payload}}","layout":"row-spread","x":247,"y":833,"wires":[]},{"id":"65318c33.e1ccd4","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":6,"width":2,"height":1,"name":"Note:","label":"Note:","format":"{{msg.payload}}","layout":"row-spread","x":135,"y":357,"wires":[]},{"id":"9052f83a.94a2d8","type":"ui_text_input","z":"9831cab2.382058","name":"note","label":"","tooltip":"","group":"c04d8bda.8dad98","order":7,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.devices.note","x":594,"y":357,"wires":[["352cbb35.06d0d4"]]},{"id":"60efbf41.dad34","type":"ui_dropdown","z":"9831cab2.382058","name":"room","label":"","tooltip":"","place":"Raum auswählen","group":"c04d8bda.8dad98","order":9,"width":6,"height":1,"passthru":false,"options":[],"payload":"","topic":"mySettings.light.devices.room","x":747,"y":408,"wires":[["352cbb35.06d0d4"]]},{"id":"14e5aee6.c84bb1","type":"subflow:8ba1eff6.75a11","z":"9831cab2.382058","name":"fillRooms","env":[{"name":"customTopic","value":"mySettings.rooms.uiDropdown","type":"str"}],"x":604,"y":408,"wires":[["60efbf41.dad34"]]},{"id":"b23da01a.56b88","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":8,"width":2,"height":1,"name":"Raum:","label":"Raum:","format":"{{msg.payload}}","layout":"row-spread","x":135,"y":408,"wires":[]},{"id":"39ef0ec4.5686d2","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":238,"wires":[]},{"id":"10c2a962.a1fc97","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":390,"y":136,"wires":[]},{"id":"8393ba63.84f3c8","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":781,"y":34,"wires":[]},{"id":"8f16b001.58fb","type":"ui_text","z":"833d7b75.5dd878","group":"61b56b5f.f16754","order":0,"width":0,"height":0,"name":"","label":"{{msg.label}}","format":"{{msg.payload}}","layout":"row-spread","x":509,"y":799,"wires":[]},{"id":"b9501903.8a5e98","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":884,"wires":[]},{"id":"64f24588.5992fc","type":"ui_slider","z":"b66f2c73.9297e","name":"deviceDimmer","label":"","tooltip":"standard Dimmer","group":"6a28c45b.c2fe1c","order":31,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.sceneMembers.dimmer","min":"0","max":"100","step":"1","x":675,"y":935,"wires":[["77ce9446.49125c"]]},{"id":"816618f9.22d418","type":"ui_numeric","z":"b66f2c73.9297e","name":"deviceDimmer","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":32,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.scenes.sceneMembers.dimmer","format":"","min":"0","max":"100","step":"1","x":675,"y":986,"wires":[["77ce9446.49125c"]]},{"id":"d448d663.e5ab08","type":"ui_colour_picker","z":"b66f2c73.9297e","name":"deveiceColor","label":"","group":"6a28c45b.c2fe1c","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":34,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.scenes.sceneMembers.color","x":665,"y":1037,"wires":[["77ce9446.49125c"]]},{"id":"77ce9446.49125c","type":"subflow:dfa4352b.bdc548","z":"b66f2c73.9297e","name":"","env":[],"x":961,"y":901,"wires":[["511d94e8.4e555c","a6f217da.0136e8"]]},{"id":"733b53ac.37ee7c","type":"switch","z":"b66f2c73.9297e","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.sceneMembers.switch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.sceneMembers.dimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.sceneMembers.color","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":441,"y":918,"wires":[["dc1c3e5c.1fc98"],["64f24588.5992fc","816618f9.22d418"],["d448d663.e5ab08"]]},{"id":"e2c8ebad.ccad48","type":"subflow:c4a7cd6c.2a0c1","z":"b66f2c73.9297e","name":"selectSceneMember","env":[{"name":"host","value":"light,scenes","type":"str"},{"name":"property","value":"scenesMembers","type":"str"}],"x":984,"y":816,"wires":[["2db2806a.fda09","1c74b75.90d0649"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"8fe4ff8.edc55","type":"subflow:30d3b36b.8d171c","z":"b66f2c73.9297e","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":247,"y":884,"wires":[["3cb73867.558b98","4bd15493.a7bcdc"],["733b53ac.37ee7c"]]},{"id":"1c74b75.90d0649","type":"link out","z":"b66f2c73.9297e","name":"updateSceneMember","links":["c7587be1.a58208"],"x":1154,"y":816,"wires":[]},{"id":"c7587be1.a58208","type":"link in","z":"b66f2c73.9297e","name":"updateSceneMember","links":["1c74b75.90d0649","a6f217da.0136e8"],"x":136,"y":884,"wires":[["8fe4ff8.edc55"]]},{"id":"558c222.c6619dc","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":30,"width":2,"height":1,"name":"device Dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":969,"wires":[]},{"id":"29b52fb2.623a6","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":33,"width":2,"height":1,"name":"device color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":257,"y":1003,"wires":[]},{"id":"3cb73867.558b98","type":"subflow:8ba1eff6.75a11","z":"b66f2c73.9297e","name":"","env":[{"name":"customTopic","value":"mySettings.light.scenes.sceneMembers.uiDropdown","type":"str"}],"x":478,"y":816,"wires":[["a526798f.662f08","fa7aaa41.9eb008"]]},{"id":"2db2806a.fda09","type":"debug","z":"b66f2c73.9297e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1189,"y":850,"wires":[]},{"id":"511d94e8.4e555c","type":"link out","z":"b66f2c73.9297e","name":"setLight","links":["31915d49.c1d6a2"],"x":1086,"y":918,"wires":[]},{"id":"a6f217da.0136e8","type":"link out","z":"b66f2c73.9297e","name":"updateSceneMember","links":["c7587be1.a58208"],"x":1086,"y":884,"wires":[]},{"id":"dc1c3e5c.1fc98","type":"ui_switch","z":"b66f2c73.9297e","name":"","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":28,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.sceneMembers.switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":645,"y":884,"wires":[["77ce9446.49125c"]]},{"id":"c12cfb73.1fe4f8","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":27,"width":2,"height":1,"name":"device Switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":935,"wires":[]},{"id":"416a303f.3ca61","type":"subflow:33d1b88e.5b1368","z":"b66f2c73.9297e","name":"","env":[{"name":"defaults","value":"{\"note\":\"\",\"switch\":true,\"dimmer\":100,\"color\":{\"h\":0,\"s\":1,\"v\":1}}","type":"json"}],"x":969,"y":714,"wires":[["d8ee6a58.1d48d8"],["b5398d9b.02eb8","a526798f.662f08"]]},{"id":"5d59ea52.a36d94","type":"subflow:8ba1eff6.75a11","z":"b66f2c73.9297e","name":"fillRooms","env":[{"name":"customTopic","value":"mySettings.rooms.uiDropdown","type":"str"}],"x":655,"y":306,"wires":[["a63a10e4.6d909"]]},{"id":"a63a10e4.6d909","type":"ui_dropdown","z":"b66f2c73.9297e","name":"room","label":"","tooltip":"","place":"Raum auswählen","group":"6a28c45b.c2fe1c","order":7,"width":6,"height":1,"passthru":false,"options":[],"payload":"","topic":"mySettings.light.scenes.room","x":798,"y":306,"wires":[["fa5b665a.fd6078"]]},{"id":"e0008836.e61da8","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":6,"width":2,"height":1,"name":"Raum:","label":"Raum:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":306,"wires":[]},{"id":"762686f9.1f99c8","type":"ui_slider","z":"fe9fd924.188388","name":"sceneDimmer","label":"","tooltip":"Dimm Szene","group":"7e22101c.03087","order":6,"width":5,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.dimmer","min":"0","max":"100","step":"1","x":692,"y":272,"wires":[["535a9c1b.c444a4"]]},{"id":"57c706d9.907f18","type":"ui_text","z":"fe9fd924.188388","group":"7e22101c.03087","order":5,"width":2,"height":1,"name":"scene dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":284,"y":272,"wires":[]},{"id":"121f1c8f.13d7c3","type":"ui_dropdown","z":"fe9fd924.188388","name":"uiDropdown","label":"","tooltip":"","place":"Szene auswählen","group":"7e22101c.03087","order":1,"width":7,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.uiDropdown","x":682,"y":85,"wires":[["7f74073e.99e2a8"]]},{"id":"2900ecda.88a7d4","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["d107ebd4.5f0418"],"x":1103,"y":204,"wires":[]},{"id":"d107ebd4.5f0418","type":"link in","z":"fe9fd924.188388","name":"updateLightGroups","links":["2900ecda.88a7d4","fcc18de9.4abcd","673d1103.fd2fe","ba5cb199.0c1ad","a7385abe.d70aa8"],"x":168,"y":153,"wires":[["6c92ed17.83e384"]]},{"id":"a7385abe.d70aa8","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["d107ebd4.5f0418"],"x":1103,"y":85,"wires":[]},{"id":"6a40bc4a.14e2b4","type":"switch","z":"fe9fd924.188388","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.switch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.dimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.tint","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.color","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":458,"y":272,"wires":[["7daa3826.831c58"],["762686f9.1f99c8"],["ea8a725c.c4d58"],["12fbbdbf.886b92"]]},{"id":"cb81a114.a5004","type":"link in","z":"fe9fd924.188388","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":134,"y":51,"wires":[["3623592c.5e2806"]]},{"id":"7f74073e.99e2a8","type":"subflow:c4a7cd6c.2a0c1","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":85,"wires":[["a7385abe.d70aa8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"3623592c.5e2806","type":"subflow:e0e09953.42b938","z":"fe9fd924.188388","name":"light.scenes","env":[{"name":"baseObject","value":"light.scenes","type":"str"},{"name":"filterProperty","value":"room","type":"str"},{"name":"filterValue","value":"57ca4364-c304-7274-5ac4-ef21a2e91463","type":"str"}],"x":274,"y":85,"wires":[["a12485f7.891488","66561fd5.9ef09"]]},{"id":"6c92ed17.83e384","type":"subflow:30d3b36b.8d171c","z":"fe9fd924.188388","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":264,"y":153,"wires":[["a12485f7.891488"],["6a40bc4a.14e2b4"]]},{"id":"a12485f7.891488","type":"subflow:8ba1eff6.75a11","z":"fe9fd924.188388","name":"","env":[],"x":478,"y":85,"wires":[["121f1c8f.13d7c3","b1720b51.a5a7d8"]]},{"id":"12fbbdbf.886b92","type":"ui_colour_picker","z":"fe9fd924.188388","name":"sceneColor","label":"","group":"7e22101c.03087","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":9,"width":3,"height":1,"passthru":false,"topic":"mySettings.light.scenes.color","x":682,"y":374,"wires":[["535a9c1b.c444a4"]]},{"id":"7c51d19f.a10ea","type":"ui_text","z":"fe9fd924.188388","group":"7e22101c.03087","order":7,"width":2,"height":1,"name":"scene color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":323,"wires":[]},{"id":"7daa3826.831c58","type":"ui_switch","z":"fe9fd924.188388","name":"","label":"","tooltip":"","group":"7e22101c.03087","order":3,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":221,"wires":[["535a9c1b.c444a4"]]},{"id":"e6242bcf.d960f8","type":"ui_text","z":"fe9fd924.188388","group":"7e22101c.03087","order":2,"width":2,"height":1,"name":"scene switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":221,"wires":[]},{"id":"2310ff72.1a31c","type":"link out","z":"fe9fd924.188388","name":"setLight","links":["31915d49.c1d6a2"],"x":1103,"y":238,"wires":[]},{"id":"ea8a725c.c4d58","type":"ui_switch","z":"fe9fd924.188388","name":"tint","label":"","tooltip":"","group":"7e22101c.03087","order":8,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.tint","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":323,"wires":[["535a9c1b.c444a4"]]},{"id":"535a9c1b.c444a4","type":"subflow:dfa4352b.bdc548","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":221,"wires":[["2900ecda.88a7d4","2310ff72.1a31c"]]},{"id":"71563804.4b99b8","type":"inject","z":"fe9fd924.188388","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":281,"y":34,"wires":[["3623592c.5e2806"]]},{"id":"66561fd5.9ef09","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":153,"wires":[]},{"id":"b1720b51.a5a7d8","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":153,"wires":[]},{"id":"c18f5a82.6afa98","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":8,"width":2,"height":1,"name":"Label:","label":"Label:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":357,"wires":[]},{"id":"e0ad94fc.db3b08","type":"ui_text_input","z":"b66f2c73.9297e","name":"label","label":"","tooltip":"Beschriftung für Schalter","group":"6a28c45b.c2fe1c","order":9,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.label","x":645,"y":357,"wires":[["fa5b665a.fd6078"]]},{"id":"aa232916.59cc58","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":13,"width":2,"height":1,"name":"Note:","label":"Note:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":408,"wires":[]},{"id":"bc831fec.5e8bb","type":"ui_text_input","z":"b66f2c73.9297e","name":"note","label":"","tooltip":"Notiz","group":"6a28c45b.c2fe1c","order":14,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.note","x":645,"y":408,"wires":[["fa5b665a.fd6078"]]},{"id":"afd09637.da57b8","type":"ui_text_input","z":"b66f2c73.9297e","name":"http","label":"","tooltip":"http: command","group":"6a28c45b.c2fe1c","order":16,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.httpCmd","x":645,"y":459,"wires":[["fa5b665a.fd6078"]]},{"id":"3dbfe031.bd7b3","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":15,"width":2,"height":1,"name":"http:","label":"http cmd:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":459,"wires":[]},{"id":"67d12a26.202b14","type":"inject","z":"9831cab2.382058","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":68,"y":68,"wires":[["e3b27cfc.9d2c9"]]},{"id":"60645b5e.694cd4","type":"inject","z":"b66f2c73.9297e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":196,"y":17,"wires":[["d194eaba.a74a98"]]},{"id":"fa7aaa41.9eb008","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":628,"y":1088,"wires":[]},{"id":"77945c10.de8f74","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":951,"y":374,"wires":[]},{"id":"8b60226e.218f7","type":"link in","z":"fe9fd924.188388","name":"updateLightScenes","links":["3cdf4653.ce30aa","52f723c4.c5accc","da3bd253.8f899","f756c281.5f1e9"],"x":134,"y":102,"wires":[["3623592c.5e2806"]]},{"id":"b5398d9b.02eb8","type":"debug","z":"b66f2c73.9297e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1172,"y":731,"wires":[]},{"id":"20fbf6c1.9052aa","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":152,"y":289,"wires":[]},{"id":"d96aa565.00e108","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":782,"wires":[]},{"id":"d8ee6a58.1d48d8","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1172,"y":680,"wires":[]},{"id":"4bd15493.a7bcdc","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":867,"wires":[]},{"id":"b3a4ef66.0ea08","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":322,"y":289,"wires":[]},{"id":"46b5afd2.1a88c","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":746,"y":67,"wires":[]},{"id":"9e639b16.dbdfe8","type":"ui_slider","z":"fe9fd924.188388","name":"sceneDimmer","label":"","tooltip":"Dimm Szene","group":"cde25ae.eff1aa8","order":6,"width":5,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.dimmer","min":"0","max":"100","step":"1","x":692,"y":663,"wires":[["fcdec52a.505458"]]},{"id":"45e3857e.e7529c","type":"ui_text","z":"fe9fd924.188388","group":"cde25ae.eff1aa8","order":5,"width":2,"height":1,"name":"scene dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":284,"y":663,"wires":[]},{"id":"1806d787.f54198","type":"ui_dropdown","z":"fe9fd924.188388","name":"uiDropdown","label":"","tooltip":"","place":"Szene auswählen","group":"cde25ae.eff1aa8","order":1,"width":7,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.uiDropdown","x":682,"y":476,"wires":[["5e39e42f.a1208c"]]},{"id":"7599ab6.7273d54","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["3902144d.81ab8c"],"x":1103,"y":595,"wires":[]},{"id":"3902144d.81ab8c","type":"link in","z":"fe9fd924.188388","name":"updateLightGroups","links":["7599ab6.7273d54","fcc18de9.4abcd","673d1103.fd2fe","ba5cb199.0c1ad","eafb15a9.560dc8"],"x":168,"y":544,"wires":[["1d8fbbfc.d76c34"]]},{"id":"eafb15a9.560dc8","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["3902144d.81ab8c"],"x":1103,"y":476,"wires":[]},{"id":"b76250c9.7f0f8","type":"switch","z":"fe9fd924.188388","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.switch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.dimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.tint","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.color","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":458,"y":663,"wires":[["d8b9eaf8.7e9078"],["9e639b16.dbdfe8"],["e7b55d5c.f404a"],["62e0442d.f3e8ac"]]},{"id":"fe243d47.7c894","type":"link in","z":"fe9fd924.188388","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":134,"y":442,"wires":[["be4c523c.e56a4"]]},{"id":"5e39e42f.a1208c","type":"subflow:c4a7cd6c.2a0c1","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":476,"wires":[["eafb15a9.560dc8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"be4c523c.e56a4","type":"subflow:e0e09953.42b938","z":"fe9fd924.188388","name":"Wohnzimmer","env":[{"name":"baseObject","value":"light.scenes","type":"str"},{"name":"filterProperty","value":"room","type":"str"},{"name":"filterValue","value":"9d5943d1-3e5b-1626-e41b-4639241614b7","type":"str"}],"x":274,"y":476,"wires":[["69c4a194.a46ec","b3aacc79.59c54"]]},{"id":"1d8fbbfc.d76c34","type":"subflow:30d3b36b.8d171c","z":"fe9fd924.188388","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":264,"y":544,"wires":[["69c4a194.a46ec"],["b76250c9.7f0f8"]]},{"id":"69c4a194.a46ec","type":"subflow:8ba1eff6.75a11","z":"fe9fd924.188388","name":"","env":[],"x":478,"y":476,"wires":[["1806d787.f54198","de48323c.4288f"]]},{"id":"62e0442d.f3e8ac","type":"ui_colour_picker","z":"fe9fd924.188388","name":"sceneColor","label":"","group":"cde25ae.eff1aa8","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":9,"width":3,"height":1,"passthru":false,"topic":"mySettings.light.scenes.color","x":682,"y":765,"wires":[["fcdec52a.505458"]]},{"id":"c672599a.e700f8","type":"ui_text","z":"fe9fd924.188388","group":"cde25ae.eff1aa8","order":7,"width":2,"height":1,"name":"scene color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":714,"wires":[]},{"id":"d8b9eaf8.7e9078","type":"ui_switch","z":"fe9fd924.188388","name":"","label":"","tooltip":"","group":"cde25ae.eff1aa8","order":3,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":612,"wires":[["fcdec52a.505458"]]},{"id":"c79591b2.f4c57","type":"ui_text","z":"fe9fd924.188388","group":"cde25ae.eff1aa8","order":2,"width":2,"height":1,"name":"scene switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":612,"wires":[]},{"id":"8e4d3523.343658","type":"link out","z":"fe9fd924.188388","name":"setLight","links":["31915d49.c1d6a2"],"x":1103,"y":629,"wires":[]},{"id":"e7b55d5c.f404a","type":"ui_switch","z":"fe9fd924.188388","name":"tint","label":"","tooltip":"","group":"cde25ae.eff1aa8","order":8,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.tint","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":714,"wires":[["fcdec52a.505458"]]},{"id":"fcdec52a.505458","type":"subflow:dfa4352b.bdc548","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":612,"wires":[["7599ab6.7273d54","8e4d3523.343658"]]},{"id":"73f2f6d1.bed358","type":"inject","z":"fe9fd924.188388","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":281,"y":425,"wires":[["be4c523c.e56a4"]]},{"id":"b3aacc79.59c54","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":544,"wires":[]},{"id":"de48323c.4288f","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":544,"wires":[]},{"id":"3a86feaf.8de552","type":"link in","z":"fe9fd924.188388","name":"updateLightScenes","links":["3cdf4653.ce30aa","52f723c4.c5accc","da3bd253.8f899","f756c281.5f1e9"],"x":134,"y":493,"wires":[["be4c523c.e56a4"]]},{"id":"9876b27e.7db04","type":"function","z":"309a0a3e.c49326","name":"delete array entries","func":"var currentObject= global.get(\"mySettings\",\"file\");\nvar start=11;\ncurrentObject.light.devices.list.splice(start,currentObject.light.devices.list.length-start);\ncurrentObject.light.devices.uiPointer=0;\ndelete currentObject.light.devices.currentUuid;\ndelete currentObject.light.devices.uiPointerUuid;","outputs":1,"noerr":0,"x":311,"y":476,"wires":[[]]},{"id":"f95b26ed.7c7438","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":476,"wires":[["9876b27e.7db04"]]},{"id":"3b5df653.a98d2a","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"e6a23911.f60378","name":"","deviceID":"ESP_Homie_Test","nodeID":"BME280","propertyID":"Temperature","topic":"ESP_Homie_Test/BME280/Temperature","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":245,"y":374,"wires":[["14334580.67484b"],["25c7e28d.1df31e"]]},{"id":"14334580.67484b","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":374,"wires":[]},{"id":"496c2519.53adbc","type":"mqtt in","z":"833d7b75.5dd878","name":"","topic":"#","qos":"2","datatype":"auto","broker":"7ef5ea17.178a64","x":391,"y":272,"wires":[["8d86031.aed8d"]]},{"id":"8d86031.aed8d","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":272,"wires":[]},{"id":"25c7e28d.1df31e","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":408,"wires":[]},{"id":"673413f6.d7244c","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"e6a23911.f60378","name":"","deviceID":"switch-controller","nodeID":"switch-sensor","propertyID":"sw0","topic":"switch-controller/switch-sensor/sw0","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":259,"y":119,"wires":[[],[]]},{"id":"642ac148.46602","type":"function","z":"991e8cc1.0c169","name":"validate","func":"var globalStore = env.get(\"globalStore\");\nvar listObject = env.get(\"listObject\");\nvar targetObject = env.get(\"targetObject\");\nvar listParts = listObject.split(\".\");\nvar errMsg;\nvar base = global.get(globalStore,\"file\");\nvar listBase = c\n\nvar checkObject = function(listBase) {\n    for (var listPart=1; listPart < listParts.length; listPart++) {\n        if (listParts[listPart].indexOf(\"[\")!==-1) {\n            var variableElement = listParts[listPart].substring(listParts[listPart].indexOf(\"[\")+1,listParts[listPart].lastIndexOf(\"]\"))\n            if (Array.isArray(listBase.list)) {\n                if (variableElement!==\"\") {\n                    checkObject(listBase.list[msg.payload[variableElement]]);\n                } else {\n                    for (var aBase in listBase.list) checkObject(aBase);\n                }\n            } else {\n                errMsg= \"Expected object.list on variable position\"\n            }\n        } else {\n            listBase=listBase[listParts[listPart]];\n        }\n    }\n}\n\ncheckObject(variableElement);\n\nif (errMsg) {\n    node.error(errMsg);\n}\n\nmsg.payload.listBase=listBase;\nreturn [null,msg];","outputs":2,"noerr":0,"x":180,"y":119,"wires":[[],[]]},{"id":"10ad777d.b669f9","type":"subflow:991e8cc1.0c169","z":"309a0a3e.c49326","name":"checkSceneMembers","env":[{"name":"listObject","value":"light.scenes.[scene].sceneMembers","type":"str"},{"name":"targetObject","value":"light.devices","type":"str"}],"x":780,"y":289,"wires":[[]]},{"id":"61a7e127.933e","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"{\"szene\":0}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":544,"y":289,"wires":[["10ad777d.b669f9"]]},{"id":"8fc4b51e.3d3718","type":"debug","z":"897fdb2a.109f68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":883,"y":952,"wires":[]},{"id":"9180f1da.c0222","type":"debug","z":"dd3f4b52.8a4468","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":628,"y":34,"wires":[]},{"id":"760edac9.0be9b4","type":"inject","z":"dd3f4b52.8a4468","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":34,"wires":[["1fb940b1.6cff6f"]]},{"id":"3cc8a52e.5c819a","type":"debug","z":"dd3f4b52.8a4468","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":356,"y":34,"wires":[]},{"id":"5af35995.c5d728","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":323,"wires":[["a3a751e8.db6f3"]]},{"id":"a3a751e8.db6f3","type":"function","z":"309a0a3e.c49326","name":"delete heating.rooms","func":"var currentObject= global.get(\"mySettings\",\"file\");\ndelete currentObject.heating.rooms;\n\nreturn msg;","outputs":1,"noerr":0,"x":321,"y":323,"wires":[[]]},{"id":"8ff02f5b.a940f","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":934,"y":306,"wires":[]},{"id":"997ce432.b8f658","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1274,"y":646,"wires":[]},{"id":"dfd31a4e.2d22d8","type":"debug","z":"afaa0885.ad2718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":424,"y":1122,"wires":[]},{"id":"2617a8a2.cd40a8","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay1","topic":"Gartenbeleuchtung-1/Lights/relay1","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Relay 4","uiPlaceName":"","uiNode":"uiSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#e46f27","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":684,"y":119,"wires":[["474f6afb.e78b64","ee4d0fdf.4f155"],[]]},{"id":"474f6afb.e78b64","type":"ui_switch","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","tooltip":"","group":"37eeda5a.799966","order":0,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":951,"y":153,"wires":[["2617a8a2.cd40a8","e33f1364.629b4"]]},{"id":"e33f1364.629b4","type":"debug","z":"833d7b75.5dd878","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1138,"y":153,"wires":[]},{"id":"ee4d0fdf.4f155","type":"debug","z":"833d7b75.5dd878","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1138,"y":102,"wires":[]},{"id":"41de50fb.158a3","type":"debug","z":"6ed67795.6a6c28","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":430,"y":640,"wires":[]},{"id":"22a4b681.f9612a","type":"switch","z":"6ed67795.6a6c28","name":"Lux =0 >5","property":"value","propertyType":"msg","rules":[{"t":"lt","v":"1","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":440,"y":600,"wires":[["6464440e.d8c33c"],["aecc35d0.6afc08"]]},{"id":"6464440e.d8c33c","type":"function","z":"6ed67795.6a6c28","name":"ON","func":"return {\"payload\":\"ON\"};","outputs":1,"noerr":0,"x":610,"y":580,"wires":[["eed79bde.26ef48","42737cad.933a54","c3092cab.abf54"]]},{"id":"aecc35d0.6afc08","type":"function","z":"6ed67795.6a6c28","name":"OFF","func":"return {\"payload\":\"OFF\"};","outputs":1,"noerr":0,"x":610,"y":620,"wires":[["eed79bde.26ef48","42737cad.933a54","c3092cab.abf54"]]},{"id":"7afcd9b.0802a28","type":"comment","z":"6ed67795.6a6c28","name":"Gartenbeleuchtung","info":"","x":130,"y":320,"wires":[]},{"id":"c64596de.862ea8","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"","deviceID":"Bewaesserung-3","nodeID":"BH1750","propertyID":"Lux","topic":"Bewaesserung-3/BH1750/Lux","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"none","labelTopic":false,"labelPayload":true,"labelName":"","uiPlaceName":"","uiNode":"uiButton","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":170,"y":620,"wires":[["22a4b681.f9612a","41de50fb.158a3","a40b41ce.b413c","1a36e17f.b98b9f"],[]]},{"id":"fa7fca77.316418","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"relay1","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay1","topic":"Gartenbeleuchtung-1/Lights/relay1","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":true,"labelName":"","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":830,"y":400,"wires":[["6cc1d2a2.8a5e7c"],[]]},{"id":"6cc1d2a2.8a5e7c","type":"ui_switch","z":"6ed67795.6a6c28","name":"","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1030,"y":460,"wires":[["fa7fca77.316418"]]},{"id":"c3092cab.abf54","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"Sonnendeck (2)","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay2","topic":"Gartenbeleuchtung-1/Lights/relay2","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":true,"labelName":"Sonnendeck","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":860,"y":480,"wires":[["c2d454da.7725a8"],[]]},{"id":"c2d454da.7725a8","type":"ui_switch","z":"6ed67795.6a6c28","name":"","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1030,"y":540,"wires":[["c3092cab.abf54"]]},{"id":"eed79bde.26ef48","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"Laterne (3)","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay3","topic":"Gartenbeleuchtung-1/Lights/relay3","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":true,"labelName":"Laterne","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":850,"y":560,"wires":[["face3bad.a0f6e8"],[]]},{"id":"face3bad.a0f6e8","type":"ui_switch","z":"6ed67795.6a6c28","name":"Laterne","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1040,"y":620,"wires":[["eed79bde.26ef48"]]},{"id":"42737cad.933a54","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"Baum (4)","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay4","topic":"Gartenbeleuchtung-1/Lights/relay4","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":true,"labelName":"Baum","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":840,"y":640,"wires":[["1541374.d0bc5c9"],[]]},{"id":"1541374.d0bc5c9","type":"ui_switch","z":"6ed67795.6a6c28","name":"Baum","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1030,"y":700,"wires":[["42737cad.933a54"]]},{"id":"a40b41ce.b413c","type":"ui_level","z":"6ed67795.6a6c28","group":"1b90cb05.60c0a5","order":2,"width":0,"height":0,"name":"Sonne","label":"Sonne","colorHi":"#ffffc6","colorWarn":"#fce64b","colorNormal":"#fbd744","colorOff":"#595959","min":0,"max":"4000","segWarn":"10","segHigh":"1000","unit":"Lux","layout":"sh","channelA":"","channelB":"","decimals":"0","animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#000000","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"x":430,"y":680,"wires":[]},{"id":"1a36e17f.b98b9f","type":"ui_chart","z":"6ed67795.6a6c28","name":"","group":"1b90cb05.60c0a5","order":1,"width":0,"height":0,"label":"Belichtung","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":450,"y":720,"wires":[[]]},{"id":"121677f.3810388","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"","deviceID":"Teichpumpe","nodeID":"Relais","propertyID":"switch","topic":"Teichpumpe/Relais/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Teichpumpe","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":150,"y":840,"wires":[["c27bc2f.544784","99d7312a.0a02c"],[]]},{"id":"c27bc2f.544784","type":"ui_switch","z":"6ed67795.6a6c28","name":"Umwälzpumpe","label":"{{msg.label}}","tooltip":"","group":"43e7dd36.28fbe4","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":440,"y":900,"wires":[["121677f.3810388"]]},{"id":"99d7312a.0a02c","type":"debug","z":"6ed67795.6a6c28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":410,"y":820,"wires":[]},{"id":"ff7f8cd5.1f168","type":"function","z":"25cbe481.e10bec","name":"payload>0","func":"if (msg.payload>0) {\n    return msg;\n}","outputs":1,"noerr":0,"x":1290,"y":600,"wires":[["6909e129.6d064"]]},{"id":"fe7c3d31.aaeb","type":"function","z":"25cbe481.e10bec","name":"Homie","func":"var homieData = global.get(\"homieData\",\"file\") || {}\nvar elements = msg.topic.split('/');\nvar date = new Date();\nvar changed = false;\n\nif (homieData[elements[1]]===undefined) homieData[elements[1]]={\"mame\":elements[1]};\nif (elements.length==2) { // unit\n    msg.unit = elements[1];\n    msg.measurement = elements[1];\n    msg.intervalUpdate = date.getTime() - homieData[elements[1]].lastUpdated;\n    homieData[elements[1]].lastUpdated=date.getTime();\n} else {\n    if (homieData[elements[1]][elements[2]]===undefined) homieData[elements[1]][elements[2]]={\"mame\":elements[2]};\n    if (elements.length==3) { // device\n        msg.unit = elements[1];\n        msg.device = elements[2];\n        msg.measurement = elements[1]+\"/\"+elements[2];\n        msg.intervalUpdate = date.getTime() - homieData[elements[1]][elements[2]].lastUpdated;\n        homieData[elements[1]][elements[2]].lastUpdated=date.getTime();\n    } else {\n        if (homieData[elements[1]][elements[2]][elements[3]]===undefined) homieData[elements[1]][elements[2]][elements[3]]={\"mame\":elements[3]};\n        if (elements.length==4) { // parameter\n            msg.unit = elements[1];\n            msg.device = elements[2];\n            msg.parameter = elements[3];\n            msg.measurement = elements[1]+\"/\"+elements[2]+\"/\"+elements[3];\n            if (homieData[elements[1]][elements[2]][elements[3]].$datatype!==undefined) {\n                if (homieData[elements[1]][elements[2]][elements[3]].$datatype==\"integer\") {\n                    msg.payload=Math.floor(Number(msg.payload));\n                }\n                if (homieData[elements[1]][elements[2]][elements[3]].$datatype==\"float\") {\n                    msg.payload=Number(msg.payload);\n                }\n            }\n            msg.intervalUpdate = date.getTime() - homieData[elements[1]][elements[2]][elements[3]].lastUpdated;\n            homieData[elements[1]][elements[2]][elements[3]].lastUpdated=date.getTime();\n            if (homieData[elements[1]][elements[2]][elements[3]].payload!=msg.payload) {\n                msg.intervalChange = date.getTime() - homieData[elements[1]][elements[2]][elements[3]].lastChanged;\n                homieData[elements[1]][elements[2]][elements[3]].payload=msg.payload;\n                homieData[elements[1]][elements[2]][elements[3]].lastChanged=date.getTime();\n                changed = true;\n            }  \n        } else if (elements.length==5) { // parameter Info\n            homieData[elements[1]][elements[2]][elements[3]][elements[4]]=msg.payload;\n        }\n    }\n}\n\nglobal.set(\"homieData\",homieData,\"file\");\nif (changed) return [msg,msg];\n    else return [msg,null];","outputs":2,"noerr":0,"x":310,"y":540,"wires":[["ea69dec0.d0125"],["69a30ff7.6d3a3","323fa9a.3078456"]],"outputLabels":["all Messages","updated Messages"],"icon":"node-red/bridge.png"},{"id":"744898eb.220ac8","type":"mqtt in","z":"25cbe481.e10bec","name":"","topic":"homie/#","qos":"0","datatype":"auto","broker":"6389f524.8a4e3c","x":140,"y":540,"wires":[["fe7c3d31.aaeb","22286578.f0b08a"]]},{"id":"ea69dec0.d0125","type":"debug","z":"25cbe481.e10bec","name":"allValues","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":502,"y":459,"wires":[]},{"id":"22286578.f0b08a","type":"debug","z":"25cbe481.e10bec","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":310,"y":580,"wires":[]},{"id":"7c6b6568.d90a8c","type":"ui_level","z":"25cbe481.e10bec","group":"43e7dd36.28fbe4","order":0,"width":0,"height":0,"name":"Pumpe Power","label":"Leistung","colorHi":"#df0000","colorWarn":"#00b700","colorNormal":"#ff0000","colorOff":"#595959","min":0,"max":100,"segWarn":"45","segHigh":"55","unit":"w","layout":"sh","channelA":"","channelB":"","decimals":"1","animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#000000","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"x":1140,"y":680,"wires":[]},{"id":"6a35eb2.ba3fd14","type":"switch","z":"25cbe481.e10bec","name":"Energy","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Power","vt":"str"},{"t":"eq","v":"Voltage","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":940,"y":720,"wires":[["1c80ab26.6c4a05","7c6b6568.d90a8c","6909e129.6d064"],["e6409eaf.30f3f","fbc1c902.17dda8","6909e129.6d064"]]},{"id":"fbc1c902.17dda8","type":"ui_level","z":"25cbe481.e10bec","group":"43e7dd36.28fbe4","order":0,"width":0,"height":0,"name":"Pumpe Voltage","label":"Spannung","colorHi":"#df0000","colorWarn":"#00b700","colorNormal":"#ff0000","colorOff":"#595959","min":"190","max":"250","segWarn":"210","segHigh":"230","unit":"V","layout":"sh","channelA":"","channelB":"","decimals":"0","animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#000000","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"x":1140,"y":760,"wires":[]},{"id":"69a30ff7.6d3a3","type":"switch","z":"25cbe481.e10bec","name":"unit","property":"unit","propertyType":"msg","rules":[{"t":"eq","v":"Bewaesserung-1","vt":"str"},{"t":"eq","v":"Bewaesserung-2","vt":"str"},{"t":"eq","v":"Bewaesserung-3","vt":"str"},{"t":"eq","v":"Teichpumpe","vt":"str"},{"t":"eq","v":"Teichventil","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":490,"y":540,"wires":[["87239fb.9860e6"],[],["5b959dfc.708394"],["cfd0cd9f.24754"],["b9d5baa.29a6848"]]},{"id":"cfd0cd9f.24754","type":"switch","z":"25cbe481.e10bec","name":"Teichpumpe","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"Energy","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":720,"wires":[["6a35eb2.ba3fd14"]]},{"id":"5b959dfc.708394","type":"switch","z":"25cbe481.e10bec","name":"Bewaesserung-3","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"BME280","vt":"str"},{"t":"eq","v":"BH1750","vt":"str"},{"t":"eq","v":"Rain","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":710,"y":540,"wires":[["824f522c.9241a"],["615b88e7.437fa8"],["4abc5d8e.055d74"]]},{"id":"824f522c.9241a","type":"switch","z":"25cbe481.e10bec","name":"BME280","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Temperature","vt":"str"},{"t":"eq","v":"Humidity","vt":"str"},{"t":"eq","v":"Pressure","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":940,"y":440,"wires":[["4707cb3e.73c874","6909e129.6d064","7ff6e58a.de588c"],["e9a281de.5463","6909e129.6d064"],["67e608be.47ec78","6909e129.6d064"]]},{"id":"4707cb3e.73c874","type":"ui_gauge","z":"25cbe481.e10bec","name":"Temperatur","group":"5ffa92f6.040b6c","order":1,"width":0,"height":0,"gtype":"gage","title":"Innentemperatur","label":"°C","format":"{{value | number:1}}","min":"-20","max":"45","colors":["#9ab1c2","#5ea83e","#a92e2e"],"seg1":"7","seg2":"30","x":1130,"y":400,"wires":[]},{"id":"615b88e7.437fa8","type":"switch","z":"25cbe481.e10bec","name":"BH1750","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Lux","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":940,"y":540,"wires":[["6909e129.6d064"]]},{"id":"67e608be.47ec78","type":"ui_text","z":"25cbe481.e10bec","group":"5ffa92f6.040b6c","order":2,"width":0,"height":0,"name":"","label":"Druck","format":"{{msg.payload}}","layout":"row-spread","x":1110,"y":480,"wires":[]},{"id":"e9a281de.5463","type":"ui_text","z":"25cbe481.e10bec","group":"5ffa92f6.040b6c","order":3,"width":0,"height":0,"name":"","label":"Luftfeuchte","format":"{{msg.payload}} %","layout":"row-spread","x":1130,"y":440,"wires":[]},{"id":"1c80ab26.6c4a05","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"763687d.660d278","order":2,"width":0,"height":0,"label":"Leistung","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1120,"y":720,"wires":[[]]},{"id":"87239fb.9860e6","type":"switch","z":"25cbe481.e10bec","name":"Bewaesserung-1","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"Boden","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":240,"wires":[["32f83a4c.e24d96"]]},{"id":"32f83a4c.e24d96","type":"switch","z":"25cbe481.e10bec","name":"Boden","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Temperature","vt":"str"},{"t":"eq","v":"Humidity","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":930,"y":240,"wires":[["beec2d09.0d7bb","a9fa8df7.44573","6909e129.6d064"],["6909e129.6d064","5a518902.cf5178","e0881662.c6eba8"]]},{"id":"beec2d09.0d7bb","type":"ui_gauge","z":"25cbe481.e10bec","name":"Temperatur","group":"9ee1b18d.51ece","order":2,"width":"3","height":"2","gtype":"gage","title":"Temperatur","label":"°C","format":"{{value | number:1}}","min":"-20","max":"45","colors":["#9ab1c2","#5ea83e","#a92e2e"],"seg1":"7","seg2":"30","x":1130,"y":180,"wires":[]},{"id":"4abc5d8e.055d74","type":"switch","z":"25cbe481.e10bec","name":"Rain","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Count","vt":"str"},{"t":"eq","v":"Total","vt":"str"},{"t":"eq","v":"Time","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":930,"y":620,"wires":[["1831d1d9.ab84ee","ff7f8cd5.1f168"],["1831d1d9.ab84ee"],[]]},{"id":"1831d1d9.ab84ee","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"4723b9bd.fb3598","order":2,"width":0,"height":0,"label":"Regen","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"step","nodata":"warte auf Regen","dot":false,"ymin":"0","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1110,"y":600,"wires":[[]]},{"id":"a9fa8df7.44573","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"9ee1b18d.51ece","order":1,"width":0,"height":0,"label":"Bodentemperatur","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"bezier","nodata":"warte auf Daten","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":220,"wires":[[]]},{"id":"e6409eaf.30f3f","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"763687d.660d278","order":2,"width":0,"height":0,"label":"Spannung","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":800,"wires":[[]]},{"id":"323fa9a.3078456","type":"debug","z":"25cbe481.e10bec","name":"changed","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":502,"y":612,"wires":[]},{"id":"b9d5baa.29a6848","type":"switch","z":"25cbe481.e10bec","name":"Teichventil","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"Temperatur1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":880,"wires":[["e71d17ca.e3eca8"]]},{"id":"e71d17ca.e3eca8","type":"switch","z":"25cbe481.e10bec","name":"Temperatur1","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Temp1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":950,"y":880,"wires":[["50cf7b79.4db344","8b8a4e79.25681","6909e129.6d064"]]},{"id":"50cf7b79.4db344","type":"ui_chart","z":"25cbe481.e10bec","name":"Temperatur","group":"fa42e847.06d618","order":2,"width":0,"height":0,"label":"{{msg.parameter}}","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"step","nodata":"warte auf Daten","dot":false,"ymin":"0","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":900,"wires":[[]]},{"id":"8b8a4e79.25681","type":"ui_gauge","z":"25cbe481.e10bec","name":"Temperatur","group":"fa42e847.06d618","order":1,"width":0,"height":0,"gtype":"gage","title":"Wassertemperatur","label":"°C","format":"{{value | number:1}}","min":"-5","max":"30","colors":["#9ab1c2","#5ea83e","#a92e2e"],"seg1":"7","seg2":"25","x":1130,"y":860,"wires":[]},{"id":"5a518902.cf5178","type":"ui_gauge","z":"25cbe481.e10bec","name":"Bodenfeuchte","group":"9ee1b18d.51ece","order":3,"width":"3","height":"2","gtype":"gage","title":"Feuchte","label":"%","format":"{{value | number:1}}","min":"40","max":"60","colors":["#008000","#5ea83e","#ffff80"],"seg1":"","seg2":"","x":1140,"y":260,"wires":[]},{"id":"e0881662.c6eba8","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"9ee1b18d.51ece","order":4,"width":0,"height":0,"label":"Bodenfeuchte","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"warte auf Daten","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1118,"y":300,"wires":[[]]},{"id":"7ff6e58a.de588c","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"5ffa92f6.040b6c","order":4,"width":"7","height":"7","label":"Temperatur","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"warte auf Daten","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":360,"wires":[[]]},{"id":"c6152cb3.110cc","type":"inject","z":"5b6fa421.88b5bc","name":"On","topic":"","payload":"{\"On\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":200,"wires":[["5c83b43c.10499c"]]},{"id":"3439b91c.802006","type":"debug","z":"5b6fa421.88b5bc","name":"HomeKit Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":600,"y":240,"wires":[]},{"id":"750c4b0e.cc4324","type":"inject","z":"5b6fa421.88b5bc","name":"Off","topic":"","payload":"{\"On\":false}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":260,"wires":[["5c83b43c.10499c"]]},{"id":"5c83b43c.10499c","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Example Switch","serviceName":"Switch","topic":"","filter":false,"manufacturer":"Default Manufacturer","model":"Default Model","serialNo":"Default Serial Number","characteristicProperties":"{}","x":410,"y":240,"wires":[["3439b91c.802006"],[]]},{"id":"6909e129.6d064","type":"influxdb out","z":"25cbe481.e10bec","d":true,"influxdb":"30064ba2.1a2874","name":"to influxDB","measurement":"","precision":"","retentionPolicy":"","x":1510,"y":460,"wires":[]},{"id":"9050990b.5553c8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":320,"wires":[]},{"id":"41b0a88c.eb29d8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":340,"wires":[]},{"id":"615e37c1.ce5ce8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1274,"y":680,"wires":[]},{"id":"994d1ce.0deabe","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1274,"y":714,"wires":[]},{"id":"2bcaf814.086108","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":374,"wires":[["dc630f01.ac99"]]},{"id":"dc630f01.ac99","type":"function","z":"309a0a3e.c49326","name":"delete heating.devices.layout","func":"var currentObject= global.get(\"mySettings\",\"file\");\ndelete currentObject.heating.devices.layout;\n\nreturn msg;","outputs":1,"noerr":0,"x":341,"y":374,"wires":[[]]},{"id":"de90c4c8.7db9d8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1036,"y":952,"wires":[]},{"id":"36542b63.916a34","type":"debug","z":"afaa0885.ad2718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":1173,"wires":[]},{"id":"23cfd0c3.e20ea","type":"debug","z":"dd3f4b52.8a4468","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":866,"y":510,"wires":[]},{"id":"3b425306.f3caec","type":"ui_list","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","name":"Lights","order":23,"width":8,"height":7,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"mySettings.light.scenes.sceneMembers","x":645,"y":714,"wires":[["416a303f.3ca61","2c818ec7.042a62"]]},{"id":"66c5ebf.74f0b14","type":"ui_list","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","name":"Lights","order":14,"width":8,"height":7,"lineType":"one","actionType":"check","allowHTML":true,"outputs":1,"topic":"mySettings.light.groups.groupMembers","x":594,"y":510,"wires":[["6cd5f93f.c42ac8"]]},{"id":"378844f7.a04c1c","type":"ui_list","z":"dd3f4b52.8a4468","group":"4ac97505.03ae4c","name":"days","order":1,"width":8,"height":7,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"mySettings.heating.periods.days","x":560,"y":459,"wires":[["baf525eb.f5de78"]]},{"id":"1751bfe.a87f04","type":"debug","z":"b66f2c73.9297e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":934,"y":561,"wires":[]},{"id":"38003863.d59a68","type":"debug","z":"b66f2c73.9297e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":934,"y":663,"wires":[]},{"id":"2c818ec7.042a62","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":798,"y":748,"wires":[]},{"id":"6dbb0f83.0bf06","type":"syslog-input","z":"1e193208.71985e","name":"syslog","socktype":"udp","address":"","port":"514","topic":"","x":118,"y":272,"wires":[["d54606f7.055af8"]]},{"id":"63cf45e5.3e8d8c","type":"ui_table","z":"1e193208.71985e","group":"51ce6aa1.620754","name":"Syslog","order":6,"width":22,"height":8,"columns":[],"outputs":1,"cts":true,"x":747,"y":187,"wires":[["4e5b6320.769b1c","e6ca246c.97c3e8"]]},{"id":"fdd77b85.5f81a8","type":"debug","z":"1e193208.71985e","name":"save ui_control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1168,"y":187,"wires":[]},{"id":"f1ca2f97.e3436","type":"function","z":"868280d8.dfda9","name":"saveUiControl","func":"var msgUI={};\n\n// store for uiControl callbacks data\nvar status={};\nvar context=env.get(\"context\");\nif (!context || !context.hasOwnProperty(\"storeName\") || !context.hasOwnProperty(\"storeProvider\") || !context.hasOwnProperty(\"storeTempName\")) {\n    node.error(\"context not configured!\");\n    return;\n}\nvar uiNode=env.get(\"uiNode\")\nif (!uiNode) {\n    node.error(\"uiNode not configured!\");\n    return;\n}\n\nvar uiControlTemp=global.get(context.storeTempName);\nif (uiControlTemp===undefined) { // initialize store\n    uiControlTemp={};\n    global.set(context.storeTempName,uiControlTemp);\n}\nif (uiControlTemp[msg.socketid]===undefined) { // initalize temporary object for socketID\n    uiControlTemp[msg.socketid]={};\n}\nuiControlTemp=uiControlTemp[msg.socketid];\n\n// store for global uiControl\nvar uiControl=global.get(context.storeName,context.storeProvider);\nif (uiControl===undefined) { // initialize store\n    uiControl={};\n    global.set(context.storeName,uiControl,context.storeProvider);\n}\n\n// set uiNode\nif (!uiControl.hasOwnProperty(uiNode)) uiControl[uiNode]={};\nuiControl=uiControl[uiNode];\nif (!uiControlTemp.hasOwnProperty(uiNode)) uiControlTemp[uiNode]={};\nuiControlTemp=uiControlTemp[uiNode];\n\n// get or initalize maxStoreLines\nvar maxStoreLines=env.get(\"maxStoreLines\") || 100;\nif (uiControl.hasOwnProperty(\"maxStoreLines\")) {\n    maxStoreLines=uiControl.maxStoreLines;\n} else {\n    msgUI.topic=\"updateMaxStoreLines\";\n    msgUI.payload=maxStoreLines;\n    uiControl.maxStoreLines=maxStoreLines;\n}\n\nif (msg.hasOwnProperty(\"ui_control\") &&\n    msg.ui_control.hasOwnProperty(\"callback\")) {\n    switch(msg.ui_control.callback) {\n        case \"columnResized\": // save column sizes globaly\n            uiControl[msg.ui_control.columnWidths.field+\":\"+msg.ui_control.columnWidths.title]={\"width\":msg.ui_control.columnWidths.width};\n            status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\": \"+msg.ui_control.columnWidths.field+\".width=\"+msg.ui_control.columnWidths.width};\n            break;\n        case \"columnMoved\": // save column order\n            if (env.get(\"tempColumnOrder\")) {\n                uiControlTemp.columnOrder=msg.ui_control.columns;\n                status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\": order \"+uiControlTemp.columnOrder.length+\" (temp)\"};\n            } else {\n                uiControl.columnOrder=msg.ui_control.columns;\n                status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\": order \"+uiControl.columnOrder.length+\" (persistant)\"};\n            }\n            break;\n        case \"addData\": // sucessfully added a new row\n            if (!uiControl.hasOwnProperty(\"tableData\") || !Array.isArray(uiControl.tableData)) uiControl[\"tableData\"]=[];\n            if (msg.return.arguments[1]) {\n                uiControl.tableData.unshift(msg.return.arguments[0]);\n                if (uiControl.tableData.length>maxStoreLines) { // delete rows from bottom\n                    uiControl.tableData.splice(maxStoreLines,uiControl.tableData.length-1);\n                }\n            } else {\n                uiControl.tableData.push(msg.return.arguments[0]);\n                if (uiControl.tableData.length>maxStoreLines) { // delete rows from top\n                    uiControl.tableData.splice(0,uiContro.tableData.length-maxStoreLines);\n                }                \n            }\n            \n            // collect possible filter options and update dropdown if nessesary\n            var filterProperty=env.get(\"filterProperty\");\n            if (msg.return.arguments[0].hasOwnProperty(filterProperty)) {\n                if (!uiControl.hasOwnProperty(\"filterList\")) uiControl.filterList=[\"[all]\"];\n                if (!uiControl.filterList.includes(msg.return.arguments[0][filterProperty])) {\n                    uiControl.filterList.push(msg.return.arguments[0][filterProperty]);\n                    msgUI.topic=\"updateFilterList\";\n                    msgUI.options=uiControl.filterList;\n                }\n            }\n            \n            status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\": \"+uiControl.tableData.length+\" rows\"};\n            break;\n    }\n}\n\nreturn [{payload:status},msg,msgUI];","outputs":3,"noerr":0,"x":199,"y":119,"wires":[[],[],[]]},{"id":"4e5b6320.769b1c","type":"subflow:868280d8.dfda9","z":"1e193208.71985e","name":"","env":[{"name":"uiNode","value":"syslogTable","type":"str"}],"x":930,"y":221,"wires":[["fdd77b85.5f81a8"],["a5a86c28.1dc44","aafd2539.905ba8"]]},{"id":"f7b608bf.20f908","type":"function","z":"e8fd2fc9.509e","name":"loadUiControl","func":"var msgOut={}; // output 1\nvar msgToInput; // output 2 (initally undefined)\nvar msgToUI; // output 3 (initally undefined)\nvar status={fill:\"yellow\",shape:\"dot\",text:\"\"};\n\n// set uiNode\nvar uiNode=env.get(\"uiNode\");\nvar context=env.get(\"context\");\nif (!context || !context.hasOwnProperty(\"storeName\") || !context.hasOwnProperty(\"storeProvider\") || !context.hasOwnProperty(\"storeTempName\")) {\n    node.error(\"context not configured!\");\n}\n\n// get store for socketid uiControl context\nvar uiControlTemp=global.get(context.storeTempName) || {};\n\n// get store for persistent uiControl conetxt\nvar uiControl=global.get(context.storeName,context.storeProvider) || {};\nif (!uiControl.hasOwnProperty(uiNode)) uiControl[uiNode]={};\nuiControl=uiControl[uiNode];\n\n// function to get teh config matching the client ip address or a general config\nuiControl.getConfig= function (msg,uiControl,uiControlTemp) {\n    var socketip;\n    if (!uiControl.hasOwnProperty(\"config\")) uiControl.config={};\n    if (msg.hasOwnProperty(\"socketid\")) {\n        if (!uiControlTemp.hasOwnProperty(msg.socketid)) uiControlTemp[msg.socketid]={};\n        \n        if (uiControlTemp[msg.socketid].hasOwnProperty(\"socketip\")){\n            socketip=uiControlTemp[msg.socketid].socketip;\n        } else if (msg.hasOwnProperty(\"socketip\")) {\n            socketip=msg.socketip;\n            uiControlTemp[msg.socketid].socketip=socketip;\n        }\n    }\n    if (socketip!==\"undefined\") {\n        if (!uiControl.config.hasOwnProperty(socketip)) uiControl.config[socketip]={};\n        return uiControl.config[socketip];\n    } else {\n        return uiControl.config;\n    }\n}\n\nvar config=uiControl.getConfig(msg, uiControl, uiControlTemp);\n\n// store all values if msg.storeValue msg arrives\n\nif (msg.hasOwnProperty(\"storeValue\")) {\n    config[msg.storeValue]=msg.payload;\n}\n\n// get or initalize maxStoreLines\nvar maxDisplayLines=env.get(\"maxDisplayLines\") || 1000;\nif (uiControl.hasOwnProperty(\"maxDisplayLines\")) maxDisplayLines=uiControl.maxDisplayLines;\nelse uiControl.maxDisplayLines=maxDisplayLines;\n\n\n// handle command send by msg.command\n\nif (msg && msg.hasOwnProperty(\"command\")) {\n    switch(msg.command) {\n        case \"deleteRecords\":\n            if (msg.payload===\"OK\") {\n                uiControl.tableData=[];\n                uiControl.filterList=[\"[any]\"];\n                msg.payload=\"OK\"; // to trigger redraw\n                msg.name=env.get(\"tabName\");\n                msgToUI={\"command\":\"resetCounter\"}\n            } else {\n                return;\n            }\n            break;\n        case \"syslogActiv\":\n            uiControl.syslogActiv=msg.payload || false;\n            if (!msgToInput) msgToInput={}\n            msgToInput.command=\"syslogActiv\";\n            msgToInput.syslogActiv=uiControl.syslogActiv;\n            status.text=\"activ :\"+uiControl.syslogActiv;\n            return [{payload:status},null,msgToInput,null];\n        case \"maxStoreLines\":\n            config.maxStoreLines=Number(msg.payload) || 100;\n            if (!msgToInput) msgToInput={}\n            msgToInput.command=\"setMaxStoreLines\";\n            msgToInput.configs=config\n            node.send(null,null,null,{topic:\"updateMaxStoreLines\", payload:config.maxStoreLines})\n            break;\n        case \"maxDisplayLines\":\n            config.maxDisplayLines=Number(msg.payload) || 1000;\n            if (!msgToInput) msgToInput={};\n            msgToInput.command=\"setMaxDisplayLines\";\n            msgToInput.config=config;\n            node.send(null,null,null,{topic:\"updateMaxDisplayLines\", payload:config.maxDisplayLines})\n            break;    \n        case \"filterHost\":\n            config.filterHost=msg.payload;\n            msg.filter= config.filterHost;\n            if (msg.payload===\"[all]\") {\n                msg.payload={\n                    command:\"clearFilter\",\n                    arguments:[],\n                    \"returnPromise\": false\n                }\n            } else {\n                msg.payload={\n                    command:\"setFilter\",\n                    arguments:[\"hostname\",\"=\",msg.payload],\n                    \"returnPromise\": false\n                }\n            }\n            status.text=\"Filter: \"+msg.payload;\n            return[status,msg,msg,null];\n    }\n}\n\n\nswitch (msg.payload) {\n    case \"lost\" : // socket lost so clean temp settings\n        if (uiControlTemp.hasOwnProperty(msg.socketid)) {\n            delete uiControlTemp[msg.socketid];\n            status={fill:\"blue\",shape:\"dot\",text:\"settings deleted\"};\n            return [{payload:status},null,null];\n        }\n        break;\n    case \"OK\":\n    case \"change\":\n    case \"connect\":    \n        // get temporary object for socketID\n        if (uiControlTemp.hasOwnProperty(msg.socketid)) { \n            uiControlTemp=uiControlTemp[msg.socketid][uiNode];\n        }\n        \n        if (msg.name===env.get(\"tabName\") || msg.payload===\"connect\") {\n            // set ui_control defaults\n            if (env.get(\"ui_control\")) {\n                msgOut.ui_control=env.get(\"ui_control\");\n                status={fill:\"green\",shape:\"dot\",text:\"defaults loaded\"};\n            }\n\n            var updateCounter = 0;\n            var columnID=\"\";\n            \n            // order columns if modified in runtime\n            // not the most elegant programming style: Improvements welcome ;)\n            \n            var tempColumnOrder = env.get(\"tempColumnOrder\") || false;\n            if ((tempColumnOrder && uiControlTemp.hasOwnProperty(\"columnOrder\")) ||\n                 (!tempColumnOrder && uiControl.hasOwnProperty(\"columnOrder\"))){\n\n                var addedColumns = 0;\n                var sortColumnsByLayout = function (sortColumns, columnsLayout, targetColumns) {\n                    for (var layoutColumn=0;  layoutColumn<columnsLayout.length; layoutColumn++) {\n                        for (var sortColumn in sortColumns) {\n                            if (sortColumns[sortColumn].hasOwnProperty(\"columns\")) {\n                                targetColumns.push({\"title\":sortColumns[sortColumn].title, \"columns\":[]});\n                                sortColumnsByLayout(sortColumns[sortColumn].columns,columnsLayout,targetColumns[targetColumns.length-1].columns);\n                                layoutColumn=addedColumns; // jump forward after childes added\n                            } else {\n                                if (columnsLayout[layoutColumn].field===sortColumns[sortColumn].field){\n                                    targetColumns.push(sortColumns[sortColumn]);\n                                    addedColumns++;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                }                 \n                \n                var newColumns=[];\n                if (tempColumnOrder) {\n                    sortColumnsByLayout(msgOut.ui_control.tabulator.columns,uiControlTemp.columnOrder,newColumns);\n                } else {\n                    sortColumnsByLayout(msgOut.ui_control.tabulator.columns,uiControl.columnOrder,newColumns);\n                }\n                msgOut.ui_control.tabulator.columns=newColumns;\n            }\n            \n            var updateColumns = function(columns,property) {\n                // add or modifiy properties if modified in runtime\n                for (var column of columns) {\n                    if (column.hasOwnProperty(\"columns\") && Array.isArray(column.columns)) {\n                        updateColumns(column.columns,property);\n                    } else {\n                        columnID=column.field+\":\"+column.title;\n                        if (uiControl.hasOwnProperty(columnID) &&\n                            uiControl[columnID].hasOwnProperty(property)) {\n                                \n                            column[property]=uiControl[columnID][property]\n                            updateCounter++;\n                        }\n                    }\n                }\n            }\n            \n            updateColumns(msgOut.ui_control.tabulator.columns,\"width\")\n            if (updateCounter>0) {\n                status.fill=\"green\";\n                status.shape=\"dot\";\n                status.text+=\" (\"+updateCounter+ \" updates)\";\n            }\n\n            if (uiControl.hasOwnProperty(\"tableData\")) {\n                msgOut.payload=uiControl.tableData; // restore stored table Data\n                status.text+=msgOut.payload.length + \" rows\"\n            } else {\n                msgOut.payload=msg.payload;\n            }\n            // update UI\n            msgToUI=[{\n                topic:\"updateMaxDisplayLines\",\n                payload:maxDisplayLines\n            },{\n                topic:\"updateMaxStoreLines\",\n                payload:uiControl.maxStoreLines\n            }];\n            return [{payload:status},msgOut,{command:\"setState\",state:\"online\"},msgToUI];\n        }\n        \n        // send online/offline messages if tab state changes\n        if (msg.name===env.get(\"tabName\")) {\n            status={fill:\"green\",shape:\"dot\",text:\"online\"};\n            if (!msgToInput) msgToInput={}\n            msgToInput.command=\"setState\"\n            msgToInput.state=\"online\";\n        } else {\n            status={fill:\"yellow\",shape:\"dot\",text:\"offline\"};\n            if (!msgToInput) msgToInput={}\n            msgToInput.command=\"setState\"\n            msgToInput.state=\"offline\";\n        }\n\n        return [{payload:status},null,msgToInput,msgToUI];\n    default:\n        node.error({\"payload:\":msg.payload,\"tab:\":env.get(\"tabName\")})\n        status={fill:\"red\",shape:\"dot\",text:msg.payload+\" unhandeled\"};\n        return [{payload:status},null,null,msgToUI];\n}\n","outputs":4,"noerr":0,"x":182,"y":153,"wires":[[],[],[],[]],"outputLabels":["status","ui-table","to input function","to dashboard"]},{"id":"f96fd3f9.0f311","type":"subflow:e8fd2fc9.509e","z":"1e193208.71985e","name":"","env":[{"name":"uiNode","value":"syslogTable","type":"str"},{"name":"ui_control","value":"{\"tabulator\":{\"columnResized\":\"function(column){  var newColumn = {         title:column._column.definition.title,field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"columnMoved = function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.definition.field, 'title': column._column.definition.title});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\",\"columns\":[{\"title\":\"Time\",\"field\":\"timestamp\",\"width\":100,\"formatter\":\"datetime\",\"formatterParams\":{\"inputFormat\":\"YYYY-MM-DD hh:mm:ss\",\"outputFormat\":\"hh:mm:ss\",\"invalidPlaceholder\":\"(invalid time)\"}},{\"title\":\"Message\",\"field\":\"msg\",\"width\":100,\"headerFilter\":true},{\"title\":\"Tag\",\"field\":\"tag\",\"width\":100,\"headerFilter\":true},{\"title\":\"Date\",\"field\":\"timestamp\",\"width\":100,\"formatter\":\"datetime\",\"formatterParams\":{\"inputFormat\":\"YYYY-MM-DD hh:mm:ss\",\"outputFormat\":\"DD.MM.YY\",\"invalidPlaceholder\":\"(invalid Date)\"}},{\"title\":\"Facility\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Code\",\"field\":\"facilityCode\",\"width\":100,\"headerFilter\":true},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Name\",\"field\":\"facility\",\"width\":100,\"headerFilter\":true}]},{\"title\":\"Severity\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Code\",\"field\":\"severityCode\",\"width\":100,\"headerFilter\":true},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Severty\",\"field\":\"severity\",\"width\":100,\"headerFilter\":true}]},{\"title\":\"Client\",\"columns\":[{\"title\":\"Hostname\",\"field\":\"hostname\",\"width\":100,\"headerFilter\":true},{\"title\":\"Address\",\"field\":\"address\",\"width\":100,\"formatter\":\"link\",\"headerFilter\":true,\"formatterParams\":{\"urlPrefix\":\"http://\",\"target\":\"_blank\"}},{\"title\":\"Port\",\"field\":\"port\",\"width\":100,\"headerFilter\":true},{\"title\":\"Protocol\",\"field\":\"family\",\"width\":100,\"headerFilter\":true}]}],\"layout\":\"fitColumns\",\"movableColumns\":true,\"groupBy\":\"\"},\"customHeight\":12}","type":"json"},{"name":"tabName","value":"ui-table example","type":"str"}],"x":335,"y":187,"wires":[["4dac4c3e.e069b4","63cf45e5.3e8d8c"],["d54606f7.055af8","a7c69580.a2cec8"],["4608e26c.241b8c"]]},{"id":"ff7d0dc8.fae43","type":"ui_ui_control","z":"1e193208.71985e","name":"","events":"all","x":128,"y":170,"wires":[["9b5a4f48.5c27c","f96fd3f9.0f311"]]},{"id":"9b5a4f48.5c27c","type":"debug","z":"1e193208.71985e","name":"ui control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":315,"y":119,"wires":[]},{"id":"4dac4c3e.e069b4","type":"debug","z":"1e193208.71985e","name":"load ui_control","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":624,"y":119,"wires":[]},{"id":"bc43cef0.26fe4","type":"inject","z":"1e193208.71985e","name":"demo data","topic":"","payload":"{\"facility\":\"daemon\",\"facilityCode\":3,\"severity\":\"info\",\"severityCode\":6,\"tag\":\"systemd[1]\",\"timestamp\":\"2018-12-26T17:53:57.000Z\",\"hostname\":\"localhost\",\"address\":\"::ffff:192.168.147.131\",\"family\":\"IPv6\",\"port\":38514,\"size\":80,\"msg\":\"Started Daily apt download activities.\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":128,"y":323,"wires":[["d54606f7.055af8"]]},{"id":"d54606f7.055af8","type":"function","z":"1e193208.71985e","name":"syslog2ui-table","func":"var msgOut;\n\n// get context variables\nvar state=context.get(\"state\") || \"online\";\nvar syslogActiv=context.get(\"syslogActiv\") || false;\nvar counter=context.get(\"counter\") || 0\nvar maxDisplayLines=context.get(\"maxDisplayLines\") || 1000;\nvar filterHost=context.get(\"filterHost\") || \"[all]\";\n\n// handle command messages\nif (msg.hasOwnProperty(\"command\")) {\n    switch (msg.command) {\n        case (\"setMaxDisplayLines\"):\n            maxDisplayLines[msg.sessionid]=msg.maxDisplayLines;\n            context.set(\"maxDisplayLines\",maxDisplayLines);\n            node.status({fill:\"blue\",shape:\"dot\",text:\"maxDisplayLines: \"+maxDisplayLines});\n            return;\n        case (\"setState\"):\n            state=msg.state;\n            context.set(\"state\",state);\n            node.status({fill:\"blue\",shape:\"dot\",text:state});\n            return;\n        case (\"syslogActiv\"):\n            syslogActiv=msg.syslogActiv;\n            context.set(\"syslogActiv\",syslogActiv);\n            node.status({fill:\"blue\",shape:\"dot\",text:\"Activ:\"+syslogActiv});\n            return;\n        case (\"resetCounter\"):\n            context.set(\"counter\",0);\n            node.status({fill:\"blue\",shape:\"dot\",text:\"counter reseted\"});\n            return;\n        case (\"filterHost\"):\n            context.set(\"filterHost\",msg.filter);\n            node.status({fill:\"blue\",shape:\"dot\",text:\"Filter: \"+msg.filter});\n            return;\n    }\n} \n\n\nif (syslogActiv) {\n        \n    \n    \n    // update timestamp as ESPEasy dont send a proper timestamp\n    var timestamp= new Date(Date.now());\n    timestamp= new Date(timestamp.getTime() - timestamp.getTimezoneOffset() * 60000);\n    msg.payload.timestamp= timestamp.toISOString();\n    \n    // correct host name (ESPEasy adds <#> infornt where # is the severty code)\n    if (msg.payload.hostname.substr(0,1)===\"<\" && msg.payload.hostname.substr(2,1)===\">\") {\n        msg.payload.hostname=msg.payload.hostname.slice(3);\n    }\n    \n    // apply host filter BEFORE sending new data to ui-table\n    if (filterHost===\"[all]\" || msg.payload.hostname===filterHost) {\n        // add id to row for later referece\n        counter++;\n        context.set(\"counter\",counter);\n        msg.payload.id=counter;\n    \n        // format the \"addData\" command of tabulator to add a new row to the top of the table\n        msgOut={\n            \"payload\": {\n                \"command\": \"addData\",\n                \"arguments\": [msg.payload,true],\n                \"returnPromise\": true\n            }\n        }\n    }\n}\n\nif (state===\"online\") {\n    if (syslogActiv) {\n        node.status({fill:\"green\",shape:\"dot\",text:counter+\". msg (\"+filterHost+\")\"});\n        return [msgOut,null];\n    } else {\n        node.status({fill:\"red\",shape:\"dot\",text:counter+\". msg\"});\n        return [null,null];\n    }\n} else {\n    if (syslogActiv) {\n        node.status({fill:\"yellow\",shape:\"dot\",text:counter+\". msg (\"+filterHost+\")\"});\n        return [null,(msgOut) ? { // \"simulate\" a successfull promise msg from ui-table\n            topic:\"success\",\n            ui_control:{callback:msgOut.payload.command},\n            return:msgOut.payload} : null\n        ];\n    } else{\n        node.status({fill:\"red\",shape:\"dot\",text:counter+\". msg\"});\n        return [null,null];\n    }\n}\n","outputs":2,"noerr":0,"x":607,"y":272,"wires":[["63cf45e5.3e8d8c","fed0aeb3.a329d"],["4e5b6320.769b1c"]],"outputLabels":["to ui-table","bypass"],"icon":"node-red/swap.svg","info":"# Format data to be displayed with ui-table\n\nUse this function node to format incomming data to be modified for ui-table\n\n## Example\n\n1. it corrects the time commingform UTC to local time\n\n```\nvar timestamp= new Date(Date.now());\ntimestamp= new Date(timestamp.getTime() - timestamp.getTimezoneOffset() * 60000);\nmsg.payload.timestamp= timestamp.toISOString();\n```\n\n2. format the \"addData\" command of tabulator to add a new row to the top of the table \n\n```\nvar msgOut={\n    \"payload\": {\n        \"command\": \"addData\",\n        \"arguments\": [msg.payload,true],\n        \"returnPromise\": true\n    }\n}\n```\n\n`command`: Tabulator command [see documentation](http://tabulator.info/docs/4.5/update#overview)\n\n`arguments`: Array with the arguments for the command function\n\n`returnPromise`: if `true` the ui-table will return the message if command sucessfully executed. Set to true to enable the saveUiControl subflow to store the data. otherwise it will not survive reload or tab changes.\n\n3. bypass ui-table if not currently visible\n4. fill host list for filtering\n"},{"id":"4fe30d6e.4483d4","type":"inject","z":"1e193208.71985e","name":"connect","topic":"","payload":"connect","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":135,"y":68,"wires":[["f96fd3f9.0f311"]]},{"id":"91815534.6da118","type":"inject","z":"1e193208.71985e","name":"change","topic":"","payload":"change","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":135,"y":119,"wires":[["f96fd3f9.0f311"]]},{"id":"e6ca246c.97c3e8","type":"debug","z":"1e193208.71985e","name":"save ui_control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":947,"y":136,"wires":[]},{"id":"bec529cb.a9bfc8","type":"ui_dropdown","z":"1e193208.71985e","name":"","label":"Filter Host","tooltip":"","place":"Select Host","group":"51ce6aa1.620754","order":1,"width":10,"height":1,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"filterHost","x":325,"y":510,"wires":[["c58cb32.f70fd5"]]},{"id":"938f3076.e84a8","type":"ui_button","z":"1e193208.71985e","name":"deleteRecords","group":"51ce6aa1.620754","order":5,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"deleteRecords","payloadType":"str","topic":"uiDeleteButton","x":335,"y":714,"wires":[["c3e235de.faff38"]]},{"id":"83669342.f1163","type":"inject","z":"d1227ddb.952f7","name":"msg.payload","topic":"","payload":"[{\"name\":\"MEQ0451495\",\"room\":\"Bathroom\",\"SET_TEMPERATURE-value\":22,\"ACTUAL_TEMPERATURE-value\":21.8,\"VALVE_STATE-value\":90,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":true,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875547\",\"room\":\"Living Room\",\"SET_TEMPERATURE-value\":12,\"ACTUAL_TEMPERATURE-value\":16.2,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":1},{\"name\":\"MEQ1875538\",\"room\":\"Living Room\",\"SET_TEMPERATURE-value\":18,\"ACTUAL_TEMPERATURE-value\":19.5,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.6,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":2},{\"name\":\"MEQ0447462\",\"room\":\"Kitchen\",\"SET_TEMPERATURE-value\":17,\"ACTUAL_TEMPERATURE-value\":22.2,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":10,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":3},{\"name\":\"MEQ1875551\",\"room\":\"Office\",\"SET_TEMPERATURE-value\":18,\"ACTUAL_TEMPERATURE-value\":20.2,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ0447425\",\"room\":\"Dining Room\",\"SET_TEMPERATURE-value\":19,\"ACTUAL_TEMPERATURE-value\":20.4,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875546\",\"room\":\"Dining Room\",\"SET_TEMPERATURE-value\":20,\"ACTUAL_TEMPERATURE-value\":18.8,\"VALVE_STATE-value\":99,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ0447483\",\"room\":\"Bedroom\",\"SET_TEMPERATURE-value\":17,\"ACTUAL_TEMPERATURE-value\":22.4,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875541\",\"room\":\"Child\",\"SET_TEMPERATURE-value\":18,\"ACTUAL_TEMPERATURE-value\":20.4,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875552\",\"room\":\"Guest Room\",\"SET_TEMPERATURE-value\":20,\"ACTUAL_TEMPERATURE-value\":21.1,\"VALVE_STATE-value\":9,\"BATTERY_STATE-value\":2.8,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0}]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":138,"y":170,"wires":[["c080b0c.71d925"]]},{"id":"f75fa4c9.e46168","type":"change","z":"d1227ddb.952f7","name":"ui_control","rules":[{"t":"set","p":"ui_control","pt":"msg","to":"{\"tabulator\":{\"columnResized\":\"function(column){     var newColumn = {         field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"ROom\",\"field\":\"room\",\"width\":100,\"frozen\":true},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Device\",\"field\":\"name\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Type\",\"field\":\"deviceType\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Measurements\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"target\",\"field\":\"SET_TEMPERATURE-value\",\"formatter\":\"function(cell, formatterParams, onRendered){return cell.getValue()+'°C';}\",\"topCalc\":\"avg\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"min\":10,\"max\":25,\"color\":[\"blue\",\"green\",\"red\"],\"legend\":\"function (value) {return '&nbsp;&nbsp;'+value+'°C';}\",\"legendColor\":\"#101010\",\"legendAlign\":\"left\"},\"title\":\"current\",\"field\":\"ACTUAL_TEMPERATURE-value\",\"formatter\":\"progress\",\"topCalc\":\"avg\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"min\":0,\"max\":99,\"color\":[\"gray\",\"orange\",\"red\"],\"legend\":\"function (value) {return (value>0)? '&nbsp;&nbsp;'+value+' %' : '-';}\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Valve\",\"field\":\"VALVE_STATE-value\",\"formatter\":\"progress\",\"topCalc\":\"max\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"min\":1.5,\"max\":4.6,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {return value+' V';}\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Batt\",\"field\":\"BATTERY_STATE-value\",\"formatter\":\"progress\",\"topCalc\":\"min\",\"width\":100}]},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Settings\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\",\"min\":0,\"max\":30,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#101010;'>\\\"+value+\\\" min</span>\\\";     else         return \\\"<span style='color:#A0A0A0;'>aus</span>\\\"; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Boost\",\"field\":\"BOOST_STATE-value\",\"formatter\":\"progress\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"allowEmpty\":true,\"allowTruthy\":true,\"tickElement\":\"<i class='fa fa-clock-o'></i>\",\"crossElement\":\"<i class='fa fa-ban'></i>\"},\"title\":\"Auto\",\"field\":\"AUTO_MODE-value\",\"formatter\":\"tickCross\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Mode\",\"field\":\"CONTROL_MODE-value\",\"formatter\":\"function(cell, formatterParams, onRendered){     var html=\\\"<i class=\\\\\\\"\\\";     switch(cell.getValue()) {         case 0: html+=\\\"fa fa-calendar-check-o\\\"; break;         case 1: html+=\\\"fa fa-hand-o-up\\\"; break;         case 2: html+=\\\"fa fa-suitcase\\\"; break;         case 3: html+=\\\"fa fa-spinner fa-spin fa-fw\\\"; break;     }     html+='\\\\\\\"></i>';     return html; }\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\",\"crossElement\":false},\"title\":\"Auto\",\"field\":\"AUTO_MODE-value\",\"formatter\":\"tickCross\",\"width\":100,\"align\":\"center\"}]}],\"layout\":\"fitColumns\",\"movableColumns\":true,\"groupBy\":\"\"},\"customHeight\":12}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":315,"y":119,"wires":[["c080b0c.71d925","cb0ec9e.9e9be38"]]},{"id":"7ee91b9d.c0c5b4","type":"debug","z":"d1227ddb.952f7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":679,"y":170,"wires":[]},{"id":"c080b0c.71d925","type":"ui_table","z":"d1227ddb.952f7","d":true,"group":"86d6c4d3.f4e698","name":"Thermostats","order":1,"width":"6","height":"4","columns":[],"outputs":1,"cts":true,"x":529,"y":170,"wires":[["7ee91b9d.c0c5b4"]]},{"id":"72f6f600.bcc8c8","type":"inject","z":"d1227ddb.952f7","name":"msg.ui_control","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":131,"y":119,"wires":[["f75fa4c9.e46168"]]},{"id":"843329f6.17a408","type":"change","z":"d1227ddb.952f7","name":"addData","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"command\":\"addData\",\"arguments\":[{\"name\":\"addedDevice\",\"room\":\"addedRoom\",\"SET_TEMPERATURE-value\":0,\"ACTUAL_TEMPERATURE-value\":0,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":0,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},true],\"returnPromise\":true}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":315,"y":357,"wires":[["81e4338d.2adfc"]]},{"id":"c381586a.c67858","type":"inject","z":"d1227ddb.952f7","name":"addData","topic":"","payload":"{\"command\":\"addData\",\"arguments\":[{\"name\":\"addedDevice\",\"room\":\"addedRoom\",\"SET_TEMPERATURE-value\":0,\"ACTUAL_TEMPERATURE-value\":0,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":0,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},true],\"returnPromise\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":128,"y":221,"wires":[["c080b0c.71d925","81e4338d.2adfc"]]},{"id":"81e4338d.2adfc","type":"debug","z":"d1227ddb.952f7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":221,"wires":[]},{"id":"cb0ec9e.9e9be38","type":"debug","z":"d1227ddb.952f7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":119,"wires":[]},{"id":"2b9bc827.b69618","type":"ui_numeric","z":"1e193208.71985e","name":"","label":"maximum Store:","tooltip":"maximum amount of rows to be saved in context store (limited by server)","group":"51ce6aa1.620754","order":2,"width":5,"height":1,"wrap":false,"passthru":false,"topic":"maxStoreLines","format":"{{value}}","min":0,"max":"200","step":"10","x":335,"y":561,"wires":[["c58cb32.f70fd5"]]},{"id":"7b320c4e.9e0654","type":"ui_toast","z":"1e193208.71985e","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"OK/Cacel","x":672,"y":714,"wires":[["43a4caa3.06c034"]]},{"id":"c3e235de.faff38","type":"change","z":"1e193208.71985e","name":"Question","rules":[{"t":"set","p":"command","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"\"Do you like to delete all records?\"","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Delete?","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":519,"y":714,"wires":[["7b320c4e.9e0654"]]},{"id":"c58cb32.f70fd5","type":"change","z":"1e193208.71985e","name":"topic2command","rules":[{"t":"set","p":"command","pt":"msg","to":"topic","tot":"msg"},{"t":"set","p":"storeValue","pt":"msg","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":624,"y":612,"wires":[["43a4caa3.06c034"]]},{"id":"43a4caa3.06c034","type":"link out","z":"1e193208.71985e","name":"uiControlSettings","links":["41b7f798.8e6a48"],"x":831,"y":663,"wires":[]},{"id":"41b7f798.8e6a48","type":"link in","z":"1e193208.71985e","name":"uiControlSettings","links":["43a4caa3.06c034"],"x":168,"y":221,"wires":[["f96fd3f9.0f311","a8a0def.6ffd62"]]},{"id":"a5a86c28.1dc44","type":"debug","z":"1e193208.71985e","name":"save ui_control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1168,"y":238,"wires":[]},{"id":"84e7d923.efb4d8","type":"ui_numeric","z":"1e193208.71985e","name":"maximum Display","label":"Display:","tooltip":"maximum amount of rows to be displayed (limited by client memory)","group":"51ce6aa1.620754","order":3,"width":4,"height":1,"wrap":false,"passthru":false,"topic":"maxDisplayLines","format":"{{value}}","min":0,"max":"1000","step":"10","x":345,"y":612,"wires":[["c58cb32.f70fd5"]]},{"id":"c2999e05.72156","type":"ui_switch","z":"1e193208.71985e","name":"activ","label":"","tooltip":"","group":"51ce6aa1.620754","order":4,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"syslogActiv","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":305,"y":663,"wires":[["c58cb32.f70fd5"]]},{"id":"a7c69580.a2cec8","type":"debug","z":"1e193208.71985e","name":"to input function","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":607,"y":323,"wires":[]},{"id":"d34f8292.cb3c","type":"switch","z":"1e193208.71985e","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"updateFilterList","vt":"str"},{"t":"eq","v":"updateMaxStoreLines","vt":"str"},{"t":"eq","v":"updateMaxDisplayLines","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":153,"y":561,"wires":[["bec529cb.a9bfc8"],["2b9bc827.b69618"],["84e7d923.efb4d8"]]},{"id":"aafd2539.905ba8","type":"link out","z":"1e193208.71985e","name":"msgToUI","links":["566f70f.2d4579"],"x":1103,"y":289,"wires":[]},{"id":"566f70f.2d4579","type":"link in","z":"1e193208.71985e","name":"msgToUI","links":["aafd2539.905ba8","4608e26c.241b8c"],"x":66,"y":561,"wires":[["d34f8292.cb3c","e8795311.41f4a"]]},{"id":"4608e26c.241b8c","type":"link out","z":"1e193208.71985e","name":"msgToUI","links":["566f70f.2d4579"],"x":542,"y":374,"wires":[]},{"id":"a8a0def.6ffd62","type":"debug","z":"1e193208.71985e","name":"ui message","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":325,"y":357,"wires":[]},{"id":"fed0aeb3.a329d","type":"debug","z":"1e193208.71985e","name":"to input function","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":828,"y":289,"wires":[]},{"id":"e8795311.41f4a","type":"debug","z":"1e193208.71985e","name":"msgToUI","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":143,"y":646,"wires":[]},{"id":"9c91a876.eb3078","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"on","topic":"2cf432130f5f/light/on","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Christbaum","uiPlaceName":"","uiNode":"uiButtonSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#ff8040","uiColorOFF":"#408080","uiColorPredicted":"#9d3300","uiUseColorPredicted":false,"uiColorPredictedOff":"#1f3f3f","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"lightbulb_outline","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":219,"y":289,"wires":[["9bdc7463.35abc8"],[]]},{"id":"9bdc7463.35abc8","type":"ui_button","z":"afe0bd06.1f05","name":"","group":"dad2c6ff.66acf8","order":1,"width":0,"height":0,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"","payload":"toggle","payloadType":"str","topic":"","x":492,"y":221,"wires":[["9c91a876.eb3078"]]},{"id":"37587a97.53dad6","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"dimmer1","topic":"2cf432130f5f/light/dimmer1","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":239,"y":408,"wires":[["863cc41.ec19738"],[]]},{"id":"863cc41.ec19738","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":2,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":357,"wires":[["37587a97.53dad6"]]},{"id":"7c3d0b50.276f14","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"dimmer2","topic":"2cf432130f5f/light/dimmer2","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":239,"y":510,"wires":[["e02e0053.1e072"],[]]},{"id":"e02e0053.1e072","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":3,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":459,"wires":[["7c3d0b50.276f14"]]},{"id":"632b0dd.5146ef4","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"dimmer","topic":"2cf432130f5f/light/dimmer","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":229,"y":612,"wires":[["12310f6f.01e7c1"],[]]},{"id":"12310f6f.01e7c1","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":3,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":561,"wires":[["632b0dd.5146ef4"]]},{"id":"b1a27d73.a0e0c","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"delay","topic":"2cf432130f5f/light/delay","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":229,"y":697,"wires":[["e5266c1e.91d7"],[]]},{"id":"e5266c1e.91d7","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":3,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":646,"wires":[["b1a27d73.a0e0c"]]}]