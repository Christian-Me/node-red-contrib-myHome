[{"id":"afe0bd06.1f05","type":"tab","label":"Esszimmer","disabled":false,"info":""},{"id":"9b61ce87.2ae62","type":"tab","label":"Worldmap","disabled":false,"info":""},{"id":"679df911.24a188","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"27d1cbb0.595ee4","type":"tab","label":"Flow 3","disabled":false,"info":""},{"id":"99f7fccc.6df2f","type":"tab","label":"myUI Demo","disabled":true,"info":""},{"id":"afaa0885.ad2718","type":"tab","label":"Heating Controller","disabled":false,"info":""},{"id":"dd3f4b52.8a4468","type":"tab","label":"Heating Periods","disabled":false,"info":""},{"id":"309a0a3e.c49326","type":"tab","label":"System","disabled":false,"info":""},{"id":"45367253.8faa7c","type":"tab","label":"Rooms","disabled":false,"info":""},{"id":"9831cab2.382058","type":"tab","label":"Light Devices","disabled":false,"info":""},{"id":"9848cbbf.0bdd68","type":"tab","label":"Light Groups","disabled":false,"info":""},{"id":"b66f2c73.9297e","type":"tab","label":"Light Scenes","disabled":false,"info":""},{"id":"fe9fd924.188388","type":"tab","label":"Light UI","disabled":false,"info":""},{"id":"897fdb2a.109f68","type":"tab","label":"Homematic","disabled":false,"info":""},{"id":"5b6fa421.88b5bc","type":"tab","label":"Homekit","disabled":true,"info":""},{"id":"4635654.3abb19c","type":"tab","label":"Lights Hardware","disabled":false,"info":""},{"id":"6ed67795.6a6c28","type":"tab","label":"Beleuchtung","disabled":false,"info":""},{"id":"25cbe481.e10bec","type":"tab","label":"Homie","disabled":false,"info":""},{"id":"d1227ddb.952f7","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"1e193208.71985e","type":"tab","label":"ui-table","disabled":false,"info":"# ui-table with ui_controll and command transmission\n## ui_control\npress the inject button on either \n- payload or\n- ui_controll\n\n## msg.payload.command / msg.payload.arguments\nsend commands to ui-table. ui-table by default expects an array with the complete table data as msg.payload. If you send an object containing:\n- `msg.payload.command` _[string]_ the command\n- `msg.payload.arguments` _[array]_ an array of arguments for the command\nit is possible to send commands to the table to i.e. update single rowas or add data"},{"id":"e74b5796.7b56d8","type":"tab","label":"Arbeitszimmer","disabled":false,"info":""},{"id":"833d7b75.5dd878","type":"tab","label":"Homie Test","disabled":false,"info":""},{"id":"292ca715.a2db08","type":"tab","label":"Examples","disabled":true,"info":""},{"id":"9d52d40a.a63668","type":"tab","label":"remoteDeviceTable","disabled":false,"info":"# remote-device-table\nNode-RED flow to display the status of remote devices on the dashboard using ui-table\n\n**first beta version**\n\n![screenshot](https://github.com/Christian-Me/remote-device-table/blob/master/screenshots/teaser.png?raw=true)\n## introduction\n>In IOT or home automation environments there are normally many remote devices connected to Node-RED sometimes over wireless connections. This flow gives a dynamic overview of all devices with their last status messages and system health information.\n\n## goals\n- expandable\n  - all kinds of data sources can be added using *translators*\n  - data can be processed through *plugins*\n  - table layout and functions can be configured\n- easy to modify\n  - no custom nodes which makes it difficult for normal users to do modifications\n  - standard nodes wherever possible and useful\n- reusable\n  - function nodes should be reusable and easy to read\n  - configuration through json objects instead if/switch statements\n  - subflows with environment variables when a function node is more \"complex\"\n- dynamic dashboard table\n  - make use of the functionality of ui-table and the tabulator js module behind\n  - only send updated data to keep traffic low\n  - let ui-table do the display formatting so the flow only holds generic data and the screen display can be individually configured\n- **contributions are highly appreciated**\n  - new **translation nodes** for different devices or protocols\n  - new or updated data **processing plugins** nodes\n  - new or updated **table designs**\n  - many parts of the flow contains only a draft layout and basic functions suggestions or PRs are always welcome.\n- **documentation**\n  - documentation in the nodes description tab so it is always available\n  - documentation in source comments if useful\n  - copy/paste documentation in the repro \n  - keep the docs up to date\n- no database necessary\n  - to make it easy to inspect all data it is hold in Node-RED context\n  - keep data as close as possible to the node *(context.set instead of flow.set, no global.set)*\n  - don't rely on data of other nodes as they could be \"unplugged\" or not available \n  - make use of the basic properties defined by the homie convention\n  - as the flow is mostly dealing with live data use non volatile **file** memory only when useful (i.e. table edits or interactive layout modifications)\n  - it is not expected that the flow is producing a huge amount of data. But many updates will occur, so quick access is the key.\n\n## some nice features (most thanks to the tabulator module)\n\n1. table population\n\n   The table is filled and updated dynamically as data arrives. Only new or updated data is sent to the client\n   ![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/gifs/table-init.gif)\n\n2. table-layout\n\n   The table layout can be modified interactively. Beside changing the column width and order you can hide (and un hide) rows and columns.\n   ![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/gifs/table-layout.gif)\n\n3. responsive layout\n\n   The table can be viewed with horizontal scroll (with frozen columns) or in a responsive layout\n   ![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/gifs/responsive-layout.gif)\n\n4. table edit\n\n   The table cells can be edited (where suitable). The edits are stored separately and are prevented from overwrites\n   ![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/gifs/table-edit.gif)\n\n## theory of operation\n\nThe flow is divided in three main parts\n\n1. **data acquisition**: translation of the data into homie and individual user defined fields (not everything fits into the homie convention but it is a good common ground). [different translator nodes can be found here](https://github.com/Christian-Me/remote-device-table/tree/master/translators)\n![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/screenshots/data_aquisition.png)\n\n2. **plugins**: little nodes doing all kind of stuff with this data. For example a watchdog, a reset counter, max. min. or avg. uptime, add icons from the values like battery or signal and other things. To make these reusable it is essential to have a common data-set defined. [different plugins can be found here](https://github.com/Christian-Me/remote-device-table/tree/master/plugins)\n![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/screenshots/plugins.png)\n\n3. **table handling and ui design**: universal flow to handle table formatting, data storage, column width and order, cell editing and interactive stuff like context menus. [different designs can be found here](https://github.com/Christian-Me/remote-device-table/tree/master/table%20designs)\n![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/screenshots/ui-table_handler.png)\n\n4. **callbacks & context menus**: ui-table callbacks are passed from the second output of the `ui-table handler` to this flow to do display context menus or other do other stuff\n![callbacks](https://raw.githubusercontent.com/Christian-Me/remote-device-table/master/screenshots/callbacks.png)\n\n## flow design\n\n- The flow starts with a msg coming in from mqtt / http or other sources in various shape or forms\n- A translator node will process the data:\n  - add a unique identifier to the message in msg.topic\n  - add properties to the msg.state object \n    - using the predefined homie convention properties\n    - adding new properties\n    - filtering out not necessary or constant data\n    - process data (i.e. signal strength form dB to %)\n- the data then will be passed into the plugin sections through in/out nodes\n- Data processing is like a stack of functions\n  - there could be different entries to the stack. (i.e. mqtt devices can make use of the LWT functionality of the broker so they do not need the watchdog node)\n  - adding new fields like icons\n  - do other stuff with the data\n- the final result will then be passed to the UI part of the flow\n- the `ui-table handler` should do the heavy lifting \n  - send the data to the table\n  - keep a copy of all data for tab changes or new clients connecting\n  - store interactive layout changes\n  - store interactive edits in the table\n  - handle commands to alter the stored data or perform other things\n  - handle context menus or callbacks form ui-table\n- context menus are designed separately to enable individual designs\n\n## homie convention\n\n<img src=\"./icons/Homie%20logo.svg?sanitize=true\" width=\"100\">\n\nTo define a common ground for all data this flow uses the [homie convention](https://homieiot.github.io/) which I highly recommend to take a closer look.\n\n> For devices using the homie convention there is no translator node necessary and it is recommended to skip the `$state watchdog` plugin\n\nThe homie convention defines some statistic and firmware topics. The remote-device-table originates using the $stats and $fw properties The base dataset is defined by the homie convention [3.0.1](https://homieiot.github.io/specification/spec-core-v3_0_1/) and [4.0.0](https://homieiot.github.io/specification/spec-core-v4_0_0/) with [$state](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_stats_extension.md) and [$fw](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_firmware_extension.md) extensions. \nIf an alternative source provides all or some of the data it should first try to use the existing properties and perform conversions if necessary.\n\n## reserved properties\nproperty | description | type    | format \n-------- | ----------- | ------- | ------ \n$homie | The implemented Homie convention version | string | \"4.0.0\"\n$name | the **unique** name of the device. This name is used to identify the device in the table. | string | \"myDevice\"\n$state | current or last state of the device | string | [\"ready\", \"lost\", \"init\", \"sleeping\", \"disconnected\", \"alert\"]\n$nodes\t| Nodes the device exposes | array | comma seperated list\n$extensions\t| Supported extensions | array | comma seperated list\n$implementation | An identifier for the Homie implementation | string | \"esp8266\"\n\n\n\ndefined by [**Legacy Firmware**](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_firmware_extension.md)\n\nproperty | description | type    | format\n-------- | ----------- | ------- | ------\n$localip | IP of the device on the local network | string | \"127.0.0.1\"\n$mac | Mac address of the device network interface | string | The format MUST be of the type `A1:B2:C3:D4:E5:F6`\nname | Name of the firmware running on the device. | string | Allowed characters are the same as the device ID\nversion | Version of the firmware running on the device. | string | \"1.0.0\"\n\n\ndefined by [**Legacy Stats**](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_stats_extension.md)\n\nproperty | description | type    | format\n-------- | ----------- | ------- | ------\ninterval | Interval in seconds at which the device refreshes its `$stats/+` | integer | Positive greater 0\nuptime | Time elapsed in seconds since the boot of the device | integer | seconds\nsignal | Signal strength | Integer | in %\ncputemp | CPU Temperature | Float | in °C\ncpuload | CPU Load in. Average of last $stats\\interval including all CPUs | Integer | %. \nbattery | Battery level. | Integer | in %\nfreeheap | Free heap. |\tPositive Integer | in bytes\nsupply | Supply Voltage | Float | in V\n\n\n"},{"id":"ab797823.3396a8","type":"tab","label":"Flow 4","disabled":false,"info":""},{"id":"c4a7cd6c.2a0c1","type":"subflow","name":"setGroup","info":"","category":"myUI","in":[{"x":40,"y":80,"wires":[{"id":"3404a4d4.23919c"}]}],"out":[{"x":360,"y":120,"wires":[{"id":"3404a4d4.23919c","port":1}]}],"env":[{"name":"host","type":"str","value":"","ui":{"icon":"font-awesome/fa-object-group","label":{"en-US":"Host"},"type":"input","opts":{"types":["str","env"]}}},{"name":"property","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Property"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3caa8e","inputLabels":["uiDropdon"],"outputLabels":["update"],"icon":"node-red-dashboard/ui_dropdown.png","status":{"x":360,"y":40,"wires":[{"id":"3404a4d4.23919c","port":0}]}},{"id":"d4a0d961.b11238","type":"subflow","name":"deleteGroup","info":"","category":"myUI","in":[{"x":40,"y":80,"wires":[{"id":"6a775fab.082ab"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"6a775fab.082ab","port":1}]}],"env":[{"name":"cancel","type":"str","value":"cancel"}],"color":"#a1decf","icon":"font-awesome/fa-minus-square","status":{"x":340,"y":40,"wires":[{"id":"6a775fab.082ab","port":0}]}},{"id":"dfa4352b.bdc548","type":"subflow","name":"saveData","info":"# Save Data to global store\n\n## parameters\n\nparamter | Description\n- | -\nhost | path to object hosting the list entry\nparameter | name of the parameter containing the list","category":"myUI","in":[{"x":60,"y":80,"wires":[{"id":"1ff3f5ad.ab0eca"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"1ff3f5ad.ab0eca","port":1}]}],"env":[{"name":"host","type":"str","value":"","ui":{"icon":"font-awesome/fa-object-group","label":{"en-US":"Host"},"type":"input","opts":{"types":["str","env"]}}},{"name":"property","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Property"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3caa8e","inputLabels":["uiElement(s)"],"outputLabels":["update"],"icon":"font-awesome/fa-database","status":{"x":340,"y":40,"wires":[{"id":"1ff3f5ad.ab0eca","port":0}]}},{"id":"e0e53645.d85fd8","type":"subflow","name":"addItemToList","info":"","category":"myUI","in":[{"x":60,"y":80,"wires":[{"id":"51c4d926.279bc8"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"51c4d926.279bc8","port":1}]}],"env":[{"name":"defaults","type":"json","value":"","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["json"]},"label":{}}}],"color":"#3caa8e","inputLabels":["add Button"],"outputLabels":["update Link"],"icon":"font-awesome/fa-plus-square","status":{"x":340,"y":40,"wires":[{"id":"51c4d926.279bc8","port":0}]}},{"id":"e0e09953.42b938","type":"subflow","name":"InitializeUi","info":"Initialize the UI Elemnets and fill the drop down list","category":"myUI","in":[{"x":60,"y":80,"wires":[{"id":"ea0578f.f595788"}]}],"out":[{"x":320,"y":120,"wires":[{"id":"ea0578f.f595788","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings"},{"name":"baseObject","type":"str","value":"heating.periods"},{"name":"uiElement","type":"str","value":"uiDropdown"},{"name":"filterProperty","type":"str","value":"","ui":{"icon":"font-awesome/fa-filter","label":{"en-US":"Filter"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"filterValue","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Value"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#3caa8e","icon":"node-red/arrow-in.png","status":{"x":320,"y":40,"wires":[{"id":"ea0578f.f595788","port":0}]}},{"id":"30d3b36b.8d171c","type":"subflow","name":"updateUi","info":"","category":"myUI","in":[{"x":54,"y":85,"wires":[{"id":"7745479f.ddca48"}]}],"out":[{"x":326,"y":85,"wires":[{"id":"7745479f.ddca48","port":1}]},{"x":326,"y":136,"wires":[{"id":"7745479f.ddca48","port":2}]}],"env":[{"name":"uiControl","type":"json","value":"{\"type\":{\"switch\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":false},\"defaultColor\":{\"enable\":false}},\"dimmer\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":false}},\"rgb\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":true}},\"rgbw\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":true}},\"rgb-w\":{\"defaultSwitch\":{\"enable\":true},\"defaultDimmer\":{\"enable\":true},\"defaultColor\":{\"enable\":true}}}}","ui":{"icon":"font-awesome/fa-check-square-o","type":"input","opts":{"types":["json"]},"label":{}}}],"color":"#a1decf","inputLabels":["updateLink"],"outputLabels":["updateGroup","updateElements"],"status":{"x":326,"y":34,"wires":[{"id":"7745479f.ddca48","port":0}]}},{"id":"8ba1eff6.75a11","type":"subflow","name":"fillDropdown","info":"","category":"myUI","in":[{"x":40,"y":80,"wires":[{"id":"9d13774f.8dc838"}]}],"out":[{"x":340,"y":120,"wires":[{"id":"9d13774f.8dc838","port":1}]}],"env":[{"name":"customTopic","type":"str","value":"","ui":{"icon":"font-awesome/fa-tasks","label":{"en-US":"Topic"},"type":"input","opts":{"types":["str","env"]}}},{"name":"filterProperty","type":"str","value":"","ui":{"icon":"font-awesome/fa-filter","label":{"en-US":"Filter"},"type":"input","opts":{"types":["str","env"]}}},{"name":"filterValue","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Value"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#a1decf","inputLabels":["update"],"outputLabels":["dropdownUi"],"status":{"x":343,"y":51,"wires":[{"id":"9d13774f.8dc838","port":0}]}},{"id":"6e9d1a04.cba814","type":"subflow","name":"buildChart","info":"","category":"myHeating","in":[{"x":54,"y":85,"wires":[{"id":"7e7bc1cc.55ff6"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"7e7bc1cc.55ff6","port":1}]}],"env":[],"color":"#a1decf","inputLabels":["select"],"outputLabels":["chart"],"icon":"font-awesome/fa-area-chart","status":{"x":343,"y":51,"wires":[{"id":"7e7bc1cc.55ff6","port":0}]}},{"id":"bbaf0ff1.1a532","type":"subflow","name":"buildSchedule","info":"","category":"myHeating","in":[{"x":122,"y":119,"wires":[{"id":"1a64ae43.a9bc52"}]}],"out":[{"x":394,"y":170,"wires":[{"id":"1a64ae43.a9bc52","port":1}]}],"env":[],"color":"#a1decf","inputLabels":["select"],"outputLabels":["schedule"],"icon":"font-awesome/fa-calendar-o","status":{"x":394,"y":68,"wires":[{"id":"1a64ae43.a9bc52","port":0}]}},{"id":"7bb9b47f.834f5c","type":"subflow","name":"updateChart","info":"","category":"","in":[{"x":88,"y":102,"wires":[{"id":"5f802c34.c65794"}]}],"out":[{"x":360,"y":136,"wires":[{"id":"5f802c34.c65794","port":1}]}],"env":[],"color":"#a1decf","inputLabels":["newTempReading"],"outputLabels":["updatedChart"],"icon":"node-red-dashboard/ui_chart.png","status":{"x":360,"y":68,"wires":[{"id":"5f802c34.c65794","port":0}]}},{"id":"7fd0d8ec.569998","type":"subflow","name":"initHeater","info":"* datapoint: datapoint provideing the catual temperatur (measuement)\n* room (optional): if input does not provide msg.room it could be set here","category":"","in":[{"x":54,"y":85,"wires":[{"id":"176161.c40d2e9f"}]}],"out":[{"x":343,"y":102,"wires":[{"id":"176161.c40d2e9f","port":1}]},{"x":343,"y":153,"wires":[{"id":"176161.c40d2e9f","port":2}]},{"x":343,"y":204,"wires":[{"id":"176161.c40d2e9f","port":3}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings"},{"name":"roomsContext","type":"str","value":"rooms"},{"name":"roomContext","type":"str","value":"heating.rooms"},{"name":"periodsContext","type":"str","value":"heating.periods"},{"name":"datapoint","type":"str","value":"ACTUAL_TEMPERATURE","ui":{"icon":"font-awesome/fa-thermometer-1","type":"input","opts":{"types":["str","json","env"]},"label":{}}},{"name":"room","type":"str","value":"","ui":{"icon":"font-awesome/fa-bed","type":"input","opts":{"types":["str"]},"label":{}}}],"color":"#a1decf","icon":"node-red/arrow-in.svg","status":{"x":343,"y":34,"wires":[{"id":"176161.c40d2e9f","port":0}]}},{"id":"2f4c5529.6abcba","type":"subflow","name":"buildTable","info":"","category":"","in":[{"x":68,"y":85,"wires":[{"id":"6a2bfd9e.ce1944"}]}],"out":[{"x":343,"y":136,"wires":[{"id":"6a2bfd9e.ce1944","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings","ui":{"type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"dataContext","type":"str","value":"heating.devices","ui":{"type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"dataSelection","type":"json","value":"[{\"title\":\"Device\",\"value\":\"name\"},{\"title\":\"Raum\",\"value\":\"room\"}]"},{"name":"config","type":"json","value":"{\"columnResized\":\"function(column){     var newColumns={};     var percentFactor=1;     var totalWidth=0;     var lastWidth=0;     var widthUnit='px';     column._column.table.columnManager.columns.forEach(function (aColumn) {          totalWidth += aColumn.width;         if (aColumn.definition.width.includes('%')) widthUnit='%';     });     if (widthUnit=='%') percentFactor=100/totalWidth;     totalWidth=0;      column._column.table.columnManager.columns.forEach(function (aColumn) {         lastWidth=Math.floor(aColumn.width*percentFactor);         newColumns[aColumn.field]=lastWidth+widthUnit;         totalWidth+= lastWidth;     });     if (widthUnit=='%' && totalWidth!=100 ) {         var keys=Object.keys(newColumns);         newColumns[keys[keys.length-1]].widthStyled=(lastWidth+(100-totalWidth))+widthUnit;     }     this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumns}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\"}","ui":{"icon":"font-awesome/fa-retweet","label":{"en-US":"config"},"type":"input","opts":{"types":["json"]}}},{"name":"layout","type":"str","value":"fitData","ui":{"type":"select","opts":{"opts":[{"l":{"en-US":"fitData"},"v":"fitData"},{"l":{"en-US":"fitDataFill"},"v":"fitDataFill"},{"l":{"en-US":"fitColumns"},"v":"fitColumns"}]},"label":{}}},{"name":"movableColumns","type":"bool","value":"true","ui":{"type":"input","opts":{"types":["bool"]},"label":{}}},{"name":"groupBy","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"customHeight","type":"num","value":"10","ui":{"icon":"font-awesome/fa-align-justify","label":{"en-US":"height"},"type":"spinner","opts":{}}}],"color":"#3caa8e","inputLabels":["trigger"],"outputLabels":["table"],"icon":"font-awesome/fa-table","status":{"x":343,"y":34,"wires":[{"id":"6a2bfd9e.ce1944","port":0}]}},{"id":"f8262c22.ca30c","type":"subflow","name":"tableCallback","info":"","category":"myUI","in":[{"x":34,"y":85,"wires":[{"id":"38e848c.4a875b8"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"38e848c.4a875b8","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings"},{"name":"dataContext","type":"str","value":""}],"color":"#3caa8e","icon":"font-awesome/fa-database","status":{"x":343,"y":51,"wires":[{"id":"38e848c.4a875b8","port":0}]}},{"id":"65174702.902988","type":"subflow","name":"setValue","info":"","category":"myHome","in":[{"x":71,"y":85,"wires":[{"id":"f5750d2d.53017"}]}],"out":[{"x":411,"y":119,"wires":[{"id":"f5750d2d.53017","port":1}]}],"env":[{"name":"globalContext","type":"str","value":"mySettings","ui":{"icon":"font-awesome/fa-globe","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"dataContext","type":"str","value":"heating.devices","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"datapointName","type":"str","value":"SET_TEMPERATURE","ui":{"icon":"font-awesome/fa-arrows-v","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"groupContext","type":"str","value":"heating.rooms","ui":{"icon":"font-awesome/fa-group","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"sourceKey","type":"str","value":"name","ui":{"icon":"font-awesome/fa-arrow-circle-right","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"targetKey","type":"str","value":"room","ui":{"icon":"font-awesome/fa-arrow-circle-left","type":"input","opts":{"types":["str","env"]},"label":{}}}],"color":"#3caa8e","icon":"font-awesome/fa-lightbulb-o","status":{"x":411,"y":51,"wires":[{"id":"f5750d2d.53017","port":0}]}},{"id":"288b8cb6.42ac94","type":"subflow","name":"preUI","info":"","category":"myHeating","in":[{"x":51,"y":85,"wires":[{"id":"f2614149.ecb88"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"f2614149.ecb88","port":1}]}],"env":[{"name":"datapoint","type":"str","value":"BOOST_STATE"}],"color":"#a1decf","icon":"node-red/timer.svg","status":{"x":343,"y":34,"wires":[{"id":"f2614149.ecb88","port":0}]}},{"id":"77ddfba9.23c614","type":"subflow","name":"postUI","info":"","category":"","in":[{"x":54,"y":85,"wires":[{"id":"374c9f22.55b41"}]}],"out":[{"x":326,"y":119,"wires":[{"id":"374c9f22.55b41","port":1}]},{"x":326,"y":170,"wires":[{"id":"374c9f22.55b41","port":2}]},{"x":326,"y":221,"wires":[{"id":"374c9f22.55b41","port":3}]}],"env":[{"name":"room","type":"str","value":"Dusche","ui":{"icon":"font-awesome/fa-bed","label":{"en-US":"Raum"},"type":"input","opts":{"types":["str","env"]}}},{"name":"datapoint","type":"str","value":"BOOST_MODE","ui":{"icon":"font-awesome/fa-bolt","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"topic","type":"str","value":"mySettings.heating.devices","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["str","env"]},"label":{}}}],"color":"#a1decf","outputLabels":["toController","uiFeedback",""],"status":{"x":326,"y":68,"wires":[{"id":"374c9f22.55b41","port":0}]}},{"id":"bbf5d78f.c16998","type":"subflow","name":"filter Room","info":"","category":"myHome","in":[{"x":71,"y":85,"wires":[{"id":"40e23834.6b3c78"}]}],"out":[{"x":360,"y":119,"wires":[{"id":"40e23834.6b3c78","port":1}]}],"env":[{"name":"room","type":"str","value":"Arbeitszimmer","ui":{"icon":"font-awesome/fa-bed","type":"input","opts":{"types":["str","env"]},"label":{}}}],"color":"#3caa8e","status":{"x":360,"y":51,"wires":[{"id":"40e23834.6b3c78","port":0}]}},{"id":"459559af.3bd1b8","type":"subflow","name":"enableUI","info":"","category":"","in":[{"x":51,"y":85,"wires":[{"id":"5a59342e.f0f39c"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"5a59342e.f0f39c","port":1}]}],"env":[],"color":"#a1decf","icon":"font-awesome/fa-check-square-o","status":{"x":343,"y":51,"wires":[{"id":"5a59342e.f0f39c","port":0}]}},{"id":"653c3a89.08f864","type":"subflow","name":"fill ui-list","info":"","category":"","in":[{"x":88,"y":85,"wires":[{"id":"7d44685b.569b28"}]}],"out":[{"x":326,"y":119,"wires":[{"id":"7d44685b.569b28","port":1}]}],"env":[{"name":"groups","type":"str","value":"light.groups","ui":{"icon":"font-awesome/fa-object-ungroup","label":{"en-US":"Host"},"type":"input","opts":{"types":["str","env"]}}},{"name":"devProperty","type":"str","value":"groupMembers","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Property"},"type":"input","opts":{"types":["str","env"]}}},{"name":"listSources","type":"json","value":"[{\"type\":\"device\",\"source\":\"light.devices\",\"icon\":\"fa-lightbulb-o\"},{\"type\":\"group\",\"source\":\"light.groups\",\"icon\":\"fa-object-group\"}]","ui":{"icon":"font-awesome/fa-bars","label":{"en-US":"Sources"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#3caa8e","icon":"font-awesome/fa-align-justify","status":{"x":326,"y":51,"wires":[{"id":"7d44685b.569b28","port":0}]}},{"id":"274dc61a.3c17aa","type":"subflow","name":"groupSend","info":"","category":"myLights","in":[{"x":68,"y":85,"wires":[{"id":"b99ddb18.33f108"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"b99ddb18.33f108","port":1}]}],"env":[{"name":"devices","type":"str","value":"light.devices","ui":{"icon":"font-awesome/fa-lightbulb-o","label":{"en-US":"Devices"},"type":"input","opts":{"types":["str","env"]}}},{"name":"groupTopic","type":"str","value":"groups","ui":{"icon":"font-awesome/fa-tasks","label":{"en-US":"Group"},"type":"input","opts":{"types":["str","env"]}}},{"name":"groupMembers","type":"str","value":"groupMembers","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Group Property"},"type":"input","opts":{"types":["str","env"]}}},{"name":"sceneTopic","type":"str","value":"scenes","ui":{"icon":"font-awesome/fa-tasks","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"sceneMembers","type":"str","value":"sceneMembers","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Scene"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3caa8e","icon":"font-awesome/fa-object-group","status":{"x":343,"y":51,"wires":[{"id":"b99ddb18.33f108","port":0}]}},{"id":"33d1b88e.5b1368","type":"subflow","name":"saveChecklist","info":"# save data from ui-list node\n\n## decription\n\n - processes data from a ui-list note. \n - creates new objects in list on demand\n - delets unchecked objects\n - triggers uiUpdate\n\n## imput\n`msg.payload.uuid` | to identify changed item\n`msg.payload.isChecked` | create new objects if _true_\n | delete object if _false_\n\n## output\n#1 | standard message\n#2 | trigger to updateUI node","category":"myHome","in":[{"x":51,"y":85,"wires":[{"id":"5065a60e.ef53a8"}]}],"out":[{"x":394,"y":85,"wires":[{"id":"5065a60e.ef53a8","port":1}]},{"x":394,"y":136,"wires":[{"id":"5065a60e.ef53a8","port":2}]}],"env":[{"name":"defaults","type":"json","value":"","ui":{"icon":"font-awesome/fa-sliders","label":{"en-US":"Defaults"},"type":"input","opts":{"types":["json"]}}}],"color":"#3caa8e","inputLabels":["ui-List"],"outputLabels":["","update UI"],"status":{"x":394,"y":34,"wires":[{"id":"5065a60e.ef53a8","port":0}]}},{"id":"991e8cc1.0c169","type":"subflow","name":"validateList","info":"","category":"","in":[{"x":54,"y":119,"wires":[{"id":"642ac148.46602"}]}],"out":[{"x":292,"y":170,"wires":[{"id":"642ac148.46602","port":1}]}],"env":[{"name":"globalStore","type":"str","value":"mySettings","ui":{"icon":"font-awesome/fa-database","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"listObject","type":"str","value":"","ui":{"icon":"font-awesome/fa-align-justify","label":{"en-US":"List"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"targetObject","type":"str","value":"","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Target"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}}],"color":"#DDAA99","status":{"x":292,"y":68,"wires":[{"id":"642ac148.46602","port":0}]}},{"id":"868280d8.dfda9","type":"subflow","name":"saveUiControl","info":"# save uiControl setting\n\n## description\nthis subflow saves settings to flow context store+\n\n## properties\n - `tempColumnOrder` true if column order should \"per session\"\n - `filterProperty` property to filter. A list of possible options will be sent on 2nd output\n\n## input\n\n - `msg.command=\"state\"` to configure new clients\n - `msg.ui_control.callback` messages for ui-table\n\n## output\n\n 1. passes msg object\n 2. message to update other dashboard UI nodes like filter presets\n","category":"ui-table","in":[{"x":37,"y":119,"wires":[{"id":"f1ca2f97.e3436"}]}],"out":[{"x":360,"y":119,"wires":[{"id":"f1ca2f97.e3436","port":1}]},{"x":360,"y":187,"wires":[{"id":"f1ca2f97.e3436","port":2}]}],"env":[{"name":"tempColumnOrder","type":"bool","value":"false","ui":{"icon":"font-awesome/fa-sort-amount-asc","label":{"en-US":"tempOrder"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"filterProperty","type":"str","value":"hostname","ui":{"icon":"font-awesome/fa-filter","label":{"en-US":"Filter"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#3FADB5","icon":"font-awesome/fa-database","status":{"x":360,"y":51,"wires":[{"id":"f1ca2f97.e3436","port":0}]}},{"id":"e8fd2fc9.509e","type":"subflow","name":"loadUiControl","info":"# load uiControl setting\n\n## description\nthis subflow loads default settings defined in the subflow properties and adds runtime settings stored by the saveUiControl subflow\n\nit uses settings for individual ip adrsses if possible and usefull\n\n## properties\n - `uiName` enter the name of the ui node to load the ui_control objects if available\n - `ui_Control` default values for `ui_control` object\n - `Table` name of the dashboard tab. if provided it only send messages to dashboard nodes if tab is opened. if empty it will update when a new client connects\n - `Context` json string configuring where to store the data sits:\n\n```\n {\n     \"storeName\": \"uiControl\",\n     \"storeProvider\": \"file\",\n     \"storeTempName\": \"uiControlTemp\"\n }\n```\n This will be passed on 2nd output on initialisazion.\n \n - `muliUser` enable muli user feature (currently not working because dashboard don`t support infividual states for ui-nodes)\n\n \n## input\n\nconnect a ui control node to initalize ui node if a client connects\n\nconnect dashboard nodes if you like to store settings\n\n## output\n\n - passes msg object\n - Adds ui_control default object\n - Adds stored settings if available\n - Adds tableData if available\n \non the second output it send `msg.state` **\"online\"** or **\"offline\"** depending if the table is visible or not. Link to your formating function to bypass ui-table and store messages instead.\n","category":"ui-table","in":[{"x":71,"y":187,"wires":[{"id":"f7b608bf.20f908"}]}],"out":[{"x":394,"y":119,"wires":[{"id":"f7b608bf.20f908","port":1}]},{"x":394,"y":187,"wires":[{"id":"f7b608bf.20f908","port":2}]},{"x":394,"y":255,"wires":[{"id":"f7b608bf.20f908","port":3}]},{"x":394,"y":323,"wires":[{"id":"f7b608bf.20f908","port":4}]}],"env":[{"name":"uiNode","type":"str","value":"","ui":{"icon":"font-awesome/fa-mouse-pointer","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"ui_control","type":"json","value":"","ui":{"icon":"font-awesome/fa-arrow-circle-right","type":"input","opts":{"types":["json"]},"label":{}}},{"name":"tabName","type":"str","value":"","ui":{"icon":"font-awesome/fa-file-o","label":{"en-US":"Table"},"type":"input","opts":{"types":["str","env"]}}},{"name":"context","type":"json","value":"{\"storeName\":\"uiControl\",\"storeProvider\":\"file\",\"storeTempName\":\"uiControlTemp\"}","ui":{"icon":"font-awesome/fa-database","label":{"en-US":"Context"},"type":"input","opts":{"types":["json","env"]}}},{"name":"defaultConfig","type":"json","value":"{\"uiParmeters\":{\"recordActive\":false,\"maxDisplayLines\":100,\"filterString\":\"[all]\"},\"firstRow\":0,\"counter\":0}","ui":{"icon":"font-awesome/fa-sliders","label":{"en-US":"config"},"type":"input","opts":{"types":["json","env"]}}},{"name":"maxStoreLines","type":"num","value":"50","ui":{"icon":"font-awesome/fa-list-ol","label":{"en-US":"maxStore"},"type":"input","opts":{"types":["num","env"]}}},{"name":"multiUser","type":"bool","value":"false","ui":{"icon":"font-awesome/fa-user-plus","type":"input","opts":{"types":["bool","env"]},"label":{}}}],"color":"#3FADB5","inputLabels":["from ui-control"],"outputLabels":["to ui-table","to saveUiControl","to UI","Passthrough"],"icon":"font-awesome/fa-database","status":{"x":394,"y":51,"wires":[{"id":"f7b608bf.20f908","port":0}]}},{"id":"769e792f.5e92b8","type":"subflow","name":"chart recorder","info":"# chart recorder\n\nThis node records incomming data as formated time based chart data ([as discribed here](https://github.com/node-red/node-red-dashboard/blob/master/Charts.md#line-charts-1)). Doublicated values will not be recorded. Instead the first occurance and last will be saved. If a `msg.payload=\"connect\"` with empty msg.topic is received the node send out the recorded chart object (array)\n\n## usage\n\nsimply place it between your incomming node and other nodes like the ui-chart dashboard widget or the chart statistic node part of this collection. Connect a ui-control node on the imput sending only connect messages to reconstruct historic data when a client connects.\n\n## configuration\n\nThe node stores the samples in the flow context of its parent flow. The context can be defined by the **context** json field. You can store multiple smples in one context by defining a **nodeName**. The number of values can be limited by **maxMsgs** to a number and **maxTime** a number of time in hours simmilar as the ui-chart widget does. Either the amount or the time limit the amount of data in the array depending on what is exceeded first. As there could more decimal places than needed in the payload you can limited them by a fixed number using the **roundTo** field. By **accuracy** you can define a threshold above witch a value is treaded as differend than a value received before.\n\n## properties\n\n- **nodeName**: Name of the node to identify the date in flow.context\n- **store**: json object defining the contect variable name and provider (normally default or file):\n```json\n{\n    \"name\": \"chartRecorder\",\n    \"provider\": \"default\"\n}\n```\n- **maxMsgs**: maximum number of values to be stored exceeding data will be deleted.\n- **maxTime**: maximum time in minutes the values could be in the past (1440min = 24h)\n- **roundTo**: number of decimal places the result will be rounded using the math.round() function\n- **accuracy**: the maximum difference between a new value and the value recorded before this to determin if the value is new. To take sensor noise into account this value should be little above the accuracy mentioned in the datasheet. As a rule of thumb half the accuracy of the sensor In example if a temerature sensor has an accuracy of 0.1°C the acuracy should be 0.05 but depends on the noise of the sensor too.","category":"chart recorder","in":[{"x":54,"y":119,"wires":[{"id":"f2978c19.8a4a1"}]}],"out":[{"x":377,"y":153,"wires":[{"id":"f2978c19.8a4a1","port":1}]}],"env":[{"name":"nodeName","type":"str","value":"chart","ui":{"icon":"font-awesome/fa-area-chart","label":{"en-US":"node"},"type":"input","opts":{"types":["str","env"]}}},{"name":"store","type":"json","value":"{\"name\":\"chartRecorder\",\"provider\":\"default\"}","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["json","env"]},"label":{}}},{"name":"maxTime","type":"num","value":"1440","ui":{"icon":"font-awesome/fa-clock-o","type":"input","opts":{"types":["num","env"]},"label":{}}},{"name":"maxMsgs","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-list-ol","label":{"en-US":"Messages"},"type":"input","opts":{"types":["num","env"]}}},{"name":"roundTo","type":"num","value":"2","ui":{"icon":"font-awesome/fa-sort-numeric-asc","type":"spinner","label":{},"opts":{}}},{"name":"accuracy","type":"num","value":"0.1","ui":{"icon":"font-awesome/fa-line-chart","type":"input","opts":{"types":["num","env"]},"label":{}}}],"color":"#3FADB5","outputLabels":["to ui-cart"],"icon":"font-awesome/fa-history","status":{"x":377,"y":85,"wires":[{"id":"f2978c19.8a4a1","port":0}]}},{"id":"df1076cf.94d498","type":"subflow","name":"chart sampler","info":"# chart sampler\n\nThi node oversamples incomming data and send out a average value of historic data + incomming payload over time or by a number of samples\n\n## usage\n\nsimply place it between your incomming node and other nodes like the ui-chart daschboard widget or the chart recorder node part of this collection.\n\n## configuration\n\nThe node stores the samples in the flow context of its parent flow. The context can be defined by the **context** json field. You can store multiple smples in one context by defining a **nodeName**. The number of **samples** is defined by samples either as amount of samples if the value is below 60 or as time in seconds if the value is over 60. As there will be a lot of decimal places due to the devision you can limited them by a fixed number using the **roundTo** field.\n\n## properties\n\n- **nodeName**: Name of the node to identify the date in flow.context\n- **store**: json object defining the contect variable name and provider (normally default or file):\n```json\n{\n    \"name\": \"chartRecorder\",\n    \"provider\": \"default\"\n}\n```\n- **samples**: number of samples beween 2 and 60 or time to sample beween 61 and X seconds.\n- **roundTo**: nuber of decimal places the result will be rounded using the math.round() function","category":"chart recorder","in":[{"x":54,"y":85,"wires":[{"id":"e1fb9716.bb7e38"}]}],"out":[{"x":343,"y":119,"wires":[{"id":"e1fb9716.bb7e38","port":1}]}],"env":[{"name":"nodeName","type":"str","value":"myChart","ui":{"icon":"font-awesome/fa-area-chart","type":"input","opts":{"types":["str","env"]},"label":{}}},{"name":"store","type":"json","value":"{\"name\":\"chartRecorder\",\"provider\":\"default\"}","ui":{"icon":"font-awesome/fa-database","label":{},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"oversampling","type":"num","value":"5","ui":{"icon":"font-awesome/fa-rotate-left","label":{"en-US":"samples"},"type":"input","opts":{"types":["num","env"]}}},{"name":"roundTo","type":"num","value":"2","ui":{"icon":"font-awesome/fa-sort-numeric-asc","type":"spinner","label":{},"opts":{}}}],"color":"#3FADB5","inputLabels":["data"],"outputLabels":["oversampled data"],"icon":"node-red/status.svg","status":{"x":343,"y":51,"wires":[{"id":"e1fb9716.bb7e38","port":0}]}},{"id":"8469bb42.e142f8","type":"subflow","name":"chart statistics","info":"# chart statistics\n\nThis node analyze incomming data received by the chart recorder and add statistic information to the chart:\n\n- minmum / maximum\n- average\n- trend (ToDo)\n- [...]\n\n## usage\n\nsimply place it after the **chart recorder** a ui-chart dashboard widget. On the first output it will send data to the ui-cart the second provides the statistics in numeric form for other use. When a message arrives it analyze existing chart date back to the **sampleTime** and send updates on the second output and additional chart lines if configured. The original message is passed unaltered.\n\n## configuration\n\nThe uses the samples in the flow context of its parent flow. The context can be defined by the **context** json field. Multiple samples in the context are defined by the **nodeName**. As there could more decimal places than needed in the payload you can limited them by a fixed number using the **roundTo** field. If a labels for min, max or avg are entered a seperate chart will be generated labeled with the original `msg.topic+label`\n\n## properties\n\n- **nodeName**: Name of the node to identify the date in flow.context\n- **store**: json object defining the contect variable name and provider (normally default or file):\n```json\n{\n    \"name\": \"chartRecorder\",\n    \"provider\": \"default\"\n}\n```\n- **liveChart**: if `true` the chart updates every incomming message. if `false` the chart only updates after sample time expires\n- **sampleTime**: time in minutes the values should update.\n- **roundTo**: number of decimal places the result will be rounded using the math.round() function\n- **config**: json object to configure statistic values\n\n\n### outputs \n  - **chart** calculated values will be add to chart curves\n  - **value** calculated values will be send to 2nd output\n\n\n### calculators\n  - **min** minimum value\n  - **max** maximum value\n  - **avg** simple average (sum of samples / amount\n  - **quardAvg** rough quadratic average (sum of samples*duration / total durtion)\n  - **delta** delta of values (last - first)\n  - **trend** change of values compared to min/max in %\n  - **total** sum of all values in time period\n\n### options\n  - **label** label to be apendeded to msg.topic\n  - **chart** define the type of chart\n  - **sampleTime** duration to sample chart data (in Minutes)\n  - **maxTime** duration to keep sample data in minutes (default 1440 = 24h)\n  - **maxMsgs** amount of samples to keep (default 1500 > on msg per minute = 24h)\n\n### example\n```json\n{\n    \"chart\": {\n        \"avg\": {\n            \"label\": \" (avg)\",\n            \"chart\": \"line\",\n            \"sampleTime\": 60,\n            \"maxTime\": 1440,\n            \"maxMsgs\": 1500\n        },\n        \"max\": {\n            \"label\": \" (max)\",\n            \"chart\": \"line\",\n            \"sampleTime\": 120\n        },\n        \"min\": {\n            \"label\": \" (min)\",\n            \"chart\": \"line\",\n            \"sampleTime\": 120\n        },\n        \"trend\": {\n            \"label\": \" (trend)\",\n            \"chart\": \"line\",\n            \"sampleTime\": 60\n        }\n    },\n    \"value\": {\n        \"min\": {\n            \"label\": \"min (24h)\",\n            \"sampleTime\": 1440\n        },\n        \"max\": {\n            \"label\": \"max (24h)\",\n            \"sampleTime\": 1440\n        },\n        \"quardAvg\": {\n            \"label\": \"quardAvg (1h)\",\n            \"sampleTime\": 60\n        },\n        \"trend\": {\n            \"label\": \"trend (1h)\",\n            \"sampleTime\": 60\n        },\n        \"delta\": {\n            \"label\": \"delta (10min)\",\n            \"sampleTime\": 10\n        }\n    }\n}\n```\n","category":"chart recorder","in":[{"x":54,"y":119,"wires":[{"id":"8aa6990.4b4b668"}]}],"out":[{"x":377,"y":119,"wires":[{"id":"8aa6990.4b4b668","port":1}]},{"x":377,"y":187,"wires":[{"id":"8aa6990.4b4b668","port":2}]}],"env":[{"name":"store","type":"json","value":"{\"name\":\"chartRecorder\",\"provider\":\"default\"}","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["json","env"]},"label":{}}},{"name":"nodeName","type":"str","value":"chart","ui":{"icon":"font-awesome/fa-area-chart","label":{"en-US":"node"},"type":"input","opts":{"types":["str","env"]}}},{"name":"liveChart","type":"bool","value":"true","ui":{"icon":"font-awesome/fa-ellipsis-h","type":"input","opts":{"types":["bool","env"]},"label":{}}},{"name":"sampleTime","type":"num","value":"10","ui":{"icon":"font-awesome/fa-history","type":"input","opts":{"types":["num","env"]},"label":{}}},{"name":"roundTo","type":"num","value":"2","ui":{"icon":"font-awesome/fa-sort-numeric-asc","type":"spinner","label":{},"opts":{}}},{"name":"config","type":"json","value":"{\"chart\":{\"avg\":{\"label\":\" (avg)\",\"chart\":\"line\",\"sampleTime\":60,\"maxTime\":1440,\"maxMsgs\":1500},\"max\":{\"label\":\" (max)\",\"chart\":\"line\",\"sampleTime\":120},\"min\":{\"label\":\" (min)\",\"chart\":\"line\",\"sampleTime\":120},\"trend\":{\"label\":\" (trend)\",\"chart\":\"line\",\"sampleTime\":60}},\"value\":{\"min\":{\"label\":\"min (24h)\",\"sampleTime\":1440},\"max\":{\"label\":\"max (24h)\",\"sampleTime\":1440},\"quardAvg\":{\"label\":\"quardAvg (1h)\",\"sampleTime\":60},\"trend\":{\"label\":\"trend (1h)\",\"sampleTime\":60},\"delta\":{\"label\":\"delta (10min)\",\"sampleTime\":10}}}","ui":{"icon":"font-awesome/fa-tags","label":{"en-US":"config"},"type":"input","opts":{"types":["json","env"]}}}],"color":"#3FADB5","outputLabels":["to ui-cart","statistics"],"icon":"node-red-dashboard/ui_chart.png","status":{"x":377,"y":51,"wires":[{"id":"8aa6990.4b4b668","port":0}]}},{"id":"2924702c.b33a7","type":"subflow","name":"ui-table handler","info":"# ui-table handler\nUniversal handler for ui-table.\n## features\n- buffer table data\n- add or update individual rows or cells of the table\n- delete rows\n- clear tableData\n- handle column width\n- handle column order\n\n## configuration\n- `tabulator` json formatted object containing configuration of the table. See ui-table for more details.\n- `property` property of the msg object that contains the data to be passed to ui-table. I.e. *state* `msg.state`\n- `index` index column to identify individual rows. Each message containing data must have a unique `msg.topic` to identify the row. Messages without this `msg.topic` will be droped. It is not nessesary but possible to display the index column in the table. Do not enable editing on this column otherwise you will loose the connection and another row will be added to the table as soon as a new message arrives!\n\n   Defaults to *$topic* `msg.state.$topic`\n- `dashboard` name of the dashboard tab to only update the table if the dashboard is visible. If empty the table will be updated on every tab change and connect.\n- `context` configuration of context data. The subflow will save or cache data in the flows context using `$parent.`. \n   **tableData** caches the incoming data to restore it on `ui-control´ *change* messages.\n   **tableConfig** saves column width and order to save the interactive table layot\n   **tableEdit** saves edits on the table data otherwise it would be overwritten when new data arrives\n```json\n{\n    \"tableData\": {\n        \"name\": \"tableData\"\n    },\n    \"tableConfig\": {\n        \"name\": \"tableConfig\",\n        \"storage\": \"file\"\n    },\n    \"tableEdit\": {\n        \"name\": \"tableEdit\",\n        \"storage\": \"file\"\n    }\n}\n```\n\n## commands\ncommands can be passed by sending a object as `msg.payload`\n- delete custom colum order and restore colum order from the tabulator json. This is important if you add or delete columns in the tabulator config otherwise the columns most likely don`t show up\n```json\n{\n    \"command\": \"delete\",\n    \"object\": \"columnOrder\"\n}\n```\n- delete custom column widths\n```json\n{\n    \"command\": \"delete\",\n    \"object\": \"columnWidth\"\n}\n```\n- delete tableCache\n```json\n{\n    \"command\": \"delete\",\n    \"object\": \"tableCache\"\n}\n```\n\n## background\nui-table warps the powerfull tabluator library. This subflow makes it easier to unleash the powerfull features of ui-table","category":"dashboard","in":[{"x":54,"y":85,"wires":[{"id":"5eb0bd6b.74b794"}]}],"out":[{"x":360,"y":85,"wires":[{"id":"5eb0bd6b.74b794","port":1}]},{"x":360,"y":136,"wires":[{"id":"5eb0bd6b.74b794","port":2}]}],"env":[{"name":"tabulator","type":"json","value":"{\"tabulator\":{\"responsiveLayout\":\"collapse\",\"responsiveLayoutCollapseStartOpen\":false,\"index\":\"$name\",\"layout\":\"fitColumns\",\"movableColumns\":true,\"groupBy\":\"\",\"columnResized\":\"function(column){     var newColumn = {         field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.definition.field, 'title': column._column.definition.title});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"rowFormatter\":\"function(row){     var data = row.getData();     switch (data.$state) {         case \\\"lost\\\":             row.getElement().style.backgroundColor = \\\"#9e2e66\\\";             row.getElement().style.color = \\\"#a6a6a6\\\";             break;         case \\\"sleeping\\\":             row.getElement().style.backgroundColor = \\\"#336699\\\";             break;         case \\\"disconnected\\\":             row.getElement().style.backgroundColor = \\\"#cc3300\\\";             row.getElement().style.color = \\\"#a6a6a6\\\";             break;         case \\\"alert\\\":             row.getElement().style.backgroundColor = \\\"#A6A6DF\\\";             break;         case \\\"init\\\":             row.getElement().style.backgroundColor = \\\"#f2f20d\\\";             break;         case \\\"ready\\\":             row.getElement().style.backgroundColor = \\\"\\\";             row.getElement().style.color = \\\"\\\";             break;         } }\",\"columns\":[{\"formatter\":\"responsiveCollapse\",\"width\":30,\"minWidth\":30,\"align\":\"center\",\"resizable\":false,\"headerSort\":false,\"frozen\":true,\"title\":\"expand\",\"field\":\"expand\",\"headerVertical\":\"flip\"},{\"formatter\":\"function(cell, formatterParams, onRendered) {      var html = cell.getValue(); return html;  }\",\"title\":\"State\",\"field\":\"$stateIcon\",\"width\":100,\"frozen\":true,\"headerVertical\":\"flip\"},{\"formatter\":\"function(cell, formatterParams, onRendered) {     var html = cell.getValue(); return html;  }\",\"title\":\"Signal\",\"field\":\"signalIcon\",\"width\":100,\"frozen\":true,\"headerVertical\":\"flip\"},{\"title\":\"Name\",\"field\":\"$name\",\"width\":100,\"frozen\":true,\"headerVertical\":\"flip\"},{\"title\":\"State\",\"field\":\"$state\",\"width\":100,\"align\":\"center\",\"headerVertical\":\"flip\"},{\"title\":\"last-ready\",\"field\":\"lastSeenreadyFormatted\",\"width\":100,\"align\":\"left\",\"headerVertical\":\"flip\"},{\"title\":\"Homie\",\"field\":\"$homie\",\"width\":100,\"align\":\"left\",\"headerVertical\":\"flip\"},{\"title\":\"Platform\",\"field\":\"$implementation\",\"width\":100,\"align\":\"left\",\"headerVertical\":\"flip\"},{\"title\":\"Statistics\",\"columns\":[{\"title\":\"Interval\",\"field\":\"interval\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"outputFormat\":\"d hh:mm:ss\",\"inputFormat\":\"seconds\",\"invalidPlaceholder\":\"(unknown)\"},\"title\":\"Uptime\",\"field\":\"uptime\",\"formatter\":\"function(cell, formatterParams, onRendered){     var pad = function (num) {         return (\\\"0\\\"+num).slice(-2);     };     var secs = Number(cell.getValue());     if (Number.isNaN(secs)) return;     var minutes = Math.floor(secs / 60);     secs = secs%60;     var hours = Math.floor(minutes/60);     minutes = minutes%60;     var days = Math.floor(hours/24);     hours = hours%24;     if (days>0)         return days+\\\"d \\\"+pad(hours)+\\\":\\\"+pad(minutes);     else         return pad(hours)+\\\":\\\"+pad(minutes)+\\\":\\\"+pad(secs); }\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" %</span>\\\"; else return; }\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"title\":\"Signal\",\"field\":\"signal\",\"formatter\":\"progress\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"min\":2.5,\"max\":3.5,\"color\":[\"red\",\"green\",\"red\"],\"legend\":\"function (value) { if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" V</span>\\\"; else return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Supply\",\"field\":\"supply\",\"formatter\":\"progress\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" %</span>\\\";     else         return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Battery\",\"field\":\"battery\",\"formatter\":\"progress\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"min\":0,\"max\":100000,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) { if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+(value/1024).toFixed(2)+\\\" kB</span>\\\"; else return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Memory\",\"field\":\"freeheap\",\"formatter\":\"progress\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"target\":\"_blank\",\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" %</span>\\\";     else         return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"CPU load\",\"field\":\"cpuload\",\"formatter\":\"progress\",\"width\":100,\"headerVertical\":\"flip\"},{\"formatterParams\":{\"min\":20,\"max\":60,\"color\":[\"green\",\"orange\",\"red\"],\"legend\":\"function (value) { if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" °C</span>\\\"; else return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"CPU temp\",\"field\":\"cputemp\",\"formatter\":\"progress\",\"width\":100,\"headerVertical\":\"flip\"}]},{\"title\":\"Firmware\",\"columns\":[{\"formatter\":\"link\",\"formatterParams\":{\"labelField\":\"$localip\",\"urlPrefix\":\"http://\",\"target\":\"_blank\"},\"title\":\"IP\",\"field\":\"$localip\",\"width\":100},{\"title\":\"mac\",\"field\":\"$mac\",\"width\":100},{\"title\":\"Accsess Point\",\"field\":\"SSID\",\"width\":100},{\"title\":\"Firmware\",\"field\":\"name\",\"width\":100},{\"title\":\"Version\",\"field\":\"version\",\"width\":100},{\"title\":\"Last Boot Cause\",\"field\":\"lastBootCause\",\"width\":100},{\"title\":\"Reset Reason\",\"field\":\"resetReason\",\"width\":100}]}]},\"customHeight\":12}","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tabulator"},"type":"input","opts":{"types":["json","env"]}}},{"name":"tableDataProp","type":"str","value":"row","ui":{"icon":"font-awesome/fa-tag","label":{"en-US":"rowProperty"},"type":"input","opts":{"types":["str","num","bool","json","bin","env"]}}},{"name":"tableIndex","type":"str","value":"$topic","ui":{"icon":"font-awesome/fa-indent","label":{"en-US":"Index"},"type":"input","opts":{"types":["str","json","env"]}}},{"name":"dashboard","type":"str","value":"Remote Device Table","ui":{"icon":"font-awesome/fa-dashboard","label":{"en-US":"Dashboard"},"type":"input","opts":{"types":["str","env"]}}},{"name":"tableContext","type":"json","value":"{\"tableData\":{\"name\":\"tableData\"},\"tableConfig\":{\"name\":\"tableConfig\",\"storage\":\"file\"},\"tableEdit\":{\"name\":\"tableEdit\",\"storage\":\"file\"}}","ui":{"icon":"font-awesome/fa-database","label":{"en-US":"Context"},"type":"input","opts":{"types":["json","env"]}}}],"color":"#3FADB5","icon":"node-red-dashboard/ui_slider.png","status":{"x":360,"y":34,"wires":[{"id":"5eb0bd6b.74b794","port":0}]}},{"id":"e0e6e559.8f30d8","type":"subflow","name":"scan","info":"","category":"ui-table","in":[{"x":51,"y":85,"wires":[{"id":"ffa780bb.8fd62"}]}],"out":[{"x":357,"y":85,"wires":[{"id":"ffa780bb.8fd62","port":0}]}],"env":[{"name":"ipString","type":"str","value":"http://192.168.2.","ui":{"icon":"font-awesome/fa-feed","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"start","type":"num","value":"1","ui":{"icon":"font-awesome/fa-arrow-circle-right","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"end","type":"num","value":"255","ui":{"icon":"font-awesome/fa-arrow-circle-left","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"suffix","type":"str","value":"/json","ui":{"icon":"font-awesome/fa-address-card-o","type":"input","opts":{"types":["str"]},"label":{}}}],"color":"#A6BBCF","icon":"font-awesome/fa-stethoscope"},{"id":"657589c7.6fef88","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"f3635ff.5072da","type":"subflow","name":"from homekit","info":"","category":"","in":[{"x":71,"y":85,"wires":[{"id":"a58a7bf7.b64008"}]}],"out":[{"x":326,"y":119,"wires":[{"id":"a58a7bf7.b64008","port":1}]}],"env":[{"name":"path","type":"str","value":"mySettings.light.devices","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"Path"},"type":"input","opts":{"types":["str","env"]}}},{"name":"contextStore","type":"json","value":"{\"currentStatusName\":\"lightStatus\",\"currentStatusStore\":\"file\"}","ui":{"icon":"font-awesome/fa-database","label":{"en-US":"Context"},"type":"input","opts":{"types":["json"]}}}],"color":"#FFCC66","inputLabels":["from Homekit"],"outputLabels":["to Node-RED"],"icon":"node-red/arrow-in.svg","status":{"x":326,"y":51,"wires":[{"id":"a58a7bf7.b64008","port":0}]}},{"id":"f92c6036.121f8","type":"subflow","name":"Subflow 2","info":"","in":[],"out":[]},{"id":"fd36bbc4.fe50d8","type":"subflow","name":"OK/Cancel helper","info":"# OK/Cancel dialog helper\n\n## description\n\nThis is a little helper to make OK/Cancel dialogs easy to implement inside a data stream\n\n## how it works\n\nIf a message arrives at the **imput** a message dialog box is triggered. The original Message is cloned into `msg.dialogHelperOrgMsg`. If the dialog sends `msg.payload` with the **passPayload** the original message is released on the second output.\n\n## configuration\n\n- **Title** ***optional** a string displayed on the title of the dialog\n- **Message** message to be displayed\n- **passPayload** the `msg.payload` expected on the imput to release to original message.","category":"","in":[{"x":37,"y":85,"wires":[{"id":"6a44f1d4.72a75"}]}],"out":[{"x":343,"y":85,"wires":[{"id":"6a44f1d4.72a75","port":1}]},{"x":343,"y":136,"wires":[{"id":"6a44f1d4.72a75","port":2}]}],"env":[{"name":"title","type":"str","value":"Please Confirm","ui":{"icon":"font-awesome/fa-comment","label":{"en-US":"Title"},"type":"input","opts":{"types":["str","env"]}}},{"name":"message","type":"str","value":"should the message pass on?","ui":{"icon":"font-awesome/fa-comment-o","label":{"en-US":"Message"},"type":"input","opts":{"types":["str","env"]}}},{"name":"passPayload","type":"str","value":"OK","ui":{"icon":"font-awesome/fa-check-square-o","type":"input","opts":{"types":["str","env"]}}}],"color":"#3FADB5","icon":"font-awesome/fa-comments-o","status":{"x":343,"y":34,"wires":[{"id":"6a44f1d4.72a75","port":0}]}},{"id":"76579ffb.cc4a3","type":"subflow","name":"convert datapoint","info":"# converter\n\nuniversal flow to convert data from non homie devices to be fet into the homie-node\n\n## supported devices\n\n* Homematic\n   * Thermostats\n   * power sockets\n\n## configuration\n\nA json objects defines the relationship between the data provided by the connected device and homie properties. Beside the properties defined by the homie convention there are special properties to ancor the device in the homie device\n\nproperty | description\n-------- | -----------\nnodeId   | unique indentifier of the node where the foloowing devices are placed (type id of a device)\npropertyId | unique indetifier of a datapoint (ie. setTemperature, currentTemperature)\nvalue | property where the current payload is delivered","category":"Homie convention","in":[{"x":37,"y":85,"wires":[{"id":"70513425.67039c"}]}],"out":[{"x":360,"y":153,"wires":[{"id":"70513425.67039c","port":1}]}],"env":[{"name":"datapointDef","type":"json","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"ACTUAL_TEMPERATURE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"°C\"},\"SET_TEMPERATURE\":{\"$setable\":true,\"$retained\":true,\"$unit\":\"°C\"},\"VALVE_STATE\":{\"$setable\":false,\"$retained\":true,\"$unit\":\"%\"},\"BATTERY_STATE\":{\"$setable\":false,\"$retained\":true,\"$unit\":\"V\"}}}","ui":{"icon":"font-awesome/fa-arrows-alt","label":{"en-US":"Config"},"type":"input","opts":{"types":["json","env"]}}},{"name":"contextStore","type":"json","value":"{\"homieConfig\":{\"name\":\"homieConfig\"}}","ui":{"icon":"font-awesome/fa-database","type":"input","opts":{"types":["json","env"]},"label":{}}},{"name":"datapointProperty","type":"str","value":"datapoint","ui":{"icon":"font-awesome/fa-crosshairs","label":{"en-US":"property"},"type":"input","opts":{"types":["str","env"]}}}],"color":"#d9584a","inputLabels":["from device"],"outputLabels":["to homie node"],"icon":"node-red/swap.svg","status":{"x":360,"y":34,"wires":[{"id":"70513425.67039c","port":0}]}},{"id":"6389f524.8a4e3c","type":"mqtt-broker","z":"","name":"lol-server","broker":"192.168.2.14","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"24d8d6bd.a1ea4a","type":"ui_tab","z":"","name":"Homie Test","icon":"dashboard","order":15,"disabled":false,"hidden":false},{"id":"8f5ef88a.50ced8","type":"ui_group","z":"","name":"[any] device & [any] node","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"21cf364a.624f6a","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":5,"cy":5,"px":2,"py":2}}},{"id":"2e70a2b0.61ff8e","type":"ui_group","z":"","name":"$datatype=enum","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"6aae0b37.682c24","type":"ui_group","z":"","name":"Bulb 02","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"306569d5.649c16","type":"ui_group","z":"","name":"Programm","tab":"831d491a.c7a7e8","order":1,"disp":true,"width":12,"collapse":true},{"id":"3e5d4543.e67aaa","type":"ui_group","z":"","name":"Räume","tab":"831d491a.c7a7e8","order":2,"disp":true,"width":"8","collapse":true},{"id":"831d491a.c7a7e8","type":"ui_tab","z":"","name":"Heizung","icon":"dashboard","order":11,"disabled":false,"hidden":false},{"id":"4ac97505.03ae4c","type":"ui_group","z":"","name":"Wochentage","tab":"831d491a.c7a7e8","order":4,"disp":true,"width":"8","collapse":true},{"id":"1727a207.b3522e","type":"ui_group","z":"","name":"Zeitabschnitt","tab":"831d491a.c7a7e8","order":3,"disp":true,"width":"8","collapse":false},{"id":"450f9708.9afe08","type":"ui_tab","z":"","name":"ui_Test","icon":"dashboard","order":13,"disabled":false,"hidden":false},{"id":"d11141a.b59afc","type":"ui_group","z":"","name":"Test Period","tab":"450f9708.9afe08","disp":true,"width":"8","collapse":false},{"id":"160939b7.e94c96","type":"ui_tab","z":"","name":"Worldmap","icon":"pin_drop","order":10,"disabled":false,"hidden":false},{"id":"234ff31e.1bc3cc","type":"ui_group","z":"","name":"Map","tab":"160939b7.e94c96","disp":false,"width":"15","collapse":false},{"id":"7ef5ea17.178a64","type":"mqtt-broker","z":"","name":"ah-berlin-0148","broker":"ah-berlin-0148","port":"8883","tls":"224962c.03df19e","clientid":"","usetls":true,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"50ef20f5.7d4f8","type":"ui_group","z":"","name":"uptime","tab":"24d8d6bd.a1ea4a","disp":true,"width":"14","collapse":false},{"id":"571ba74f.fd87f8","type":"ui_tab","z":"","name":"Homie debug","icon":"dashboard","order":14,"disabled":false,"hidden":false},{"id":"61b56b5f.f16754","type":"ui_group","z":"","name":"debug","tab":"571ba74f.fd87f8","disp":true,"width":"6","collapse":false},{"id":"9ce06846.951a68","type":"ui_group","z":"","name":"Arbeitszimmer","tab":"61a83671.30e428","order":1,"disp":false,"width":"8","collapse":false},{"id":"dcd63e8.d157fc","type":"ccu-connection","z":"","name":"ccu2","host":"192.168.2.5","regaEnabled":true,"bcrfEnabled":true,"iprfEnabled":true,"virtEnabled":false,"bcwiEnabled":false,"cuxdEnabled":false,"regaPoll":false,"regaInterval":"30","rpcPingTimeout":"60","rpcInitAddress":"192.168.2.212","rpcServerHost":"192.168.2.212","rpcBinPort":"2059","rpcXmlPort":"2060","queueTimeout":"5000","queuePause":"250","contextStore":"file"},{"id":"e1cac84f.fefdd8","type":"ui_group","z":"","name":"Thermostate","tab":"7a65a7c7.108478","order":2,"disp":true,"width":"15","collapse":true},{"id":"b353f4cb.6e6ff8","type":"ui_spacer","name":"spacer","group":"306569d5.649c16","order":3,"width":2,"height":1},{"id":"d9f713b7.8622a","type":"ui_spacer","name":"spacer","group":"306569d5.649c16","order":6,"width":2,"height":1},{"id":"3e1c95a4.0e104a","type":"ui_tab","z":"","name":"Lights","icon":"lightbulb_outline","order":16,"disabled":false,"hidden":false},{"id":"c04d8bda.8dad98","type":"ui_group","z":"","name":"Leuchten","tab":"3e1c95a4.0e104a","disp":true,"width":"8","collapse":true},{"id":"ceeb11f0.8bfba","type":"ui_group","z":"","name":"Gruppen","tab":"3e1c95a4.0e104a","disp":true,"width":"8","collapse":false},{"id":"6a28c45b.c2fe1c","type":"ui_group","z":"","name":"Szenen","tab":"3e1c95a4.0e104a","disp":true,"width":"8","collapse":false},{"id":"7e22101c.03087","type":"ui_group","z":"","name":"Arbeitszimmer","tab":"61a83671.30e428","order":2,"disp":true,"width":"7","collapse":true},{"id":"370a54c3.841eac","type":"ui_spacer","name":"spacer","group":"c04d8bda.8dad98","order":16,"width":4,"height":1},{"id":"5f00499d.f4add8","type":"ui_spacer","name":"spacer","group":"ceeb11f0.8bfba","order":8,"width":4,"height":1},{"id":"3a14f0a5.039ee","type":"ui_spacer","name":"spacer","group":"6a28c45b.c2fe1c","order":12,"width":4,"height":1},{"id":"78ce343c.3cb0cc","type":"ui_spacer","name":"spacer","group":"6a28c45b.c2fe1c","order":29,"width":4,"height":1},{"id":"cde25ae.eff1aa8","type":"ui_group","z":"","name":"Wohnzimmer","tab":"bbb7e304.9ef9e","order":1,"disp":true,"width":"7","collapse":false},{"id":"7341c8b3.0e9088","type":"ui_spacer","name":"spacer","group":"cde25ae.eff1aa8","order":4,"width":3,"height":1},{"id":"97f7df1d.bb18a","type":"tls-config","z":"","name":"1st Test","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"ca.crt","servername":"AH-BERLIN-0148","verifyservercert":true},{"id":"224962c.03df19e","type":"tls-config","z":"","name":"Localhost ca.crt","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"ca.crt","servername":"ah-berlin-0148","verifyservercert":false},{"id":"51ce6aa1.620754","type":"ui_group","z":"","name":"Syslog Server","tab":"7653f2c6.4b174c","order":1,"disp":true,"width":"19","collapse":false},{"id":"37eeda5a.799966","type":"ui_group","z":"","name":"Switch","tab":"24d8d6bd.a1ea4a","disp":true,"width":"6","collapse":false},{"id":"1b90cb05.60c0a5","type":"ui_group","z":"","name":"Sonne","tab":"23f4d58e.4acb7a","order":4,"disp":false,"width":"7","collapse":false},{"id":"43e7dd36.28fbe4","type":"ui_group","z":"","name":"Pumpe","tab":"23f4d58e.4acb7a","order":7,"disp":false,"width":"7","collapse":false},{"id":"5ffa92f6.040b6c","type":"ui_group","z":"","name":"Gewächshaus","tab":"23f4d58e.4acb7a","order":1,"disp":false,"width":"7","collapse":false},{"id":"763687d.660d278","type":"ui_group","z":"","name":"Energie Chart","tab":"97c2c784.50f0a8","order":6,"disp":true,"width":"8","collapse":true},{"id":"9ee1b18d.51ece","type":"ui_group","z":"","name":"Boden","tab":"23f4d58e.4acb7a","order":2,"disp":false,"width":"8","collapse":false},{"id":"4723b9bd.fb3598","type":"ui_group","z":"","name":"Regen","tab":"23f4d58e.4acb7a","order":3,"disp":false,"width":"8","collapse":false},{"id":"fa42e847.06d618","type":"ui_group","z":"","name":"Teich","tab":"23f4d58e.4acb7a","order":5,"disp":true,"width":"8","collapse":false},{"id":"1f012f45.a13f31","type":"homekit-bridge","z":"5b6fa421.88b5bc","bridgeName":"myHome","pinCode":"111-11-111","port":"","allowInsecureRequest":false,"manufacturer":"homemade","model":"Node-RED","serialNo":"0115","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true,"allowMessagePassthrough":true},{"id":"23f4d58e.4acb7a","type":"ui_tab","z":"","name":"Garten","icon":"dashboard","order":12,"disabled":false,"hidden":false},{"id":"30064ba2.1a2874","type":"influxdb","z":"","hostname":"192.168.2.14","port":"8086","protocol":"http","database":"openhab","name":"","usetls":false,"tls":"97f7df1d.bb18a"},{"id":"61a83671.30e428","type":"ui_tab","z":"","name":"Arbeitszimmer","icon":"desktop_mac","order":1,"disabled":false,"hidden":false},{"id":"7a65a7c7.108478","type":"ui_tab","z":"","name":"Thermostate","icon":"fa-thermometer-half ","order":9,"disabled":false,"hidden":false},{"id":"bbb7e304.9ef9e","type":"ui_tab","z":"","name":"Wohnzimmer","icon":"music_video","order":8,"disabled":false,"hidden":false},{"id":"97c2c784.50f0a8","type":"ui_tab","z":"","name":"Energie","icon":"power","order":17,"disabled":false,"hidden":false},{"id":"7653f2c6.4b174c","type":"ui_tab","z":"","name":"ui-table example","icon":"table","order":18,"disabled":false,"hidden":false},{"id":"fe4aa0cd.8767f","type":"ui_tab","z":"","name":"ui-table demo","icon":"dashboard","order":20,"disabled":true,"hidden":false},{"id":"86d6c4d3.f4e698","type":"ui_group","z":"","name":"ui-table demo","tab":"fe4aa0cd.8767f","disp":true,"width":"6","collapse":false},{"id":"c8b19aad.8fb698","type":"ui_tab","z":"","name":"Esszimmer","icon":"fa-cutlery","order":5,"disabled":false,"hidden":false},{"id":"dad2c6ff.66acf8","type":"ui_group","z":"","name":"Weihnachtsbaum","tab":"c8b19aad.8fb698","disp":true,"width":"7","collapse":false},{"id":"6cd1ccc3.7b5b94","type":"ui_group","z":"","name":"Sonoff Socket","tab":"c8b19aad.8fb698","disp":true,"width":"6","collapse":false},{"id":"b52e5a6.7c55ca8","type":"ui_group","z":"","name":"Deckenleuchte","tab":"bbb7e304.9ef9e","disp":true,"width":"6","collapse":false},{"id":"b46bc9fc.6556d8","type":"ui_group","z":"","name":"Chart Recorder","tab":"9b8e049b.971f68","order":1,"disp":true,"width":"20","collapse":false},{"id":"b3f1d4c.c657728","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":6},{"id":"fc9ce462.cd0308","type":"ui_spacer","name":"spacer","group":"7e22101c.03087","order":4,"width":3,"height":1},{"id":"9b8e049b.971f68","type":"ui_tab","z":"","name":"chart recorder","icon":"show_chart","order":21,"disabled":false,"hidden":false},{"id":"612f702e.cc40e","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"3e8e6acd.3587c6","type":"ui_group","z":"","name":"Remote Device Table","tab":"dc3e656c.bbd048","order":2,"disp":false,"width":"19","collapse":false},{"id":"dc3e656c.bbd048","type":"ui_tab","z":"","name":"Remote Device Table","icon":"dashboard","order":19,"disabled":false,"hidden":false},{"id":"237da972.5d69a6","type":"ui_group","z":"","name":"ui-table with commands","tab":"379a501f.53b59","disp":true,"width":"17","collapse":false},{"id":"379a501f.53b59","type":"ui_tab","z":"","name":"ui-table command","icon":"fa-table","disabled":false,"hidden":false},{"id":"fb8c8a77.0a62e8","type":"ui_tab","z":"","name":"Room","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"c91332c0.50c11","type":"ui_group","z":"","name":"commands","tab":"379a501f.53b59","disp":true,"width":"6","collapse":false},{"id":"a1c14418.954cd8","type":"ui_tab","z":"","name":"ui-table test","icon":"dashboard","disabled":false,"hidden":false},{"id":"113a4af6.0aab85","type":"ui_group","z":"","name":"ui-table Copy & Paste","tab":"a1c14418.954cd8","disp":true,"width":"17","collapse":false},{"id":"55767fb2.45a41","type":"ui_tab","z":"","name":"Home","icon":"track_changes","order":1,"disabled":false,"hidden":false},{"id":"4fbe3b18.5aa454","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"e8e983e2.70d21","type":"ui_tab","z":"","name":"Home","icon":"track_changes","order":1,"disabled":false,"hidden":false},{"id":"586a06ae.e429d8","type":"ui_tab","z":"","name":"Realtime Power","icon":"dashboard","order":9,"disabled":false,"hidden":false},{"id":"3840d6b5.4291da","type":"homie-convention-broker-config","z":0,"mqtt-host":"192.168.2.14","mqtt-port":"1883","usetls":false,"name":"mosquitto@home","homieName":"Node-RED","homieRoot":"homie","storeGlobal":true},{"id":"e6a23911.f60378","type":"homie-convention-broker-config","z":"","mqtt-host":"AH-BERLIN-0148","mqtt-port":"8883","tls":"224962c.03df19e","usetls":true,"name":"localhost@hp-spectre-360","homieName":"Node-RED","homieRoot":"homie","storeGlobal":true},{"id":"9914a8a8.6c95e8","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"[any]","propertyID":"rssi","topic":"[any]/[any]/rssi","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":199,"y":221,"wires":[["1f89b01d.03705","973ff9a3.1c5b98"],[]]},{"id":"973ff9a3.1c5b98","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":544,"y":246,"wires":[]},{"id":"1f89b01d.03705","type":"ui_chart","z":"833d7b75.5dd878","name":"","group":"8f5ef88a.50ced8","order":1,"width":0,"height":0,"label":"RSSI","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":544,"y":206,"wires":[[]]},{"id":"80476272.93daa","type":"ui_dropdown","z":"833d7b75.5dd878","name":"","label":"","tooltip":"","place":"Select option","group":"2e70a2b0.61ff8e","order":2,"width":"10","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":927,"y":544,"wires":[[]]},{"id":"331b158d.5a539a","type":"ui_text","z":"833d7b75.5dd878","group":"2e70a2b0.61ff8e","order":1,"width":"4","height":"1","name":"Label","label":"{{msg.property}}","format":"","layout":"row-spread","x":917,"y":510,"wires":[]},{"id":"79a8da8c.382984","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-02","nodeID":"Bulb","propertyID":"dimmer","topic":"RGBW-Bulb-02/Bulb/dimmer","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Dimmer","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","settable":true,"x":273,"y":663,"wires":[["e62cb7fb.c742e8","53ecce0d.af71b"],[]]},{"id":"53ecce0d.af71b","type":"ui_slider","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","tooltip":"","group":"6aae0b37.682c24","order":4,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":10,"step":1,"x":543,"y":595,"wires":[["f305a68d.980598","79a8da8c.382984"]]},{"id":"e62cb7fb.c742e8","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":663,"wires":[]},{"id":"f305a68d.980598","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":713,"y":595,"wires":[]},{"id":"811cdd9.977c92","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"System_Info","propertyID":"freeheap","topic":"[any]/System_Info/freeheap","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":234,"y":337,"wires":[["333f3981.18f326","fb0894d9.a1b7f8"],[]]},{"id":"fb0894d9.a1b7f8","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":544,"y":357,"wires":[]},{"id":"333f3981.18f326","type":"ui_chart","z":"833d7b75.5dd878","name":"","group":"8f5ef88a.50ced8","order":1,"width":0,"height":0,"label":"Free Stack","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":564,"y":317,"wires":[[]]},{"id":"b9c07e15.72b63","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-02","nodeID":"Bulb","propertyID":"switch","topic":"RGBW-Bulb-02/Bulb/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Switch","uiPlaceName":"","uiNode":"uiButtonSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#66dd33","uiColorOFF":"#f33f3f","uiColorPredicted":"#20791e","uiUseColorPredicted":true,"uiColorPredictedOff":"#9b2424","uiUseColorPredictedOff":true,"uiFormat":false,"uiTooltip":"3 state Button as Switch (off - predicted - on - predicted - off)","uiIcon1":"fa-bolt","uiIconON":"fa-lightbulb-o","uiIconOFF":"fa-bolt","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":true,"x":273,"y":544,"wires":[["5bb67a31.216244","fff82904.260238"],[]]},{"id":"fff82904.260238","type":"ui_button","z":"833d7b75.5dd878","name":"","group":"6aae0b37.682c24","order":1,"width":"7","height":"1","passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"","payload":"","payloadType":"str","topic":"","x":543,"y":476,"wires":[["b9c07e15.72b63","ee4926a1.436498"]]},{"id":"5bb67a31.216244","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":546,"y":544,"wires":[]},{"id":"ee4926a1.436498","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":713,"y":476,"wires":[]},{"id":"1b262c23.00dc14","type":"ui_button","z":"afaa0885.ad2718","name":"zurück","group":"306569d5.649c16","order":10,"width":1,"height":1,"passthru":false,"label":"","tooltip":"vorheriger Zeitpunkt","color":"","bgcolor":"","icon":"chevron_left","payload":"-1","payloadType":"num","topic":"mySettings.heating.periods.uiBack","x":186,"y":884,"wires":[["121f0029.37417"]]},{"id":"ccd7c6ba.ed0be8","type":"ui_button","z":"afaa0885.ad2718","name":"vor","group":"306569d5.649c16","order":11,"width":1,"height":1,"passthru":false,"label":"","tooltip":"nächster Zeitpunkt","color":"","bgcolor":"","icon":"chevron_right","payload":"1","payloadType":"num","topic":"mySettings.heating.periods.uiForward","x":186,"y":935,"wires":[["121f0029.37417"]]},{"id":"1c7f5200.379bae","type":"ui_numeric","z":"afaa0885.ad2718","name":"temp","label":"","tooltip":"","group":"306569d5.649c16","order":8,"width":2,"height":1,"wrap":false,"passthru":false,"topic":"mySettings.heating.periods.uiTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":220,"y":714,"wires":[["a7992ce4.43c1b","57ad0440.5441cc"]]},{"id":"57ad0440.5441cc","type":"ui_slider","z":"afaa0885.ad2718","name":"temp","label":"","tooltip":"","group":"306569d5.649c16","order":9,"width":2,"height":7,"passthru":false,"outs":"all","topic":"mySettings.heating.periods.uiTemp","min":"10","max":"32","step":"0.5","x":220,"y":663,"wires":[["a7992ce4.43c1b","1c7f5200.379bae"]]},{"id":"5268d302.225c3c","type":"ui_chart","z":"afaa0885.ad2718","name":"","group":"306569d5.649c16","order":7,"width":10,"height":8,"label":"{{msg.label}}","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#bc165c","#4bc2ef","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1206,"y":544,"wires":[["7d726f92.5ad68"]]},{"id":"dda96c22.e479b","type":"ui_dropdown","z":"afaa0885.ad2718","name":"Tag","label":"","tooltip":"","place":"Periode auswählen","group":"306569d5.649c16","order":5,"width":8,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.heating.periods.uiList","x":509,"y":391,"wires":[["f16908b5.8911a8"]]},{"id":"3deb5b65.175bc4","type":"ui_dropdown","z":"afaa0885.ad2718","name":"roomList","label":"","tooltip":"","place":"Raum auswählen","group":"306569d5.649c16","order":2,"width":8,"height":1,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"mySettings.heating.rooms.uiRoomList","x":519,"y":323,"wires":[["5c233d43.925de4"]]},{"id":"e3464ffd.e30ce","type":"ui_button","z":"afaa0885.ad2718","name":"delete","group":"306569d5.649c16","order":15,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"","payloadType":"str","topic":"mySettings.heating.periods.uiDelete","x":186,"y":833,"wires":[["f1c74f66.718cc"]]},{"id":"5fdcdfed.62831","type":"function","z":"afaa0885.ad2718","name":"room changed","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled]\n\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature curves\"};\ncUI=cUI.tempCurveEdit;\n\ncUI.roomUuid=msg.payload;\nnode.warn(msg.pathToRooms)\ncUI.roomsEntry=currentObject.getEntry(msg.pathToRooms,msg.payload);\nnode.warn(msg.topic)\ncUI.roomEntry=currentObject.getEntry(msg.topic,cUI.roomsEntry.uuid,\"roomUuid\");\nif (!cUI.roomEntry) { // room not in List\n    cUI.roomEntry=currentObject.newEntry(msg.topic,cUI.roomsEntry.name);\n    cUI.roomEntry.roomUuid=cUI.roomsEntry.uuid;\n}\n\nif (cUI.period === undefined) cUI.period=0;\nmsg.payload= cUI.period;\n\nif (cUI.roomEntry) {\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomEntry.name});\n    msg.enabled= true;\n    return [msg,ui.enabled];\n} else {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n    return[null,ui.disabled];\n}\n","outputs":2,"noerr":0,"x":879,"y":323,"wires":[["dda96c22.e479b"],[]],"outputLabels":["DayOfWeek","enabled"]},{"id":"b86b21db.c2b68","type":"function","z":"afaa0885.ad2718","name":"update chart","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload=== undefined) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nvar statusText = \"\"\nif (cUI.chart===undefined)\n    cUI.chart = [{\n    \"series\":[\"soll\",\"\",\"\"],\n    \"data\":[[],[],[]],\n    \"labels\":[\"soll\",\"cursor\",\"standard\"]\n    }];\n\nstatusText+= cUI.roomEntry.name;\nnode.status({fill:\"red\",shape:\"ring\",text:statusText});\nvar timeStamp = 0; //new Date();\nvar temp=0;\nvar time=0;\nvar timeBefore=0;\n\n// timeStamp.setHours(0,0,0);\n\nif (cUI.roomEntry && \n    cUI.periodEntry &&\n    cUI.periodEntry.list &&\n    cUI.periodEntry.list.length>0) {\n        \n    statusText+= \":\"+cUI.periodsEntry.name;\n    //sort periods by time\n    if (cUI.periodEntry.list!==undefined) {\n        cUI.periodEntry.list.sort(function(a,b) {\n            if (a.time > b.time) return 1;\n            if (a.time < b.time) return -1;\n            return 0;\n        });\n    }\n    \n    // write time array for chart\n    cUI.chart[0].data[1]=[];\n    cUI.periodEntry.list.forEach(function (period) {\n        temp=period.temp;\n        cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(timeBefore*60*1000),\"y\":temp}));\n        time=Number(period.time);\n        cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp}));\n        timeBefore=time;\n    });\n    \n    temp= cUI.periodEntry.list[0].temp;\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp,\"note\":\"end\"}));\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":temp,\"note\":\"end\"}));\n  \n    // draw default temp\n    try{\n        cUI.chart[0].data[2]=[]; // clear old data\n        cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n        cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    } catch (err) {\n        statusText+=\" no default temp\"\n        node.status({fill:\"red\",shape:\"ring\",text:statusText}); \n        return;\n    }\n    \n} else {\n    statusText+= \" no settings\";\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    cUI.chart[0].data[1].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    cUI.chart[0].data[2].push(currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":cUI.roomsEntry.defaultTemp || 24}));\n    node.status({fill:\"red\",shape:\"dot\",text:statusText}); \n    msg.payload = cUI.chart;\n    return msg;\n}\nmsg.payload = cUI.chart;\nmsg.label= cUI.roomEntry.name;\nvar msgUpdate={\n    \"payload\": \"update\",\n    \"room\": cUI.roomEntry.name,\n    \"period\": cUI.periodsEntry.name\n}\n\n\nnode.status({fill:\"green\",shape:\"dot\",text:statusText}); \nreturn [msgUpdate,msg];","outputs":2,"noerr":0,"x":801,"y":544,"wires":[["974d4be9.b36dd8"],["47938a1d.dadc94"]],"outputLabels":["update","toCursor"],"icon":"node-red-dashboard/ui_chart.png"},{"id":"47938a1d.dadc94","type":"function","z":"afaa0885.ad2718","name":"draw cursor","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled,ui.disabled]\n}\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) return [null,ui.disabled,ui.disabled];\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nif (typeof msg.payload != \"object\") cUI.tempPoint=Number(msg.payload);\nvar statusText= cUI.roomEntry.name;\nnode.status({fill:\"red\",shape:\"ring\",text:statusText});\nif (!cUI.roomEntry.name) return null;\nvar temp=0;\nvar tempB=0;\nvar timeA=0;\nvar timeB=0;\nvar msgEnablePrev={\"enabled\":false};\nvar msgEnableNext={\"enabled\":false};\nvar msgEnableDelete={\"enabled\":false};\n\nstatusText+= \":\"+cUI.periodsEntry.name+\":\"+cUI.tempPoint;\nnode.status({fill:\"yellow\",shape:\"ring\",text:statusText});\n\n// find cursor values\ntemp=cUI.periodEntry.list[cUI.tempPoint].temp;\nif (cUI.tempPoint===0) { // first\n    timeA=0;\n    timeB=cUI.periodEntry.list[cUI.tempPoint].time;\n    if (cUI.periodEntry.list[cUI.tempPoint+1]) \n        tempB=cUI.periodEntry.list[cUI.tempPoint+1].temp;\n    else \n        tempB=temp;\n} else if (cUI.tempPoint<cUI.periodEntry.list.length-1) {\n    if (cUI.tempPoint>0)\n        timeA=cUI.periodEntry.list[cUI.tempPoint-1].time;\n    else\n        timeA=0;\n    timeB=cUI.periodEntry.list[cUI.tempPoint].time;\n    tempB=cUI.periodEntry.list[cUI.tempPoint+1].temp;\n} else {\n    timeA=cUI.periodEntry.list[cUI.tempPoint-1].time;\n    timeB=cUI.periodEntry.list[cUI.tempPoint].time;\n    tempB=cUI.periodEntry.list[0].temp;\n}\n\n// control UI elements enabale/disable\nif (cUI.tempPoint>0) msgEnablePrev=ui.enabled;\nif (cUI.tempPoint<cUI.periodEntry.list.length-1) msgEnableNext= ui.enabled;\nif (cUI.periodEntry.list.length>1) msgEnableDelete= ui.enabled;\n\n// draw cursor\ncUI.chart[0].data[0]=[];\nnode.status({fill:\"yellow\",shape:\"dot\",text:\"debug:\"+statusText}); \n\ncUI.chart[0].data[0].push(currentObject.adjustTime(-1,{\"x\":(timeA*60*1000),\"y\":temp,\"note\":\"cursorA\"}));\ncUI.chart[0].data[0].push(currentObject.adjustTime(-1,{\"x\":(timeB*60*1000),\"y\":temp,\"note\":\"cursorB\"}));\nif (tempB>0) cUI.chart[0].data[0].push(currentObject.adjustTime(-1,{\"x\":(timeB*60*1000),\"y\":tempB,\"note\":\"cursorC\"}));\nmsg.payload = cUI.chart;\n\nnode.status({fill:\"green\",shape:\"dot\",text:statusText}); \nreturn [msg,msgEnablePrev,msgEnableNext,msgEnableDelete];\n","outputs":4,"noerr":0,"x":801,"y":663,"wires":[["5136c3e.e30683c"],["d899ded4.f9dff"],["52fc0b87.338624"],["e2233c7d.53701"]],"outputLabels":["","enablePrev","enableNext","enableDelete"],"icon":"node-red-dashboard/ui_chart.png"},{"id":"d4a83ce3.99bc7","type":"function","z":"afaa0885.ad2718","name":"update","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"expect cursor pos as payload\"});\n    return [null,ui.disabled];\n}\n\nif (!msg.settingsContext) msg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature curves\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry{\n    var msgOut = {\"topic\":msg.topic,\"socketid\":msg.socketid,\"settingsContext\":msg.settingsContext}; // create new message because it will be cloned (split of paths)\n\n    if (cUI.tempPoint>cUI.periodEntry.list.length-1) cUI.tempPoint=cUI.periodEntry.list.length-1;\n    msgOut.payload=cUI.tempPoint;\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomEntry.name+\"/\"+cUI.periodEntry.name+\" (\"+ cUI.tempPoint +\"/\"+ (cUI.periodEntry.list.length-1) +\")\"});\n    return [msgOut,ui.enabled];\n}\ncatch (err) {\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"no periods defined\"});\n}","outputs":1,"noerr":0,"x":577,"y":782,"wires":[["b86b21db.c2b68","a70c51b5.99fd4","aa4dedd.2c2011"]]},{"id":"aa4dedd.2c2011","type":"function","z":"afaa0885.ad2718","name":"updateTemp","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled];\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) return null;\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry {\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n\n    msg.payload= currentEntry.temp;\n    msg.ui_control={\"min\":cUI.roomsEntry.minTemp,\"max\":cUI.roomsEntry.maxTemp};\n\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.periodEntry.name+\"=\"+currentEntry.temp+\" °C\"});\n    return msg;\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"updateTemp failed (\"+cUI.tempPoint+\")\"});\n    node.error(\"updateTemp failed\")\n}","outputs":1,"noerr":0,"x":801,"y":833,"wires":[["3276e425.a62e7c"]]},{"id":"121f0029.37417","type":"function","z":"afaa0885.ad2718","name":"move cursor","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\n\ntry{\n    cUI.tempPoint=cUI.tempPoint+Number(msg.payload);\n    if (cUI.tempPoint<0) \n        cUI.tempPoint=0;\n    if (cUI.tempPoint>cUI.periodEntry.list.length-1)\n        cUI.tempPoint=cUI.periodEntry.list.length-1\n    msg.payload=cUI.tempPoint;\n    node.status({fill:\"green\",shape:\"dot\",text:\"move to pos=\"+cUI.tempPoint});\n    return msg;\n} catch (err) {\n    node.error(\"moveCursor failed\");\n    node.status({fill:\"red\",shape:\"dot\",text:\"moveCursor failed\"});\n}","outputs":1,"noerr":0,"x":359,"y":884,"wires":[["d4a83ce3.99bc7"]]},{"id":"f9d7b245.0bff4","type":"link in","z":"afaa0885.ad2718","name":"uiDelete","links":["e2233c7d.53701","fc5cf126.b689a"],"x":100,"y":833,"wires":[["e3464ffd.e30ce"]]},{"id":"a70c51b5.99fd4","type":"function","z":"afaa0885.ad2718","name":"updateTime","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return null;\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) return null;\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry {\n    var timeBefore=0;\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint-1)\n    if (currentEntry) timeBefore= currentEntry.time || 0;\n\n    var timeNext=1440;\n    currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint+1)\n    if (currentEntry) timeNext= currentEntry.time || 1440;\n    \n    currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint)\n\n    if (currentEntry) {\n        msg.payload= currentEntry.time;\n        msg.ui_control={min: timeBefore, max: timeNext};\n    \n        node.status({fill:\"green\",shape:\"dot\",text:cUI.periodEntry.name+\" \"+currentEntry.time+\" min (\"+cUI.tempPoint+\")\"});\n        if (cUI.periodEntry.list.length>1) msg.enabled= true;\n            else msg.enabled= false;\n            \n        return msg;\n    } else {\n        node.status({fill:\"red\",shape:\"dot\",text:cUI.periodEntry.name+\":\"+cUI.tempPoint+\" undefined\"});\n    }\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"updateTime failed (\"+cUI.tempPoint+\")\"});\n}","outputs":1,"noerr":0,"x":801,"y":782,"wires":[["73dbe81a.6afdf8"]],"outputLabels":["hour"]},{"id":"f1c74f66.718cc","type":"function","z":"afaa0885.ad2718","name":"delete schedule","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nvar statusText= cUI.roomsEntry.name;\nnode.status({fill:\"yellow\",shape:\"dot\",text:statusText});\n\nif (cUI.periodEntry.list.length>1)\n    currentObject.deleteEntry(cUI.periodEntry, cUI.tempPoint);\nif (cUI.tempPoint>cUI.periodEntry.list.length-1) cUI.tempPoint=cUI.periodEntry.list.length-1;\nif (cUI.periodEntry.list.length==1) cUI.periodEntry.list[0].time=1440;\n\nstatusText+=\"=\"+cUI.periodEntry.list.length+\" periods\";\nnode.status({fill:\"green\",shape:\"dot\",text:statusText});\nreturn msg;","outputs":1,"noerr":0,"x":369,"y":833,"wires":[["d4a83ce3.99bc7"]]},{"id":"e622d8ea.78e168","type":"ui_slider","z":"afaa0885.ad2718","name":"moveTime","label":"","tooltip":"","group":"306569d5.649c16","order":12,"width":6,"height":1,"passthru":true,"outs":"all","topic":"mySettings.heating.periods.uiTimeSlider","min":"0","max":"1440","step":"5","x":206,"y":544,"wires":[["7f497259.95751c","b6acc0d6.952bd"]]},{"id":"7f497259.95751c","type":"function","z":"afaa0885.ad2718","name":"newTime","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\n\ntry {\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n    if (currentEntry.time!=Number(msg.payload)) {\n        currentEntry.time= Number(msg.payload);\n\n        node.status({fill:\"green\",shape:\"dot\",text:currentEntry.time+\" min\"});\n        return msg;\n    } else {\n        node.status({fill:\"yellow\",shape:\"dot\",text:currentEntry.time+\" min unchanged\"});\n    }\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"updateTime failed\"});\n}","outputs":1,"noerr":0,"x":400,"y":544,"wires":[["b86b21db.c2b68"]],"outputLabels":["minutes"],"icon":"font-awesome/fa-clock-o"},{"id":"8335dee3.41e66","type":"ui_button","z":"afaa0885.ad2718","name":"insert","group":"306569d5.649c16","order":14,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"add_box","payload":"1","payloadType":"num","topic":"mySettings.heating.periods.uiInsert","x":186,"y":782,"wires":[["5b7a086c.f4e288"]]},{"id":"7e57e861.993338","type":"link in","z":"afaa0885.ad2718","name":"Enable Details","links":["67ba3ed2.70bad"],"x":100,"y":782,"wires":[["8335dee3.41e66"]]},{"id":"5b7a086c.f4e288","type":"function","z":"afaa0885.ad2718","name":"insert schedule","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry {\n    var timeBefore=0;\n    var currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint-1)\n    if (currentEntry) timeBefore= currentEntry.time || 0;\n   \n    currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n    var temp= currentEntry.temp;\n    var time= currentEntry.time;\n    var entry= currentObject.insertItemLeft(cUI.periodEntry,cUI.tempPoint);\n    entry.time= timeBefore+Math.floor((time-timeBefore)/2);\n    entry.temp= temp;\n    \n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomsEntry.name+\"=\"+cUI.periodEntry.list.length+\" periods\"});\n    return msg;\n} catch (err) {\n    node.error(\"moveCursor failed\");\n    node.status({fill:\"red\",shape:\"dot\",text:\"moveCursor failed\"});\n}","outputs":1,"noerr":0,"x":369,"y":782,"wires":[["d4a83ce3.99bc7"]]},{"id":"a7992ce4.43c1b","type":"function","z":"afaa0885.ad2718","name":"newTemp","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (!msg.payload) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature presets\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\nvar currentEntry= currentObject.getEntryByIndex(cUI.periodEntry,cUI.tempPoint);\n\nif (currentEntry && currentEntry.temp) {\n    if (currentEntry.temp!= Number(msg.payload)) {\n        currentEntry.temp= Number(msg.payload);\n        node.status({fill:\"green\",shape:\"dot\",text:cUI.tempPoint+\"=\"+msg.payload+\"°C\"});\n        msg.payload=cUI.tempPoint;\n        return msg;\n    }\n} else {\n    node.error(\"newTemp failed\");\n    node.status({fill:\"red\",shape:\"dot\",text:\"newTemp failed\"});\n}","outputs":1,"noerr":0,"x":400,"y":663,"wires":[["b86b21db.c2b68"]]},{"id":"f29c0d3d.112fa","type":"link in","z":"afaa0885.ad2718","name":"new Room","links":["8dd67254.ead3a","f64f8db5.e2ea"],"x":440,"y":731,"wires":[["d4a83ce3.99bc7"]]},{"id":"b6acc0d6.952bd","type":"function","z":"afaa0885.ad2718","name":"hh:mm","func":"var minutes=msg.payload;\nvar hourString=\"00\"+Math.floor(minutes/60);\nvar minuteString=\"00\"+minutes % 60;\nmsg.payload=hourString.substr(-2)+\":\"+minuteString.substr(-2);\nnode.status({fill:\"green\",shape:\"dot\",text: minutes+\"=\"+msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":595,"wires":[["bf96e9aa.4cea28"]],"inputLabels":["minutes"],"outputLabels":["h"],"icon":"font-awesome/fa-clock-o"},{"id":"bf96e9aa.4cea28","type":"ui_text","z":"afaa0885.ad2718","group":"306569d5.649c16","order":13,"width":2,"height":1,"name":"hh:mm","label":"","format":"{{msg.payload}}","layout":"col-center","x":509,"y":595,"wires":[]},{"id":"1f0cbb5.81b0045","type":"function","z":"afaa0885.ad2718","name":"Periods changed","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.payload === undefined) return [null,ui.disabled];\n\nmsg.settingsContext=msg.topic.slice(0,msg.topic.indexOf('.'));\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nnode.status({fill:\"yellow\",shape:\"dot\",text: msg.topic+\"/\"+msg.payload});\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) {\n    node.status({fill:\"red\",shape:\"dot\",text: \" UI not initialized\"});\n    return [null,ui.disabled]\n}\ncUI=cUI.tempCurveEdit;\n\ncUI.periodUuid=msg.payload;\ncUI.periodsEntry=currentObject.getEntry(msg.pathToPeriods,cUI.periodUuid); // get period entry for selected period\ncUI.periodEntry=currentObject.getEntry(cUI.roomEntry,cUI.periodsEntry.uuid,\"periodUuid\"); // get period entry for this room\nif (!cUI.periodEntry) { // period not in List - create new entry\n    cUI.periodEntry=currentObject.newEntry(cUI.roomEntry,cUI.periodsEntry.uuid);\n    cUI.periodEntry.periodUuid=cUI.periodsEntry.uuid;\n}\n\ncUI.periodEntry.name=cUI.periodsEntry.name;\n\n// set first point in temp curve to default if not existant\nif (!cUI.periodEntry.list) cUI.periodEntry.list=[];\nif (cUI.periodEntry.list.length<1) {\n    cUI.periodEntry.list.push({\"time\":1440,\"temp\":cUI.roomsEntry.defaultTemp});\n}\ncUI.tempPoint=0;\n\nif (cUI.periodEntry) {\n    node.status({fill:\"green\",shape:\"dot\",text:cUI.roomEntry.name + \"/\" + cUI.periodEntry.name});\n    return [msg,ui.enabled];\n} else {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n    return [null,ui.disabled];\n}","outputs":2,"noerr":0,"x":889,"y":391,"wires":[["f64f8db5.e2ea","b1a8e1f2.ea1e5"],[]],"outputLabels":["DayOfWeek","enabled"]},{"id":"f64f8db5.e2ea","type":"link out","z":"afaa0885.ad2718","name":"update Chart","links":["f29c0d3d.112fa"],"x":1035,"y":357,"wires":[]},{"id":"5136c3e.e30683c","type":"function","z":"afaa0885.ad2718","name":"label & limits","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.settingsContext});\n    return [null,ui.disabled]\n}\n\n// get currentUI settings\nvar cUI = currentObject.getUI(msg.socketid);\nif (!cUI.tempCurveEdit) cUI.tempCurveEdit={\"name\":\"Edit temperature curves\"};\ncUI=cUI.tempCurveEdit;\n\n// --------------- end of UI header ---------------------\n\ntry{\n    msg.label=cUI.roomEntry.name+\" (\"+cUI.periodEntry.name+\")\";\n    msg.room=cUI.roomEntry.name;\n    msg.roomID=cUI.roomEntry.uuid;\n    msg.period=cUI.periodEntry.name;\n    msg.periodID=cUI.periodEntry.uuid;\n    msg.ui_control={};\n    msg.ui_control.ymin=cUI.roomsEntry.minTemp;\n    msg.ui_control.ymax=cUI.roomsEntry.maxTemp;\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not find temp limits\"});\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1022,"y":595,"wires":[["5268d302.225c3c"]],"outputLabels":["minutes"],"icon":"font-awesome/fa-clock-o"},{"id":"3404a4d4.23919c","type":"function","z":"c4a7cd6c.2a0c1","name":"set editPeriod","func":"if (!msg.payload) return;\nvar topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\n\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n}\n\n    if (currentObject.isUuid(msg.payload)) {\n        var currentEntry=currentObject.getEntry(currentProperty,msg.payload);\n        if (currentEntry && currentEntry.hasOwnProperty(\"name\")) {\n            currentProperty.uiPointer=currentObject.getIndexOfEntry(currentProperty,msg.payload);\n            currentProperty.uiPointerUuid=msg.payload;\n            msg.index=currentProperty.uiPointer;\n            return [{payload:{fill:\"green\",shape:\"dot\",text:currentEntry.name+\" (\"+currentProperty.uiPointer+\" by uuid)\"}},msg];\n        } else {\n            return [{payload:{fill:\"red\",shape:\"dot\",text:\"uuid not found\"}},currentEntry];\n        }\n    } else {\n        currentProperty.uiPointer=Number(msg.payload);\n        currentProperty.uiPointerUuid=currentObject.getUuidByName(currentProperty,msg.payload);\n        msg.index=Number(msg.payload);\n        return [{payload:{fill:\"green\",shape:\"dot\",text:currentProperty.list[currentProperty.uiPointer].name+\" (\"+msg.payload+\")\"}},msg];\n    }\ntry {\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"}},null];\n} ","outputs":2,"noerr":0,"x":200,"y":80,"wires":[[],[]],"outputLabels":["status","standard"]},{"id":"1ff3f5ad.ab0eca","type":"function","z":"dfa4352b.bdc548","name":"save Data","func":"var currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar currentProperty=currentObject.getCurrentEntry(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text: msg.topic+\" not found\"}},null];\n}\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\n\ntry {\n    // make shure your topic is set correctly in your ui nodes(s): objectName.propertyName\n    msg.property=currentProperty;\n    if (!currentProperty.hasOwnProperty(propertyName) || currentProperty[propertyName]!=msg.payload) {\n        currentProperty[propertyName]=msg.payload;\n        msg.action=\"updateUI\";\n        return [{payload:{fill:\"green\",shape:\"dot\",text:propertyName+\"=\"+msg.payload+\"!\"}},msg];\n    } else {\n        return [{payload:{fill:\"yellow\",shape:\"dot\",text:propertyName+\" unchanged (\"+msg.payload+\")\"}},null];\n    }\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"}},null];\n} ","outputs":2,"noerr":0,"x":200,"y":80,"wires":[[],[]],"outputLabels":["status","update"],"icon":"font-awesome/fa-database"},{"id":"6a775fab.082ab","type":"function","z":"d4a0d961.b11238","name":"delete period","func":"if (msg.payload==env.get(\"cancel\")) return;\nnode.status({});\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar currentProperty=currentObject.getCurrentEntry(msg.topic);\nif (!currentProperty) {\n    return[{payload:{fill:\"red\",shape:\"dot\",text: msg.topic+\" not found\"}},null];\n}\nvar name=currentProperty.name;\n\ntry {\n    if (currentObject.deleteEntry(msg.topic)) {\n        return [{payload:{fill:\"green\",shape:\"dot\",text:name+\" deleted\"}},msg];\n    } else {\n        return [{payload:{fill:\"green\",shape:\"dot\",text:name+\" NOT deleted\"}},null];\n    }\n    return msg;\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, something gone wrong.\"}},null];\n} ","outputs":2,"noerr":0,"x":190,"y":80,"wires":[[],[]],"outputLabels":["status","standard"]},{"id":"7745479f.ddca48","type":"function","z":"30d3b36b.8d171c","name":"updateUi","func":"var msgDropdown={};\nvar msgName={};\nvar msgList={};\nvar msgParameter=[];\n\nvar topicParts=msg.topic.split('.');\n\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return [{payload:{fill:\"red\",shape:\"dot\",text:topicParts[0]+\" not found\"}},null,null];\nvar keyword = topicParts.pop();\nmsg.item=keyword;\nvar propertyTopic = msg.topic.slice(0,msg.topic.lastIndexOf('.'));\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null,null];\n}\n\nmsgDropdown.topic=msg.topic;\n\n//try {\n    \n    // get uiControl config\n    var uiControlJson= env.get(\"uiControl\");\n    var uiControl={};\n    if (uiControlJson) {\n//        node.warn(\"step 1\");\n//        node.warn(uiControl);\n        for (var criteria in uiControlJson) { \n//            node.warn(currentProperty.list[currentProperty.uiPointer]);\n//            node.warn(currentProperty.list[currentProperty.uiPointer].hasOwnProperty(criteria));\n            if (currentProperty.list[currentProperty.uiPointer].hasOwnProperty(criteria)) {\n                currentObject.merge(uiControl,uiControlJson[criteria][currentProperty.list[currentProperty.uiPointer][criteria]])\n            }\n        }\n//        node.warn(uiControl)\n    }\n\n    // fill an array for all parameters in list if existing\n    if (currentProperty.list) {\n//        node.warn(\"step 2\");\n//        node.warn(uiControl);\n        for (var item in currentProperty.list[currentProperty.uiPointer]) {\n            if (!item.startsWith('ui'))\n                if (uiControl.hasOwnProperty(item)) { // add uiControl if matches criteria\n                    currentObject.merge(uiControl[item],{\"payload\":currentProperty.list[currentProperty.uiPointer][item], \"topic\": propertyTopic+'.'+item, \"item\": item});\n                    msgParameter.push(uiControl[item]);\n                } else {\n                    msgParameter.push({\"payload\":currentProperty.list[currentProperty.uiPointer][item], \"topic\": propertyTopic+'.'+item, \"item\": item});\n                }\n        }\n//        node.warn(uiControl)\n//        node.warn(msgParameter)\n    }\n \n    switch (keyword) {\n        case \"uiDropdown\":\n            // update all parameters\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"Dropdown updated!\"}},null,msgParameter];\n        case \"uiAdd\":\n            msgDropdown.payload=currentProperty.uiPointer;\n            // update only dropdown, parametes will follow next call\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"new entry nr=\"+currentProperty.uiPointer}},msgDropdown,null];\n        case \"uiDelete\":\n            msgDropdown.payload=\"init\"; \n            // update only dropdown, parametes will follow next call\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"entry deleted\"}},msgDropdown,null];\n        case \"name\":\n            msgDropdown.payload=currentProperty.uiPointer;\n            // update only dropdown\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"entry renamed!\"}},msgDropdown,null];\n    }\n    if (msg.action && msg.action==\"updateUI\") {\n//        node.warn(msg.item);\n        if (uiControlJson.hasOwnProperty(msg.item)) { // add uiControl if changed value matches criteria\n            return [{payload:{fill:\"green\",shape:\"dot\",text:msg.item+\"=\"+msg.payload}},null,msgParameter];\n        } else {\n            return [{payload:{fill:\"green\",shape:\"dot\",text:msg.item+\"=\"+msg.payload}},null,msg];\n        }\n    } else\n        return [{payload:{fill:\"gray\",shape:\"dot\",text:msg.topic+\"=\"+msg.payload}},null,null];\n/*} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong. (\"+keyword+\")\"}},null,null];\n} \n*/","outputs":3,"noerr":0,"x":179,"y":85,"wires":[[],[],[]],"outputLabels":["status","updateDropdown","updateElements"]},{"id":"9d13774f.8dc838","type":"function","z":"8ba1eff6.75a11","name":"fillDropdown","func":"var customTopic=env.get(\"customTopic\");\nif (customTopic) msg.topic= customTopic;\n\n// prepare filter: 1) node.store 2) send by msg 3) set by config\nvar filter= context.get(\"filter\");\nif (msg.hasOwnProperty(\"filterProperty\") && msg.hasOwnProperty(\"filterValue\")) {\n    filter= {\n        \"property\": msg.filterProperty,\n        \"value\": msg.filterValue\n    }\n    //if (filter.property!==\"\") node.warn(\"filter from msg\");\n} else if (env.get(\"filterPropety\") && env.get(\"filterValue\")) {\n    filter= {\n        \"property\": env.get(\"filterProperty\"),\n        \"value\": env.get(\"filterValue\")\n    }\n    //if (filter.property!==\"\") node.warn(\"filter from node Context\");\n} else {\n    filter= {\n        \"property\": \"\",\n        \"value\": \"\"\n    }\n    //node.warn(\"no Filter\");\n}\ncontext.set(\"filter\",filter)\n//if (filter.property!==\"\") node.warn(filter);\n\nvar topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\nvar keyword = topicParts.pop();\n//node.warn(msg.topic);\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n}\n\n//node.warn(currentProperty)\n\n    if (currentProperty.list!==undefined) {\n\n        var sortedList=currentObject.saveSort(currentProperty.list);\n        msg.options=[];\n        sortedList.forEach(function(item){\n            // node.warn(item);\n            if ((filter.property===\"\" && filter.value===\"\") || (item[filter.property]===filter.value)) {\n                if (item.hasOwnProperty(\"name\") &&\n                    item.hasOwnProperty(\"uuid\")) msg.options.push({[item.name]:item.uuid});\n            }\n        })\n        \n        if (msg.payload===\"\") {\n            \n        } else if (currentObject.isUuid(msg.payload)) { // select entry provided by msg.payload (uuid)\n            if (!currentObject.entryExists(currentProperty,msg.payload)) {\n                delete msg.payload; // item not in list\n            } else {\n                currentProperty.uiPointerUuid=msg.payload;  \n            }\n        } else if (typeof msg.payload===\"number\" && msg.payload<currentProperty.list.length) { // by msg payload (index)\n            currentProperty.uiPointerUuid=currentProperty.list[msg.payload].uuid;\n            msg.payload=currentProperty.uiPointerUuid;\n        } else if (!currentProperty.list[currentProperty.uiPointer]) {\n            if (currentProperty.list.length>0){ // or first Entry\n                currentProperty.uiPointer=0; // reset to first\n                currentProperty.uiPointerUuid=currentProperty.list[0].uuid;\n                msg.payload=currentProperty.uiPointerUuid;\n            } else { // item not in List, give up\n                delete msg.payload;\n            }\n        } else { // by uiPointer \n            // send uuid instead index\n            currentProperty.uiPointerUuid=currentProperty.list[currentProperty.uiPointer].uuid;\n            msg.payload=currentProperty.uiPointerUuid;\n        }\n        return [{payload:{fill:\"green\",shape:\"dot\",text:\"done!\"}},msg];\n    } else {\n        return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"object.list empty\"}},null];\n    }\ntry {\n} catch (err) {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"No list entry\"}},null];\n}","outputs":2,"noerr":0,"x":190,"y":80,"wires":[[],[]],"outputLabels":["status","dropdownUi"]},{"id":"c50c7cfb.369ab","type":"link in","z":"afaa0885.ad2718","name":"Raumliste","links":["3e96545a.6496cc","2d70dbd3.249b94","c42ef6ca.d72a58","7501fdd.b420b04","8ee11259.a6efb"],"x":236,"y":323,"wires":[["a4cb6fd6.eb046"]]},{"id":"cee4b8dd.5e4678","type":"link in","z":"afaa0885.ad2718","name":"Periodenliste","links":["21638ecb.172702","8ca231d8.0d419"],"x":236,"y":391,"wires":[["927bddbd.48dca"]]},{"id":"4eef4b8f.b402d4","type":"ui_text","z":"afaa0885.ad2718","group":"306569d5.649c16","order":1,"width":2,"height":1,"name":"Raum:","label":"Raum:","format":"{{msg.payload}}","layout":"row-spread","x":138,"y":322,"wires":[]},{"id":"15a32a2b.41e616","type":"ui_text","z":"afaa0885.ad2718","group":"306569d5.649c16","order":4,"width":2,"height":1,"name":"Periode:","label":"Periode:","format":"{{msg.payload}}","layout":"row-spread","x":145,"y":391,"wires":[]},{"id":"ea0578f.f595788","type":"function","z":"e0e09953.42b938","name":"initializeUi","func":"let globalContext= env.get(\"globalContext\");\nlet baseObject= env.get(\"baseObject\");\nlet uiElement= env.get(\"uiElement\");\n\nmsg.topic= globalContext+'.'+baseObject+'.'+uiElement;\nmsg.filterProperty= env.get(\"filterProperty\");\nmsg.filterValue= env.get(\"filterValue\");\nvar topicParts= \"\";\n\ntry {\n    topicParts=msg.topic.split('.');\n} catch (err) {\n    return [null,{payload: {fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"}}];\n}\nif (topicParts.length<3) {\n    return [null,{payload: {fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"}}];\n}\n\n// get or initalize root for global store\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text:\"could not find: \"+globalContext}},null];\n}\n\n// get or initialize base Object\ncurrentObject= currentObject.getObject(msg.topic);\nif (!currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic}},null];\n} else {\n    return [{payload: {fill:\"green\",shape:\"dot\",text:baseObject}},msg];\n}\n","outputs":2,"noerr":0,"x":180,"y":80,"wires":[[],[]],"outputLabels":["status","standard"]},{"id":"51c4d926.279bc8","type":"function","z":"e0e53645.d85fd8","name":"add new","func":"var currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar defaults=env.get(\"defaults\");\nif (!defaults) {\n    node.error(\"sub[add new] failed, no defaults defined \"+msg.payload+\" to: \"+ msg.topic);\n    return [{payload:{fill:\"red\",shape:\"dot\",text: \"defaults not defined!\"}},null];\n}\n\n// create a new List Entry\nif (!currentObject.entryExists(msg.topic,msg.payload,\"name\")) {\n    var currentEntry= currentObject.newEntry(msg.topic,msg.payload);\n    if (currentEntry) {\n        currentObject.merge(currentEntry,defaults); // merge defaults from subflow config\n        if (msg.hasOwnProperty(\"defaults\")) currentObject.merge(currentEntry,msg.defaults); // merge defaults from msg\n        msg.payload=currentEntry.uuid;\n    \n        return [{payload:{fill:\"green\",shape:\"dot\",text:currentEntry.name+\" saved\"}},msg];\n    } else {\n        node.error(\"sub[add new] failed to add \"+msg.payload+\" to: \"+ msg.topic);\n        return [{payload:{fill:\"red\",shape:\"dot\",text:\"failed to add \"+msg.payload+\" to: \"+ msg.topic}},null];\n    }\n} else {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text:msg.payload+\" allready exists\"}},null];\n}","outputs":2,"noerr":0,"x":200,"y":80,"wires":[[],[]],"outputLabels":["status","standard"],"icon":"font-awesome/fa-plus-square"},{"id":"5c233d43.925de4","type":"change","z":"afaa0885.ad2718","name":"pathToRooms","rules":[{"t":"set","p":"pathToRooms","pt":"msg","to":"mySettings.rooms.name","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":692,"y":323,"wires":[["5fdcdfed.62831"]]},{"id":"927bddbd.48dca","type":"change","z":"afaa0885.ad2718","name":"del payload","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":359,"y":391,"wires":[["dda96c22.e479b"]]},{"id":"a4cb6fd6.eb046","type":"change","z":"afaa0885.ad2718","name":"del payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":359,"y":323,"wires":[["3deb5b65.175bc4"]]},{"id":"b1a8e1f2.ea1e5","type":"debug","z":"afaa0885.ad2718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":391,"wires":[]},{"id":"f16908b5.8911a8","type":"change","z":"afaa0885.ad2718","name":"pathToRooms","rules":[{"t":"set","p":"pathToRoom","pt":"msg","to":"mySettings.heating.rooms.name","tot":"str"},{"t":"set","p":"pathToPeriods","pt":"msg","to":"mySettings.heating.periods.name","tot":"str"},{"t":"set","p":"pathToRooms","pt":"msg","to":"mySettings.rooms.name","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":692,"y":391,"wires":[["1f0cbb5.81b0045"]]},{"id":"4eea0d2d.491f14","type":"ui_worldmap","z":"9b61ce87.2ae62","group":"234ff31e.1bc3cc","order":0,"width":"15","height":"11","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"hide","layers":"hide","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"true","coords":"none","showgrid":"false","path":"/worldmap","x":400,"y":140,"wires":[]},{"id":"73dbe81a.6afdf8","type":"link out","z":"afaa0885.ad2718","name":"newTime","links":["cfa0b157.c2ba8"],"x":967,"y":782,"wires":[]},{"id":"cfa0b157.c2ba8","type":"link in","z":"afaa0885.ad2718","name":"newTime","links":["73dbe81a.6afdf8","7c671be4.4c5d04"],"x":100,"y":544,"wires":[["e622d8ea.78e168"]]},{"id":"c87c4075.3cbcb","type":"link in","z":"afaa0885.ad2718","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":831,"y":493,"wires":[["a11f3381.e27d8"]]},{"id":"2c5f476c.d63d28","type":"function","z":"afaa0885.ad2718","name":"delete tempCurveEdit","func":"node.status({});\nvar currentSettings = flow.get(\"currentSettings\");\nif (!currentSettings || !currentSettings.tempCurveEdit){\n    node.status({fill:\"red\",shape:\"dot\",text:\"currentSettings.tempCurveEdit missing!\"});\n    return null;   \n}\ntry {\n    delete currentSettings.tempCurveEdit;\n    node.status({fill:\"green\",shape:\"dot\",text:\"currentSettings.tempCurveEdit deleted!\"});\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not delete currentSettings.tempCurveEdit!\"});\n}\nreturn msg;","outputs":1,"noerr":0,"x":389,"y":255,"wires":[[]]},{"id":"e1a3f1e7.b946f","type":"link in","z":"afaa0885.ad2718","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":236,"y":255,"wires":[["2c5f476c.d63d28","2bd077d3.9f45c8"]]},{"id":"a11f3381.e27d8","type":"function","z":"afaa0885.ad2718","name":"clear UI","func":"msg.label=\"Temperaturverlauf\"\nmsg.payload=[];\n\nreturn msg;","outputs":1,"noerr":0,"x":1012,"y":493,"wires":[["5268d302.225c3c"]]},{"id":"2bd077d3.9f45c8","type":"debug","z":"afaa0885.ad2718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":339,"y":204,"wires":[]},{"id":"54e7856d.fb36ec","type":"file in","z":"679df911.24a188","name":"","filename":"C:\\\\Users\\\\cmeinert\\\\Documents\\\\GitHub\\\\node-red-contrib-homie-convention-debug\\\\dumps\\\\dump.txt","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":480,"y":140,"wires":[["aacd3eef.d0d16"]]},{"id":"4f989710.939d18","type":"debug","z":"679df911.24a188","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1050,"y":200,"wires":[]},{"id":"3d84def.665ce22","type":"inject","z":"679df911.24a188","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":80,"wires":[["54e7856d.fb36ec"]]},{"id":"aacd3eef.d0d16","type":"function","z":"679df911.24a188","name":"split","func":"var posSpace= msg.payload.indexOf(\" \");\nmsg.topic= msg.payload.substr(0,posSpace);\nmsg.payload= msg.payload.substr(posSpace+1);\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":140,"wires":[["4f989710.939d18","bda34faa.57ead"]]},{"id":"bda34faa.57ead","type":"mqtt out","z":"679df911.24a188","name":"","topic":"","qos":"2","retain":"true","broker":"7ef5ea17.178a64","x":1050,"y":140,"wires":[]},{"id":"39ae9afa.4bf6b6","type":"homie-convention-device","z":"679df911.24a188","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"[any]","propertyID":"uptime","topic":"[any]/[any]/uptime","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device","labelTopic":true,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":true,"uiControlMinMax":false,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":130,"y":360,"wires":[["10171cd7.050b33"],[]]},{"id":"3596694a.e9f8d6","type":"homie-convention-device","z":"679df911.24a188","broker":"e6a23911.f60378","name":"","deviceID":"a4cf12250ffc","nodeID":"doser","propertyID":"dose","topic":"a4cf12250ffc/doser/dose","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"device/node/property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiText","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":true,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":410,"y":500,"wires":[["dab41f33.6649b","a46f524.6bed8b"],["44ce44b4.f5218c"]]},{"id":"dab41f33.6649b","type":"debug","z":"679df911.24a188","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":440,"wires":[]},{"id":"44ce44b4.f5218c","type":"debug","z":"679df911.24a188","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":540,"wires":[]},{"id":"13044583.6a38da","type":"inject","z":"679df911.24a188","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":500,"wires":[["3596694a.e9f8d6"]]},{"id":"10171cd7.050b33","type":"ui_chart","z":"679df911.24a188","name":"","group":"50ef20f5.7d4f8","order":0,"width":0,"height":0,"label":"Uptime","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":332,"y":340,"wires":[[]]},{"id":"a46f524.6bed8b","type":"ui_text","z":"679df911.24a188","group":"61b56b5f.f16754","order":0,"width":0,"height":0,"name":"","label":"{{msg.label}}","format":"{{msg.payload}}","layout":"row-spread","x":650,"y":480,"wires":[]},{"id":"b615ecab.41005","type":"link in","z":"afaa0885.ad2718","name":"uiBack","links":["d899ded4.f9dff"],"x":100,"y":884,"wires":[["1b262c23.00dc14"]]},{"id":"4264471a.b28b38","type":"link in","z":"afaa0885.ad2718","name":"uiNext","links":["52fc0b87.338624"],"x":100,"y":935,"wires":[["ccd7c6ba.ed0be8"]]},{"id":"d899ded4.f9dff","type":"link out","z":"afaa0885.ad2718","name":"msgEnablePrev","links":["b615ecab.41005"],"x":967,"y":629,"wires":[]},{"id":"52fc0b87.338624","type":"link out","z":"afaa0885.ad2718","name":"msgEnableNext","links":["4264471a.b28b38"],"x":967,"y":663,"wires":[]},{"id":"21bb58f8.ca7b08","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"3840d6b5.4291da","name":"","deviceID":"RGBW-Bulb-02","nodeID":"Bulb","propertyID":"eventHSV","topic":"RGBW-Bulb-02/Bulb/eventHSV","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Light Color","uiPlaceName":"","uiNode":"uiColor","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#f4cf39","uiBgColor1":"#c0c0c0","uiColorON":"#f0610b","uiColorOFF":"#3f3f3f","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"Switch Light","uiIcon1":"fa-bolt","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":true,"uiSwitchColorPredictedON":"#a4a4a4","uiSwitchColorPredictedOFF":"#9b9b9b","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"nodeRedObject","settable":false,"x":283,"y":782,"wires":[["9124023b.3c87f","7935a593.dc18bc"],[]]},{"id":"9124023b.3c87f","type":"ui_colour_picker","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","group":"6aae0b37.682c24","format":"hsv","outformat":"object","showSwatch":true,"showPicker":true,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":4,"width":"10","height":"1","passthru":false,"topic":"","x":563,"y":714,"wires":[["21bb58f8.ca7b08"]]},{"id":"7935a593.dc18bc","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":782,"wires":[]},{"id":"e2233c7d.53701","type":"link out","z":"afaa0885.ad2718","name":"msgEnableDelete","links":["f9d7b245.0bff4"],"x":967,"y":697,"wires":[]},{"id":"9211ec38.5bb63","type":"ui_chart","z":"afaa0885.ad2718","name":"","group":"9ce06846.951a68","order":6,"width":8,"height":6,"label":"{{msg.label}}","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#f3bb12","#4bc2ef","#92877c","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":866,"y":1122,"wires":[[]]},{"id":"7d726f92.5ad68","type":"debug","z":"afaa0885.ad2718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1325,"y":544,"wires":[]},{"id":"7e7bc1cc.55ff6","type":"function","z":"6e9d1a04.cba814","name":"buildChart","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nmsg.currentObject= global.get(msg.globalContext,\"file\");\nif (!msg.currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.globalContext}},ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\nvar statusText = \"\"\n\nvar cRoom=msg.roomEntry;\nvar cPeriod=msg.periodEntry;\n\nif (cRoom.chart===undefined)\n    cRoom.chart = [{\n    \"series\":[\"ist\",\"soll\",\"\"],\n    \"data\":[[],[],[]],\n    \"labels\":[\"ist\",\"soll\",\"standard\"]\n    }];\n\nstatusText+= msg.roomEntry.name;\n\nvar timeStamp = 0; //new Date();\nvar temp=0;\nvar time=0;\nvar timeBefore=0;\n\n// timeStamp.setHours(0,0,0);\n\nif (cRoom && \n    cPeriod &&\n    cPeriod.list &&\n    cPeriod.list.length>0) {\n        \n    statusText+= \":\"+cPeriod.name;\n    //sort periods by time\n    if (cPeriod.list!==undefined) {\n        cPeriod.list.sort(function(a,b) {\n            if (a.time > b.time) return 1;\n            if (a.time < b.time) return -1;\n            return 0;\n        });\n    }\n    \n    // write time array for chart\n    cRoom.chart[0].data[1]=[];\n    cPeriod.list.forEach(function (period) {\n        temp=period.temp;\n        cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(timeBefore*60*1000),\"y\":temp}));\n        time=Number(period.time);\n        cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp}));\n        timeBefore=time;\n    });\n    \n    temp= cPeriod.list[0].temp;\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(time*60*1000),\"y\":temp,\"note\":\"end\"}));\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":temp,\"note\":\"end\"}));\n  \n    // draw default temp\n    try{\n        cRoom.chart[0].data[2]=[]; // clear old data\n        cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n        cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    } catch (err) {\n        statusText+=\" no default temp\"\n        return [{payload: {fill:\"red\",shape:\"ring\",text:statusText}},null];\n    }\n    \n} else {\n    statusText+= \" no settings\";\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    cRoom.chart[0].data[1].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(0*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    cRoom.chart[0].data[2].push(msg.currentObject.adjustTime(-1,{\"x\":(86400*1000),\"y\":msg.roomsEntry.defaultTemp || 24}));\n    msg.payload = cRoom.chart;\n    return [{payload: {fill:\"yellow\",shape:\"ring\",text:statusText}},msg];\n}\nmsg.payload = cRoom.chart;\nmsg.label= msg.periodEntry.name;\nmsg.ui_control={};\nmsg.ui_control.ymin=msg.roomsEntry.minTemp;\nmsg.ui_control.ymax=msg.roomsEntry.maxTemp;\nreturn [{payload: {fill:\"green\",shape:\"dot\",text:statusText}},msg];","outputs":2,"noerr":0,"x":206,"y":85,"wires":[[],[]],"icon":"node-red-dashboard/ui_chart.png"},{"id":"1c7e54e8.36570b","type":"subflow:6e9d1a04.cba814","z":"afaa0885.ad2718","name":"buildChart","env":[{"name":"heating.rooms","value":"heating.rooms","type":"str"}],"x":682,"y":1071,"wires":[["9211ec38.5bb63","3a4aabd3.986f04"]]},{"id":"1a64ae43.a9bc52","type":"function","z":"bbaf0ff1.1a532","name":"buildSchedule","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nconst dow = [\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\",\"Sunday\"];\n\nmsg.currentObject= global.get(msg.globalContext,\"file\");\nif (!msg.currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.globalContext}},ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\nmsg.roomEntry=msg.currentObject.getEntry(msg.globalContext+\".heating.rooms.null\",msg.roomID,\"roomUuid\");\nif (!msg.roomEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"no room found!\"}},ui.disabled]\n\nmsg.roomsEntry=msg.currentObject.getEntry(msg.globalContext+\".rooms.null\",msg.roomID);\nif (!msg.roomsEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"no rooms found!\"}},ui.disabled]\n\nmsg.periodsObject=msg.currentObject.getObject(msg.globalContext+\".heating.periods.null\");\nif (!msg.periodsObject) return [{payload: {fill:\"red\",shape:\"dot\",text: \"no periods found!\"}},ui.disabled]\n\nvar statusText = msg.roomEntry.name;\n\nvar timeStamp = new Date();\nmsg.payload={};\n\nif (msg.roomEntry.list) {\n        \n    var day =0;\n    \n    var formatMinutes2String = function (minutes) {\n        var hourString=\"00\"+Math.floor(minutes/60);\n        var minuteString=\"00\"+minutes % 60;\n        return hourString.substr(-2)+\":\"+minuteString.substr(-2);\n    }\n    \n    var addSchedule = function (time, temp) {\n        msg.payload[dow[day]][formatMinutes2String(time)]=temp;\n    }\n    \n    var addDay = function (period) {\n            //node.warn(period);\n            periodDef=msg.currentObject.getEntry(msg.globalContext+\".heating.periods.null\",period.periodUuid);\n             if (periodDef.days[day].isChecked) {\n                msg.payload[dow[day]][formatMinutes2String(0)]=period.list[0].temp; // start @ 00:00\n                for (var i=0; i<period.list.length-1; i++) {\n                    addSchedule(period.list[i].time,period.list[i+1].temp);\n                }\n                addSchedule(period.list[i].time,period.list[0].temp);\n                msg.payload[dow[day]][formatMinutes2String(1439)]=period.list[0].temp; // end @ 23:59\n            }\n        }\n        \n    for (day=0; day<7; day++) {\n        msg.payload[dow[day]]= {};\n        msg.roomEntry.list.forEach(addDay);\n    }\n  \n} else {\n    statusText+= \" no settings\";\n    return [{payload: {fill:\"yellow\",shape:\"ring\",text:statusText}},msg];\n}\nmsg.topic= \"setCalendar\";\nreturn [{payload: {fill:\"green\",shape:\"dot\",text:statusText}},msg];","outputs":2,"noerr":0,"x":250,"y":119,"wires":[[],[]],"icon":"node-red-dashboard/ui_chart.png"},{"id":"3a4aabd3.986f04","type":"subflow:bbaf0ff1.1a532","z":"afaa0885.ad2718","name":"","env":[],"x":896,"y":1071,"wires":[["380d6165.def24e","1f1d7c0d.edf184"]]},{"id":"a9b14d57.af05a","type":"subflow:7bb9b47f.834f5c","z":"afaa0885.ad2718","name":"","env":[{"name":"roomID","value":"73188484-c593-2c8c-ef96-f766623c513f","type":"str"}],"x":682,"y":1122,"wires":[["9211ec38.5bb63"]]},{"id":"5f802c34.c65794","type":"function","z":"7bb9b47f.834f5c","name":"updateChart","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\n\nif (!msg.roomID ||\n    !msg.globalContext ||\n    !msg.roomContext ||\n    !msg.roomsContext) {\n        return [{payload: {fill:\"red\",shape:\"dot\",text: \"check configuration\"}},ui.disabled];\n    }\n\nmsg.currentObject= global.get(msg.globalContext,\"file\");\nif (!msg.currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.globalContext}},ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\nmsg.roomEntry=msg.currentObject.getEntry(msg.globalContext+\".\"+msg.roomContext+\".null\",msg.roomID,\"roomUuid\");\nmsg.roomsEntry=msg.currentObject.getEntry(msg.globalContext+\".\"+msg.roomsContext+\".null\",msg.roomID);\n\nvar cRoom=msg.roomEntry;\nnode.warn(cRoom);\nvar statusText = \"\"\nif (cRoom.chart===undefined)\n    cRoom.chart = [{\n    \"series\":[\"ist\",\"soll\",\"\"],\n    \"data\":[[],[],[]],\n    \"labels\":[\"ist\",\"soll\",\"standard\"]\n    }];\n\nstatusText+= msg.roomEntry.name;\n\nvar temp=Number(msg.payload);\nvar timeMidnight = new Date();\ntimeMidnight.setHours(0,0,0);\nvar time=new Date();\nvar timeOffset=time.getTimezoneOffset()/60;\n\nvar timePoint=msg.currentObject.adjustTime(timeOffset,{\"x\":time.getTime()-timeMidnight.getTime(),\"y\":temp})\n\n// delete old datapoints\ncRoom.chart[0].data[0].forEach(function (dataPoint,index) {\n    if (dataPoint.x>timePoint.x) {\n        cRoom.chart[0].data[0].splice(index,1);\n    }\n});\n\n// add new datapoint\ncRoom.chart[0].data[0].push(timePoint);\nmsg.payload = cRoom.chart;\nmsg.label= msg.periodEntry.name;\nreturn [{payload: {fill:\"green\",shape:\"dot\",text:statusText}},msg];","outputs":2,"noerr":0,"x":223,"y":102,"wires":[[],[]],"icon":"node-red-dashboard/ui_chart.png"},{"id":"176161.c40d2e9f","type":"function","z":"7fd0d8ec.569998","name":"initHeater","func":"const ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nlet datapoint = env.get(\"datapoint\")\nif (msg.payload!==\"update\") {\n    if (typeof datapoint == \"object\") { // multiple Datapoints\n        if (!datapoint.includes(msg.datapoint)) return;\n    } else {\n        if (msg.datapoint!=datapoint) return;\n    }\n}\nvar statusText=\"\";\nlet globalContext = env.get(\"globalContext\");\nlet thisRoom = (!msg.room) ? env.get(\"room\") : msg.room;\nmsg.pathToRooms = globalContext +\".\"+ env.get(\"roomsContext\") + \".homematic\";\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not get \"+globalContext}},null,null]\n}\n\n\n// --------------- end of UI header ---------------------\nnode.warn(msg.room)\nif (msg.room) {\n    if (msg.room === thisRoom) {\n        \n        var roomContext= env.get(\"roomContext\");\n        var roomsContext= env.get(\"roomsContext\");\n        var periodsContext= env.get(\"periodsContext\")\n        \n        var msgValue={\n            \"globalContext\": globalContext,\n            \"roomContext\": roomContext,\n            \"roomsContext\": roomsContext,\n            \"periodsContext\": periodsContext,\n            \"topic\":msg.topic,\n            \"room\":msg.room,\n            \"payload\": msg.payload\n        };\n        \n        var msgHeater={\n            \"topic\": \"currentTemp\",\n            \"payload\": msg.payload\n        };\n        var msgInit={\n            \"globalContext\": globalContext,\n            \"roomContext\": roomContext,\n            \"roomsContext\": roomsContext,\n            \"periodsContext\": periodsContext,\n            \"topic\":msg.topic,\n            \"room\":msg.room,\n            \"payload\": msg.payload\n        };\n\n        msgInit.roomID= currentObject.getUuidByName(msg.pathToRooms,msg.room);\n        msgValue.roomID= msgInit.roomID;\n        if (!msgInit.roomID) {\n            statusText= msg.room+\" not found (\"+msg.pathToRooms+\")\";\n            return [{payload: {fill:\"red\",shape:\"dot\",text: statusText}},null,null,null];\n        } else {\n            node.warn(msgInit.roomID)\n            msg.roomEntry=currentObject.getEntry(globalContext+\".\"+roomContext+\".null\",msgInit.roomID,\"roomUuid\");\n            node.warn(msg.roomEntry)\n            msg.roomsEntry=currentObject.getEntry(globalContext+\".\"+roomsContext+\".null\",msgInit.roomID);\n            node.warn(msg.roomsEntry)\n            if (!msg.roomsEntry || !msg.roomEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not find room \"+msgInit.roomID}},ui.disabled];\n\n\n            var date = new Date();\n            var day = (date.getDay()-1 > 0) ? date.getDay()-1 : 6; // shift dow to monday=0\n            statusText+= '('+day+')';\n            var pathToPeriods = globalContext+\".\"+periodsContext+\".null\";\n            \n                var checkDay = function (period) {\n                        msg.periodsEntry=currentObject.getEntry(pathToPeriods,period.periodUuid);\n                        node.warn(msg.periodsEntry);\n                         if (msg.periodsEntry && msg.periodsEntry.days[day].isChecked) {\n                            msg.periodID=period.uuid;\n                            return;\n                        }\n                    }\n            msg.roomEntry.list.forEach(checkDay);\n            node.warn(msg.periodID);\n            if (!msg.periodID) return [{payload: {fill:\"red\",shape:\"dot\",text: \"periodID \"+msg.periodID}},ui.disabled];\n            msg.periodEntry=currentObject.getEntry(msg.roomEntry,msg.periodID); // get period entry for this room\n            if (!msg.periodEntry) return [{payload: {fill:\"red\",shape:\"dot\",text: \"could not find period \"+msg.periodID}},ui.disabled];\n            msgValue.roomEntry= msg.roomEntry;\n            msgInit.roomEntry=msg.roomEntry;\n            msgValue.roomsEntry= msg.roomsEntry;\n            msgInit.roomsEntry=msg.roomsEntry;\n            msgValue.periodEntry= msg.periodEntry;\n            msgInit.periodEntry=msg.periodEntry;\n            \n            if (msg.payload !== \"update\") {\n                switch(msg.datapoint){\n                    case 'VALVE_STATE':\n                        msgHeater.topic=\"currentValve\"\n                        statusText=msg.room+\" (\"+msg.payload+\"%)\";\n                        return [{payload: {fill:\"green\",shape:\"dot\",text: statusText}},msgHeater,null,null];\n                    case 'ACTUAL_TEMPERATURE':\n                        msgHeater.topic=\"currentTemp\"\n                        statusText=msg.room+\" (\"+msg.payload+\"°C)\";\n                        return [{payload: {fill:\"green\",shape:\"dot\",text: statusText}},msgHeater,msgValue,msgInit];\n                }\n            } else {\n                return [{payload: {fill:\"green\",shape:\"dot\",text: statusText}},null,msgValue,null];\n            }\n        }\n    } \n}","outputs":4,"noerr":0,"x":162,"y":85,"wires":[[],[],[],[]],"inputLabels":["thermostate"],"outputLabels":["state","update","build","chart"]},{"id":"94bfa7d7.5b8398","type":"subflow:7fd0d8ec.569998","z":"afaa0885.ad2718","name":"Temperature Chart","env":[{"name":"datapoint","value":"[\"ACTUAL_TEMPERATURE\",\"VALVE_STATE\"]","type":"json"}],"x":464,"y":1054,"wires":[["380d6165.def24e"],["1c7e54e8.36570b"],["a9b14d57.af05a","36542b63.916a34"]]},{"id":"99b23ac3.2c7b08","type":"ui_text_input","z":"99f7fccc.6df2f","name":"name","label":"","tooltip":"","group":"d11141a.b59afc","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.heating.test.name","x":679,"y":272,"wires":[["38e0e6af.b7834a"]]},{"id":"66509821.89aa58","type":"ui_button","z":"99f7fccc.6df2f","name":"uiDelete","group":"d11141a.b59afc","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Do you really like to delete this entry?","payloadType":"str","topic":"mySettings.heating.test.uiDelete","x":689,"y":212,"wires":[["87ad832b.0f59e"]]},{"id":"4f32a762.51c228","type":"ui_date_picker","z":"99f7fccc.6df2f","name":"start","label":"","group":"d11141a.b59afc","order":7,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.test.start","x":679,"y":312,"wires":[["38e0e6af.b7834a"]]},{"id":"542a80fb.3d2bb","type":"ui_date_picker","z":"99f7fccc.6df2f","name":"end","label":"","group":"d11141a.b59afc","order":9,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.test.end","x":679,"y":352,"wires":[["38e0e6af.b7834a"]]},{"id":"e95c2be4.9ea798","type":"ui_text","z":"99f7fccc.6df2f","group":"d11141a.b59afc","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":272,"wires":[]},{"id":"55e6bdd1.caa9d4","type":"ui_text","z":"99f7fccc.6df2f","group":"d11141a.b59afc","order":6,"width":2,"height":1,"name":"Start:","label":"Begin:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":332,"wires":[]},{"id":"3d8b0903.25f7e6","type":"ui_text","z":"99f7fccc.6df2f","group":"d11141a.b59afc","order":8,"width":2,"height":1,"name":"End:","label":"End:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":392,"wires":[]},{"id":"49ee9243.bc36bc","type":"ui_dropdown","z":"99f7fccc.6df2f","name":"uiDropdown","label":"","tooltip":"","place":"select period","group":"d11141a.b59afc","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.heating.test.uiDropdown","x":699,"y":92,"wires":[["f4172b16.eeb348"]]},{"id":"8c1d91ef.92703","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":272,"wires":[]},{"id":"2d5c77a.660c488","type":"link in","z":"99f7fccc.6df2f","name":"updatePeriod","links":["8c1d91ef.92703","af64a243.aa02c","480be8a7.ca3858","b814ae11.09716","55011644.db5958"],"x":168,"y":187,"wires":[["5b2ccb43.bd59f4"]]},{"id":"af64a243.aa02c","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":92,"wires":[]},{"id":"1f109766.2438b9","type":"function","z":"99f7fccc.6df2f","name":"fill dropdown","func":"var topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\nvar keyword = topicParts.pop();\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"});\n    return;\n}\n\ntry {\n    if (currentProperty.list!==undefined) {\n        msg.options=[];\n        var listEntry={};\n        currentProperty.list.forEach(function(item,index){\n            listEntry={};\n            listEntry[item.name]=String(index);\n            msg.options.push(listEntry);\n        })\n        msg.options.sort();\n     \n        if (!currentProperty.list[currentProperty.uiPointer]) {\n            if (currentProperty.list.length>0){\n                currentProperty.uiPointer=0; // reset to first\n                msg.payload=currentProperty.uiPointer;\n            } else { // no list existing\n                delete msg.payload;\n            }\n        } else msg.payload=currentProperty.uiPointer;\n            \n        node.status({fill:\"green\",shape:\"dot\",text:\"done!\"});\n    } else {\n        node.status({fill:\"yellow\",shape:\"dot\",text:\"object.list empty\"});\n    }\n    return msg;\n\n} catch (err) {\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"No list entry\"});\n    return msg;\n}","outputs":1,"noerr":0,"x":499,"y":92,"wires":[["49ee9243.bc36bc"]]},{"id":"b814ae11.09716","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":212,"wires":[]},{"id":"cf0daed0.447a6","type":"ui_button","z":"99f7fccc.6df2f","name":"uiAdd","group":"d11141a.b59afc","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unnamed","payloadType":"str","topic":"mySettings.heating.test.uiAdd","x":674,"y":147,"wires":[["48e37f92.34826"]]},{"id":"55011644.db5958","type":"link out","z":"99f7fccc.6df2f","name":"updatePeriod","links":["2d5c77a.660c488"],"x":1104,"y":152,"wires":[]},{"id":"47e71fbc.8fed5","type":"switch","z":"99f7fccc.6df2f","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.heating.test.name","vt":"str"},{"t":"eq","v":"mySettings.heating.test.start","vt":"str"},{"t":"eq","v":"mySettings.heating.test.end","vt":"str"},{"t":"eq","v":"mySettings.heating.test.monday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.tuesday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.wednesday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.thursday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.friday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.saturday","vt":"str"},{"t":"eq","v":"mySettings.heating.test.sunday","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":459,"y":332,"wires":[["99b23ac3.2c7b08"],["4f32a762.51c228"],["542a80fb.3d2bb"],["c715800e.f7e3b"],["4d7b3e1c.38bf6"],["34a1f17e.69729e"],["eb6abb25.752688"],["2f4d11e1.dd1bae"],["5da96133.bfaa7"],["957355cf.98c598"]]},{"id":"87ad832b.0f59e","type":"ui_toast","z":"99f7fccc.6df2f","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":829,"y":212,"wires":[["9b8fc84f.5bf548"]]},{"id":"c715800e.f7e3b","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Monday","tooltip":"","group":"d11141a.b59afc","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.monday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":392,"wires":[["38e0e6af.b7834a"]]},{"id":"4d7b3e1c.38bf6","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Tuesday","tooltip":"","group":"d11141a.b59afc","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.tuesday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":452,"wires":[["38e0e6af.b7834a"]]},{"id":"34a1f17e.69729e","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Wednesday","tooltip":"","group":"d11141a.b59afc","order":12,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.wednesday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":699,"y":512,"wires":[["38e0e6af.b7834a"]]},{"id":"eb6abb25.752688","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Thursday","tooltip":"","group":"d11141a.b59afc","order":13,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.thursday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":572,"wires":[["38e0e6af.b7834a"]]},{"id":"2f4d11e1.dd1bae","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Friday","tooltip":"","group":"d11141a.b59afc","order":14,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.friday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":679,"y":632,"wires":[["38e0e6af.b7834a"]]},{"id":"5da96133.bfaa7","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Saturday","tooltip":"","group":"d11141a.b59afc","order":15,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.saturday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":692,"wires":[["38e0e6af.b7834a"]]},{"id":"957355cf.98c598","type":"ui_switch","z":"99f7fccc.6df2f","name":"","label":"Sunday","tooltip":"","group":"d11141a.b59afc","order":16,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"mySettings.heating.test.sunday","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":689,"y":692,"wires":[["38e0e6af.b7834a"]]},{"id":"8d6c628b.def81","type":"function","z":"99f7fccc.6df2f","name":"initialize","func":"if (!msg.payload) return;\n\nvar topicParts=\"\";\n\ntry {\n    topicParts=msg.topic.split('.');\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"});\n    return;\n}\nif (topicParts.length<3) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"msg.topic='context.object.property' expected\"});\n    return;\n}\n\n// get or initalize root for global store\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic});\n    return null;\n}\n\n// get or initialize base Object\ncurrentObject= currentObject.getObject(msg.topic);\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic});\n} else {\n    node.status({fill:\"green\",shape:\"dot\",text:\"done!\"});\n    return msg;\n}\n","outputs":1,"noerr":0,"x":289,"y":92,"wires":[["1f109766.2438b9"]]},{"id":"b7d8835f.d797e","type":"link in","z":"99f7fccc.6df2f","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":64,"y":92,"wires":[["37850e1b.2c6062"]]},{"id":"37850e1b.2c6062","type":"change","z":"99f7fccc.6df2f","name":"init","rules":[{"t":"set","p":"topic","pt":"msg","to":"mySettings.heating.test.uiDropdown","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":159,"y":92,"wires":[["8d6c628b.def81"]]},{"id":"48e37f92.34826","type":"change","z":"99f7fccc.6df2f","name":"defaults","rules":[{"t":"set","p":"start","pt":"msg","to":"","tot":"date"},{"t":"set","p":"end","pt":"msg","to":"","tot":"date"},{"t":"set","p":"monday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"tuesday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"wednesday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"thursday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"friday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"saturday","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"sunday","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":147,"wires":[["1c4cc57f.2b277b"]]},{"id":"f4172b16.eeb348","type":"subflow:c4a7cd6c.2a0c1","z":"99f7fccc.6df2f","name":"","env":[],"x":973,"y":96,"wires":[["af64a243.aa02c"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"9b8fc84f.5bf548","type":"subflow:d4a0d961.b11238","z":"99f7fccc.6df2f","name":"","x":979,"y":212,"wires":[["b814ae11.09716"]]},{"id":"38e0e6af.b7834a","type":"subflow:dfa4352b.bdc548","z":"99f7fccc.6df2f","name":"","env":[],"x":969,"y":272,"wires":[["8c1d91ef.92703"]]},{"id":"1c4cc57f.2b277b","type":"subflow:e0e53645.d85fd8","z":"99f7fccc.6df2f","name":"","x":973,"y":147,"wires":[["55011644.db5958"]]},{"id":"e74b0ec5.c9454","type":"ccu-rpc-event","z":"897fdb2a.109f68","name":"Termostate","iface":"","ccuConfig":"dcd63e8.d157fc","rooms":"","roomsRx":"str","functions":"","functionsRx":"str","device":"","deviceRx":"str","deviceName":"","deviceNameRx":"str","deviceType":"","deviceTypeRx":"str","channel":"","channelRx":"str","channelName":"","channelNameRx":"str","channelType":"","channelTypeRx":"str","channelIndex":"","channelIndexRx":"str","datapoint":"","datapointRx":"str","change":true,"working":false,"cache":true,"topic":"${room}/${channelName}/${datapoint}","x":128,"y":374,"wires":[["ab7e0d9.92789f","b22fa377.375a3"]]},{"id":"673d1103.fd2fe","type":"link out","z":"897fdb2a.109f68","name":"updateRoom","links":["604d5679.2820a8","7617b0dc.9c27a","e2b6f8c3.598888","49404117.0231f","2a7781f8.d8451e","43d9e00d.06c2e","47ade8d3.fa85c8","d107ebd4.5f0418","a30de23c.d157e","3902144d.81ab8c"],"x":899,"y":272,"wires":[]},{"id":"ab7e0d9.92789f","type":"change","z":"897fdb2a.109f68","name":"settings","rules":[{"t":"set","p":"settingsContext","pt":"msg","to":"mySettings","tot":"str"},{"t":"set","p":"roomsContext","pt":"msg","to":"rooms","tot":"str"},{"t":"set","p":"roomContext","pt":"msg","to":"heating.rooms","tot":"str"},{"t":"set","p":"periodsContext","pt":"msg","to":"heating.periods","tot":"str"},{"t":"set","p":"deviceContext","pt":"msg","to":"{\"HM-CC-RT-DN\":\"heating.devices\",\"HM-Sec-SCo\":\"windows.devices\",\"HMIP-PS\":\"sockets.devices\",\"HMIP-PSM\":\"sockets.devices\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":298,"y":374,"wires":[["43c3f57f.c210bc","9050990b.5553c8"]]},{"id":"7723d235.db067c","type":"subflow:e0e53645.d85fd8","z":"897fdb2a.109f68","name":"add new Room","env":[{"name":"defaults","value":"{\"type\":\"room\",\"defaultTemp\":20,\"minTemp\":16,\"maxTemp\":24,\"winTemp\":10}","type":"json"}],"x":760,"y":272,"wires":[["673d1103.fd2fe"]]},{"id":"43c3f57f.c210bc","type":"function","z":"897fdb2a.109f68","name":"filter new devices","func":"node.status({});\nconst ui = {\"enabled\":{\"enabled\": true},\"disabled\":{\"enabled\": false}};\nif (msg.room === undefined) return [null,null,ui.disabled];\n\nvar currentObject= global.get(msg.settingsContext,\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,null,ui.disabled]\n}\n\n// --------------- end of UI header ---------------------\n\n// check for new Room\nvar msgNewRoom= null;\nvar roomEntry=currentObject.entryExists(msg.settingsContext+'.'+msg.roomsContext+'.homematic',msg.room,\"name\");\nif (!roomEntry) {\n    msgNewRoom= {\n        \"topic\": msg.settingsContext+\".\"+msg.roomsContext+\".uiAdd\",\n        \"payload\": msg.room,\n        \"defaults\": {\n            \"source\": \"device\",\n            \"deviceType\": \"homatic\"\n        }\n    };\n    node.status({fill:\"green\",shape:\"dot\",text: msg.room+\" new\"});\n}\n\n// check for new device\n//node.warn(msg.deviceContext);\n//node.warn(msg.deviceContext.hasOwnProperty(msg.deviceType))\nvar msgNewDevice= null;\nif (msg.deviceContext.hasOwnProperty(msg.deviceType)) {\n//    node.warn(msg.settingsContext+'.'+msg.deviceContext[msg.deviceType]+'.homematic');\n    var deviceEntry=currentObject.entryExists(msg.settingsContext+'.'+msg.deviceContext[msg.deviceType]+'.homematic',msg.device,\"name\");\n//    node.warn(deviceEntry);\n    if (!deviceEntry && roomEntry) { // only if room exits\n        msgNewDevice= {\n            \"topic\": msg.settingsContext+\".\"+msg.deviceContext[msg.deviceType]+\".uiAdd\",\n            \"payload\": msg.device,\n            \"defaults\": {\n                \"source\": \"device\",\n                \"deviceName\": msg.deviceName,\n                \"deviceType\": msg.deviceType,\n                \"room\": msg.room,\n                \"roomUuid\": roomEntry.uuid\n            }\n        };\n        node.status({fill:\"green\",shape:\"dot\",text: msg.device+\" new\"});\n    }\n    if (deviceEntry) {\n        deviceEntry[msg.datapoint]= {\n            \"datapoint\": msg.datapoint,\n            \"datapointName\": msg.datapointName,\n            \"datapointMin\": msg.datapointMin,\n            \"datapointMax\": msg.datapointMax,\n            \"datapointDefault\": msg.datapointDefault,\n            \"datapointType\": msg.datapointType,\n            \"value\": msg.value\n        }\n    }\n    \n    return [msgNewRoom,msgNewDevice,msg,ui.enabled];\n} else {\n    node.status({fill:\"yellow\",shape:\"dot\",text: msg.deviceType+\" undefined\"});\n    return;\n}","outputs":4,"noerr":0,"x":481,"y":374,"wires":[["7723d235.db067c","39ef0ec4.5686d2"],["a5ab64be.9cfa48","41b0a88c.eb29d8"],["c0e3b6b0.78ffa8","2c347f7a.6efd1"],[]],"outputLabels":["newRoom","newDevice","message","enabled"]},{"id":"5b2ccb43.bd59f4","type":"subflow:30d3b36b.8d171c","z":"99f7fccc.6df2f","name":"","env":[],"x":281,"y":187,"wires":[["1f109766.2438b9"],["47e71fbc.8fed5"]]},{"id":"59328d01.19fe44","type":"comment","z":"897fdb2a.109f68","name":"Handle incomming messages for homematic devices","info":"the homematic ccu sends room names with every new value.\nif the room does not exits it will be automatically added to the database\nNew reedings will send with a modified topic and other data","x":258,"y":238,"wires":[]},{"id":"380d6165.def24e","type":"ui_heater_controller","z":"afaa0885.ad2718","name":"heater","group":"9ce06846.951a68","unit":"C","order":1,"width":8,"height":4,"topic":"Arbeitszimmer","sliderMinValue":10,"sliderMaxValue":35,"sliderStep":0.5,"thresholdRising":0.5,"thresholdFalling":0.5,"calendar":"{\n    \"Monday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Tuesday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Wednesday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Thursday\": {\n        \"00:00\": 19,\n        \"06:20\": 22,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Friday\": {\n        \"00:00\": 19,\n        \"06:20\": 23,\n        \"08:00\": 19,\n        \"16:40\": 22,\n        \"23:59\": 19\n    },\n    \"Saturday\": {\n        \"00:00\": 19,\n        \"08:00\": 20,\n        \"20:00\": 22,\n        \"23:59\": 19\n    },\n    \"Sunday\": {\n        \"00:00\": 19,\n        \"08:00\": 20,\n        \"20:00\": 22,\n        \"23:59\": 19\n    }\n}","x":1138,"y":1037,"wires":[["92b35afb.a03f08"]]},{"id":"c23e076c.76b9a8","type":"link in","z":"afaa0885.ad2718","name":"update Chart","links":["5c9ea701.d1a758","2f827c46.e6e414","36d32a91.d1b4f6","bd444756.1d08e8","834d27dd.abd968","1dba0bcd.2d9d54"],"x":576,"y":493,"wires":[["b86b21db.c2b68"]]},{"id":"bf2fec97.c6463","type":"link in","z":"afaa0885.ad2718","name":"newTemp","links":["3276e425.a62e7c"],"x":100,"y":663,"wires":[["57ad0440.5441cc"]]},{"id":"3276e425.a62e7c","type":"link out","z":"afaa0885.ad2718","name":"newTemp","links":["bf2fec97.c6463"],"x":967,"y":833,"wires":[]},{"id":"974d4be9.b36dd8","type":"link out","z":"afaa0885.ad2718","name":"updateUiCharts","links":["43e416d.9fdc9e8"],"x":967,"y":544,"wires":[]},{"id":"43e416d.9fdc9e8","type":"link in","z":"afaa0885.ad2718","name":"updateUiCharts","links":["974d4be9.b36dd8"],"x":83,"y":1020,"wires":[["a0a1b0ea.47894"]]},{"id":"1f1d7c0d.edf184","type":"debug","z":"afaa0885.ad2718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1138,"y":1071,"wires":[]},{"id":"b22fa377.375a3","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":288,"y":442,"wires":[]},{"id":"a5ab64be.9cfa48","type":"subflow:e0e53645.d85fd8","z":"897fdb2a.109f68","name":"add new device","env":[{"name":"defaults","value":"{\"type\":\"homematicDevice\"}","type":"json"}],"x":760,"y":374,"wires":[["b276c5e9.8a1ac8"]]},{"id":"b276c5e9.8a1ac8","type":"link out","z":"897fdb2a.109f68","name":"updateThermostats","links":["5df47bd2.481764"],"x":899,"y":374,"wires":[]},{"id":"3924e72c.ffb7d8","type":"inject","z":"897fdb2a.109f68","name":"initalize","topic":"mySettings","payload":"uiInit","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":475,"y":952,"wires":[["3ac3a2ea.8778be"]]},{"id":"c1390f83.17151","type":"ui_table","z":"897fdb2a.109f68","group":"e1cac84f.fefdd8","name":"","order":1,"width":"15","height":"10","columns":[{"field":"name","title":"Device","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"deviceType","title":"Type","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"room","title":"Raum","width":"40%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"ACTUAL_TEMPERATURE-value","title":"Temp","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"VALVE_STATE-value","title":"Ventil","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"BATTERY_STATE-value","title":"Batt","width":"10%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":883,"y":901,"wires":[["e011f241.e3854","de90c4c8.7db9d8"]]},{"id":"6a2bfd9e.ce1944","type":"function","z":"2f4c5529.6abcba","name":"buildTable","func":"var statusText= \"\";\nvar topicParts= (msg.topic)? msg.topic.split('.') : [\"\"];\n\n// get globalContext out of A) msg.globalContext B) env.globalContext C) msg.topic\nvar globalContext = (msg.globalContext) ? msg.globalContext : env.get(\"globalContext\");\nif (!globalContext || globalContext===\"\") globalContext=topicParts[0];\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar dataContext = (msg.dataContext) ? msg.dataContext : env.get(\"dataContext\");\nif ((!dataContext || dataContext===\"\") && topicParts.length>1) \n    dataContext=msg.topic.slice(msg.topic.indexOf('.'),msg.topic.lastIndexOf('.'));\n\nvar msgOut={};    \n// rebuild msg.topic (could be from differen sources)\nmsgOut.topic=globalContext+\".\"+dataContext+\".uiTable\";\n\n// aquire data\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    statusText=globalContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\nvar currentProperty=currentObject.getObject(msgOut.topic);\nif (!currentProperty) {\n    statusText=dataContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\n\nvar lineObj={};\nvar dataSelection=(msg.dataSelection)? msg.dataSelection : env.get(\"dataSelection\");\n\n// --------------------------------------\n// build list of used columns\n// --------------------------------------\nvar buildList = function (source,target,property,index) {\n    for (let sourceItem in source) {\n        if (source[sourceItem].columns) {\n            buildList(source[sourceItem].columns,target,property,index);\n        } else {\n            if (index<0) target.push(source[sourceItem][property]);\n            else target.push(source[sourceItem][property].split('.')[index]);\n        }\n    }\n}\n\nvar itemList=[];\nbuildList(dataSelection,itemList,\"field\",0);\n\n// --------------------------------------\n// function to get a value form a list object\n// --------------------------------------\nvar getValue= function(element, property) {\n    var propertySplitted=property.split('.');\n    for (var i=0; i<propertySplitted.length; i++) {\n        if (element && element.hasOwnProperty(propertySplitted[i])) {\n            element=element[propertySplitted[i]];\n        } else {\n//            node.warn(property)\n//            node.warn(element)\n            return undefined;\n        }\n    }\n    return element;\n}\n\n\n// --------------------------------------\n// function to a matching item\n// --------------------------------------\nvar getByName= function(anArray,aProperty,aValue) {\n    var result;\n    anArray.forEach(function (item) {\n        if (item[aProperty].replace(/\\./g,\"-\") == aValue.replace(/\\./g,\"-\")) {\n            result = item;\n            return;\n        }\n    })\n    return result;\n}\n\n// --------------------------------------\n// function to sort column to match a given array\n// --------------------------------------\nvar addedColumns = 0;\nvar sortColumnsByLayout = function (sortColumns, columnsLayout, targetColumns) {\n    for (var layoutColumn=0;  layoutColumn<columnsLayout.length; layoutColumn++) {\n        for (var sortColumn in sortColumns) {\n            if (sortColumns[sortColumn].columns) {\n                targetColumns.push({\"title\":sortColumns[sortColumn].title, \"columns\":[]});\n                sortColumnsByLayout(sortColumns[sortColumn].columns,columnsLayout,targetColumns[targetColumns.length-1].columns);\n                layoutColumn=addedColumns;\n            } else {\n                if (columnsLayout[layoutColumn].field===sortColumns[sortColumn].field){\n                    targetColumns.push(sortColumns[sortColumn]);\n                    addedColumns++;\n                    break;\n                }\n            }\n        }\n    }\n}\n\n\nvar fieldNoDots=\"\";\nswitch (msg.payload) {\n    case 'uiInit':\n        var config=env.get(\"config\");\n        msgOut.ui_control={\"tabulator\": (config) ? config : {}};\n\n        // ui_control add column definition\n        var addColumn = function (destination,element,source) {\n            switch (element) {\n                case 'field' : \n//                    fieldList.push(source);\n                    source=source.replace(/\\./g,\"-\");\n                    fieldNoDots= source;\n                    break;\n                case 'width' :\n                    if (currentProperty.layout && \n                        currentProperty.layout.columnWidths &&\n                        currentProperty.layout.columnWidths[fieldNoDots])\n                            source = currentProperty.layout.columnWidths[fieldNoDots].width;\n                    break; \n                case 'min' :\n                case 'max' :\n                    if (typeof source === \"string\") source=getValue(currentProperty.list[0],source);\n                    break;\n                    \n            }\n            \n            destination[element]=source;\n            return;\n        } \n        \n        var addColumns = function (destination,source) {\n            //node.warn(source);\n            for (var element in source) {\n                if (!destination[element]) destination[element]=(Array.isArray(source[element])) ? [] : {\"formatterParams\": {\"target\": \"_blank\"}}\n                if (typeof source[element] === \"object\") {\n                    addColumns(destination[element],source[element])\n                    //node.warn(destination[element]);\n                } else {\n                    addColumn(destination,element,source[element]);\n                }\n            }\n        }\n        \n        msgOut.ui_control.tabulator.columns = [];\n        addColumns(msgOut.ui_control.tabulator.columns,dataSelection);\n        //node.warn(msgOut.ui_control.tabulator.columns)\n        if (env.get(\"movableColumns\")) {\n            if (currentProperty.layout && Array.isArray(currentProperty.layout.columns)) { // && checkColumns(currentProperty, dataSelection)\n                try {\n                    var newConfig=[];\n                    addedColumns = 0;\n                    sortColumnsByLayout(msgOut.ui_control.tabulator.columns,currentProperty.layout.columns,newConfig);\n                    if (newConfig)\n                        msgOut.ui_control.tabulator.columns=newConfig;\n                    else \n                        node.warn(\"column sorting gave an empty list!\");\n                } catch(error) {\n                    node.error(\"an error accured when sorting columns (\"+error+\")\");\n                    delete currentProperty.layout.columns;\n                }\n            }\n        }\n        // get additional data from subflow config\n        msgOut.ui_control.tabulator.layout= env.get(\"layout\");\n        msgOut.ui_control.tabulator.movableColumns= env.get(\"movableColumns\");\n        msgOut.ui_control.tabulator.groupBy= env.get(\"groupBy\");\n        msgOut.ui_control.customHeight= env.get(\"customHeight\");\n        statusText= \"ui_control send \"+itemList.length + \" columns\";\n        \n    default:\n        if (msg.payload!=\"uiInit\" && itemList.indexOf(msg.datapoint)<0) {\n            statusText=msg.datapoint+\" not in Table\";\n            return [{payload:{fill:\"yellow\",shape:\"dot\",text: statusText}},null];\n        } else {\n            var fieldList=[];\n            buildList (dataSelection,fieldList,\"field\",-1);\n            \n            msgOut.payload=[];\n            // loop through lines\n            currentProperty.list.forEach(function (lineElement,lineIndex) {\n                // add Data to payload\n                lineObj={};\n                var addLine = function (column) {\n                    lineObj[column.replace(/\\./g,\"-\")]= getValue(lineElement,column);\n                }\n                fieldList.forEach(addLine);\n                \n                msgOut.payload.push(lineObj);\n            });\n            statusText= \"Data send \"+msgOut.payload.length + \" lines\";\n        }\n        break;\n}\n\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msgOut];","outputs":2,"noerr":0,"x":196,"y":85,"wires":[[],[]],"inputLabels":["trigger"],"outputLabels":["status","tableData"]},{"id":"3ac3a2ea.8778be","type":"subflow:2f4c5529.6abcba","z":"897fdb2a.109f68","name":"heating.devices","env":[{"name":"dataSelection","value":"[{\"title\":\"Raum\",\"field\":\"room\",\"width\":100,\"frozen\":true},{\"title\":\"Messungen\",\"columns\":[{\"title\":\"soll\",\"field\":\"SET_TEMPERATURE.value\",\"formatter\":\"function(cell, formatterParams, onRendered){return cell.getValue()+'°C';}\",\"topCalc\":\"avg\",\"width\":100},{\"title\":\"ist\",\"field\":\"ACTUAL_TEMPERATURE.value\",\"formatter\":\"progress\",\"topCalc\":\"avg\",\"formatterParams\":{\"min\":10,\"max\":25,\"color\":[\"blue\",\"green\",\"red\"],\"legend\":\"function (value) {return '&nbsp;&nbsp;'+value+'°C';}\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"left\"},\"width\":100},{\"title\":\"Ventil\",\"field\":\"VALVE_STATE.value\",\"formatter\":\"progress\",\"topCalc\":\"max\",\"formatterParams\":{\"min\":\"VALVE_STATE.datapointMin\",\"max\":\"VALVE_STATE.datapointMax\",\"color\":[\"gray\",\"orange\",\"red\"],\"legend\":\"function (value) {return (value>0)? '&nbsp;&nbsp;'+value+' %' : '-';}\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"width\":100},{\"title\":\"Batt\",\"field\":\"BATTERY_STATE.value\",\"formatter\":\"progress\",\"topCalc\":\"min\",\"formatterParams\":{\"min\":\"BATTERY_STATE.datapointMin\",\"max\":\"BATTERY_STATE.datapointMax\",\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {return value+' V';}\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"width\":100}]},{\"title\":\"Einstellungen\",\"columns\":[{\"title\":\"Boost\",\"field\":\"BOOST_STATE.value\",\"formatter\":\"progress\",\"formatterParams\":{\"min\":\"BOOST_STATE.datapointMin\",\"max\":\"BOOST_STATE.datapointMax\",\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" min</span>\\\";     else         return \\\"<span style='color:#A0A0A0;'>aus</span>\\\"; }\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"width\":100},{\"title\":\"Auto\",\"field\":\"AUTO_MODE.value\",\"formatter\":\"tickCross\",\"formatterParams\":{\"allowEmpty\":true,\"allowTruthy\":true,\"tickElement\":\"<i class='fa fa-clock-o'></i>\",\"crossElement\":\"<i class='fa fa-ban'></i>\"},\"width\":100,\"align\":\"center\"},{\"title\":\"Mode\",\"field\":\"CONTROL_MODE.value\",\"formatter\":\"function(cell, formatterParams, onRendered){     var html=\\\"<i class=\\\\\\\"\\\";     switch(cell.getValue()) {         case 0: html+=\\\"fa fa-calendar-check-o\\\"; break;         case 1: html+=\\\"fa fa-hand-o-up\\\"; break;         case 2: html+=\\\"fa fa-suitcase\\\"; break;         case 3: html+=\\\"fa fa-spinner fa-spin fa-fw\\\"; break;     }     html+='\\\\\\\"></i>';     return html; }\",\"width\":100,\"align\":\"center\"}]}]","type":"json"},{"name":"config","value":"{\"columnResized\":\"function(column){     var newColumn = {         field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\"}","type":"json"},{"name":"layout","value":"fitColumns","type":"str"},{"name":"customHeight","value":"12","type":"num"},{"name":"groupHeader","value":"function (value, count, data, group) {return value + \"<span style='color:#d00; margin-left:10px;'>(\" + count + \" Termostat\"+((count>1) ? \"e\" : \"\") + \")</span>\";}","type":"str"},{"name":"callbacks","value":"{\"columnMoved\":\"columnMoved = function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"columnResized\":\"columnResized = function(column){     var newColumns={};     var percentFactor=1;     var totalWidth=0;     var lastWidth=0;     var widthUnit='px';     column._column.table.columnManager.columns.forEach(function (aColumn) {          totalWidth += aColumn.width;         if (aColumn.definition.width.includes('%')) widthUnit='%';     });     if (widthUnit=='%') percentFactor=100/totalWidth;     totalWidth=0;      column._column.table.columnManager.columns.forEach(function (aColumn) {         lastWidth=Math.floor(aColumn.width*percentFactor);         newColumns[aColumn.field]=lastWidth+widthUnit;         totalWidth+= lastWidth;     });     if (widthUnit=='%' && totalWidth!=100 ) {         var keys=Object.keys(newColumns);         newColumns[keys[keys.length-1]].widthStyled=(lastWidth+(100-totalWidth))+widthUnit;     }     this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumns}}); };\"}","type":"json"}],"x":709,"y":901,"wires":[["c1390f83.17151","8fc4b51e.3d3718"]],"info":"# prepare data for ui-table node\n\n## callbacks\n```\ncolumnMoved = function(column, columns) {\n    var newColumns=[];\n    columns.forEach(function (column) {\n        newColumns.push({'field': column._column.field});\n    });\n    $scope.send({topic:$scope.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}});\n}\n```\n\n```\ncolumnResized = function(column){\n    var newColumns={};\n    var percentFactor=1;\n    var totalWidth=0;\n    var lastWidth=0;\n    var widthUnit='px';\n    column._column.table.columnManager.columns.forEach(function (aColumn) { \n        totalWidth += aColumn.width;\n        if (aColumn.definition.width.includes('%')) widthUnit='%';\n    });\n    if (widthUnit=='%') percentFactor=100/totalWidth;\n    totalWidth=0;\n                \n    column._column.table.columnManager.columns.forEach(function (aColumn) {\n        lastWidth=Math.floor(aColumn.width*percentFactor);\n        newColumns[aColumn.field]=lastWidth+widthUnit;\n        totalWidth+= lastWidth;\n    });\n    if (widthUnit=='%' && totalWidth!=100 ) {\n        var keys=Object.keys(newColumns);\n        newColumns[keys[keys.length-1]].widthStyled=(lastWidth+(100-totalWidth))+widthUnit;\n    }\n    $scope.send({topic:$scope.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumns}});\n};\n```\n"},{"id":"38e848c.4a875b8","type":"function","z":"f8262c22.ca30c","name":"table callback","func":"if (!msg.ui_control || !msg.ui_control.callback) return;\n\nvar statusText= \"\";\nvar topicParts= (msg.topic)? msg.topic.split('.') : [\"\"];\n\n// get globalContext out of A) msg.globalContext B) env.globalContext C) msg.topic\nvar globalContext = (msg.globalContext) ? msg.globalContext : env.get(\"globalContext\");\nif (!globalContext || globalContext===\"\") globalContext=topicParts[0];\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar dataContext = (msg.dataContext) ? msg.dataContext : env.get(\"dataContext\");\nif ((!dataContext || dataContext===\"\") && topicParts.length>1) \n    dataContext=msg.topic.slice(msg.topic.indexOf('.'),msg.topic.lastIndexOf('.'));\n    \n// rebuild msg.topic (could be from differen sources)\nmsg.topic=globalContext+\".\"+dataContext+\".uiTable\";\n\n// aquire data\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    statusText=globalContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    statusText=dataContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\n\n// -------------- store layout updates -----------------\n\nif (!currentProperty.layout) currentProperty.layout={};\nif (!currentProperty.layout.columns) currentProperty.layout.columns={};\nif (!currentProperty.layout.columnWidths) currentProperty.layout.columnWidths={};\nswitch(msg.ui_control.callback) {\n    case 'columnResized':\n        currentProperty.layout.columnWidths[msg.ui_control.columnWidths.field]=msg.ui_control.columnWidths;\n        statusText=\"width stored\"\n        break;\n    case 'columnMoved':\n        currentProperty.layout.columns=msg.ui_control.columns;\n        statusText=\"columns stored\"\n        break;\n}\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},null];\n","outputs":2,"noerr":0,"x":199,"y":85,"wires":[[],[]]},{"id":"e011f241.e3854","type":"subflow:f8262c22.ca30c","z":"897fdb2a.109f68","name":"","env":[{"name":"dataContext","value":"heating.devices","type":"str"}],"x":1049,"y":901,"wires":[[]]},{"id":"f5750d2d.53017","type":"function","z":"65174702.902988","name":"setValue by Group","func":"var statusText= \"\";\n \nvar msgsOut=[];\nvar topicParts= (msg.topic)? msg.topic.split('.') : [\"\"];\n\n// get globalContext out of A) msg.globalContext B) env.globalContext C) msg.topic\nvar globalContext = (msg.globalContext) ? msg.globalContext : env.get(\"globalContext\");\nif (!globalContext || globalContext===\"\") globalContext=topicParts[0];\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar dataContext = (msg.dataContext) ? msg.dataContext : env.get(\"dataContext\");\nif ((!dataContext || dataContext===\"\") && topicParts.length>1) \n    dataContext=msg.topic.slice(msg.topic.indexOf('.'),msg.topic.lastIndexOf('.'));\n\n// get dataContext out of A) msg.dataContext B) env.dataContext C) msg.topic\nvar groupContext = (msg.groupContext) ? msg.groupContext : env.get(\"groupContext\");\n\n// aquire data\nvar currentObject= global.get(globalContext,\"file\");\nif (!currentObject) {\n    statusText=globalContext+\" not found\";\n    return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];\n}\nvar currentData=currentObject.getObject(globalContext+\".\"+dataContext+\".uiTable\");\nif (!currentData) { statusText=dataContext+\" not found\"; return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];}\n\nvar currentGroup=currentObject.getObject(globalContext+\".\"+groupContext+\".setValue\");\nif (!currentGroup) { statusText=groupContext+\" not found\"; return [{payload:{fill:\"red\",shape:\"dot\",text: statusText}},null];}\n\nvar targetKey=env.get(\"targetKey\");\nvar sourceKey=env.get(\"sourceKey\");\nfor (var dataItem of currentData.list) {\n    if (dataItem[targetKey]==msg.payload[targetKey]) {\n        let msgOut={\n            \"topic\":globalContext+\".\"+dataContext+\".uiTable\",\n            \"room\": msg.payload.room,\n            \"datapointName\": env.get(\"datapointName\"),\n            \"payload\": msg.payload.targetValue,\n            \"groupContext\": globalContext+\".\"+groupContext+\".setValue\",\n            \"deviceName\": dataItem.deviceName,\n            \"roomID\": dataItem.roomId\n        };\n        statusText=msg.room;\n        msgsOut.push(msgOut);\n    }\n}\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msgsOut];","outputs":2,"noerr":0,"x":243,"y":85,"wires":[[],[]]},{"id":"50a20eeb.2b705","type":"link in","z":"897fdb2a.109f68","name":"systemStarted","links":["4db6721d.45de6c","15f2ac84.d7a7b3"],"x":508,"y":850,"wires":[["3ac3a2ea.8778be"]]},{"id":"699fa730.275918","type":"subflow:65174702.902988","z":"afaa0885.ad2718","name":"","env":[],"x":1488,"y":1071,"wires":[["d93a4627.4e4118"]]},{"id":"55af5083.9c7ef","type":"inject","z":"afaa0885.ad2718","name":"initalize","topic":"","payload":"{\"room\":\"Wohnzimmer\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1291,"y":1122,"wires":[["699fa730.275918"]]},{"id":"92b35afb.a03f08","type":"change","z":"afaa0885.ad2718","name":"add room","rules":[{"t":"set","p":"payload.room","pt":"msg","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1301,"y":1071,"wires":[["699fa730.275918"]]},{"id":"26b6adab.2176a2","type":"ui_button","z":"afaa0885.ad2718","name":"","group":"9ce06846.951a68","order":2,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"timer","payload":"true","payloadType":"bool","topic":"","x":645,"y":1207,"wires":[["c21d3752.fc2028"]]},{"id":"d66c2850.277c38","type":"ui_button","z":"afaa0885.ad2718","name":"high","group":"9ce06846.951a68","order":3,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"fa-thermometer-full fa-2x","payload":"true","payloadType":"bool","topic":"","x":645,"y":1275,"wires":[["292fb76e.8ec348"]]},{"id":"760c9a9f.5cff64","type":"ui_button","z":"afaa0885.ad2718","name":"low","group":"9ce06846.951a68","order":4,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"fa-thermometer-half fa-2x","payload":"true","payloadType":"bool","topic":"","x":645,"y":1377,"wires":[["e46441fd.cedc6"]]},{"id":"59d3d239.da2ccc","type":"ui_button","z":"afaa0885.ad2718","name":"Boost","group":"9ce06846.951a68","order":5,"width":2,"height":1,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"timelapse","payload":"true","payloadType":"bool","topic":"{{msg.topic}}","x":645,"y":1479,"wires":[["bc75e252.d90c9"]]},{"id":"2660d137.ac350e","type":"link out","z":"897fdb2a.109f68","name":"homematicThermotstat","links":["14ca55d8.90760a"],"x":933,"y":476,"wires":[]},{"id":"f2614149.ecb88","type":"function","z":"288b8cb6.42ac94","name":"preUI","func":"var statusText=\"\"\nif (msg.datapoint===env.get(\"datapoint\")) {\n    var msgUI={\"payload\":\"\"};\n    if (typeof msg.payload==\"boolean\") {\n        if (msg.payload) {\n            msgUI.ui_control={\"bgcolor\":\"#eb9534\"};\n            statusText=\"ein\";\n        } else {\n            msgUI.ui_control={\"bgcolor\":\"\"};\n            statusText=\"aus\";\n        }\n    } else {\n        if (msg.payload>0) {\n            msgUI.label=msg.payload+\"min\";\n            msgUI.ui_control={\"bgcolor\":\"#eb9534\"};\n        } else {\n            msgUI.label=\"aus\";\n            msgUI.ui_control={\"bgcolor\":\"\"};\n        }\n        statusText=msgUI.label;\n    }\n    return [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msgUI];\n}","outputs":2,"noerr":0,"x":186,"y":85,"wires":[[],[]]},{"id":"5bbb1b98.ca3604","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"BOOST_STATE","env":[{"name":"room","value":"Dusche","type":"str"}],"x":454,"y":1479,"wires":[["59d3d239.da2ccc"]]},{"id":"2fdefbc3.19e354","type":"ui_ui_control","z":"897fdb2a.109f68","name":"","events":"all","x":128,"y":969,"wires":[["59c024d4.156bfc"]]},{"id":"59c024d4.156bfc","type":"switch","z":"897fdb2a.109f68","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"connect","vt":"str"},{"t":"eq","v":"change","vt":"str"},{"t":"eq","v":"lost","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":289,"y":969,"wires":[["e486e65b.a94ce8"],["e486e65b.a94ce8"],["6096176e.2d1d88"]]},{"id":"e486e65b.a94ce8","type":"change","z":"897fdb2a.109f68","name":"uiInit","rules":[{"t":"set","p":"payload","pt":"msg","to":"uiInit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":475,"y":901,"wires":[["3ac3a2ea.8778be"]]},{"id":"6096176e.2d1d88","type":"function","z":"897fdb2a.109f68","name":"close socket","func":"var myUI=global.get(\"myUI\");\nif (myUI.hasOwnProperty(msg.socketid)) {\n    delete myUI[msg.socketid];\n    node.status({fill:\"green\",shape:\"dot\",text:\"socket closed!\"});\n} else {\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"socket unknown!\"});\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1000,"wires":[[]]},{"id":"374c9f22.55b41","type":"function","z":"77ddfba9.23c614","name":"postUI","func":"msg.room=env.get(\"room\");\nmsg.datapoint=env.get(\"datapoint\");\nmsg.topic=env.get(\"topic\");\n\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))}},null,null];\n}\nvar devices=currentObject.getObject(msg.topic);\nfor(var device in devices.list) {\n    if (devices.list[device].room==msg.room) {\n        msg.payload=!devices.list[device][msg.datapoint].value;\n        devices.list[device][msg.datapoint].value=msg.payload;\n    }\n}\nvar statusText= msg.room+\":\"+msg.datapoint+\"=\"+msg.payload;\nvar msgUI=(msg.payload)? \n    {\"ui_control\": {\"color\":\"#ffffff\",\"bgcolor\":\"#b87d2a\"}}:\n    {\"ui_control\": {\"color\":\"\",\"bgcolor\":\"\"}};\nmsgUI.payload=\"\";\nreturn [{payload:{fill:\"green\",shape:\"dot\",text: statusText}},msg,msgUI,{\"payload\":false}];","outputs":4,"noerr":0,"x":169,"y":85,"wires":[[],[],[],[]],"outputLabels":["state","toController","uiFeedback",""]},{"id":"bc75e252.d90c9","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"room","value":"Arbeitszimmer","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"}],"x":886,"y":1513,"wires":[["d0c8a047.0030d"],["59d3d239.da2ccc"],[]]},{"id":"d8deca34.d729f8","type":"link in","z":"897fdb2a.109f68","name":"setHomematic","links":["d0c8a047.0030d","d93a4627.4e4118"],"x":151,"y":578,"wires":[["33b98145.f2f30e","881e8a94.e84cb8"]]},{"id":"d0c8a047.0030d","type":"link out","z":"afaa0885.ad2718","name":"setHomematic","links":["d8deca34.d729f8"],"x":1120,"y":1343,"wires":[]},{"id":"33b98145.f2f30e","type":"function","z":"897fdb2a.109f68","name":"sendByRoom","func":"node.status({});\nif (msg.payload === undefined) return [null]\n\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text: \"could not get \"+msg.topic.slice(0,msg.topic.indexOf('.'))});\n    return [null,ui.disabled]\n}\n\nvar devices=currentObject.getObject(msg.topic);\n// node.warn([msg,devices]);\n\nmsgOut=[];\nfor(var device in devices.list) {\n    if (devices.list[device].room==msg.room) {\n        if (devices.list[device].hasOwnProperty(msg.datapoint) &&\n            devices.list[device][msg.datapoint].hasOwnProperty(\"datapointName\")) {\n            msgOut.push({\n                \"topic\":devices.list[device][msg.datapoint].datapointName,\n                \"payload\":msg.payload});\n            } else {\n                // node.error(\"Datapoint not found: \"+msg.datapoint);\n                // node.error(devices.list[device])\n            }\n    }\n}\nnode.status({fill:\"green\",shape:\"dot\",text: msg.room+\" \"+msg.datapoint+\"=\"+msg.payload});\nreturn msgOut;","outputs":1,"noerr":0,"x":319,"y":578,"wires":[["ee30b845.4157a8","ca6f4c89.711eb"]]},{"id":"ca6f4c89.711eb","type":"ccu-value","z":"897fdb2a.109f68","name":"","iface":"BidCos-RF","channel":"","datapoint":"","mode":"","start":true,"change":true,"cache":true,"queue":false,"on":0,"onType":"undefined","ramp":0,"rampType":"undefined","working":false,"ccuConfig":"dcd63e8.d157fc","topic":"${CCU}/${Interface}/${channel}/${datapoint}","x":526,"y":578,"wires":[[]]},{"id":"881e8a94.e84cb8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":288,"y":646,"wires":[]},{"id":"ee30b845.4157a8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":526,"y":646,"wires":[]},{"id":"d97e19b5.87a038","type":"ui_text_input","z":"dd3f4b52.8a4468","name":"name","label":"","tooltip":"","group":"1727a207.b3522e","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.heating.periods.name","x":560,"y":289,"wires":[["c9039c74.f2a3d"]]},{"id":"5439ed5.7be8814","type":"ui_button","z":"dd3f4b52.8a4468","name":"uiDelete","group":"1727a207.b3522e","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.heating.periods.uiDelete","x":570,"y":204,"wires":[["91115979.ce6ef8"]]},{"id":"d8b4dc09.39b6","type":"ui_date_picker","z":"dd3f4b52.8a4468","name":"start","label":"","group":"1727a207.b3522e","order":7,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.periods.start","x":560,"y":349,"wires":[["c9039c74.f2a3d"]]},{"id":"a23010ff.ec49c","type":"ui_date_picker","z":"dd3f4b52.8a4468","name":"end","label":"","group":"1727a207.b3522e","order":9,"width":6,"height":1,"passthru":false,"topic":"mySettings.heating.periods.end","x":560,"y":409,"wires":[["c9039c74.f2a3d"]]},{"id":"fa2b5d01.652dd","type":"ui_text","z":"dd3f4b52.8a4468","group":"1727a207.b3522e","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":164,"y":275,"wires":[]},{"id":"ead1e965.aa3f68","type":"ui_text","z":"dd3f4b52.8a4468","group":"1727a207.b3522e","order":6,"width":2,"height":1,"name":"Start:","label":"Anfang:","format":"{{msg.payload}}","layout":"row-spread","x":164,"y":335,"wires":[]},{"id":"e9936df2.ea103","type":"ui_text","z":"dd3f4b52.8a4468","group":"1727a207.b3522e","order":8,"width":2,"height":1,"name":"End:","label":"Ende:","format":"{{msg.payload}}","layout":"row-spread","x":164,"y":395,"wires":[]},{"id":"6a84f2d4.226abc","type":"ui_dropdown","z":"dd3f4b52.8a4468","name":"uiDropdown","label":"","tooltip":"","place":"Tage auswählen","group":"1727a207.b3522e","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.heating.periods.uiDropdown","x":580,"y":85,"wires":[["16747f89.5a9e6"]]},{"id":"f30d4ae0.421b58","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1005,"y":349,"wires":[]},{"id":"e5b0ccf8.8cbf9","type":"link in","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["f30d4ae0.421b58","aa9da778.95b658","480be8a7.ca3858","c3518fa6.aeb8c","286c7f51.fb355"],"x":66,"y":204,"wires":[["7ce76bdb.c899a4"]]},{"id":"aa9da778.95b658","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1001,"y":102,"wires":[]},{"id":"baf525eb.f5de78","type":"function","z":"dd3f4b52.8a4468","name":"save List","func":"node.status({});\nvar currentObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nif (!currentObject) return;\nvar currentProperty=currentObject.getCurrentEntry(msg.topic);\nif (!currentProperty) {\n    node.status({fill:\"red\",shape:\"dot\",text: msg.topic+\" not found\"});\n    return;\n}\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\n\ntry {\n    currentProperty.days.forEach(function (item,index) {\n        if (item.title.includes(msg.payload.title)) {\n            item.isChecked=msg.payload.isChecked;\n            node.status({fill:\"green\",shape:\"dot\",text:msg.payload.title+\"=\"+msg.payload.isChecked});\n            return msg;\n        }\n    });\n //   node.status({fill:\"yellow\",shape:\"dot\",text:msg.payload.title+\" not found\"});\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n} ","outputs":1,"noerr":0,"x":876,"y":459,"wires":[[]]},{"id":"c3518fa6.aeb8c","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1009,"y":215,"wires":[]},{"id":"43ac6074.ce415","type":"ui_button","z":"dd3f4b52.8a4468","name":"uiAdd","group":"1727a207.b3522e","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.heating.periods.uiAdd","x":564,"y":155,"wires":[["8efca346.1bc4e"]]},{"id":"286c7f51.fb355","type":"link out","z":"dd3f4b52.8a4468","name":"updatePeriod","links":["e5b0ccf8.8cbf9"],"x":1009,"y":155,"wires":[]},{"id":"5d2f0dd.1fe12f4","type":"switch","z":"dd3f4b52.8a4468","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.heating.periods.name","vt":"str"},{"t":"eq","v":"mySettings.heating.periods.start","vt":"str"},{"t":"eq","v":"mySettings.heating.periods.end","vt":"str"},{"t":"eq","v":"mySettings.heating.periods.days","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":360,"y":389,"wires":[["d97e19b5.87a038"],["d8b4dc09.39b6"],["a23010ff.ec49c"],["378844f7.a04c1c"]]},{"id":"91115979.ce6ef8","type":"ui_toast","z":"dd3f4b52.8a4468","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":740,"y":204,"wires":[["e52a49d0.5016a8"]]},{"id":"8ca231d8.0d419","type":"link out","z":"dd3f4b52.8a4468","name":"Periodenliste","links":["cee4b8dd.5e4678"],"x":525,"y":34,"wires":[]},{"id":"c9080f67.e24a6","type":"link in","z":"dd3f4b52.8a4468","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":66,"y":85,"wires":[["1fb940b1.6cff6f"]]},{"id":"16747f89.5a9e6","type":"subflow:c4a7cd6c.2a0c1","z":"dd3f4b52.8a4468","name":"","env":[],"x":876,"y":85,"wires":[["aa9da778.95b658"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"e52a49d0.5016a8","type":"subflow:d4a0d961.b11238","z":"dd3f4b52.8a4468","name":"","env":[],"x":886,"y":204,"wires":[["c3518fa6.aeb8c"]]},{"id":"c9039c74.f2a3d","type":"subflow:dfa4352b.bdc548","z":"dd3f4b52.8a4468","name":"","env":[],"x":870,"y":349,"wires":[["f30d4ae0.421b58"]]},{"id":"8efca346.1bc4e","type":"subflow:e0e53645.d85fd8","z":"dd3f4b52.8a4468","name":"addPeriod","env":[{"name":"defaults","value":"{\"note\":\"\",\"start\":0,\"end\":0,\"days\":[{\"title\":\"Montag\",\"description\":\"1. Tag der Woche\",\"isChecked\":false},{\"title\":\"Dienstag\",\"isChecked\":false},{\"title\":\"Mittwoch\",\"isChecked\":false},{\"title\":\"Donnerstag\",\"isChecked\":false},{\"title\":\"Freitag\",\"isChecked\":false},{\"title\":\"Samstag\",\"isChecked\":false},{\"title\":\"Sonntag\",\"isChecked\":false}]}","type":"json"}],"x":886,"y":153,"wires":[["286c7f51.fb355"]]},{"id":"1fb940b1.6cff6f","type":"subflow:e0e09953.42b938","z":"dd3f4b52.8a4468","name":"","env":[],"x":172,"y":85,"wires":[["a7df1d89.5a2f8","3cc8a52e.5c819a"]]},{"id":"7ce76bdb.c899a4","type":"subflow:30d3b36b.8d171c","z":"dd3f4b52.8a4468","name":"","env":[],"x":162,"y":204,"wires":[["a7df1d89.5a2f8"],["5d2f0dd.1fe12f4"]]},{"id":"a7df1d89.5a2f8","type":"subflow:8ba1eff6.75a11","z":"dd3f4b52.8a4468","name":"","env":[],"x":376,"y":85,"wires":[["8ca231d8.0d419","6a84f2d4.226abc","9180f1da.c0222"]]},{"id":"1f21ccbe.1ceb73","type":"ui_slider","z":"45367253.8faa7c","name":"defaultTemp","label":"","tooltip":"Standard Temperatur","group":"3e5d4543.e67aaa","order":7,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.defaultTemp","min":"10","max":"32","step":"0.5","x":563,"y":357,"wires":[["e8dd3ddb.3e972"]]},{"id":"681af0a6.9dd9c","type":"ui_numeric","z":"45367253.8faa7c","name":"defaultTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":8,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.defaultTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":563,"y":408,"wires":[["e8dd3ddb.3e972"]]},{"id":"59d8425e.6cb33c","type":"ui_slider","z":"45367253.8faa7c","name":"minTemp","label":"","tooltip":"minTemperatur","group":"3e5d4543.e67aaa","order":10,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.minTemp","min":"10","max":"32","step":"0.5","x":553,"y":459,"wires":[["e8dd3ddb.3e972"]]},{"id":"409b5ee3.734e7","type":"ui_numeric","z":"45367253.8faa7c","name":"minTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":11,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.minTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":553,"y":510,"wires":[["e8dd3ddb.3e972"]]},{"id":"bce7494b.8bcb38","type":"ui_slider","z":"45367253.8faa7c","name":"maxTemp","label":"","tooltip":"max Temperatur","group":"3e5d4543.e67aaa","order":13,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.maxTemp","min":"10","max":"32","step":"0.5","x":553,"y":561,"wires":[["e8dd3ddb.3e972"]]},{"id":"7f990308.4b3c6c","type":"ui_numeric","z":"45367253.8faa7c","name":"maxTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":14,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.maxTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":553,"y":612,"wires":[["e8dd3ddb.3e972"]]},{"id":"7657836a.dcf97c","type":"ui_slider","z":"45367253.8faa7c","name":"winTemp","label":"","tooltip":"Lüftungs Temperatur","group":"3e5d4543.e67aaa","order":16,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.rooms.winTemp","min":"10","max":"32","step":"0.5","x":553,"y":663,"wires":[["e8dd3ddb.3e972"]]},{"id":"81865311.1028b","type":"ui_numeric","z":"45367253.8faa7c","name":"winTemp","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":17,"width":2,"height":1,"passthru":false,"topic":"mySettings.rooms.winTemp","format":"{{value | number: 1}}","min":"10","max":"32","step":".5","x":553,"y":714,"wires":[["e8dd3ddb.3e972"]]},{"id":"bd444756.1d08e8","type":"link out","z":"45367253.8faa7c","name":"update Chart","links":["3bdaaf3a.acde6","c23e076c.76b9a8"],"x":967,"y":357,"wires":[]},{"id":"9c56db.a9d81928","type":"ui_text_input","z":"45367253.8faa7c","name":"name","label":"","tooltip":"","group":"3e5d4543.e67aaa","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.rooms.name","x":543,"y":306,"wires":[["e8dd3ddb.3e972"]]},{"id":"5c4901c3.c6544","type":"ui_button","z":"45367253.8faa7c","name":"uiDelete","group":"3e5d4543.e67aaa","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.rooms.uiDelete","x":553,"y":238,"wires":[["9f147b0d.831038"]]},{"id":"3b6634d0.2b351c","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":135,"y":306,"wires":[]},{"id":"47076641.09ba38","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":6,"width":2,"height":1,"name":"standard Temp","label":"standard:","format":"{{msg.payload}}","layout":"row-spread","x":165,"y":357,"wires":[]},{"id":"38794688.f7dafa","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":9,"width":2,"height":1,"name":"min Temp","label":"min:","format":"{{msg.payload}}","layout":"row-spread","x":145,"y":459,"wires":[]},{"id":"fcf56307.1a039","type":"ui_dropdown","z":"45367253.8faa7c","name":"uiDropdown","label":"","tooltip":"","place":"Raum auswählen","group":"3e5d4543.e67aaa","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.rooms.uiDropdown","x":563,"y":119,"wires":[["bf84f42d.48d7a8"]]},{"id":"e4ebc040.ea23a","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":306,"wires":[]},{"id":"7617b0dc.9c27a","type":"link in","z":"45367253.8faa7c","name":"updateRoom","links":["e4ebc040.ea23a","f5b51a0c.2d40f8","2184abed.0f3854","85b3a82f.196ff8","673d1103.fd2fe"],"x":49,"y":204,"wires":[["879210e4.df1dc"]]},{"id":"85b3a82f.196ff8","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":119,"wires":[]},{"id":"f5b51a0c.2d40f8","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":238,"wires":[]},{"id":"222984a5.3bf3ec","type":"ui_button","z":"45367253.8faa7c","name":"uiAdd","group":"3e5d4543.e67aaa","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.rooms.uiAdd","x":543,"y":187,"wires":[["aa9631f1.58127"]]},{"id":"2184abed.0f3854","type":"link out","z":"45367253.8faa7c","name":"","links":["7617b0dc.9c27a"],"x":967,"y":187,"wires":[]},{"id":"3801ce78.21bff2","type":"switch","z":"45367253.8faa7c","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.rooms.name","vt":"str"},{"t":"eq","v":"mySettings.rooms.defaultTemp","vt":"str"},{"t":"eq","v":"mySettings.rooms.minTemp","vt":"str"},{"t":"eq","v":"mySettings.rooms.maxTemp","vt":"str"},{"t":"eq","v":"mySettings.rooms.winTemp","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":339,"y":374,"wires":[["9c56db.a9d81928"],["1f21ccbe.1ceb73","681af0a6.9dd9c"],["59d8425e.6cb33c","409b5ee3.734e7"],["bce7494b.8bcb38","7f990308.4b3c6c"],["7657836a.dcf97c","81865311.1028b"]]},{"id":"9f147b0d.831038","type":"ui_toast","z":"45367253.8faa7c","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":706,"y":238,"wires":[["baca714f.0d771"]]},{"id":"c84c6ede.eac3a","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":12,"width":2,"height":1,"name":"max Temp","label":"max:","format":"{{msg.payload}}","layout":"row-spread","x":155,"y":561,"wires":[]},{"id":"65c3aa3.01ad954","type":"ui_text","z":"45367253.8faa7c","group":"3e5d4543.e67aaa","order":15,"width":2,"height":1,"name":"Fenster Temp","label":"Fenster:","format":"{{msg.payload}}","layout":"row-spread","x":165,"y":663,"wires":[]},{"id":"b2a258b.6903ca8","type":"link in","z":"45367253.8faa7c","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":49,"y":119,"wires":[["5f370c3b.990b24"]]},{"id":"a22aab5f.173ae8","type":"change","z":"45367253.8faa7c","name":"defaults","rules":[{"t":"set","p":"defaultTemp","pt":"msg","to":"23","tot":"num"},{"t":"set","p":"minTemp","pt":"msg","to":"16","tot":"num"},{"t":"set","p":"maxTemp","pt":"msg","to":"28","tot":"num"},{"t":"set","p":"winTemp","pt":"msg","to":"10","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":689,"y":153,"wires":[[]]},{"id":"bf84f42d.48d7a8","type":"subflow:c4a7cd6c.2a0c1","z":"45367253.8faa7c","name":"","env":[],"x":842,"y":119,"wires":[["85b3a82f.196ff8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"baca714f.0d771","type":"subflow:d4a0d961.b11238","z":"45367253.8faa7c","name":"","env":[],"x":852,"y":238,"wires":[["f5b51a0c.2d40f8"]]},{"id":"e8dd3ddb.3e972","type":"subflow:dfa4352b.bdc548","z":"45367253.8faa7c","name":"","env":[],"x":842,"y":306,"wires":[["e4ebc040.ea23a"]]},{"id":"aa9631f1.58127","type":"subflow:e0e53645.d85fd8","z":"45367253.8faa7c","name":"newRoom","env":[{"name":"defaults","value":"{\"type\":\"room\",\"note\":\"\",\"defaultTemp\":20,\"minTemp\":10,\"maxTemp\":26,\"winTemp\":10}","type":"json"}],"x":842,"y":187,"wires":[["2184abed.0f3854"]]},{"id":"5f370c3b.990b24","type":"subflow:e0e09953.42b938","z":"45367253.8faa7c","name":"","env":[{"name":"baseObject","value":"rooms","type":"str"}],"x":155,"y":119,"wires":[["43cbaf37.99f38"]]},{"id":"879210e4.df1dc","type":"subflow:30d3b36b.8d171c","z":"45367253.8faa7c","name":"","env":[],"x":145,"y":204,"wires":[["43cbaf37.99f38"],["3801ce78.21bff2"]]},{"id":"43cbaf37.99f38","type":"subflow:8ba1eff6.75a11","z":"45367253.8faa7c","name":"","env":[],"x":359,"y":119,"wires":[["fcf56307.1a039","2d70dbd3.249b94"]]},{"id":"2d70dbd3.249b94","type":"link out","z":"45367253.8faa7c","name":"Raumliste","links":["c50c7cfb.369ab"],"x":508,"y":68,"wires":[]},{"id":"4f125157.b64ed","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"LOWERING_MODE","env":[{"name":"dataPoint","value":"LOWERING_MODE","type":"str"},{"name":"room","value":"Dusche","type":"str"}],"x":474,"y":1377,"wires":[["760c9a9f.5cff64"]]},{"id":"e46441fd.cedc6","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"room","value":"Arbeitszimmer","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"},{"name":"parameter","value":"LOWERING_MODE","type":"str"}],"x":886,"y":1411,"wires":[["d0c8a047.0030d"],["760c9a9f.5cff64"],["59d3d239.da2ccc","d66c2850.277c38"]]},{"id":"d5c15893.96aca8","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"COMFORT_MODE","env":[{"name":"dataPoint","value":"COMFORT_MODE","type":"str"},{"name":"room","value":"Dusche","type":"str"}],"x":464,"y":1275,"wires":[["d66c2850.277c38"]]},{"id":"292fb76e.8ec348","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"room","value":"Arbeitszimmer","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"},{"name":"parameter","value":"COMFORT_MODE","type":"str"}],"x":886,"y":1309,"wires":[["d0c8a047.0030d"],["d66c2850.277c38"],["760c9a9f.5cff64","59d3d239.da2ccc"]]},{"id":"c21d3752.fc2028","type":"subflow:77ddfba9.23c614","z":"afaa0885.ad2718","name":"postButton","env":[{"name":"room","value":"Arbeitszimmer","type":"str"},{"name":"datapoint","value":"MANU_MODE","type":"str"},{"name":"topic","value":"mySettings.heating.devices.list","type":"str"},{"name":"parameter","value":"AUTO_MODE","type":"str"}],"x":886,"y":1241,"wires":[["d0c8a047.0030d"],["26b6adab.2176a2"],["59d3d239.da2ccc"]]},{"id":"92adb69e.7aed88","type":"subflow:288b8cb6.42ac94","z":"afaa0885.ad2718","name":"AUTO_MODE","env":[{"name":"datapoint","value":"MANU_MODE","type":"str"},{"name":"dataPoint","value":"AUTO_MODE","type":"str"},{"name":"room","value":"Dusche","type":"str"}],"x":454,"y":1207,"wires":[["26b6adab.2176a2"]]},{"id":"b6b74615.0add68","type":"ui_toast","z":"897fdb2a.109f68","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"New Room?","x":1005,"y":153,"wires":[["1559bf45.0da0c1"]]},{"id":"d3a1410.d6faac","type":"function","z":"897fdb2a.109f68","name":"pre","func":"msg.oiginalMsg=RED.util.cloneMessage(msg)\nmsg.topic=msg.payload\nmsg.payload=\"Neuer Raum erkannt, soll dieser hinzugefügt werden\";\nnode.status({fill:\"yellow\",shape:\"dot\",text: \"neu:\"+msg.room});\nreturn msg;","outputs":1,"noerr":0,"x":849,"y":153,"wires":[["b6b74615.0add68"]]},{"id":"1559bf45.0da0c1","type":"function","z":"897fdb2a.109f68","name":"post","func":"if (msg.payload==\"OK\"){\n    msg=msg.oiginalMsg;\n    node.status({fill:\"green\",shape:\"dot\",text: \"add: \"+msg.room});\n    return msg;\n} else {\n    node.status({fill:\"red\",shape:\"dot\",text: \"calcel: \"+msg.room});\n}\n    ","outputs":1,"noerr":0,"x":1155,"y":153,"wires":[[]]},{"id":"c0e3b6b0.78ffa8","type":"switch","z":"897fdb2a.109f68","name":"deviceType","property":"deviceType","propertyType":"msg","rules":[{"t":"eq","v":"HM-CC-RT-DN","vt":"str"},{"t":"eq","v":"HM-Sec-SCo","vt":"str"},{"t":"eq","v":"HMIP-PSM","vt":"str"},{"t":"eq","v":"HMIP-PS","vt":"str"},{"t":"eq","v":"HM-WDS30-OT2-SM","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":750,"y":629,"wires":[["2660d137.ac350e","8d504276.777d2"],["d81885f6.478168","f69e57b4.56cef8"],["de9df925.480858","df5b7229.0b5f4"],[],["af89e711.5e93c8","b2288398.2c648"]],"outputLabels":["Thermostat","Window","measuring Socket","Socket","temp sensor"]},{"id":"2c347f7a.6efd1","type":"link out","z":"897fdb2a.109f68","name":"ui-Table","links":["c6ef1a3f.b313c8"],"x":695,"y":440,"wires":[]},{"id":"c6ef1a3f.b313c8","type":"link in","z":"897fdb2a.109f68","name":"ui-table","links":["2c347f7a.6efd1"],"x":304,"y":799,"wires":[["e2184403.303c08"]]},{"id":"e2184403.303c08","type":"switch","z":"897fdb2a.109f68","name":"deviceType","property":"deviceType","propertyType":"msg","rules":[{"t":"eq","v":"HM-CC-RT-DN","vt":"str"},{"t":"eq","v":"HM-Sec-SCo","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":442,"y":799,"wires":[["3ac3a2ea.8778be"],[]]},{"id":"9cddbe0f.c49aa","type":"debug","z":"897fdb2a.109f68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1529,"y":595,"wires":[]},{"id":"d93a4627.4e4118","type":"link out","z":"afaa0885.ad2718","name":"setHomematic","links":["d8deca34.d729f8"],"x":1596,"y":1071,"wires":[]},{"id":"eb1d6c8d.22fee","type":"comment","z":"897fdb2a.109f68","name":"Handle outgoing messages for homematic devices","info":"","x":258,"y":527,"wires":[]},{"id":"40e23834.6b3c78","type":"function","z":"bbf5d78f.c16998","name":"filter Room","func":"if (msg.room==env.get(\"room\")) {\n    return [{payload:{fill:\"green\",shape:\"dot\",text: msg.room}},msg];\n} else {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text: msg.room}},null];\n}","outputs":2,"noerr":0,"x":206,"y":85,"wires":[[],[]]},{"id":"a0a1b0ea.47894","type":"subflow:bbf5d78f.c16998","z":"afaa0885.ad2718","name":"Arbeitszimmer","env":[],"x":206,"y":1054,"wires":[["5bbb1b98.ca3604","4f125157.b64ed","d5c15893.96aca8","92adb69e.7aed88","94bfa7d7.5b8398","dfd31a4e.2d22d8"]]},{"id":"14ca55d8.90760a","type":"link in","z":"afaa0885.ad2718","name":"homematicThermotstat","links":["2660d137.ac350e"],"x":83,"y":1088,"wires":[["a0a1b0ea.47894"]]},{"id":"5d20737b.4da22c","type":"inject","z":"309a0a3e.c49326","name":"initalize","topic":"mySettings","payload":"uiInit","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":111,"y":85,"wires":[["92438ce.e26927"]]},{"id":"92438ce.e26927","type":"function","z":"309a0a3e.c49326","name":"initMethods","func":"// expect global context name in msg.topic\n\nnode.status({});\n\n// get or initalize root for global store\nvar currentObject= global.get(msg.topic,\"file\");\nif (!currentObject) {\n    currentObject={};\n    global.set(msg.topic,currentObject,\"file\")\n}\n\n// generate UUID\ncurrentObject.uuid = function () {\n  function chr4(){\n    return Math.random().toString(16).slice(-4);\n  }\n  return chr4() + chr4() +\n    '-' + chr4() +\n    '-' + chr4() +\n    '-' + chr4() +\n    '-' + chr4() + chr4() + chr4();\n}\n\n// adjust x coordinate by sytem time zone\n// zone     : hours from GMT (-1 for CET / Berlin)\n\ncurrentObject.isUuid = function(payload) {\n    if (typeof payload == \"string\")\n        return (\n            payload.substr(8,1)=='-' &&\n            payload.substr(13,1)=='-'&&\n            payload.substr(18,1)=='-' &&\n            payload.substr(23,1)=='-')\n    return false;\n}\n\n// deep merge one object (source) into a target\ncurrentObject.merge = function (target,source) {\n//    node.warn(\"merge source\")\n//    node.warn(source);\n    for (var item in source) {\n        if (typeof source[item] === \"object\") {\n            if (Array.isArray(source[item])) { // because arrays are objects too!\n                if (typeof target[item] === \"object\" && !Array.isArray(target[item])) { // already existing?\n                    target[item]= []; // right type (array)?\n                } else {\n                    if (!Array.isArray(target[item])) target[item]= [];\n                }\n            } else { \n                if (target.hasOwnProperty(item) && typeof target[item] === \"object\") { // already existing?\n                    // keep existing\n                } else {\n                    target[item]= {};\n                }\n            }\n            this.merge(target[item],source[item])\n        } else {\n            if (target[item]===undefined) target[item]=source[item]; // do not overwrite\n        }\n    }\n//    node.warn(\"merge target\");\n//    node.warn(target);\n}\n\ncurrentObject.adjustTime = function (zone,point) {\n  point.x=point.x+(zone*3600000);\n  return point;\n}\n\n// sort a copy of an array of objects by name and keep the index\n// use for display purose or one time use ony\n//\n// originalArray : array of objects (must include name property)\n//\n// return       : sorted array as copy\n\ncurrentObject.saveSort = function(originalArray) {\n    var sortedArray=[]; // make a copy to not mess up the index for later use\n    originalArray.forEach(function(item,index){ \n        sortedArray.push(item);\n    });\n    // sorting should be save because it only sorts for display purpose\n    sortedArray.sort(function(a,b) {\n        if (a.name > b.name) return 1;\n        if (a.name < b.name) return -1;\n        return 0;\n    });\n    return sortedArray;\n}\n// store current settings in flow for durther use\ncurrentObject.getUI = function (socketid) {\n    var myUI=global.get(\"myUI\");\n    if (!myUI) {\n        myUI={\"version\":\"0.0.1\"}\n        global.set(\"myUI\",myUI);\n    }\n    if (!myUI[socketid]) {\n        myUI[socketid]= {\"socketid\":socketid};\n    }\n    return myUI[socketid];\n}\n\n// function to create object for specific topic\ncurrentObject.newObject = function(topic) {\n    var topicParts = topic.split('.');\n    var keyword=topicParts.pop();\n    if (keyword!='uiAdd') return undefined;\n    if (topicParts.length<2) return undefined;\n    var objectPtr=global.get(topicParts[0],\"file\");\n    for (var i=1; i<topicParts.length; i++) {\n        if (!objectPtr[topicParts[i]]) objectPtr[topicParts[i]]={}; // object not found so initialize it\n        objectPtr=objectPtr[topicParts[i]];\n    }\n    if (!objectPtr.list) objectPtr.list=[]; // initialize list if not existing\n    objectPtr.list.push({}); // add new object into list\n    objectPtr.list[objectPtr.list.length-1].uuid=this.uuid();\n    return objectPtr;\n};\n\n// function to get object holding the list array for specific topic or initialize the object\ncurrentObject.getObject = function(topic) {\n    if (!topic) return undefined;\n    if (typeof topic === \"object\") return topic; // topic is already object\n    var topicParts = topic.split('.');\n    if (topicParts.length<2) return undefined;\n    var objectPtr=global.get(topicParts[0],\"file\");\n    if (!objectPtr) {\n        node.error(\"getObject(\"+topic+\") global context '\"+topicParts[0]+\"' not found\");\n        return;\n    }\n    for (var i=1; i<topicParts.length-1; i++) { // ignore the last/entry identifier\n//        node.warn([\"getObject: \"+topicParts[i],objectPtr])\n        if (i<topicParts.length-2 && (objectPtr[topicParts[i]] && objectPtr[topicParts[i]].hasOwnProperty(\"list\"))) {\n            // select item the uiPointer points at\n            // ToDo: Make it multi user compatible using session id\n//            node.warn(\"getObject(\"+topic+\") \"+topicParts[i]+\" list[\"+objectPtr[topicParts[i]].uiPointer+\"]!\")\n            objectPtr=objectPtr[topicParts[i]].list[objectPtr[topicParts[i]].uiPointer];\n        } else {\n            if (!objectPtr[topicParts[i]]){ \n                node.warn(\"getObject(\"+topic+\") \"+topicParts[i]+\" initialized!\")\n                objectPtr[topicParts[i]]={}; // object not found so initialize it\n            }\n            objectPtr=objectPtr[topicParts[i]];\n        }\n//        node.warn(objectPtr)\n    }\n    if (!objectPtr.uiPointer) objectPtr.uiPointer= 0;\n    if (!objectPtr.list) objectPtr.list= [];\n    return objectPtr;\n};\n\n// function to get child object holding the list array for parententry or initialize a new\ncurrentObject.getSubObject = function(parent,childName) {\n    if (!parent || !childName) return undefined;\n    \n    // create child if not existing\n    if (!parent.hasOwnProperty(childName)) {\n        parent[childName]={\n            \"name\": childName,\n            \"uiPointer\": 0,\n            \"list\": []\n        }\n    }\n    \n    return parent[childName];\n};\n\n// function to get object for current entry ot of list[] where the uiPointer points to \n// topic    : path to object context/object/.../entryName OR object of list location\n//\n// return   : found or new object\n\ncurrentObject.getCurrentEntry = function(topic) {\n    var objectPrt;\n    try {\n        if (typeof topic !== \"object\") objectPtr= this.getObject(topic);\n            else objectPtr= topic;\n        if (objectPtr.uiPointer>=objectPtr.list.length) {\n            // node.warn(\"getCurrentEntry() corrected uiPointer!\")\n            objectPtr.uiPointer= objectPtr.list.length-1;\n        }\n        return objectPtr.list[objectPtr.uiPointer];\n    } catch (err) {\n        if (typeof topic === \"string\") node.warn(\"getCurrentEntry(\"+topic+\") failed!\")\n            else node.warn(\"getCurrentEntry(\"+objectPrt.name+\") failed!\")\n        return undefined;\n    }\n};\n\n// function to get entry UUID by name out of list defined by topic or object. Returns first match\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name to search for\n//\n// return   : uuid of found entry or undefined\n\ncurrentObject.getUuidByName = function (topic,name) {\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    // node.warn(objectPtr);\n    if (!objectPtr) return;\n    var uuid;\n    \n    objectPtr.list.forEach(function (item) {\n        if (item.name === name) {\n            uuid= item.uuid;\n            // node.warn(uuid);\n            return;\n        }\n    })\n    if (uuid) return uuid;\n        else return undefined;\n};\n\n// function to return entry by name or uuid out of list defined by topic\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name or\n// uuid     : uuid to search for\n//\n// return   : entry or undefined\n\ncurrentObject.entryExists = function(topic,uuid,target) {\n    if (!target && !this.isUuid(uuid)) { // to make function backwards compatible\n        node.error(\"entryExists(\"+topic+\",\"+uuid+\") uuid is not a valid uuid\")\n        return;\n    }\n    if (!target) target=\"uuid\" // use own uuid\n    \n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr || !objectPtr.list) return;\n\n    for (var i=0; i<objectPtr.list.length; i++) {\n        if (objectPtr.list[i][target]===uuid) {\n            return objectPtr.list[i];\n        }\n    }\n}\n\n// function to return index of Entry by name or uuid out of list defined by topic\n// topic    : path to object context/object/.../entryName OR object of list location\n// id       : name OG uuid to search for\n//\n// return   : entry or undefined\n\ncurrentObject.getIndexOfEntry = function(topic,id) {\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr || !objectPtr.list) return;\n    \n    var name,uuid;\n    if (this.isUuid(id)) uuid=id;\n    else name=id;\n\n    for (var i=0; i<objectPtr.list.length; i++) {\n        if ((name && objectPtr.list[i].name===name) ||\n            (uuid && objectPtr.list[i].uuid===uuid)) {\n            return i;\n        }\n    }\n    return 0;\n}\n\n// function to get object for current entry by uuid out of list defined by topic\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// uuid     : uuid to search for amd to set if new entry is created\n//\n// return   : found or new object\n\ncurrentObject.getEntry = function(topic,uuid,target) {\n    if (!this.isUuid(uuid)) { // to make function backwards compatible\n        node.error(\"getEntry(\"+topic+\",\"+uuid+\") uuid is not a valid uuid\")\n        return;\n    }\n    if (!target) target=\"uuid\" // use own uuid\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr) {\n        node.error(\"[getEntry] base object could not be found: \"+topic)\n        return;\n    }\n\n    var entryPtr;\n    if (!objectPtr.list) {\n        node.error(\"[getEntry] no list property found: \"+topic)\n        return;\n    } else {\n        entryPtr= this.entryExists(objectPtr,uuid,target);\n        if (entryPtr && !entryPtr.hasOwnProperty(\"uuid\")) entryPtr.uuid=this.uuid();\n    }\n\n    if (!entryPtr) { // define new entry in list\n        node.error(\"[getEntry] entry not found: \"+uuid+\" (\"+target+\")\");\n        return;\n    }\n    return entryPtr;\n};\n\n// function to create a new entry object\n// topic    : path to objtypeof topicect context/object/.../entryName OR object of list location\n// name     : name of the name to search for\n//\n// return   : new object\n\ncurrentObject.newEntry = function(topic,name) {\n\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n    if (!objectPtr){\n        node.error(\"[newEntry] base object could not be found: \"+topic)\n        return;\n    }\n\n    if (!objectPtr.list) {\n        objectPtr.list=[]; // initialize list if not existing\n        objectPtr.uiPointer= 0;\n        objectPtr.uiPointerUuid= \"\";\n    }\n\n    objectPtr.list.push({}); // add new object into list\n    entryPtr= objectPtr.list[objectPtr.list.length-1];\n    entryPtr.name= name;\n    entryPtr.uuid= this.uuid();\n    node.warn(\"New list Entry created: \"+objectPtr.name+\":\"+entryPtr.name);\n    objectPtr.uiPointer=objectPtr.list.length-1;\n    objectPtr.uiPointerUuid=entryPtr.uuid;\n    return entryPtr;\n};\n\n// function to get object for current entry by index number out of list defined by topic\ncurrentObject.getEntryByIndex = function(topic,index) {\n    var objectPrt;\n    if (typeof topic === \"string\") objectPtr=this.getObject(topic);\n        else objectPtr= topic;\n\n    if (objectPtr && objectPtr.list) {\n        return objectPtr.list[index];\n    } else return undefined;\n};\n\n// function to delete current entry out of list\n// topic        :   path to objtypeof topicect context/object/.../entryName OR object of list location\n// index        :   uuid or\n//                  index of entry to delete (uiPointer if undefined)\n\ncurrentObject.deleteEntry = function(topic,index) {\n    var objectPrt;\n    try {\n        if (typeof topic !== \"object\") objectPtr=this.getObject(topic);\n            else objectPtr= topic;\n        node.warn(\"[deleteEntry]\");\n        node.warn(objectPtr);\n        if (this.isUuid(index)) { // find index id uuid is given\n            index=this.getIndexOfEntry(objectPtr,index);\n        }\n        if (index === undefined) index=objectPtr.uiPointer;\n        if (index<objectPtr.list.length){\n            var returnObj= objectPtr.list.splice(index,1);\n            node.warn(\"[deleteEntry] Index :\"+index+\"(\"+returnObj.name+\") deleted (\"+objectPtr.list.length+\" items left)\");\n            if (returnObj) objectPtr.uiPointer=0;\n            return returnObj;\n        } else return undefined;\n    } catch (err) {\n        if (typeof topic === \"string\") node.warn(\"deleteEntry(\"+topic+\") failed!\")\n            else node.warn(\"deleteEntry(\"+objectPrt.name+\") failed!\")\n        return undefined;\n    }\n};\n\n// function to insert a list entry left from uiPointer and gives back the new Object\n// entryObject  : path to object context/object/.../entryName OR object of list location\n// index        : index of entry to delete (uiPointer if undefined)\ncurrentObject.insertItemLeft = function(topic,index) {\n    var objectPrt;\n    try {\n        if (typeof topic !== \"object\") objectPtr=this.getObject(topic);\n            else objectPrt= topic;\n        if (index === undefined) index= objectPtr.uiPointer;\n        objectPrt.list.splice(index,0,{});\n        return objectPrt.list[index];\n    } catch (err) {\n        if (typeof topic === \"string\") node.warn(\"insertItemLeft(\"+topic+\") failed!\")\n            else node.warn(\"insertItemLeft(\"+objectPrt.name+\") failed!\")\n        return undefined;\n    }\n}\n\n/*\n\n// (re)build Object Tree\ncurrentObject= currentObject.getObject(msg.topic);\nif (!currentObject) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"could not init: \"+msg.topic});\n}\n*/\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"done!\"});\nmsg.payload=\"OK\";\nreturn msg;\n","outputs":1,"noerr":0,"x":291,"y":85,"wires":[["614cbda8.934e84","15f2ac84.d7a7b3"]],"info":"# Functions defined here\n\n## uuid()\n### generate a uuid to identifiy elements\n\n#### parameter\n- none\n\n#### returns\n**uuid** _string_\n\n## isUuid(string)\n### check if a string is a valid uuid\n#### paramter\n- **string** to be tested\n\n#### returns\n**result** _boolean_"},{"id":"15f2ac84.d7a7b3","type":"link out","z":"309a0a3e.c49326","name":"systemStarted","links":["ad801e81.ee1dd","d1841267.e09a","63cdea8e.1d3a14","dc819b4e.c75fe8","c87c4075.3cbcb","e1a3f1e7.b946f","75144ced.ca12e4","b7d8835f.d797e","50a20eeb.2b705","c9080f67.e24a6","b2a258b.6903ca8","b0a62377.bb602","ff00a80a.192d38","9404d95d.fa6508","2ce7837b.02bc0c","21d36cb5.8ba4f4","cb81a114.a5004","fe243d47.7c894"],"x":440,"y":85,"wires":[]},{"id":"22a0c3e.f70223c","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":272,"wires":[["b09ca54e.d77f88"]]},{"id":"b09ca54e.d77f88","type":"function","z":"309a0a3e.c49326","name":"delete something","func":"var currentObject= global.get(\"mySettings\",\"file\");\ndelete currentObject.light.uiPointer\ndelete currentObject.light.list\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":272,"wires":[[]]},{"id":"614cbda8.934e84","type":"debug","z":"309a0a3e.c49326","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":475,"y":136,"wires":[]},{"id":"fa1ce257.9f07b","type":"comment","z":"309a0a3e.c49326","name":"initialize golbal store & methods","info":"","x":165,"y":37,"wires":[]},{"id":"3a6597b5.ca00c8","type":"comment","z":"309a0a3e.c49326","name":"tools","info":"","x":84,"y":204,"wires":[]},{"id":"a735300.f2772d","type":"ui_slider","z":"9831cab2.382058","name":"defaultDimmer","label":"","tooltip":"standard Dimmer","group":"c04d8bda.8dad98","order":18,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.devices.defaultDimmer","min":"0","max":"100","step":"1","x":658,"y":612,"wires":[["352cbb35.06d0d4"]]},{"id":"802dba90.2141f8","type":"ui_numeric","z":"9831cab2.382058","name":"defaultDimmer","label":"","tooltip":"","group":"c04d8bda.8dad98","order":19,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.devices.defaultDimmer","format":"","min":"0","max":"100","step":"1","x":658,"y":663,"wires":[["352cbb35.06d0d4"]]},{"id":"5ccaf23a.be91ac","type":"ui_text_input","z":"9831cab2.382058","name":"name","label":"","tooltip":"","group":"c04d8bda.8dad98","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.devices.name","x":628,"y":306,"wires":[["352cbb35.06d0d4"]]},{"id":"1e8fd4c0.df8beb","type":"ui_button","z":"9831cab2.382058","name":"uiDelete","group":"c04d8bda.8dad98","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.light.devices.uiDelete","x":638,"y":238,"wires":[["72c3dbc.c92f324"]]},{"id":"185cb6b5.1b0569","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":169,"y":306,"wires":[]},{"id":"2bfad25b.276b9e","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":17,"width":2,"height":1,"name":"standard Dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":209,"y":612,"wires":[]},{"id":"618f944e.278a8c","type":"ui_dropdown","z":"9831cab2.382058","name":"uiDropdown","label":"","tooltip":"","place":"Leuchtmittel auswählen","group":"c04d8bda.8dad98","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.devices.uiDropdown","x":648,"y":119,"wires":[["7a2bafc7.a25a"]]},{"id":"a3ea0d5e.05044","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1086,"y":476,"wires":[]},{"id":"49404117.0231f","type":"link in","z":"9831cab2.382058","name":"updateLightDevices","links":["276f613a.6a947e","5c47b568.ebd50c","673d1103.fd2fe","a3ea0d5e.05044","f2e67c30.a5a3f"],"x":83,"y":187,"wires":[["dc74b72e.539cd8"]]},{"id":"f2e67c30.a5a3f","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1069,"y":119,"wires":[]},{"id":"276f613a.6a947e","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1069,"y":238,"wires":[]},{"id":"cf0cae35.3ca73","type":"ui_button","z":"9831cab2.382058","name":"uiAdd","group":"c04d8bda.8dad98","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.light.devices.uiAdd","x":628,"y":187,"wires":[["a8dee692.284158"]]},{"id":"5c47b568.ebd50c","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["49404117.0231f"],"x":1069,"y":187,"wires":[]},{"id":"8683c82c.0ab1b8","type":"switch","z":"9831cab2.382058","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.devices.name","vt":"str"},{"t":"eq","v":"mySettings.light.devices.note","vt":"str"},{"t":"eq","v":"mySettings.light.devices.room","vt":"str"},{"t":"eq","v":"mySettings.light.devices.system","vt":"str"},{"t":"eq","v":"mySettings.light.devices.type","vt":"str"},{"t":"eq","v":"mySettings.light.devices.defaultSwitch","vt":"str"},{"t":"eq","v":"mySettings.light.devices.defaultDimmer","vt":"str"},{"t":"eq","v":"mySettings.light.devices.defaultColor","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":373,"y":340,"wires":[["5ccaf23a.be91ac"],["9052f83a.94a2d8"],["14e5aee6.c84bb1"],["359d7857.f33c98"],["73aa3271.12cf0c"],["fdd2bd54.a1e0a"],["802dba90.2141f8","a735300.f2772d"],["b01ad5ad.1debd8"]]},{"id":"72c3dbc.c92f324","type":"ui_toast","z":"9831cab2.382058","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"cancel","raw":false,"topic":"","name":"Delete?","x":791,"y":238,"wires":[["d51abd93.5310e"]]},{"id":"ff00a80a.192d38","type":"link in","z":"9831cab2.382058","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":83,"y":119,"wires":[["e3b27cfc.9d2c9"]]},{"id":"7a2bafc7.a25a","type":"subflow:c4a7cd6c.2a0c1","z":"9831cab2.382058","name":"setDevice","env":[],"x":944,"y":119,"wires":[["f2e67c30.a5a3f"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"d51abd93.5310e","type":"subflow:d4a0d961.b11238","z":"9831cab2.382058","name":"","env":[],"x":954,"y":238,"wires":[["276f613a.6a947e"]]},{"id":"352cbb35.06d0d4","type":"subflow:dfa4352b.bdc548","z":"9831cab2.382058","name":"","env":[],"x":961,"y":493,"wires":[["a3ea0d5e.05044","1581eb1f.859c75","8ef78348.73dce"]]},{"id":"a8dee692.284158","type":"subflow:e0e53645.d85fd8","z":"9831cab2.382058","name":"newDevice","env":[{"name":"defaults","value":"{\"type\":\"\",\"system\":\"\",\"room\":\"\",\"note\":\"\",\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1},\"defaultswitch\":false}","type":"json"}],"x":954,"y":187,"wires":[["5c47b568.ebd50c"]]},{"id":"e3b27cfc.9d2c9","type":"subflow:e0e09953.42b938","z":"9831cab2.382058","name":"light.devices","env":[{"name":"baseObject","value":"light.devices","type":"str"},{"name":"filterProperty","value":"","type":"str"},{"name":"filterValue","value":"","type":"str"}],"x":189,"y":119,"wires":[["35796416.49e6bc","14e5aee6.c84bb1"]]},{"id":"dc74b72e.539cd8","type":"subflow:30d3b36b.8d171c","z":"9831cab2.382058","name":"","env":[{"name":"uiControl","value":"{\"type\":{\"switch\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":false},\"defaultColor\":{\"enabled\":false}},\"dimmer\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":false}},\"rgb\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":true}},\"rgbw\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":true}},\"rgb-w\":{\"defaultSwitch\":{\"enabled\":true},\"defaultDimmer\":{\"enabled\":true},\"defaultColor\":{\"enabled\":true}}}}","type":"json"}],"x":179,"y":187,"wires":[["35796416.49e6bc"],["8683c82c.0ab1b8"]]},{"id":"35796416.49e6bc","type":"subflow:8ba1eff6.75a11","z":"9831cab2.382058","name":"","env":[],"x":393,"y":119,"wires":[["618f944e.278a8c","a55589e2.8611b8"]]},{"id":"359d7857.f33c98","type":"ui_dropdown","z":"9831cab2.382058","name":"system","label":"","tooltip":"","place":"System auswählen","group":"c04d8bda.8dad98","order":11,"width":6,"height":1,"passthru":false,"options":[{"label":"milight","value":"milight","type":"str"},{"label":"zigbee","value":"zigbee","type":"str"},{"label":"Selbstgebaut","value":"homie","type":"str"}],"payload":"","topic":"mySettings.light.devices.system","x":638,"y":459,"wires":[["352cbb35.06d0d4"]]},{"id":"73aa3271.12cf0c","type":"ui_dropdown","z":"9831cab2.382058","name":"type","label":"","tooltip":"","place":"System auswählen","group":"c04d8bda.8dad98","order":13,"width":6,"height":1,"passthru":false,"options":[{"label":"RGB","value":"rgb","type":"str"},{"label":"RGBW","value":"rgbw","type":"str"},{"label":"RGB oder W","value":"rgb-w","type":"str"},{"label":"Dimmer","value":"dimmer","type":"str"},{"label":"Schalter","value":"switch","type":"str"}],"payload":"","topic":"mySettings.light.devices.type","x":628,"y":510,"wires":[["352cbb35.06d0d4"]]},{"id":"78e54211.d0990c","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":10,"width":2,"height":1,"name":"System:","label":"System:","format":"{{msg.payload}}","layout":"row-spread","x":179,"y":459,"wires":[]},{"id":"7b502723.428028","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":12,"width":2,"height":1,"name":"Typ:","label":"Typ:","format":"{{msg.payload}}","layout":"row-spread","x":169,"y":510,"wires":[]},{"id":"5a59342e.f0f39c","type":"function","z":"459559af.3bd1b8","name":"enableUI","func":"var topicParts=msg.topic.split('.');\nvar currentObject= global.get(topicParts[0],\"file\");\nif (!currentObject) return;\nvar keyword = topicParts.pop();\nvar currentProperty=currentObject.getObject(msg.topic);\nif (!currentProperty) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n}\n\nvar statusText=\"\";\nvar msgOut={};\nif (!currentProperty.list || currentProperty.list.length===0) {\n    msgOut.enabled=false\n    statusText=\"disabled\";\n} else {\n    if (msg.hasOwnProperty(\"enabled\")) {\n        statusText= (msg.enabled)? \"enabled\" : \"disabled\";\n        msgOut.enabled=msg.enabled;\n    } else {\n        statusText=\"enabled\";\n        msgOut.enabled=true;\n    }\n}\n\nreturn [{payload:{fill:\"green\",shape:\"dot\",statusText}},msgOut];","outputs":2,"noerr":0,"x":197,"y":85,"wires":[[],[]]},{"id":"b01ad5ad.1debd8","type":"ui_colour_picker","z":"9831cab2.382058","name":"","label":"","group":"c04d8bda.8dad98","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":21,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.devices.defaultColor","x":648,"y":714,"wires":[["352cbb35.06d0d4"]]},{"id":"73579303.2ebd0c","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":20,"width":2,"height":1,"name":"standard Farbe","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":199,"y":714,"wires":[]},{"id":"7d44685b.569b28","type":"function","z":"653c3a89.08f864","name":"fill ui-list","func":"if (!msg.topic) msg.topic=env.get(\"topic\");\nvar topicParts=msg.topic.split('.');\nvar myStore = topicParts[0];\n// get Base from global store\nvar baseObject= global.get(myStore,\"file\");\nif (!baseObject) return [{payload:{fill:\"red\",shape:\"dot\",text:\"store: \"+myStore+\" not found\"}},null];\n// get groups object\nvar keyword = topicParts.pop();\nvar groups=baseObject.getObject(msg.topic);\nif (!groups) return [{payload:{fill:\"red\",shape:\"dot\",text:\"msg.topic='object.property' expected\"}},null];\n// get current group selected\nvar group= baseObject.getCurrentEntry(groups);\n// get devices in current group\nvar devProperty = env.get(\"devProperty\");\nvar groupDevices= baseObject.getSubObject(group,devProperty);\n\nvar listSources=env.get(\"listSources\");\nvar listEntry= {};\nmsg.payload=[];\n\nlistSources.forEach(function (currentSource){\n\n    // get devices list object\n    var devices= baseObject.getObject(myStore+\".\"+currentSource.source+\".uiList\");\n    \n    if (devices.list !== undefined) {\n        var sortedDevices=baseObject.saveSort(devices.list);\n        // loop through all devices\n        sortedDevices.forEach(function(device){\n            listEntry={};\n            listEntry.title=device.name;\n            listEntry.type=currentSource.type;\n            listEntry.uuid=device.uuid;\n            listEntry.icon_name= currentSource.icon;\n            listEntry.isChecked= false;\n            // loop throug devices defined in group\n            for (var groupDevice of groupDevices.list) {\n                if (groupDevice.elementUuid === device.uuid) { // match by uuid\n                    listEntry.isChecked= groupDevice.isChecked;\n                    break;\n                }\n            }\n            msg.payload.push(listEntry);\n        });\n    }\n});\n\nif (msg.payload.length>0){\n    return [{payload:{fill:\"green\",shape:\"dot\",text:msg.payload.length+\" items\"}},msg];\n} else {\n    return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"list is empty\"}},null];\n}\n\n\ntry {\n\n} catch (err) {\n    return [{payload:{fill:\"red\",shape:\"dot\",text:\"No list entry\"}},null];\n}","outputs":2,"noerr":0,"x":196,"y":85,"wires":[[],[]]},{"id":"a55589e2.8611b8","type":"link out","z":"9831cab2.382058","name":"updateLightDevices","links":["321364bf.d6ae6c","284e5776.5b72b8","528a0ee.43886f"],"x":593,"y":85,"wires":[]},{"id":"fdd2bd54.a1e0a","type":"ui_switch","z":"9831cab2.382058","name":"","label":"","tooltip":"","group":"c04d8bda.8dad98","order":15,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.devices.defaultSwitch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":628,"y":561,"wires":[["352cbb35.06d0d4"]]},{"id":"c2ad1135.5249c","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":14,"width":2,"height":1,"name":"standard Schalter","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":209,"y":561,"wires":[]},{"id":"120e96ed.3b4ec9","type":"MiLight","z":"4635654.3abb19c","name":"Schreibtischleuchte","bridgetype":"legacy","bulbtype":"rgbw","zone":"4","ip":"192.168.2.20","broadcast":false,"x":974,"y":204,"wires":[]},{"id":"31915d49.c1d6a2","type":"link in","z":"4635654.3abb19c","name":"setLight","links":["1581eb1f.859c75","f669e0e2.6f196","c07b76a5.fce788","9194a4d8.035d58","511d94e8.4e555c","2310ff72.1a31c","8e4d3523.343658","c5450f7d.ea00c","2a46f326.e0eb6c"],"x":49,"y":238,"wires":[["1cd2078f.2c4918","20fbf6c1.9052aa"]]},{"id":"b0eb9abe.196d58","type":"switch","z":"4635654.3abb19c","name":"System","property":"property.system","propertyType":"msg","rules":[{"t":"eq","v":"milight","vt":"str"},{"t":"eq","v":"homie","vt":"str"},{"t":"eq","v":"zigbee","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":366,"y":238,"wires":[["2ab2dbb3.063354","37d98b1.2f2cf74"],[],[]]},{"id":"768f72f8.3f213c","type":"switch","z":"4635654.3abb19c","name":"uuid","property":"uuid","propertyType":"msg","rules":[{"t":"eq","v":"8a91a9b8-226f-3c0d-fb37-3e490bc714bc","vt":"str"},{"t":"eq","v":"c3f1aab3-d959-4275-fd56-b28b856b6ebf","vt":"str"},{"t":"eq","v":"b4b4025b-9a05-b3a3-6e7b-dd81caa15899","vt":"str"},{"t":"eq","v":"0c2a7b26-5fd6-5e3f-6eec-5295804ba98f","vt":"str"},{"t":"eq","v":"147626f2-d8a9-642b-8de4-24445f521c19","vt":"str"},{"t":"eq","v":"65911eb5-032b-17e9-822e-a2df695f158f","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":7,"x":764,"y":187,"wires":[["cb162cff.aaf0b"],["e487706f.bcd42"],["1bf4c321.058e4d"],["120e96ed.3b4ec9"],["862f84f3.326078"],["4b8af7ad.587268"],["8ff02f5b.a940f"]],"outputLabels":["Kugel Fenster","Kugel Bad","Schreibtischleuchte","Stehleuchte","Nachtischlampe Jomo","Nachtischlampe Chris",null]},{"id":"1581eb1f.859c75","type":"link out","z":"9831cab2.382058","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1086,"y":510,"wires":[]},{"id":"2ab2dbb3.063354","type":"function","z":"4635654.3abb19c","name":"prepareMilight","func":"var msgOut= {\n    \"name\": msg.property.name,\n    \"uuid\": msg.property.uuid\n};\n\nvar command= msg.topic.slice(msg.topic.lastIndexOf('.')+1);\n\nfunction hsvToRgb(hsv) {\n  var h=hsv.h/360;\n  var s=hsv.s;\n  var v=hsv.v;\n  var r, g, b;\n\n  var i = Math.floor(h * 6);\n  var f = h * 6 - i;\n  var p = v * (1 - s);\n  var q = v * (1 - f * s);\n  var t = v * (1 - (1 - f) * s);\n\n  switch (i % 6) {\n    case 0: r = v; g = t; b = p; break;\n    case 1: r = q; g = v; b = p; break;\n    case 2: r = p; g = v; b = t; break;\n    case 3: r = p; g = q; b = v; break;\n    case 4: r = t; g = p; b = v; break;\n    case 5: r = v; g = p; b = q; break;\n  }\n\n  return \"rgb(\"+Math.floor(r * 255)+\",\"+Math.floor(g * 255)+\",\"+Math.floor(b * 255)+\")\";\n}\n\nswitch (command) {\n    case \"switch\":\n    case \"defaultSwitch\":\n        msgOut.payload= (msg.property.defaultSwitch)? \"on\" : \"off\";\n        break;\n    case \"dimmer\":\n    case \"defaultDimmer\":\n        msgOut.payload= msg.property.defaultDimmer;\n        msgOut.topic= \"brightness\"\n        break;\n    case \"color\":\n    case \"defaultColor\":\n        msgOut=[];\n        if (msg.property.defaultColor.s<0.05) {\n           msgOut.push({\n                \"name\": msg.property.name,\n                \"uuid\": msg.property.uuid,\n                \"payload\":\"white\"});\n           msgOut.push({\n                \"name\": msg.property.name, \n                \"uuid\": msg.property.uuid,\n                \"topic\":\"brightness\", \n                \"payload\":Math.floor(msg.property.defaultColor.v*100)});\n        } else {\n            msgOut.push({\n                \"name\": msg.property.name, \n                \"uuid\": msg.property.uuid,\n                \"topic\":\"brightness\", \n                \"payload\":Math.floor(msg.property.defaultColor.v*100)});\n//           msgOut.push({\"name\": msg.property.name, \"topic\":\"color\", \"payload\":255-Math.floor(msg.property.defaultColor.h*(255/360))});\n            msgOut.push({\n                \"name\": msg.property.name, \n                \"uuid\": msg.property.uuid,\n                \"topic\":\"rgb\", \n                \"payload\":hsvToRgb(msg.property.defaultColor)});\n        }\n        node.status({fill:\"green\",shape:\"dot\",text:msgOut.name+\"=color\"});\n        return [msgOut];\n}\n\nif (msgOut.payload) {\n    node.status({fill:\"green\",shape:\"dot\",text:msgOut.name+\"=\"+msgOut.payload});\n    return msgOut;\n}\nnode.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});","outputs":1,"noerr":0,"x":573,"y":187,"wires":[["768f72f8.3f213c","46b5afd2.1a88c"]]},{"id":"cb162cff.aaf0b","type":"MiLight","z":"4635654.3abb19c","name":"Kugel Bad","bridgetype":"legacy","bulbtype":"rgbw","zone":"1","ip":"192.168.2.20","broadcast":false,"x":954,"y":102,"wires":[]},{"id":"37d98b1.2f2cf74","type":"debug","z":"4635654.3abb19c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":136,"wires":[]},{"id":"e487706f.bcd42","type":"MiLight","z":"4635654.3abb19c","name":"Kugeln Wohnzimmer","bridgetype":"legacy","bulbtype":"rgbw","zone":"2","ip":"192.168.2.20","broadcast":false,"x":984,"y":136,"wires":[]},{"id":"1bf4c321.058e4d","type":"MiLight","z":"4635654.3abb19c","name":"Stehleuchte","bridgetype":"legacy","bulbtype":"rgbw","zone":"3","ip":"192.168.2.20","broadcast":false,"x":954,"y":170,"wires":[]},{"id":"862f84f3.326078","type":"MiLight","z":"4635654.3abb19c","name":"Nachttischleuchte Jomo","bridgetype":"legacy","bulbtype":"rgbw","zone":"2","ip":"192.168.2.21","broadcast":false,"x":994,"y":238,"wires":[]},{"id":"4b8af7ad.587268","type":"MiLight","z":"4635654.3abb19c","name":"Nachttischleuchte Christian","bridgetype":"legacy","bulbtype":"rgbw","zone":"1","ip":"192.168.2.21","broadcast":false,"x":1004,"y":272,"wires":[]},{"id":"b99ddb18.33f108","type":"function","z":"274dc61a.3c17aa","name":"Group","func":"var groupTopic= env.get(\"groupTopic\");\nvar groupMembers=env.get(\"groupMembers\");\nvar sceneTopic=env.get(\"sceneTopic\") || \"scenes\";\nvar sceneMembers=env.get(\"sceneMembers\");\n\nif (!msg.topic) msg.topic=env.get(\"topic\");\nvar topicParts=msg.topic.split('.');\nvar myStore = topicParts[0];\n// get Base from global store\nvar baseObject= global.get(myStore,\"file\");\nvar devices= baseObject.getObject(myStore+\".\"+env.get(\"devices\")+\".uiList\");\nvar device= {};\nvar msgOut=[];\n\nswitch (topicParts[topicParts.length-2]) {\n    case sceneTopic : // control scene \n        if (msg.property.hasOwnProperty(sceneMembers)) {\n            msg.property[sceneMembers].list.forEach(function (light) {\n                if (light.isChecked) {\n                   device=baseObject.getEntry(devices,light.lightUuid)\n                   msgOut.push({\n                       \"topic\": msg.topic,\n                       \"property\": {\n                           \"name\": light.name,\n                           \"system\": device.system,\n                           \"type\": device.type,\n                           \"defaultSwitch\": (topicParts[topicParts.length-1]===\"switch\") ? msg.payload : light.switch,\n                           \"defaultDimmer\": (topicParts[topicParts.length-1]===\"dimmer\") ? light.dimmer*(msg.payload/100) : light.dimmer,\n                           \"defaultColor\": (topicParts[topicParts.length-1]===\"tint\") ? light.color : msg.property.defaultColor\n                       }\n                   });\n               }\n            });\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"scene: \"+msg.property.name}},msgOut];\n        } else {\n            node.warn(msg)\n        }\n        break;\n    case sceneMembers : // control scene members\n        if (msg.property.hasOwnProperty(sceneMembers)) {\n            msg.property[sceneMembers].list.forEach(function (light) {\n                if (light.isChecked) {\n                   device=baseObject.getEntry(devices,light.lightUuid)\n                   msgOut.push({\n                       \"topic\": msg.topic,\n                       \"property\": {\n                           \"name\": light.name,\n                           \"system\": device.system,\n                           \"type\": device.type,\n                           \"defaultSwitch\": (topicParts[topicParts.length-1]===\"defaultSwitch\") ? msg.payload : light.switch,\n                           \"defaultDimmer\": (topicParts[topicParts.length-1]===\"defaultDimmer\") ? light.dimmer*(msg.payload/100) : light.dimmer,\n                           \"defaultColor\": light.color\n                       }\n                   });\n               }\n            });\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"scene: \"+msg.property.name}},msgOut];\n        } else { // single scene Member\n            device=baseObject.getEntry(devices,msg.property.elementUuid)\n            msgOut={\n                       \"topic\": msg.topic,\n                       \"property\": {\n                           \"name\": device.name,\n                           \"uuid\": msg.property.elementUuid, \n                           \"system\": device.system,\n                           \"type\": device.type,\n                           \"defaultSwitch\": (topicParts[topicParts.length-1]===\"switch\") ? msg.payload : device.defaultSwitch,\n                           \"defaultDimmer\": (topicParts[topicParts.length-1]===\"dimmer\") ? Math.floor(device.defaultDimmer*(msg.payload/100)) : device.defaultDimmer,\n                           \"defaultColor\": (topicParts[topicParts.length-1]===\"color\") ? msg.payload : device.defaultColor\n                       }\n                   };\n            node.warn({\"task\":\"singleSceneMember\",\"devices\":devices,\"device\":device});\n            return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"single device\"}},msgOut];\n        }\n        break;\n    case groupTopic : // control group members;\n        if (msg.property.hasOwnProperty(groupMembers)) {\n            msg.property[groupMembers].list.forEach(function (light) {\n               if (light.isChecked) {\n                   device=baseObject.getEntry(devices,light.uuid)\n                   if (device===undefined) { // device does not exist any more so delete link\n                        var erasedEntry = baseObject.deleteEntry(msg.property[groupMembers],light.uuid);\n                        if (erasedEntry) node.warn(\"sub[groupSend] success: \"+erasedEntry.name+\" deleted\")\n                        else node.error(\"sub[groupSend] failed to delete non existing device: \"+light.name+\" \"+light.uuid);\n                   } else {\n                       msgOut.push({\n                           \"topic\": msg.topic,\n                           \"property\": {\n                               \"name\": light.name,\n                               \"uuid\": light.uuid,\n                               \"system\": device.system,\n                               \"type\": device.type,\n                               \"defaultSwitch\": msg.property.defaultSwitch,\n                               \"defaultDimmer\": msg.property.defaultDimmer,\n                               \"defaultColor\": msg.property.defaultColor\n                           }\n                       });\n                   }\n               }\n            });\n            return [{payload:{fill:\"green\",shape:\"dot\",text:\"group: \"+msg.property.name}},msgOut];\n        }\n        break;\n    default :\n        //node.warn(msg)\n        return [{payload:{fill:\"yellow\",shape:\"dot\",text:\"single device\"}},msg];\n}\n","outputs":2,"noerr":0,"x":203,"y":85,"wires":[[],[]]},{"id":"1cd2078f.2c4918","type":"subflow:274dc61a.3c17aa","z":"4635654.3abb19c","name":"","env":[{"name":"sceneControl","value":"sceneMembers","type":"str"},{"name":"groupProperty","value":"groups","type":"str"}],"x":189,"y":238,"wires":[["b0eb9abe.196d58","b3a4ef66.0ea08"]]},{"id":"842280d1.71514","type":"http in","z":"4635654.3abb19c","name":"Lights","url":"/lights","method":"put","upload":false,"swaggerDoc":"","x":170,"y":408,"wires":[["21649ad0.b262a6","df1057ea.990088"]]},{"id":"21649ad0.b262a6","type":"debug","z":"4635654.3abb19c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":339,"y":459,"wires":[]},{"id":"df1057ea.990088","type":"http response","z":"4635654.3abb19c","name":"","statusCode":"","headers":{},"x":339,"y":408,"wires":[]},{"id":"6cd5f93f.c42ac8","type":"function","z":"9848cbbf.0bdd68","name":"save List","func":"node.status({});\nvar baseObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\nif (!baseObject) return;\nvar currentObject= baseObject.getCurrentEntry(msg.topic);\nvar currentGroup= baseObject.getSubObject(currentObject,propertyName);\n\ntry {\n    var currentEntry= baseObject.getEntry(currentGroup,msg.payload.uuid);\n    currentEntry.isChecked=msg.payload.isChecked;\n    currentEntry.name=msg.payload.title;\n    node.status({fill:\"green\",shape:\"dot\",text:currentObject.name+\": \"+msg.payload.title+\"=\"+msg.payload.isChecked});\n    return msg;\n} catch (err) {\n    node.status({fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"});\n} ","outputs":1,"noerr":0,"x":774,"y":510,"wires":[[]]},{"id":"616ec306.1ee08c","type":"subflow:653c3a89.08f864","z":"9848cbbf.0bdd68","name":"","env":[{"name":"listSources","value":"[{\"source\":\"light.devices\",\"icon\":\"lightbulb_outline\"}]","type":"json"}],"x":434,"y":510,"wires":[["3d08e03a.a8722","66c5ebf.74f0b14"]]},{"id":"85c6dad8.203e68","type":"debug","z":"9848cbbf.0bdd68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":764,"y":561,"wires":[]},{"id":"f160fc2b.9fce1","type":"ui_slider","z":"9848cbbf.0bdd68","name":"defaultDimmer","label":"","tooltip":"standard Dimmer","group":"ceeb11f0.8bfba","order":10,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.groups.defaultDimmer","min":"0","max":"100","step":"1","x":624,"y":357,"wires":[["cd630682.9c0b08"]]},{"id":"77f72e8.ab5d6d","type":"ui_numeric","z":"9848cbbf.0bdd68","name":"defaultDimmer","label":"","tooltip":"","group":"ceeb11f0.8bfba","order":11,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.groups.defaultDimmer","format":"","min":"0","max":"100","step":"1","x":624,"y":408,"wires":[["cd630682.9c0b08"]]},{"id":"85ae12e7.de203","type":"ui_text_input","z":"9848cbbf.0bdd68","name":"name","label":"","tooltip":"","group":"ceeb11f0.8bfba","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.groups.name","x":594,"y":255,"wires":[["cd630682.9c0b08"]]},{"id":"85af380f.768348","type":"ui_button","z":"9848cbbf.0bdd68","name":"uiDelete","group":"ceeb11f0.8bfba","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.light.groups.uiDelete","x":604,"y":187,"wires":[["e3e5ccaa.594e5"]]},{"id":"d9ad01b3.7ea9f","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":186,"y":255,"wires":[]},{"id":"c4be6731.b42308","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":9,"width":2,"height":1,"name":"standard Dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":226,"y":357,"wires":[]},{"id":"c47db1b3.19356","type":"ui_dropdown","z":"9848cbbf.0bdd68","name":"uiDropdown","label":"","tooltip":"","place":"Gruppe auswählen","group":"ceeb11f0.8bfba","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.groups.uiDropdown","x":614,"y":68,"wires":[["6f691c7e.4b7c24","8393ba63.84f3c8"]]},{"id":"81813d03.04566","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":238,"wires":[]},{"id":"43d9e00d.06c2e","type":"link in","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["81813d03.04566","c4eedb06.193328","673d1103.fd2fe","9f49f524.a5ab28","4eb2691a.86f7e8"],"x":100,"y":136,"wires":[["2a2d3f8d.a5686"]]},{"id":"4eb2691a.86f7e8","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":68,"wires":[]},{"id":"9f49f524.a5ab28","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":187,"wires":[]},{"id":"d9481c11.8e89c","type":"ui_button","z":"9848cbbf.0bdd68","name":"uiAdd","group":"ceeb11f0.8bfba","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.light.groups.uiAdd","x":594,"y":136,"wires":[["b9b20930.263498"]]},{"id":"c4eedb06.193328","type":"link out","z":"9848cbbf.0bdd68","name":"updateLightGroups","links":["43d9e00d.06c2e"],"x":1018,"y":136,"wires":[]},{"id":"7215d6df.f42878","type":"switch","z":"9848cbbf.0bdd68","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.groups.name","vt":"str"},{"t":"eq","v":"mySettings.light.groups.defaultSwitch","vt":"str"},{"t":"eq","v":"mySettings.light.groups.defaultDimmer","vt":"str"},{"t":"eq","v":"mySettings.light.groups.defaultColor","vt":"str"},{"t":"eq","v":"mySettings.light.groups.groupMembers","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":390,"y":289,"wires":[["85ae12e7.de203"],["cac70d3a.7430f"],["77f72e8.ab5d6d","f160fc2b.9fce1"],["2d5501ae.16dcbe"],["616ec306.1ee08c","6ad0bae2.005634"]]},{"id":"e3e5ccaa.594e5","type":"ui_toast","z":"9848cbbf.0bdd68","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","topic":"","name":"Delete?","x":757,"y":187,"wires":[["e33eebe2.253908"]]},{"id":"2ce7837b.02bc0c","type":"link in","z":"9848cbbf.0bdd68","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":100,"y":68,"wires":[["55f88a42.fd86c4"]]},{"id":"7d53c565.2686ac","type":"change","z":"9848cbbf.0bdd68","name":"defaults","rules":[{"t":"set","p":"system","pt":"msg","to":"milight","tot":"str"},{"t":"set","p":"type","pt":"msg","to":"rgb-w","tot":"str"},{"t":"set","p":"defaultDimmer","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"defaultColor","pt":"msg","to":"hsv","tot":"str"},{"t":"set","p":"groupMembers","pt":"msg","to":"{\"name\":\"groupMembers\",\"uiPointer\":0,\"list\":[]}","tot":"json"},{"t":"set","p":"defaultSwitch","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":119,"wires":[[]]},{"id":"6f691c7e.4b7c24","type":"subflow:c4a7cd6c.2a0c1","z":"9848cbbf.0bdd68","name":"","env":[],"x":893,"y":68,"wires":[["4eb2691a.86f7e8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"e33eebe2.253908","type":"subflow:d4a0d961.b11238","z":"9848cbbf.0bdd68","name":"","env":[],"x":903,"y":187,"wires":[["9f49f524.a5ab28"]]},{"id":"cd630682.9c0b08","type":"subflow:dfa4352b.bdc548","z":"9848cbbf.0bdd68","name":"","env":[],"x":893,"y":255,"wires":[["81813d03.04566","c07b76a5.fce788"]]},{"id":"b9b20930.263498","type":"subflow:e0e53645.d85fd8","z":"9848cbbf.0bdd68","name":"addGroup","env":[{"name":"defaults","value":"{\"type\":\"group\",\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1},\"defaultswitch\":false,\"groupMembers\":{\"name\":\"sceneMembers\",\"uiPointer\":0,\"list\":[]}}","type":"json"}],"x":893,"y":136,"wires":[["c4eedb06.193328"]]},{"id":"55f88a42.fd86c4","type":"subflow:e0e09953.42b938","z":"9848cbbf.0bdd68","name":"light.groups","env":[{"name":"baseObject","value":"light.groups","type":"str"},{"name":"filterProperty","value":"","type":"str"},{"name":"filterValue","value":"","type":"str"}],"x":206,"y":68,"wires":[["f60c5313.bda62"]]},{"id":"2a2d3f8d.a5686","type":"subflow:30d3b36b.8d171c","z":"9848cbbf.0bdd68","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":196,"y":136,"wires":[["f60c5313.bda62"],["7215d6df.f42878","10c2a962.a1fc97"]]},{"id":"f60c5313.bda62","type":"subflow:8ba1eff6.75a11","z":"9848cbbf.0bdd68","name":"","env":[],"x":410,"y":68,"wires":[["c47db1b3.19356"]]},{"id":"2d5501ae.16dcbe","type":"ui_colour_picker","z":"9848cbbf.0bdd68","name":"","label":"","group":"ceeb11f0.8bfba","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":13,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.groups.defaultColor","x":614,"y":459,"wires":[["cd630682.9c0b08"]]},{"id":"bfdaff3f.29d7d","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":12,"width":2,"height":1,"name":"standard Farbe","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":216,"y":459,"wires":[]},{"id":"284e5776.5b72b8","type":"link in","z":"9848cbbf.0bdd68","name":"updateLightDevices","links":["a55589e2.8611b8"],"x":253,"y":510,"wires":[["616ec306.1ee08c","4b2af7b8.dd8128"]]},{"id":"4b2af7b8.dd8128","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":424,"y":595,"wires":[]},{"id":"6ad0bae2.005634","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":424,"y":561,"wires":[]},{"id":"3d08e03a.a8722","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":594,"y":561,"wires":[]},{"id":"cac70d3a.7430f","type":"ui_switch","z":"9848cbbf.0bdd68","name":"","label":"","tooltip":"","group":"ceeb11f0.8bfba","order":7,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.groups.defaultSwitch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":594,"y":306,"wires":[["cd630682.9c0b08"]]},{"id":"58628360.01c88c","type":"ui_text","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","order":6,"width":2,"height":1,"name":"standard Schalter","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":226,"y":306,"wires":[]},{"id":"c07b76a5.fce788","type":"link out","z":"9848cbbf.0bdd68","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1018,"y":272,"wires":[]},{"id":"5065a60e.ef53a8","type":"function","z":"33d1b88e.5b1368","name":"save List","func":"var status={};\nvar baseObject= global.get(msg.topic.slice(0,msg.topic.indexOf('.')),\"file\");\nvar propertyName=msg.topic.slice(msg.topic.lastIndexOf('.')+1);\nif (!baseObject) return;\nvar currentObject= baseObject.getCurrentEntry(msg.topic);\nvar currentGroup= baseObject.getSubObject(currentObject,propertyName);\nnode.warn(currentGroup)\n    if (!msg.payload.isChecked) { // delete entry from list if unchecked\n        baseObject.deleteEntry(currentGroup,msg.payload.uuid,\"elementUuid\")\n        status= {fill:\"green\",shape:\"dot\",text:currentObject.name+\": \"+msg.payload.title+\" removed\"};\n    } else {\n        var currentEntry= baseObject.getEntry(currentGroup,msg.payload.uuid,\"elementUuid\");\n        if (!currentEntry) currentEntry= baseObject.newEntry(currentGroup,msg.payload.title);\n        \n        node.warn(currentEntry)\n        baseObject.merge(currentEntry,env.get(\"defaults\"));\n        currentEntry.elementUuid=msg.payload.uuid;\n        currentEntry.isChecked=msg.payload.isChecked;\n        currentEntry.type=msg.payload.type;\n        currentEntry.name=msg.payload.title;\n        status= {fill:\"green\",shape:\"dot\",text:currentObject.name+\": \"+msg.payload.title+\"=\"+msg.payload.isChecked};\n    }\n    var msgDropdown={\"options\":[]};\n    for (var device of currentGroup.list) {\n        if (device.isChecked) msgDropdown.options.push({[device.name]: device.uuid});\n    }\n    return [{\"payload\":status},msg,msgDropdown];\ntry {\n} catch (err) {\n    return [{\"payload\":{fill:\"red\",shape:\"dot\",text:\"ups, somthing gone wrong.\"}},null,null];\n} ","outputs":3,"noerr":0,"x":196,"y":85,"wires":[[],[],[]]},{"id":"78458350.bcc2dc","type":"subflow:653c3a89.08f864","z":"b66f2c73.9297e","name":"","env":[{"name":"groups","value":"light.scenes","type":"str"},{"name":"devProperty","value":"sceneMembers","type":"str"},{"name":"listSources","value":"[{\"source\":\"light.groups\",\"icon\":\"logout\"},{\"source\":\"light.devices\",\"icon\":\"lightbulb_outline\"}]","type":"json"},{"name":"addGroups","value":"light.groups","type":"str"},{"name":"scenes","value":"light.scenes","type":"str"}],"x":485,"y":714,"wires":[["3b425306.f3caec"]]},{"id":"43d17279.2750cc","type":"ui_slider","z":"b66f2c73.9297e","name":"sceneDimmer","label":"","tooltip":"standard Dimmer","group":"6a28c45b.c2fe1c","order":18,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.defaultDimmer","min":"0","max":"100","step":"1","x":675,"y":561,"wires":[["fa5b665a.fd6078","1751bfe.a87f04"]]},{"id":"36ec32e6.018e5e","type":"ui_numeric","z":"b66f2c73.9297e","name":"sceneDimmer","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":19,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.scenes.defaultDimmer","format":"","min":"0","max":"100","step":"1","x":675,"y":612,"wires":[["fa5b665a.fd6078"]]},{"id":"a1dd93aa.1ff5b","type":"ui_text_input","z":"b66f2c73.9297e","name":"name","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":5,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.name","x":645,"y":255,"wires":[["fa5b665a.fd6078"]]},{"id":"2a22337a.fd90cc","type":"ui_button","z":"b66f2c73.9297e","name":"uiDelete","group":"6a28c45b.c2fe1c","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"Wirklich löschen?","payloadType":"str","topic":"mySettings.light.scenes.uiDelete","x":655,"y":187,"wires":[["613f1b44.1b7f74"]]},{"id":"ec781acf.2387b8","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":4,"width":2,"height":1,"name":"Name:","label":"Name:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":255,"wires":[]},{"id":"6ea78752.8cf458","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":17,"width":2,"height":1,"name":"scene dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":561,"wires":[]},{"id":"d95a24b7.329688","type":"ui_dropdown","z":"b66f2c73.9297e","name":"uiDropdown","label":"","tooltip":"","place":"Szene auswählen","group":"6a28c45b.c2fe1c","order":1,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.uiDropdown","x":665,"y":68,"wires":[["ed42ea1f.4c56f8"]]},{"id":"f756c281.5f1e9","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":238,"wires":[]},{"id":"47ade8d3.fa85c8","type":"link in","z":"b66f2c73.9297e","name":"updateLightScenes","links":["3cdf4653.ce30aa","52f723c4.c5accc","673d1103.fd2fe","da3bd253.8f899","f756c281.5f1e9"],"x":151,"y":136,"wires":[["58f6e3ff.cb086c"]]},{"id":"52f723c4.c5accc","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":34,"wires":[]},{"id":"3cdf4653.ce30aa","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":187,"wires":[]},{"id":"cf500f43.216b8","type":"ui_button","z":"b66f2c73.9297e","name":"uiAdd","group":"6a28c45b.c2fe1c","order":2,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"playlist_add","payload":"unbenannt","payloadType":"str","topic":"mySettings.light.scenes.uiAdd","x":645,"y":136,"wires":[["76f3a56e.1e3ecc"]]},{"id":"da3bd253.8f899","type":"link out","z":"b66f2c73.9297e","name":"updateLightScenes","links":["47ade8d3.fa85c8","a30de23c.d157e","8b60226e.218f7","3a86feaf.8de552"],"x":1086,"y":136,"wires":[]},{"id":"1abaf620.87881a","type":"switch","z":"b66f2c73.9297e","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.name","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.room","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.label","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.note","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.httpCmd","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.defaultSwitch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.defaultDimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.defaultColor","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.sceneMembers","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":441,"y":459,"wires":[["a1dd93aa.1ff5b"],["5d59ea52.a36d94","77945c10.de8f74"],["e0ad94fc.db3b08"],["bc831fec.5e8bb"],["afd09637.da57b8"],["9c7fcb88.57d8d8"],["36ec32e6.018e5e","43d17279.2750cc"],["847f1ceb.9665"],["78458350.bcc2dc","3cb73867.558b98","d96aa565.00e108"]]},{"id":"613f1b44.1b7f74","type":"ui_toast","z":"b66f2c73.9297e","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"cancel","raw":false,"topic":"","name":"Delete?","x":808,"y":187,"wires":[["3a623a29.219616"]]},{"id":"21d36cb5.8ba4f4","type":"link in","z":"b66f2c73.9297e","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":151,"y":68,"wires":[["d194eaba.a74a98"]]},{"id":"ed42ea1f.4c56f8","type":"subflow:c4a7cd6c.2a0c1","z":"b66f2c73.9297e","name":"","env":[],"x":961,"y":68,"wires":[["52f723c4.c5accc","c5450f7d.ea00c"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"3a623a29.219616","type":"subflow:d4a0d961.b11238","z":"b66f2c73.9297e","name":"","env":[],"x":971,"y":187,"wires":[["3cdf4653.ce30aa"]]},{"id":"fa5b665a.fd6078","type":"subflow:dfa4352b.bdc548","z":"b66f2c73.9297e","name":"","env":[],"x":961,"y":255,"wires":[["f756c281.5f1e9","9194a4d8.035d58"]]},{"id":"76f3a56e.1e3ecc","type":"subflow:e0e53645.d85fd8","z":"b66f2c73.9297e","name":"newScene","env":[{"name":"defaults","value":"{\"room\":\"\",\"label\":\"\",\"note\":\"\",\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1},\"defaultswitch\":false,\"sceneMembers\":{\"name\":\"sceneMembers\",\"uiPointer\":0,\"list\":[]}}","type":"json"}],"x":971,"y":136,"wires":[["da3bd253.8f899"]]},{"id":"d194eaba.a74a98","type":"subflow:e0e09953.42b938","z":"b66f2c73.9297e","name":"light.scenes","env":[{"name":"baseObject","value":"light.scenes","type":"str"},{"name":"filterProperty","value":"","type":"str"},{"name":"filterValue","value":"","type":"str"}],"x":257,"y":68,"wires":[["3a5df967.450b06","5d59ea52.a36d94"]]},{"id":"58f6e3ff.cb086c","type":"subflow:30d3b36b.8d171c","z":"b66f2c73.9297e","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":247,"y":136,"wires":[["3a5df967.450b06"],["1abaf620.87881a"]]},{"id":"3a5df967.450b06","type":"subflow:8ba1eff6.75a11","z":"b66f2c73.9297e","name":"","env":[],"x":461,"y":68,"wires":[["d95a24b7.329688"]]},{"id":"847f1ceb.9665","type":"ui_colour_picker","z":"b66f2c73.9297e","name":"sceneColor","label":"","group":"6a28c45b.c2fe1c","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":21,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.scenes.defaultColor","x":665,"y":663,"wires":[["fa5b665a.fd6078","38003863.d59a68"]]},{"id":"f7f3dd70.4e1e2","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":20,"width":2,"height":1,"name":"scene color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":257,"y":646,"wires":[]},{"id":"528a0ee.43886f","type":"link in","z":"b66f2c73.9297e","name":"updateLightDevices","links":["a55589e2.8611b8"],"x":304,"y":714,"wires":[["78458350.bcc2dc"]]},{"id":"9c7fcb88.57d8d8","type":"ui_switch","z":"b66f2c73.9297e","name":"","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":11,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.defaultSwitch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":645,"y":510,"wires":[["fa5b665a.fd6078"]]},{"id":"66216b67.7f7a14","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":10,"width":2,"height":1,"name":"scene switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":257,"y":510,"wires":[]},{"id":"9194a4d8.035d58","type":"link out","z":"b66f2c73.9297e","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1086,"y":272,"wires":[]},{"id":"be0c1772.ba5a88","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":22,"width":8,"height":1,"name":"Elemente in Szene","label":"Elemente in Szene","format":"{{msg.payload}}","layout":"row-spread","x":277,"y":680,"wires":[]},{"id":"99079aaf.e7fd58","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":24,"width":8,"height":1,"name":"Einstellungen","label":"Einstellungen","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":799,"wires":[]},{"id":"a526798f.662f08","type":"ui_dropdown","z":"b66f2c73.9297e","name":"uiDropdown","label":"","tooltip":"","place":"Element auswählen","group":"6a28c45b.c2fe1c","order":26,"width":6,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.sceneMembers.uiDropdown","x":665,"y":816,"wires":[["e2c8ebad.ccad48"]]},{"id":"4fa1e7d2.43ae78","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":25,"width":2,"height":1,"name":"Element:","label":"Element:","format":"{{msg.payload}}","layout":"row-spread","x":247,"y":833,"wires":[]},{"id":"65318c33.e1ccd4","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":6,"width":2,"height":1,"name":"Note:","label":"Note:","format":"{{msg.payload}}","layout":"row-spread","x":169,"y":357,"wires":[]},{"id":"9052f83a.94a2d8","type":"ui_text_input","z":"9831cab2.382058","name":"note","label":"","tooltip":"","group":"c04d8bda.8dad98","order":7,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.devices.note","x":628,"y":357,"wires":[["352cbb35.06d0d4"]]},{"id":"60efbf41.dad34","type":"ui_dropdown","z":"9831cab2.382058","name":"room","label":"","tooltip":"","place":"Raum auswählen","group":"c04d8bda.8dad98","order":9,"width":6,"height":1,"passthru":false,"options":[],"payload":"","topic":"mySettings.light.devices.room","x":781,"y":408,"wires":[["352cbb35.06d0d4"]]},{"id":"14e5aee6.c84bb1","type":"subflow:8ba1eff6.75a11","z":"9831cab2.382058","name":"fillRooms","env":[{"name":"customTopic","value":"mySettings.rooms.uiDropdown","type":"str"}],"x":638,"y":408,"wires":[["60efbf41.dad34"]]},{"id":"b23da01a.56b88","type":"ui_text","z":"9831cab2.382058","group":"c04d8bda.8dad98","order":8,"width":2,"height":1,"name":"Raum:","label":"Raum:","format":"{{msg.payload}}","layout":"row-spread","x":169,"y":408,"wires":[]},{"id":"39ef0ec4.5686d2","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":238,"wires":[]},{"id":"10c2a962.a1fc97","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":390,"y":136,"wires":[]},{"id":"8393ba63.84f3c8","type":"debug","z":"9848cbbf.0bdd68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":781,"y":34,"wires":[]},{"id":"64f24588.5992fc","type":"ui_slider","z":"b66f2c73.9297e","name":"deviceDimmer","label":"","tooltip":"standard Dimmer","group":"6a28c45b.c2fe1c","order":31,"width":4,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.sceneMembers.dimmer","min":"0","max":"100","step":"1","x":675,"y":935,"wires":[["77ce9446.49125c"]]},{"id":"816618f9.22d418","type":"ui_numeric","z":"b66f2c73.9297e","name":"deviceDimmer","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":32,"width":2,"height":1,"wrap":true,"passthru":false,"topic":"mySettings.light.scenes.sceneMembers.dimmer","format":"","min":"0","max":"100","step":"1","x":675,"y":986,"wires":[["77ce9446.49125c"]]},{"id":"d448d663.e5ab08","type":"ui_colour_picker","z":"b66f2c73.9297e","name":"deveiceColor","label":"","group":"6a28c45b.c2fe1c","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":34,"width":6,"height":1,"passthru":false,"topic":"mySettings.light.scenes.sceneMembers.color","x":665,"y":1037,"wires":[["77ce9446.49125c"]]},{"id":"77ce9446.49125c","type":"subflow:dfa4352b.bdc548","z":"b66f2c73.9297e","name":"","env":[],"x":961,"y":901,"wires":[["511d94e8.4e555c","a6f217da.0136e8"]]},{"id":"733b53ac.37ee7c","type":"switch","z":"b66f2c73.9297e","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.sceneMembers.switch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.sceneMembers.dimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.sceneMembers.color","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":441,"y":918,"wires":[["dc1c3e5c.1fc98"],["64f24588.5992fc","816618f9.22d418"],["d448d663.e5ab08"]]},{"id":"e2c8ebad.ccad48","type":"subflow:c4a7cd6c.2a0c1","z":"b66f2c73.9297e","name":"selectSceneMember","env":[{"name":"host","value":"light,scenes","type":"str"},{"name":"property","value":"scenesMembers","type":"str"}],"x":984,"y":816,"wires":[["2db2806a.fda09","1c74b75.90d0649"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"8fe4ff8.edc55","type":"subflow:30d3b36b.8d171c","z":"b66f2c73.9297e","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":247,"y":884,"wires":[["3cb73867.558b98","4bd15493.a7bcdc"],["733b53ac.37ee7c"]]},{"id":"1c74b75.90d0649","type":"link out","z":"b66f2c73.9297e","name":"updateSceneMember","links":["c7587be1.a58208"],"x":1154,"y":816,"wires":[]},{"id":"c7587be1.a58208","type":"link in","z":"b66f2c73.9297e","name":"updateSceneMember","links":["1c74b75.90d0649","a6f217da.0136e8"],"x":136,"y":884,"wires":[["8fe4ff8.edc55"]]},{"id":"558c222.c6619dc","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":30,"width":2,"height":1,"name":"device Dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":969,"wires":[]},{"id":"29b52fb2.623a6","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":33,"width":2,"height":1,"name":"device color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":257,"y":1003,"wires":[]},{"id":"3cb73867.558b98","type":"subflow:8ba1eff6.75a11","z":"b66f2c73.9297e","name":"","env":[{"name":"customTopic","value":"mySettings.light.scenes.sceneMembers.uiDropdown","type":"str"}],"x":478,"y":816,"wires":[["a526798f.662f08","fa7aaa41.9eb008"]]},{"id":"2db2806a.fda09","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1189,"y":850,"wires":[]},{"id":"511d94e8.4e555c","type":"link out","z":"b66f2c73.9297e","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1086,"y":918,"wires":[]},{"id":"a6f217da.0136e8","type":"link out","z":"b66f2c73.9297e","name":"updateSceneMember","links":["c7587be1.a58208"],"x":1086,"y":884,"wires":[]},{"id":"dc1c3e5c.1fc98","type":"ui_switch","z":"b66f2c73.9297e","name":"","label":"","tooltip":"","group":"6a28c45b.c2fe1c","order":28,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.sceneMembers.switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":645,"y":884,"wires":[["77ce9446.49125c"]]},{"id":"c12cfb73.1fe4f8","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":27,"width":2,"height":1,"name":"device Switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":267,"y":935,"wires":[]},{"id":"416a303f.3ca61","type":"subflow:33d1b88e.5b1368","z":"b66f2c73.9297e","name":"","env":[{"name":"defaults","value":"{\"note\":\"\",\"switch\":true,\"dimmer\":100,\"color\":{\"h\":0,\"s\":1,\"v\":1}}","type":"json"}],"x":969,"y":714,"wires":[["d8ee6a58.1d48d8"],["b5398d9b.02eb8","a526798f.662f08"]]},{"id":"5d59ea52.a36d94","type":"subflow:8ba1eff6.75a11","z":"b66f2c73.9297e","name":"fillRooms","env":[{"name":"customTopic","value":"mySettings.rooms.uiDropdown","type":"str"}],"x":655,"y":306,"wires":[["a63a10e4.6d909"]]},{"id":"a63a10e4.6d909","type":"ui_dropdown","z":"b66f2c73.9297e","name":"room","label":"","tooltip":"","place":"Raum auswählen","group":"6a28c45b.c2fe1c","order":7,"width":6,"height":1,"passthru":false,"options":[],"payload":"","topic":"mySettings.light.scenes.room","x":798,"y":306,"wires":[["fa5b665a.fd6078"]]},{"id":"e0008836.e61da8","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":6,"width":2,"height":1,"name":"Raum:","label":"Raum:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":306,"wires":[]},{"id":"762686f9.1f99c8","type":"ui_slider","z":"fe9fd924.188388","name":"sceneDimmer","label":"","tooltip":"Dimm Szene","group":"7e22101c.03087","order":6,"width":5,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.dimmer","min":"0","max":"100","step":"1","x":692,"y":272,"wires":[["535a9c1b.c444a4"]]},{"id":"57c706d9.907f18","type":"ui_text","z":"fe9fd924.188388","group":"7e22101c.03087","order":5,"width":2,"height":1,"name":"scene dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":284,"y":272,"wires":[]},{"id":"121f1c8f.13d7c3","type":"ui_dropdown","z":"fe9fd924.188388","name":"uiDropdown","label":"","tooltip":"","place":"Szene auswählen","group":"7e22101c.03087","order":1,"width":7,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.uiDropdown","x":682,"y":85,"wires":[["7f74073e.99e2a8"]]},{"id":"2900ecda.88a7d4","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["d107ebd4.5f0418"],"x":1103,"y":204,"wires":[]},{"id":"d107ebd4.5f0418","type":"link in","z":"fe9fd924.188388","name":"updateLightGroups","links":["2900ecda.88a7d4","fcc18de9.4abcd","673d1103.fd2fe","ba5cb199.0c1ad","a7385abe.d70aa8"],"x":168,"y":153,"wires":[["6c92ed17.83e384"]]},{"id":"a7385abe.d70aa8","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["d107ebd4.5f0418"],"x":1103,"y":85,"wires":[]},{"id":"6a40bc4a.14e2b4","type":"switch","z":"fe9fd924.188388","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.switch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.dimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.tint","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.color","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":458,"y":272,"wires":[["7daa3826.831c58"],["762686f9.1f99c8"],["ea8a725c.c4d58"],["12fbbdbf.886b92"]]},{"id":"cb81a114.a5004","type":"link in","z":"fe9fd924.188388","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":134,"y":51,"wires":[["3623592c.5e2806"]]},{"id":"7f74073e.99e2a8","type":"subflow:c4a7cd6c.2a0c1","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":85,"wires":[["a7385abe.d70aa8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"3623592c.5e2806","type":"subflow:e0e09953.42b938","z":"fe9fd924.188388","name":"light.scenes","env":[{"name":"baseObject","value":"light.scenes","type":"str"},{"name":"filterProperty","value":"room","type":"str"},{"name":"filterValue","value":"57ca4364-c304-7274-5ac4-ef21a2e91463","type":"str"}],"x":274,"y":85,"wires":[["a12485f7.891488","66561fd5.9ef09"]]},{"id":"6c92ed17.83e384","type":"subflow:30d3b36b.8d171c","z":"fe9fd924.188388","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":264,"y":153,"wires":[["a12485f7.891488"],["6a40bc4a.14e2b4"]]},{"id":"a12485f7.891488","type":"subflow:8ba1eff6.75a11","z":"fe9fd924.188388","name":"","env":[],"x":478,"y":85,"wires":[["121f1c8f.13d7c3","b1720b51.a5a7d8"]]},{"id":"12fbbdbf.886b92","type":"ui_colour_picker","z":"fe9fd924.188388","name":"sceneColor","label":"","group":"7e22101c.03087","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":9,"width":3,"height":1,"passthru":false,"topic":"mySettings.light.scenes.color","x":682,"y":374,"wires":[["535a9c1b.c444a4"]]},{"id":"7c51d19f.a10ea","type":"ui_text","z":"fe9fd924.188388","group":"7e22101c.03087","order":7,"width":2,"height":1,"name":"scene color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":323,"wires":[]},{"id":"7daa3826.831c58","type":"ui_switch","z":"fe9fd924.188388","name":"","label":"","tooltip":"","group":"7e22101c.03087","order":3,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":221,"wires":[["535a9c1b.c444a4"]]},{"id":"e6242bcf.d960f8","type":"ui_text","z":"fe9fd924.188388","group":"7e22101c.03087","order":2,"width":2,"height":1,"name":"scene switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":221,"wires":[]},{"id":"2310ff72.1a31c","type":"link out","z":"fe9fd924.188388","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1103,"y":238,"wires":[]},{"id":"ea8a725c.c4d58","type":"ui_switch","z":"fe9fd924.188388","name":"tint","label":"","tooltip":"","group":"7e22101c.03087","order":8,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.tint","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":323,"wires":[["535a9c1b.c444a4"]]},{"id":"535a9c1b.c444a4","type":"subflow:dfa4352b.bdc548","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":221,"wires":[["2900ecda.88a7d4","2310ff72.1a31c"]]},{"id":"71563804.4b99b8","type":"inject","z":"fe9fd924.188388","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":281,"y":34,"wires":[["3623592c.5e2806"]]},{"id":"66561fd5.9ef09","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":153,"wires":[]},{"id":"b1720b51.a5a7d8","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":153,"wires":[]},{"id":"c18f5a82.6afa98","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":8,"width":2,"height":1,"name":"Label:","label":"Label:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":357,"wires":[]},{"id":"e0ad94fc.db3b08","type":"ui_text_input","z":"b66f2c73.9297e","name":"label","label":"","tooltip":"Beschriftung für Schalter","group":"6a28c45b.c2fe1c","order":9,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.label","x":645,"y":357,"wires":[["fa5b665a.fd6078"]]},{"id":"aa232916.59cc58","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":13,"width":2,"height":1,"name":"Note:","label":"Note:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":408,"wires":[]},{"id":"bc831fec.5e8bb","type":"ui_text_input","z":"b66f2c73.9297e","name":"note","label":"","tooltip":"Notiz","group":"6a28c45b.c2fe1c","order":14,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.note","x":645,"y":408,"wires":[["fa5b665a.fd6078"]]},{"id":"afd09637.da57b8","type":"ui_text_input","z":"b66f2c73.9297e","name":"http","label":"","tooltip":"http: command","group":"6a28c45b.c2fe1c","order":16,"width":6,"height":1,"passthru":false,"mode":"text","delay":"0","topic":"mySettings.light.scenes.httpCmd","x":645,"y":459,"wires":[["fa5b665a.fd6078"]]},{"id":"3dbfe031.bd7b3","type":"ui_text","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","order":15,"width":2,"height":1,"name":"http:","label":"http cmd:","format":"{{msg.payload}}","layout":"row-spread","x":237,"y":459,"wires":[]},{"id":"67d12a26.202b14","type":"inject","z":"9831cab2.382058","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":102,"y":68,"wires":[["e3b27cfc.9d2c9"]]},{"id":"60645b5e.694cd4","type":"inject","z":"b66f2c73.9297e","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":196,"y":17,"wires":[["d194eaba.a74a98"]]},{"id":"fa7aaa41.9eb008","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":645,"y":1088,"wires":[]},{"id":"77945c10.de8f74","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":951,"y":374,"wires":[]},{"id":"8b60226e.218f7","type":"link in","z":"fe9fd924.188388","name":"updateLightScenes","links":["3cdf4653.ce30aa","52f723c4.c5accc","da3bd253.8f899","f756c281.5f1e9"],"x":134,"y":102,"wires":[["3623592c.5e2806"]]},{"id":"b5398d9b.02eb8","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1172,"y":731,"wires":[]},{"id":"20fbf6c1.9052aa","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":169,"y":289,"wires":[]},{"id":"d96aa565.00e108","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":782,"wires":[]},{"id":"d8ee6a58.1d48d8","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1172,"y":680,"wires":[]},{"id":"4bd15493.a7bcdc","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":867,"wires":[]},{"id":"b3a4ef66.0ea08","type":"debug","z":"4635654.3abb19c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":356,"y":289,"wires":[]},{"id":"46b5afd2.1a88c","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":764,"y":68,"wires":[]},{"id":"9e639b16.dbdfe8","type":"ui_slider","z":"fe9fd924.188388","name":"sceneDimmer","label":"","tooltip":"Dimm Szene","group":"cde25ae.eff1aa8","order":6,"width":5,"height":1,"passthru":false,"outs":"all","topic":"mySettings.light.scenes.dimmer","min":"0","max":"100","step":"1","x":692,"y":663,"wires":[["fcdec52a.505458"]]},{"id":"45e3857e.e7529c","type":"ui_text","z":"fe9fd924.188388","group":"cde25ae.eff1aa8","order":5,"width":2,"height":1,"name":"scene dimmer","label":"Dimmer:","format":"{{msg.payload}}","layout":"row-spread","x":284,"y":663,"wires":[]},{"id":"1806d787.f54198","type":"ui_dropdown","z":"fe9fd924.188388","name":"uiDropdown","label":"","tooltip":"","place":"Szene auswählen","group":"cde25ae.eff1aa8","order":1,"width":7,"height":1,"passthru":true,"options":[],"payload":"","topic":"mySettings.light.scenes.uiDropdown","x":682,"y":476,"wires":[["5e39e42f.a1208c"]]},{"id":"7599ab6.7273d54","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["3902144d.81ab8c"],"x":1103,"y":595,"wires":[]},{"id":"3902144d.81ab8c","type":"link in","z":"fe9fd924.188388","name":"updateLightGroups","links":["7599ab6.7273d54","fcc18de9.4abcd","673d1103.fd2fe","ba5cb199.0c1ad","eafb15a9.560dc8"],"x":168,"y":544,"wires":[["1d8fbbfc.d76c34"]]},{"id":"eafb15a9.560dc8","type":"link out","z":"fe9fd924.188388","name":"updateLightGroups","links":["3902144d.81ab8c"],"x":1103,"y":476,"wires":[]},{"id":"b76250c9.7f0f8","type":"switch","z":"fe9fd924.188388","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"mySettings.light.scenes.switch","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.dimmer","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.tint","vt":"str"},{"t":"eq","v":"mySettings.light.scenes.color","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":458,"y":663,"wires":[["d8b9eaf8.7e9078"],["9e639b16.dbdfe8"],["e7b55d5c.f404a"],["62e0442d.f3e8ac"]]},{"id":"fe243d47.7c894","type":"link in","z":"fe9fd924.188388","name":"systemStarted","links":["d0f901ac.5cc01","4db6721d.45de6c","15f2ac84.d7a7b3"],"x":134,"y":442,"wires":[["be4c523c.e56a4"]]},{"id":"5e39e42f.a1208c","type":"subflow:c4a7cd6c.2a0c1","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":476,"wires":[["eafb15a9.560dc8"]],"inputLabels":["Dropdown"],"outputLabels":["Update"],"icon":"node-red-node-ui-list/icon.png"},{"id":"be4c523c.e56a4","type":"subflow:e0e09953.42b938","z":"fe9fd924.188388","name":"Wohnzimmer","env":[{"name":"baseObject","value":"light.scenes","type":"str"},{"name":"filterProperty","value":"room","type":"str"},{"name":"filterValue","value":"9d5943d1-3e5b-1626-e41b-4639241614b7","type":"str"}],"x":274,"y":476,"wires":[["69c4a194.a46ec","b3aacc79.59c54"]]},{"id":"1d8fbbfc.d76c34","type":"subflow:30d3b36b.8d171c","z":"fe9fd924.188388","name":"","env":[{"name":"uiControl","value":"{}","type":"json"}],"x":264,"y":544,"wires":[["69c4a194.a46ec"],["b76250c9.7f0f8"]]},{"id":"69c4a194.a46ec","type":"subflow:8ba1eff6.75a11","z":"fe9fd924.188388","name":"","env":[],"x":478,"y":476,"wires":[["1806d787.f54198","de48323c.4288f"]]},{"id":"62e0442d.f3e8ac","type":"ui_colour_picker","z":"fe9fd924.188388","name":"sceneColor","label":"","group":"cde25ae.eff1aa8","format":"hsv","outformat":"object","showSwatch":true,"showPicker":false,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":true,"square":"true","dynOutput":"false","order":9,"width":3,"height":1,"passthru":false,"topic":"mySettings.light.scenes.color","x":682,"y":765,"wires":[["fcdec52a.505458"]]},{"id":"c672599a.e700f8","type":"ui_text","z":"fe9fd924.188388","group":"cde25ae.eff1aa8","order":7,"width":2,"height":1,"name":"scene color","label":"Farbe:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":714,"wires":[]},{"id":"d8b9eaf8.7e9078","type":"ui_switch","z":"fe9fd924.188388","name":"","label":"","tooltip":"","group":"cde25ae.eff1aa8","order":3,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":612,"wires":[["fcdec52a.505458"]]},{"id":"c79591b2.f4c57","type":"ui_text","z":"fe9fd924.188388","group":"cde25ae.eff1aa8","order":2,"width":2,"height":1,"name":"scene switch","label":"Schalter:","format":"{{msg.payload}}","layout":"row-spread","x":274,"y":612,"wires":[]},{"id":"8e4d3523.343658","type":"link out","z":"fe9fd924.188388","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1103,"y":629,"wires":[]},{"id":"e7b55d5c.f404a","type":"ui_switch","z":"fe9fd924.188388","name":"tint","label":"","tooltip":"","group":"cde25ae.eff1aa8","order":8,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"mySettings.light.scenes.tint","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":662,"y":714,"wires":[["fcdec52a.505458"]]},{"id":"fcdec52a.505458","type":"subflow:dfa4352b.bdc548","z":"fe9fd924.188388","name":"","env":[],"x":978,"y":612,"wires":[["7599ab6.7273d54","8e4d3523.343658"]]},{"id":"73f2f6d1.bed358","type":"inject","z":"fe9fd924.188388","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":281,"y":425,"wires":[["be4c523c.e56a4"]]},{"id":"b3aacc79.59c54","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":458,"y":544,"wires":[]},{"id":"de48323c.4288f","type":"debug","z":"fe9fd924.188388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":544,"wires":[]},{"id":"3a86feaf.8de552","type":"link in","z":"fe9fd924.188388","name":"updateLightScenes","links":["3cdf4653.ce30aa","52f723c4.c5accc","da3bd253.8f899","f756c281.5f1e9"],"x":134,"y":493,"wires":[["be4c523c.e56a4"]]},{"id":"9876b27e.7db04","type":"function","z":"309a0a3e.c49326","name":"delete array entries","func":"var currentObject= global.get(\"mySettings\",\"file\");\nvar start=11;\ncurrentObject.light.devices.list.splice(start,currentObject.light.devices.list.length-start);\ncurrentObject.light.devices.uiPointer=0;\ndelete currentObject.light.devices.currentUuid;\ndelete currentObject.light.devices.uiPointerUuid;","outputs":1,"noerr":0,"x":311,"y":476,"wires":[[]]},{"id":"f95b26ed.7c7438","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":476,"wires":[["9876b27e.7db04"]]},{"id":"642ac148.46602","type":"function","z":"991e8cc1.0c169","name":"validate","func":"var globalStore = env.get(\"globalStore\");\nvar listObject = env.get(\"listObject\");\nvar targetObject = env.get(\"targetObject\");\nvar listParts = listObject.split(\".\");\nvar errMsg;\nvar base = global.get(globalStore,\"file\");\nvar listBase = c\n\nvar checkObject = function(listBase) {\n    for (var listPart=1; listPart < listParts.length; listPart++) {\n        if (listParts[listPart].indexOf(\"[\")!==-1) {\n            var variableElement = listParts[listPart].substring(listParts[listPart].indexOf(\"[\")+1,listParts[listPart].lastIndexOf(\"]\"))\n            if (Array.isArray(listBase.list)) {\n                if (variableElement!==\"\") {\n                    checkObject(listBase.list[msg.payload[variableElement]]);\n                } else {\n                    for (var aBase in listBase.list) checkObject(aBase);\n                }\n            } else {\n                errMsg= \"Expected object.list on variable position\"\n            }\n        } else {\n            listBase=listBase[listParts[listPart]];\n        }\n    }\n}\n\ncheckObject(variableElement);\n\nif (errMsg) {\n    node.error(errMsg);\n}\n\nmsg.payload.listBase=listBase;\nreturn [null,msg];","outputs":2,"noerr":0,"x":180,"y":119,"wires":[[],[]]},{"id":"10ad777d.b669f9","type":"subflow:991e8cc1.0c169","z":"309a0a3e.c49326","name":"checkSceneMembers","env":[{"name":"listObject","value":"light.scenes.[scene].sceneMembers","type":"str"},{"name":"targetObject","value":"light.devices","type":"str"}],"x":780,"y":289,"wires":[[]]},{"id":"61a7e127.933e","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"{\"szene\":0}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":544,"y":289,"wires":[["10ad777d.b669f9"]]},{"id":"8fc4b51e.3d3718","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":883,"y":952,"wires":[]},{"id":"9180f1da.c0222","type":"debug","z":"dd3f4b52.8a4468","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":34,"wires":[]},{"id":"760edac9.0be9b4","type":"inject","z":"dd3f4b52.8a4468","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":34,"wires":[["1fb940b1.6cff6f"]]},{"id":"3cc8a52e.5c819a","type":"debug","z":"dd3f4b52.8a4468","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":356,"y":34,"wires":[]},{"id":"5af35995.c5d728","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":323,"wires":[["a3a751e8.db6f3"]]},{"id":"a3a751e8.db6f3","type":"function","z":"309a0a3e.c49326","name":"delete heating.rooms","func":"var currentObject= global.get(\"mySettings\",\"file\");\ndelete currentObject.heating.rooms;\n\nreturn msg;","outputs":1,"noerr":0,"x":321,"y":323,"wires":[[]]},{"id":"8ff02f5b.a940f","type":"debug","z":"4635654.3abb19c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":934,"y":306,"wires":[]},{"id":"dfd31a4e.2d22d8","type":"debug","z":"afaa0885.ad2718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":424,"y":1122,"wires":[]},{"id":"2617a8a2.cd40a8","type":"homie-convention-device","z":"833d7b75.5dd878","broker":"e6a23911.f60378","name":"","deviceID":"[any]","nodeID":"[any]","propertyID":"dose","topic":"[any]/[any]/dose","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Relay 4","uiPlaceName":"","uiNode":"uiSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#e46f27","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":216,"y":102,"wires":[["474f6afb.e78b64","ee4d0fdf.4f155"],[]]},{"id":"474f6afb.e78b64","type":"ui_switch","z":"833d7b75.5dd878","name":"","label":"{{msg.label}}","tooltip":"","group":"37eeda5a.799966","order":0,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":543,"y":34,"wires":[["2617a8a2.cd40a8","e33f1364.629b4"]]},{"id":"41de50fb.158a3","type":"debug","z":"6ed67795.6a6c28","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":430,"y":640,"wires":[]},{"id":"22a4b681.f9612a","type":"switch","z":"6ed67795.6a6c28","name":"Lux =0 >5","property":"value","propertyType":"msg","rules":[{"t":"lt","v":"1","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":440,"y":600,"wires":[["6464440e.d8c33c"],["aecc35d0.6afc08"]]},{"id":"6464440e.d8c33c","type":"function","z":"6ed67795.6a6c28","name":"ON","func":"return {\"payload\":\"ON\"};","outputs":1,"noerr":0,"x":610,"y":580,"wires":[["42737cad.933a54","c3092cab.abf54"]]},{"id":"aecc35d0.6afc08","type":"function","z":"6ed67795.6a6c28","name":"OFF","func":"return {\"payload\":\"OFF\"};","outputs":1,"noerr":0,"x":610,"y":620,"wires":[["42737cad.933a54","c3092cab.abf54"]]},{"id":"7afcd9b.0802a28","type":"comment","z":"6ed67795.6a6c28","name":"Gartenbeleuchtung","info":"","x":130,"y":320,"wires":[]},{"id":"c64596de.862ea8","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"","deviceID":"Bewaesserung-3","nodeID":"BH1750","propertyID":"Lux","topic":"Bewaesserung-3/BH1750/Lux","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"none","labelTopic":false,"labelPayload":true,"labelName":"","uiPlaceName":"","uiNode":"uiButton","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":170,"y":620,"wires":[["22a4b681.f9612a","41de50fb.158a3","a40b41ce.b413c","1a36e17f.b98b9f"],[]]},{"id":"fa7fca77.316418","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"relay1","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay1","topic":"Gartenbeleuchtung-1/Lights/relay1","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":true,"labelName":"","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":830,"y":400,"wires":[["6cc1d2a2.8a5e7c"],[]]},{"id":"6cc1d2a2.8a5e7c","type":"ui_switch","z":"6ed67795.6a6c28","name":"","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1030,"y":460,"wires":[["fa7fca77.316418"]]},{"id":"c3092cab.abf54","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"Sonnendeck (2)","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay2","topic":"Gartenbeleuchtung-1/Lights/relay2","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":true,"labelName":"Sonnendeck","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":860,"y":480,"wires":[["c2d454da.7725a8"],[]]},{"id":"c2d454da.7725a8","type":"ui_switch","z":"6ed67795.6a6c28","name":"","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1030,"y":540,"wires":[["c3092cab.abf54"]]},{"id":"eed79bde.26ef48","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"Laterne (3)","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay3","topic":"Gartenbeleuchtung-1/Lights/relay3","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":true,"labelName":"Laterne","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":850,"y":560,"wires":[["face3bad.a0f6e8"],[]]},{"id":"face3bad.a0f6e8","type":"ui_switch","z":"6ed67795.6a6c28","name":"Laterne","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1040,"y":620,"wires":[["eed79bde.26ef48"]]},{"id":"42737cad.933a54","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"Baum (4)","deviceID":"Gartenbeleuchtung-1","nodeID":"Lights","propertyID":"relay4","topic":"Gartenbeleuchtung-1/Lights/relay4","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":true,"labelName":"Baum","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ff8000","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":840,"y":640,"wires":[["1541374.d0bc5c9"],[]]},{"id":"1541374.d0bc5c9","type":"ui_switch","z":"6ed67795.6a6c28","name":"Baum","label":"{{msg.label}}","tooltip":"","group":"1b90cb05.60c0a5","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1030,"y":700,"wires":[["42737cad.933a54"]]},{"id":"a40b41ce.b413c","type":"ui_level","z":"6ed67795.6a6c28","group":"1b90cb05.60c0a5","order":2,"width":"7","height":"1","name":"Sonne","label":"Sonne","colorHi":"#ffffc6","colorWarn":"#fce64b","colorNormal":"#fbd744","colorOff":"#595959","min":0,"max":"4000","segWarn":"10","segHigh":"1000","unit":"Lux","layout":"sh","channelA":"","channelB":"","decimals":"0","animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#000000","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"x":430,"y":680,"wires":[]},{"id":"1a36e17f.b98b9f","type":"ui_chart","z":"6ed67795.6a6c28","name":"","group":"1b90cb05.60c0a5","order":1,"width":0,"height":0,"label":"Belichtung","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":450,"y":720,"wires":[[]]},{"id":"121677f.3810388","type":"homie-convention-device","z":"6ed67795.6a6c28","broker":"3840d6b5.4291da","name":"","deviceID":"Teichpumpe","nodeID":"Relais","propertyID":"switch","topic":"Teichpumpe/Relais/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Teichpumpe","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":150,"y":840,"wires":[["c27bc2f.544784","99d7312a.0a02c"],[]]},{"id":"c27bc2f.544784","type":"ui_switch","z":"6ed67795.6a6c28","name":"Umwälzpumpe","label":"{{msg.label}}","tooltip":"","group":"43e7dd36.28fbe4","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":440,"y":900,"wires":[["121677f.3810388"]]},{"id":"99d7312a.0a02c","type":"debug","z":"6ed67795.6a6c28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":410,"y":820,"wires":[]},{"id":"ff7f8cd5.1f168","type":"function","z":"25cbe481.e10bec","name":"payload>0","func":"if (msg.payload>0) {\n    return msg;\n}","outputs":1,"noerr":0,"x":1290,"y":600,"wires":[["6909e129.6d064"]]},{"id":"fe7c3d31.aaeb","type":"function","z":"25cbe481.e10bec","name":"Homie","func":"var homieData = global.get(\"homieData\",\"file\") || {}\nvar elements = msg.topic.split('/');\nvar date = new Date();\nvar changed = false;\n\nif (homieData[elements[1]]===undefined) homieData[elements[1]]={\"mame\":elements[1]};\nif (elements.length==2) { // unit\n    msg.unit = elements[1];\n    msg.measurement = elements[1];\n    msg.intervalUpdate = date.getTime() - homieData[elements[1]].lastUpdated;\n    homieData[elements[1]].lastUpdated=date.getTime();\n} else {\n    if (homieData[elements[1]][elements[2]]===undefined) homieData[elements[1]][elements[2]]={\"mame\":elements[2]};\n    if (elements.length==3) { // device\n        msg.unit = elements[1];\n        msg.device = elements[2];\n        msg.measurement = elements[1]+\"/\"+elements[2];\n        msg.intervalUpdate = date.getTime() - homieData[elements[1]][elements[2]].lastUpdated;\n        homieData[elements[1]][elements[2]].lastUpdated=date.getTime();\n    } else {\n        if (homieData[elements[1]][elements[2]][elements[3]]===undefined) homieData[elements[1]][elements[2]][elements[3]]={\"mame\":elements[3]};\n        if (elements.length==4) { // parameter\n            msg.unit = elements[1];\n            msg.device = elements[2];\n            msg.parameter = elements[3];\n            msg.measurement = elements[1]+\"/\"+elements[2]+\"/\"+elements[3];\n            if (homieData[elements[1]][elements[2]][elements[3]].$datatype!==undefined) {\n                if (homieData[elements[1]][elements[2]][elements[3]].$datatype==\"integer\") {\n                    msg.payload=Math.floor(Number(msg.payload));\n                }\n                if (homieData[elements[1]][elements[2]][elements[3]].$datatype==\"float\") {\n                    msg.payload=Number(msg.payload);\n                }\n            }\n            msg.intervalUpdate = date.getTime() - homieData[elements[1]][elements[2]][elements[3]].lastUpdated;\n            homieData[elements[1]][elements[2]][elements[3]].lastUpdated=date.getTime();\n            if (homieData[elements[1]][elements[2]][elements[3]].payload!=msg.payload) {\n                msg.intervalChange = date.getTime() - homieData[elements[1]][elements[2]][elements[3]].lastChanged;\n                homieData[elements[1]][elements[2]][elements[3]].payload=msg.payload;\n                homieData[elements[1]][elements[2]][elements[3]].lastChanged=date.getTime();\n                changed = true;\n            }  \n        } else if (elements.length==5) { // parameter Info\n            homieData[elements[1]][elements[2]][elements[3]][elements[4]]=msg.payload;\n        }\n    }\n}\n\nglobal.set(\"homieData\",homieData,\"file\");\nif (changed) return [msg,msg];\n    else return [msg,null];","outputs":2,"noerr":0,"x":310,"y":540,"wires":[["ea69dec0.d0125"],["69a30ff7.6d3a3","323fa9a.3078456"]],"outputLabels":["all Messages","updated Messages"],"icon":"node-red/bridge.png"},{"id":"744898eb.220ac8","type":"mqtt in","z":"25cbe481.e10bec","name":"","topic":"homie/#","qos":"0","datatype":"auto","broker":"6389f524.8a4e3c","x":140,"y":540,"wires":[["fe7c3d31.aaeb","22286578.f0b08a"]]},{"id":"ea69dec0.d0125","type":"debug","z":"25cbe481.e10bec","name":"allValues","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":502,"y":459,"wires":[]},{"id":"22286578.f0b08a","type":"debug","z":"25cbe481.e10bec","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":310,"y":580,"wires":[]},{"id":"7c6b6568.d90a8c","type":"ui_level","z":"25cbe481.e10bec","group":"43e7dd36.28fbe4","order":0,"width":"7","height":"1","name":"Pumpe Power","label":"Leistung","colorHi":"#df0000","colorWarn":"#00b700","colorNormal":"#ff0000","colorOff":"#595959","min":0,"max":100,"segWarn":"45","segHigh":"55","unit":"w","layout":"sh","channelA":"","channelB":"","decimals":"1","animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#000000","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"x":1140,"y":680,"wires":[]},{"id":"6a35eb2.ba3fd14","type":"switch","z":"25cbe481.e10bec","name":"Energy","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Power","vt":"str"},{"t":"eq","v":"Voltage","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":940,"y":720,"wires":[["1c80ab26.6c4a05","7c6b6568.d90a8c","6909e129.6d064"],["e6409eaf.30f3f","fbc1c902.17dda8","6909e129.6d064"]]},{"id":"fbc1c902.17dda8","type":"ui_level","z":"25cbe481.e10bec","group":"43e7dd36.28fbe4","order":0,"width":"7","height":"1","name":"Pumpe Voltage","label":"Spannung","colorHi":"#df0000","colorWarn":"#00b700","colorNormal":"#ff0000","colorOff":"#595959","min":"190","max":"250","segWarn":"210","segHigh":"230","unit":"V","layout":"sh","channelA":"","channelB":"","decimals":"0","animations":"soft","shape":2,"colorschema":"fixed","textoptions":"default","colorText":"#000000","fontLabel":"","fontValue":"","fontSmall":"","colorFromTheme":true,"x":1140,"y":760,"wires":[]},{"id":"69a30ff7.6d3a3","type":"switch","z":"25cbe481.e10bec","name":"unit","property":"unit","propertyType":"msg","rules":[{"t":"eq","v":"Bewaesserung-1","vt":"str"},{"t":"eq","v":"Bewaesserung-2","vt":"str"},{"t":"eq","v":"Bewaesserung-3","vt":"str"},{"t":"eq","v":"Teichpumpe","vt":"str"},{"t":"eq","v":"Teichventil","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":490,"y":540,"wires":[["87239fb.9860e6"],[],["5b959dfc.708394"],["cfd0cd9f.24754"],["b9d5baa.29a6848"]]},{"id":"cfd0cd9f.24754","type":"switch","z":"25cbe481.e10bec","name":"Teichpumpe","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"Energy","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":699,"y":731,"wires":[["6a35eb2.ba3fd14"]]},{"id":"5b959dfc.708394","type":"switch","z":"25cbe481.e10bec","name":"Bewaesserung-3","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"BME280","vt":"str"},{"t":"eq","v":"BH1750","vt":"str"},{"t":"eq","v":"Rain","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":710,"y":540,"wires":[["824f522c.9241a"],["615b88e7.437fa8"],["4abc5d8e.055d74"]]},{"id":"824f522c.9241a","type":"switch","z":"25cbe481.e10bec","name":"BME280","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Temperature","vt":"str"},{"t":"eq","v":"Humidity","vt":"str"},{"t":"eq","v":"Pressure","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":940,"y":440,"wires":[["4707cb3e.73c874","6909e129.6d064","7ff6e58a.de588c"],["e9a281de.5463","6909e129.6d064"],["67e608be.47ec78","6909e129.6d064"]]},{"id":"4707cb3e.73c874","type":"ui_gauge","z":"25cbe481.e10bec","name":"Temperatur","group":"5ffa92f6.040b6c","order":1,"width":0,"height":0,"gtype":"gage","title":"Innentemperatur","label":"°C","format":"{{value | number:1}}","min":"-20","max":"45","colors":["#9ab1c2","#5ea83e","#a92e2e"],"seg1":"7","seg2":"30","x":1130,"y":400,"wires":[]},{"id":"615b88e7.437fa8","type":"switch","z":"25cbe481.e10bec","name":"BH1750","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Lux","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":940,"y":540,"wires":[["6909e129.6d064"]]},{"id":"67e608be.47ec78","type":"ui_text","z":"25cbe481.e10bec","group":"5ffa92f6.040b6c","order":2,"width":0,"height":0,"name":"","label":"Druck","format":"{{msg.payload}}","layout":"row-spread","x":1110,"y":480,"wires":[]},{"id":"e9a281de.5463","type":"ui_text","z":"25cbe481.e10bec","group":"5ffa92f6.040b6c","order":3,"width":0,"height":0,"name":"","label":"Luftfeuchte","format":"{{msg.payload}} %","layout":"row-spread","x":1130,"y":440,"wires":[]},{"id":"1c80ab26.6c4a05","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"763687d.660d278","order":2,"width":0,"height":0,"label":"Leistung","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1120,"y":720,"wires":[[]]},{"id":"87239fb.9860e6","type":"switch","z":"25cbe481.e10bec","name":"Bewaesserung-1","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"Boden","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":240,"wires":[["32f83a4c.e24d96"]]},{"id":"32f83a4c.e24d96","type":"switch","z":"25cbe481.e10bec","name":"Boden","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Temperature","vt":"str"},{"t":"eq","v":"Humidity","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":930,"y":240,"wires":[["beec2d09.0d7bb","a9fa8df7.44573","6909e129.6d064"],["6909e129.6d064","5a518902.cf5178","e0881662.c6eba8"]]},{"id":"beec2d09.0d7bb","type":"ui_gauge","z":"25cbe481.e10bec","name":"Temperatur","group":"9ee1b18d.51ece","order":2,"width":"3","height":"2","gtype":"gage","title":"Temperatur","label":"°C","format":"{{value | number:1}}","min":"-20","max":"45","colors":["#9ab1c2","#5ea83e","#a92e2e"],"seg1":"7","seg2":"30","x":1130,"y":180,"wires":[]},{"id":"4abc5d8e.055d74","type":"switch","z":"25cbe481.e10bec","name":"Rain","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Count","vt":"str"},{"t":"eq","v":"Total","vt":"str"},{"t":"eq","v":"Time","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":930,"y":620,"wires":[["1831d1d9.ab84ee","ff7f8cd5.1f168"],["1831d1d9.ab84ee"],[]]},{"id":"1831d1d9.ab84ee","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"4723b9bd.fb3598","order":2,"width":0,"height":0,"label":"Regen","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"step","nodata":"warte auf Regen","dot":false,"ymin":"0","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1110,"y":600,"wires":[[]]},{"id":"a9fa8df7.44573","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"9ee1b18d.51ece","order":1,"width":0,"height":0,"label":"Bodentemperatur","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"bezier","nodata":"warte auf Daten","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":220,"wires":[[]]},{"id":"e6409eaf.30f3f","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"763687d.660d278","order":2,"width":0,"height":0,"label":"Spannung","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":800,"wires":[[]]},{"id":"323fa9a.3078456","type":"debug","z":"25cbe481.e10bec","name":"changed","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":502,"y":612,"wires":[]},{"id":"b9d5baa.29a6848","type":"switch","z":"25cbe481.e10bec","name":"Teichventil","property":"device","propertyType":"msg","rules":[{"t":"eq","v":"Temperatur1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":880,"wires":[["e71d17ca.e3eca8"]]},{"id":"e71d17ca.e3eca8","type":"switch","z":"25cbe481.e10bec","name":"Temperatur1","property":"parameter","propertyType":"msg","rules":[{"t":"eq","v":"Temp1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":950,"y":880,"wires":[["50cf7b79.4db344","8b8a4e79.25681","6909e129.6d064"]]},{"id":"50cf7b79.4db344","type":"ui_chart","z":"25cbe481.e10bec","name":"Temperatur","group":"fa42e847.06d618","order":2,"width":0,"height":0,"label":"{{msg.parameter}}","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"step","nodata":"warte auf Daten","dot":false,"ymin":"0","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":900,"wires":[[]]},{"id":"8b8a4e79.25681","type":"ui_gauge","z":"25cbe481.e10bec","name":"Temperatur","group":"fa42e847.06d618","order":1,"width":0,"height":0,"gtype":"gage","title":"Wassertemperatur","label":"°C","format":"{{value | number:1}}","min":"-5","max":"30","colors":["#9ab1c2","#5ea83e","#a92e2e"],"seg1":"7","seg2":"25","x":1130,"y":860,"wires":[]},{"id":"5a518902.cf5178","type":"ui_gauge","z":"25cbe481.e10bec","name":"Bodenfeuchte","group":"9ee1b18d.51ece","order":3,"width":"3","height":"2","gtype":"gage","title":"Feuchte","label":"%","format":"{{value | number:1}}","min":"40","max":"60","colors":["#008000","#5ea83e","#ffff80"],"seg1":"","seg2":"","x":1140,"y":260,"wires":[]},{"id":"e0881662.c6eba8","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"9ee1b18d.51ece","order":4,"width":0,"height":0,"label":"Bodenfeuchte","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"warte auf Daten","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1118,"y":300,"wires":[[]]},{"id":"7ff6e58a.de588c","type":"ui_chart","z":"25cbe481.e10bec","name":"","group":"5ffa92f6.040b6c","order":4,"width":"7","height":"7","label":"Temperatur","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"warte auf Daten","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1130,"y":360,"wires":[[]]},{"id":"c6152cb3.110cc","type":"inject","z":"5b6fa421.88b5bc","name":"On","topic":"","payload":"{\"On\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":200,"wires":[["5c83b43c.10499c"]]},{"id":"3439b91c.802006","type":"debug","z":"5b6fa421.88b5bc","name":"HomeKit Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":600,"y":240,"wires":[]},{"id":"750c4b0e.cc4324","type":"inject","z":"5b6fa421.88b5bc","name":"Off","topic":"","payload":"{\"On\":false}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":260,"wires":[["5c83b43c.10499c"]]},{"id":"5c83b43c.10499c","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Example Switch","serviceName":"Switch","topic":"","filter":false,"manufacturer":"Default Manufacturer","model":"Default Model","serialNo":"Default Serial Number","cameraConfigVideoProcessor":"","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":"","cameraConfigMaxWidth":"","cameraConfigMaxHeight":"","cameraConfigMaxFPS":"","cameraConfigMaxBitrate":"","cameraConfigVideoCodec":"","cameraConfigAudioCodec":"","cameraConfigAudio":false,"cameraConfigPacketSize":"","cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"","cameraConfigMapAudio":"","cameraConfigVideoFilter":"","cameraConfigAdditionalCommandLine":"","cameraConfigDebug":false,"characteristicProperties":"{}","x":403,"y":238,"wires":[["3439b91c.802006"],[]]},{"id":"6909e129.6d064","type":"influxdb out","z":"25cbe481.e10bec","d":true,"influxdb":"30064ba2.1a2874","name":"to influxDB","measurement":"","precision":"","retentionPolicy":"","x":1510,"y":460,"wires":[]},{"id":"9050990b.5553c8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":320,"wires":[]},{"id":"41b0a88c.eb29d8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":340,"wires":[]},{"id":"2bcaf814.086108","type":"inject","z":"309a0a3e.c49326","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":374,"wires":[["dc630f01.ac99"]]},{"id":"dc630f01.ac99","type":"function","z":"309a0a3e.c49326","name":"delete heating.devices.layout","func":"var currentObject= global.get(\"mySettings\",\"file\");\ndelete currentObject.heating.devices.layout;\n\nreturn msg;","outputs":1,"noerr":0,"x":341,"y":374,"wires":[[]]},{"id":"de90c4c8.7db9d8","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1036,"y":952,"wires":[]},{"id":"36542b63.916a34","type":"debug","z":"afaa0885.ad2718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":662,"y":1173,"wires":[]},{"id":"23cfd0c3.e20ea","type":"debug","z":"dd3f4b52.8a4468","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":866,"y":510,"wires":[]},{"id":"3b425306.f3caec","type":"ui_list","z":"b66f2c73.9297e","group":"6a28c45b.c2fe1c","name":"Lights","order":23,"width":8,"height":7,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"mySettings.light.scenes.sceneMembers","x":645,"y":714,"wires":[["416a303f.3ca61","2c818ec7.042a62"]]},{"id":"66c5ebf.74f0b14","type":"ui_list","z":"9848cbbf.0bdd68","group":"ceeb11f0.8bfba","name":"Lights","order":14,"width":8,"height":7,"lineType":"one","actionType":"check","allowHTML":true,"outputs":1,"topic":"mySettings.light.groups.groupMembers","x":594,"y":510,"wires":[["6cd5f93f.c42ac8"]]},{"id":"378844f7.a04c1c","type":"ui_list","z":"dd3f4b52.8a4468","group":"4ac97505.03ae4c","name":"days","order":1,"width":8,"height":7,"lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"mySettings.heating.periods.days","x":560,"y":459,"wires":[["baf525eb.f5de78"]]},{"id":"1751bfe.a87f04","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":934,"y":561,"wires":[]},{"id":"38003863.d59a68","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":934,"y":663,"wires":[]},{"id":"2c818ec7.042a62","type":"debug","z":"b66f2c73.9297e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":798,"y":748,"wires":[]},{"id":"63cf45e5.3e8d8c","type":"ui_table","z":"1e193208.71985e","group":"51ce6aa1.620754","name":"Syslog","order":6,"width":"19","height":"7","columns":[],"outputs":1,"cts":true,"x":815,"y":136,"wires":[["4e5b6320.769b1c","e6ca246c.97c3e8"]]},{"id":"fdd77b85.5f81a8","type":"debug","z":"1e193208.71985e","name":"save ui_control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1236,"y":187,"wires":[]},{"id":"f1ca2f97.e3436","type":"function","z":"868280d8.dfda9","name":"saveUiControl","func":"var msgUI=[];\nvar status={fill:\"yellow\",shape:\"dot\",text:msg.topic+\"=\"+msg.payload};\nvar configContext=flow.get(\"$parent.configContext\");\nvar uiNode=flow.get(\"$parent.uiNode\");\nvar multiUser=flow.get(\"$parent.multiUser\") || false;\n// handle command messages\nif (msg.hasOwnProperty(\"command\")) {\n    status.text=\"command:\"+msg.command;\n    switch (msg.command) {\n        case (\"state\"):\n            if (msg.hasOwnProperty(\"configContext\")) {\n                configContext=msg.configContext;\n                flow.set(\"$parent.configContext\",configContext);\n            }\n            if (msg.hasOwnProperty(\"uiNode\")) {\n                uiNode=msg.uiNode;\n                flow.set(\"$parent.uiNode\",uiNode);\n            }\n            if (msg.hasOwnProperty(\"multiUser\")) {\n                multiUser=msg.multiUser;\n                flow.set(\"$parent.multiUser\",multiUser);\n            }\n            return [{payload:status},null];\n    }\n}\n\n// store for uiControl callbacks data\nif (!configContext || !configContext.hasOwnProperty(\"storeName\") || !configContext.hasOwnProperty(\"storeProvider\") || !configContext.hasOwnProperty(\"storeTempName\")) {\n    node.error(\"context not configured!\");\n    return;\n}\nif (!uiNode) {\n    node.error(\"uiNode not configured!\");\n    return;\n}\n\nvar uiControlTemp=global.get(configContext.storeTempName);\nif (uiControlTemp===undefined) { // initialize store\n    uiControlTemp={};\n    global.set(configContext.storeTempName,uiControlTemp);\n}\n\n// store for global uiControl\nvar uiControl=global.get(configContext.storeName,configContext.storeProvider);\nif (uiControl===undefined) { // initialize store\n    uiControl={};\n    global.set(configContext.storeName,uiControl,configContext.storeProvider);\n}\n\n// set uiNode\nif (!uiControl.hasOwnProperty(uiNode)) uiControl[uiNode]={};\nvar uiFunction=uiControl;\nuiControl=uiControl[uiNode];\nif (uiControl===undefined) {\n    node.error(\"no configuration for \"+uiNode+\" found\");\n    return;\n}\nif (!uiControl.hasOwnProperty(\"tableData\") || !Array.isArray(uiControl.tableData)) uiControl.tableData=[];\n\n// get or initalize maxStoreLines\nvar maxStoreLines=100;\nif (uiControl.config.hasOwnProperty(\"maxStoreLines\")) {\n    maxStoreLines=uiControl.config.maxStoreLines;\n} else {\n    node.error(\"uiControl.config.maxStoreLines undefined!\");\n    return;\n}\n\n// handle incomming messages form ui-table\nif (msg.hasOwnProperty(\"ui_control\") &&\n    msg.ui_control.hasOwnProperty(\"callback\")) {\n    var config=uiFunction.getConfig((multiUser) ? msg.socketid:\"default\", uiControl, uiControlTemp.clients);\n    switch(msg.ui_control.callback) {\n        case \"columnResized\": // save column sizes globaly\n            config[msg.ui_control.columnWidths.field+\":\"+msg.ui_control.columnWidths.title]={\"width\":msg.ui_control.columnWidths.width};\n            status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\": \"+msg.ui_control.columnWidths.field+\".width=\"+msg.ui_control.columnWidths.width};\n            break;\n        case \"columnMoved\": // save column order\n            config.columnOrder=msg.ui_control.columns;\n            status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\": order \"+uiControlTemp.columnOrder.length+\" (temp)\"};\n            break;\n        case \"addData\": // sucessfully added a new row\n            status={fill:\"green\",shape:\"dot\",text: msg.ui_control.callback+\" success (\"+uiControl.tableData.length+\")\"};\n            break;\n        default:\n            status={fill:\"red\",shape:\"dot\",text: \"callback: \"+msg.ui_control.callback+\"?\"};\n            break;\n    }\n}\n\nif (msg.command===\"storeRow\") {\n    if (msg.placeOnTop) {\n        uiControl.tableData.unshift(msg.payload);\n        if (uiControl.tableData.length>maxStoreLines) { // delete rows from bottom\n            uiControl.tableData.splice(maxStoreLines,uiControl.tableData.length-1);\n        }\n    } else {\n        uiControl.tableData.push(msg.payload);\n        if (uiControl.tableData.length>maxStoreLines) { // delete rows from top\n            uiControl.tableData.splice(0,uiControl.tableData.length-maxStoreLines);\n        }                \n    }\n    \n    // collect possible filter options and update dropdown if nessesary\n    var filterProperty=env.get(\"filterProperty\");\n    if (msg.payload.hasOwnProperty(filterProperty)) {\n        if (!uiControl.hasOwnProperty(\"filterList\")) uiControl.filterList=[\"[all]\"];\n        if (!uiControl.filterList.includes(msg.payload[filterProperty])) {\n            uiControl.filterList.push(msg.payload[filterProperty]);\n            msgUI.push({\"topic\":\"filterString\",\"options\":uiControl.filterList});\n        }\n    }\n    status={fill:\"green\",shape:\"dot\",text: msg.command+\": \"+uiControl.tableData.length+\" rows\"};\n}\n\nreturn [{payload:status},msg,msgUI];","outputs":3,"noerr":0,"x":199,"y":119,"wires":[[],[],[]]},{"id":"4e5b6320.769b1c","type":"subflow:868280d8.dfda9","z":"1e193208.71985e","name":"","env":[{"name":"uiNode","value":"syslogTable","type":"str"}],"x":1015,"y":221,"wires":[["fdd77b85.5f81a8"],["aafd2539.905ba8"]]},{"id":"f7b608bf.20f908","type":"function","z":"e8fd2fc9.509e","name":"loadUiControl","func":"var msgOut={}; // output 1\nvar msgToInput=[]; // output 2 (initally undefined)\nvar msgToUI=[]; // output 3\nvar status={fill:\"yellow\",shape:\"dot\",text:\"\"};\nvar multiUser= env.get(\"multiUser\") || false;\n\nif (!msg.hasOwnProperty(\"socketid\")) {\n    status.text=\"No socketID!\"\n    return [{payload:status},null,null,null,msg];\n}\n\n// set uiNode\nvar uiNode=env.get(\"uiNode\");\nvar configContext=env.get(\"context\");\nif (!configContext || !configContext.hasOwnProperty(\"storeName\") || !configContext.hasOwnProperty(\"storeProvider\") || !configContext.hasOwnProperty(\"storeTempName\")) {\n    node.error(\"context not configured!\");\n    return;\n}\n\n// get store for socketid uiControl context\nvar uiControlTemp=global.get(configContext.storeTempName);\nif (uiControlTemp===undefined) {\n    uiControlTemp={\"clients\":{}};\n    global.set(configContext.storeTempName,uiControlTemp);\n}\n//initialize or update socketid to socketip lookup table;\nif (msg.hasOwnProperty(\"socketip\")) {\n    if (!uiControlTemp.hasOwnProperty(\"clients\")) uiControlTemp.clients={};\n    uiControlTemp.clients[msg.socketid]={};\n    uiControlTemp.clients[msg.socketid].socketip=msg.socketip;\n}\n\n// get store for persistent uiControl conetxt\nvar uiControl=global.get(configContext.storeName,configContext.storeProvider);\nif (uiControl===undefined) { // initialize store\n    uiControl={};\n    global.set(configContext.storeName,uiControl,configContext.storeProvider);\n}\nif (!uiControl.hasOwnProperty(uiNode)) uiControl[uiNode]={};\n\nuiControl.getIp= function(socketid) {\n    return uiControlTemp.clients[socketid].socketip;\n}\n\n// function to get thw config matching the client ip address or a general config\nuiControl.getConfig= function (socketid,uiControl,clients) {\n    if (!uiControl.hasOwnProperty(\"config\")) uiControl.config={};\n    if (socketid===\"default\") {\n        if (!uiControl.config.hasOwnProperty(\"default\")) uiControl.config[\"default\"]={};\n        return uiControl.config[\"default\"];\n    }\n    var socketip;\n    if (socketid!==undefined) {\n        if (!clients.hasOwnProperty(socketid)) clients[socketid]={};\n        socketip=clients[socketid].socketip;\n    } else {\n        node.error(\"[getConfig] SocketID undefined!\");\n    }\n    if (socketip!==undefined) {\n        if (!uiControl.config.hasOwnProperty(socketip)) uiControl.config[socketip]={};\n        return uiControl.config[socketip];\n    } else {\n        node.error(\"[getConfig] SocketIP not found! (\"+socketid+\")\")\n        return uiControl.config;\n    }\n}\n\nvar config\nif (multiUser) {\n    config=uiControl.getConfig(msg.socketid, uiControl[uiNode], uiControlTemp.clients);\n} else {\n    config=uiControl.getConfig(\"default\", uiControl[uiNode], uiControlTemp.clients);\n}\nuiControl=uiControl[uiNode];\n\n// initialize und update UI\nif (!uiControl.config.hasOwnProperty(\"maxStoreLines\")) {\n    uiControl.config.maxStoreLines=env.get(\"maxStoreLines\") || 50;\n    msgToUI.push({\"topic\":\"maxStoreLines\",\"payload\":uiControl.config.maxStoreLines});\n}\n\n// store all values if msg.storeValue msg arrives and give feedback\nif (msg.hasOwnProperty(\"storeValue\")) {\n    config.params.uiParmeters[msg.storeValue]=msg.payload;\n    msgToUI.push(RED.util.cloneMessage(msg));\n    msgToUI[msgToUI.length-1].sessionid=msg.socketid\n}\n\n// handle command send by msg.command\nif (msg && msg.hasOwnProperty(\"command\")) {\n    msgToInput.push(RED.util.cloneMessage(msg));\n    status.text=msg.command+\" :\"+msg.payload;\n    switch(msg.command) {\n        case \"deleteRecords\":\n            if (msg.payload===\"OK\") {\n                uiControl.tableData=[];\n                uiControl.filterList=[\"[any]\"];\n                msg.payload=\"OK\"; // to trigger redraw\n                msg.name=env.get(\"tabName\");\n                msgToInput[msgToInput.length-1].command=\"resetCounter\";\n                msgToInput[msgToInput.length-1].payload=0;\n            } else {\n                return;\n            }\n            break;\n        case \"recordActive\":\n            msgToInput[msgToInput.length-1].payload=config.params.uiParmeters.recordActive;\n            return [{payload:status},null,msgToInput,msgToUI];\n        case \"maxStoreLines\":\n            uiControl.config.maxStoreLines=Number(msg.payload) || 100; // don`t store in config.ip as there is only one buffer\n            return [{payload:status},null,msgToInput,msgToUI];\n        case \"maxDisplayLines\":\n            msgToInput[msgToInput.length-1].payload=config.params.uiParmeters.maxDisplayLines;\n            return [{payload:status},null,msgToInput,msgToUI];\n        case \"filterString\":\n            if (msg.payload===\"[all]\" || msg.payload===\"\") {\n                msg.payload={\n                    command:\"clearFilter\",\n                    arguments:[],\n                    \"returnPromise\": false\n                }\n            } else {\n                msg.payload={\n                    command:\"setFilter\",\n                    arguments:[\"hostname\",\"=\",msg.payload],\n                    \"returnPromise\": false\n                }\n            }\n            return[{payload:status},msg,msgToInput,msgToUI];\n    }\n}\n\n// handle messages from ui-control node\nswitch (msg.payload) {\n    case \"lost\" : // socket lost so clean temp settings\n        if (uiControlTemp.clients.hasOwnProperty(msg.socketid)) {\n            delete uiControlTemp.clients[msg.socketid];\n            status={fill:\"blue\",shape:\"dot\",text:\"settings deleted\"};\n            return [{payload:status},null,null];\n        }\n        break;\n    case \"OK\":\n    case \"change\":\n    case \"connect\":\n        msgOut.socketid=msg.socketid;\n        msgToInput.push(RED.util.cloneMessage(msg));\n        msgToInput[msgToInput.length-1].command=\"state\"\n        msgToInput[msgToInput.length-1].uiNode=uiNode;\n        msgToInput[msgToInput.length-1].configContext=configContext;\n        msgToInput[msgToInput.length-1].multiUser=multiUser;\n\n        if (msg.name===env.get(\"tabName\") || msg.payload===\"connect\") {\n            // load default settings into UI\n            if (!config.hasOwnProperty(\"params\")) config.params=RED.util.cloneMessage(env.get(\"defaultConfig\"));\n            Object.keys(config.params.uiParmeters).forEach(function (key) {\n                msgToUI.push({\"topic\":key,\"socketid\":msg.socketid,\"payload\":config.params.uiParmeters[key]});\n            });\n            \n            // set ui_control defaults\n            if (env.get(\"ui_control\")) {\n                msgOut.ui_control=env.get(\"ui_control\");\n                status={fill:\"green\",shape:\"dot\",text:\"defaults loaded\"};\n            }\n\n            var updateCounter = 0;\n            var columnID=\"\";\n            \n            // order columns if modified in runtime\n            // not the most elegant programming style: Improvements welcome ;)\n            \n            if (config.hasOwnProperty(\"columnOrder\")){\n\n                var addedColumns = 0;\n                var sortColumnsByLayout = function (sortColumns, columnsLayout, targetColumns) {\n                    for (var layoutColumn=0;  layoutColumn<columnsLayout.length; layoutColumn++) {\n                        for (var sortColumn in sortColumns) {\n                            if (sortColumns[sortColumn].hasOwnProperty(\"columns\")) {\n                                targetColumns.push({\"title\":sortColumns[sortColumn].title, \"columns\":[]});\n                                sortColumnsByLayout(sortColumns[sortColumn].columns,columnsLayout,targetColumns[targetColumns.length-1].columns);\n                                layoutColumn=addedColumns; // jump forward after childes added\n                            } else {\n                                if (columnsLayout[layoutColumn].field===sortColumns[sortColumn].field){\n                                    targetColumns.push(sortColumns[sortColumn]);\n                                    addedColumns++;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                }                 \n                \n                var newColumns=[];\n                sortColumnsByLayout(msgOut.ui_control.tabulator.columns,config.columnOrder,newColumns);\n                msgOut.ui_control.tabulator.columns=newColumns;\n            }\n            \n            var updateColumns = function(columns,property) {\n                // add or modifiy properties if modified in runtime\n                for (var column of columns) {\n                    if (column.hasOwnProperty(\"columns\") && Array.isArray(column.columns)) {\n                        updateColumns(column.columns,property);\n                    } else {\n                        columnID=column.field+\":\"+column.title;\n                        if (config.hasOwnProperty(columnID) &&\n                            config[columnID].hasOwnProperty(property)) {\n                                \n                            column[property]=config[columnID][property]\n                            updateCounter++;\n                        }\n                    }\n                }\n            }\n            \n            updateColumns(msgOut.ui_control.tabulator.columns,\"width\")\n            if (updateCounter>0) {\n                status.fill=\"green\";\n                status.shape=\"dot\";\n                status.text+=\" (\"+updateCounter+ \" updates)\";\n            }\n\n            // restore stored table Data\n            if (uiControl.hasOwnProperty(\"tableData\")) {\n                msgOut.payload=uiControl.tableData;\n                // set counter & first row to match restored data\n                if (uiControl.tableData.length>0) {\n                    config.params.counter=uiControl.tableData[0].id;\n                    config.params.firstRow=uiControl.tableData[uiControl.tableData.length-1].id;\n                }                \n                status.text+=msgOut.payload.length + \" rows\"\n            } else {\n                config.params.counter=0;\n                config.params.firstRow=0;\n                msgOut.payload=[]; // send empty array to clear table\n                msgToInput.push({\"command\":\"resetCounter\",\"payload\":0});\n            }\n\n            // update filter List\n            if (uiControl.hasOwnProperty(\"filterList\")) {\n                msgToUI.push({\"topic\":\"filterString\",\"socketid\":msg.socketid,\"options\":uiControl.filterList});\n            }\n\n            config.params.visible=true;\n            return [{payload:status},msgOut,msgToInput,msgToUI];\n        }\n        \n        // send online/offline messages if tab state changes\n        if (msg.name===env.get(\"tabName\")) {\n            config.params.visible=true;\n            status={fill:\"green\",shape:\"dot\",text:\"online\"};\n        } else {\n            config.params.visible=false;\n            status={fill:\"yellow\",shape:\"dot\",text:\"offline\"};\n        }\n\n        return [{payload:status},null,msgToInput,msgToUI];\n    default:\n        node.error({\"payload:\":msg.payload,\"tab:\":env.get(\"tabName\")})\n        status={fill:\"red\",shape:\"dot\",text:msg.payload+\" unhandeled\"};\n        return [{payload:status},null,null,msgToUI];\n}\n","outputs":5,"noerr":0,"x":199,"y":187,"wires":[[],[],[],[],[]],"outputLabels":["status","ui-table","to input function","to dashboard","passthrough"]},{"id":"f96fd3f9.0f311","type":"subflow:e8fd2fc9.509e","z":"1e193208.71985e","name":"","env":[{"name":"uiNode","value":"syslogTable","type":"str"},{"name":"ui_control","value":"{\"tabulator\":{\"columnResized\":\"function(column){  var newColumn = {         title:column._column.definition.title,field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"columnMoved = function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.definition.field, 'title': column._column.definition.title});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\",\"columns\":[{\"title\":\"Id\",\"field\":\"id\",\"width\":100},{\"title\":\"Time\",\"field\":\"timestamp\",\"width\":100,\"formatter\":\"datetime\",\"formatterParams\":{\"inputFormat\":\"YYYY-MM-DD HH:mm:ss.SSS\",\"outputFormat\":\"HH:mm:ss\",\"invalidPlaceholder\":\"(invalid time)\"}},{\"title\":\"Message\",\"field\":\"msg\",\"width\":100,\"headerFilter\":true},{\"title\":\"Tag\",\"field\":\"tag\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}},{\"title\":\"Date\",\"field\":\"timestamp\",\"width\":100,\"formatter\":\"datetime\",\"formatterParams\":{\"inputFormat\":\"YYYY-MM-DD HH:mm:ss.SSS\",\"outputFormat\":\"DD.MM.YY\",\"invalidPlaceholder\":\"(invalid Date)\"}},{\"title\":\"Facility\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Code\",\"field\":\"facilityCode\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Name\",\"field\":\"facility\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}}]},{\"title\":\"Severity\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Code\",\"field\":\"severityCode\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Severty\",\"field\":\"severity\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}}]},{\"title\":\"Client\",\"columns\":[{\"title\":\"Hostname\",\"field\":\"hostname\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}},{\"title\":\"Address\",\"field\":\"address\",\"width\":100,\"formatter\":\"link\",\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true},\"formatterParams\":{\"urlPrefix\":\"http://\",\"target\":\"_blank\"}},{\"title\":\"Port\",\"field\":\"port\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}},{\"title\":\"Protocol\",\"field\":\"family\",\"width\":100,\"headerFilter\":\"select\",\"headerFilterParams\":{\"values\":true}}]}],\"layout\":\"fitColumns\",\"movableColumns\":true,\"groupBy\":\"\"},\"customHeight\":12}","type":"json"},{"name":"tabName","value":"ui-table example","type":"str"},{"name":"context","value":"{\"storeName\":\"uiControl\",\"storeProvider\":\"file\",\"storeTempName\":\"uiControlTemp\",\"storeTempProvider\":\"default\"}","type":"json"},{"name":"defaultConfig","value":"{\"uiParmeters\":{\"recordActive\":false,\"maxStoreLines\":50,\"maxDisplayLines\":100,\"filterString\":\"[all]\"},\"firstRow\":0,\"counter\":0}","type":"json"}],"x":318,"y":153,"wires":[["4dac4c3e.e069b4","63cf45e5.3e8d8c"],["d54606f7.055af8","a7c69580.a2cec8","4e5b6320.769b1c"],["4608e26c.241b8c"],[]]},{"id":"ff7d0dc8.fae43","type":"ui_ui_control","z":"1e193208.71985e","name":"","events":"all","x":77,"y":136,"wires":[["9b5a4f48.5c27c","f96fd3f9.0f311"]]},{"id":"9b5a4f48.5c27c","type":"debug","z":"1e193208.71985e","name":"ui control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":298,"y":102,"wires":[]},{"id":"4dac4c3e.e069b4","type":"debug","z":"1e193208.71985e","name":"load ui_control","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":624,"y":68,"wires":[]},{"id":"bc43cef0.26fe4","type":"inject","z":"1e193208.71985e","name":"demo data","topic":"","payload":"{\"facility\":\"daemon\",\"facilityCode\":3,\"severity\":\"info\",\"severityCode\":6,\"tag\":\"systemd[1]\",\"timestamp\":\"2018-12-26T17:53:57.000Z\",\"hostname\":\"localhost\",\"address\":\"127.0.0.1\",\"family\":\"IPv4\",\"port\":38514,\"size\":80,\"msg\":\"some demo data\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":111,"y":323,"wires":[["d54606f7.055af8"]]},{"id":"d54606f7.055af8","type":"function","z":"1e193208.71985e","name":"syslog2ui-table","func":"var counter=context.get(\"counter\") || 0\nvar configContext=context.get(\"configContext\");\nvar uiNode=context.get(\"uiNode\");\nvar multiUser=context.get(\"multiUser\") || false;\n// handle command messages\nif (msg.hasOwnProperty(\"command\")) {\n    node.status({fill:\"yellow\",shape:\"dot\",text:msg.command+\"=\"+msg.payload});\n    switch (msg.command) {\n        case (\"state\"):\n            if (msg.hasOwnProperty(\"configContext\")) {\n                configContext=msg.configContext;\n                context.set(\"configContext\",configContext);\n            }\n            if (msg.hasOwnProperty(\"uiNode\")) {\n                uiNode=msg.uiNode;\n                context.set(\"uiNode\",uiNode);\n            }\n            if (msg.hasOwnProperty(\"multiUser\")) {\n                multiUser=msg.multiUser;\n                context.set(\"multiUser\",multiUser);\n            }\n            return;\n        case (\"resetCounter\"):\n            counter= 0;\n            context.set(\"counter\",counter);\n            return [{\"payload\": {\"command\": \"clearData\",\"arguments\": [], \"returnPromise\": false}},null];\n        default: \n            return;\n    }\n}\n\nvar msgOut;\n\n// get context variables\nif (!configContext || !configContext.hasOwnProperty(\"storeName\") || !configContext.hasOwnProperty(\"storeProvider\")) {\n    return;\n}\nvar uiControl=global.get(configContext.storeName,configContext.storeProvider);\nvar clients=global.get(configContext.storeTempName);\nif (clients && clients.hasOwnProperty(\"clients\")) {\n    clients=clients.clients;\n} else {\n    node.error(\"clients not defined in \"+configContext.storeTempName);\n    return;\n}\n\n\nif (uiNode===undefined) {node.error(\"uiNode not defined!\"); return;}\nif (uiControl===undefined) {node.error(\"uiControl not defined!\"); return;}\n\n// ----------------------------------------------------------------------------\n// make some adjustements to the incomming data when nessesary here\n// ----------------------------------------------------------------------------\n\n// update adjust timestamp to local timezone\nvar timestamp= new Date(Date.now());\ntimestamp= new Date(timestamp.getTime() - timestamp.getTimezoneOffset() * 60000);\nmsg.payload.timestamp= timestamp.toISOString();\n\n// correct host name (ESPEasy adds <#> infront where # is the severty code)\nif (msg.payload.hostname.substr(0,1)===\"<\" && msg.payload.hostname.substr(2,1)===\">\") {\n    msg.payload.hostname=msg.payload.hostname.slice(3);\n}\n\n// ----------------------------------------------------------------------------\n// no changes below this line unless you know what you are doing ;)\n\n// add global id to row for later referece i.e. deleting rows\ncounter++;\ncontext.set(\"counter\",counter);\nmsg.payload.id=counter;\n\n// format the \"addData\" command of tabulator to add a new row to the top of the table\nmsgOut={\n    \"payload\": {\n        \"command\": \"addData\",\n        \"arguments\": [msg.payload,true],\n        \"returnPromise\": true\n    }\n}\n\n// allways send row to second output to store them\nnode.send([null,{\"command\":\"storeRow\",\"payload\":msg.payload, \"placeOnTop\":true}]);\n\n// message to delete individual rows without returning a promise\nvar msgDeleteRow={\n    \"payload\": {\n        \"command\": \"deleteRow\",\n        \"arguments\": 0,\n        \"returnPromise\": false\n    }\n}\n\n// loop through all connected clinets and send them individual data\n\nvar deletedCounter = 0;\nvar sentCounter = 0; // indicator the a line was sent once\nvar client;\nvar keys = Object.keys(clients);\nif (!multiUser) keys = [keys[0]]; // if multiuser disabled use only first available client config\nfor (const key of keys) {\n    client=uiControl[uiNode].config[(multiUser) ? clients[key].socketip:\"default\"].params;\n    if (client.uiParmeters.recordActive && (!multiUser  || client.visible)) {\n        // apply host filter BEFORE sending new data to ui-table\n        if (!client.uiParmeters.hasOwnProperty(\"filterString\")) client.uiParmeters.filterString=\"[any]\";\n        if (client.uiParmeters.filterString===\"[any]\" || client.uiParmeters.filterString===msg.payload.hostname) {\n            client.counter=counter;\n            if (client.firstRow>counter) client.firstRow=counter; // adjust client counter after reset;\n            msgOut.socketid=client.socketid;\n            // first delete row from the bottom\n            if (client.counter-client.firstRow>client.uiParmeters.maxDisplayLines) {\n                if (client.counter-client.firstRow > uiControl[uiNode].config.maxStoreLines+client.uiParmeters.maxDisplayLines) { // client is behind buffer!\n                    var msgReplaceData={\n                        \"payload\": {\n                            \"command\": \"replaceData\",\n                            \"arguments\": [uiControl[uiNode].tableData],\n                            \"returnPromise\": false\n                        }\n                    }\n                    node.send([msgReplaceData,null]);\n                    // adjust new first row;\n                    client.firstRow=uiControl[uiNode].tableData[uiControl[uiNode].tableData.length-1].id;\n                    // node.warn(\"client behind buffer, restoring buffer! new firstRow=\"+client.firstRow);\n                } else {\n                    var warnText=\"client exceed \"+client.uiParmeters.maxDisplayLines+\" counter:\"+client.counter+\" first:\"+client.firstRow;\n                    msgDeleteRow.payload.arguments=[];\n                \n                    for (var i=client.firstRow; i<client.counter-client.uiParmeters.maxDisplayLines; i++) {\n                        msgDeleteRow.payload.arguments.push(i);\n                    }\n                    deletedCounter+=msgDeleteRow.payload.arguments.length;\n                    warnText += \" delete \"+msgDeleteRow.payload.arguments.length+\" rows\";\n                    node.send([msgDeleteRow,null]);\n                    client.firstRow=client.counter-client.uiParmeters.maxDisplayLines;\n                    // warnText += \"client 1st row:\"+client.firstRow+\" [\"+msgDeleteRow.payload.arguments.toString()+\"]\";\n                    // node.warn(warnText);\n                }\n            }\n            // send new row to the top\n            if (multiUser) msgOut.socketid=key;\n            node.send([msgOut,null]);\n            sentCounter++;\n            if (sentCounter===1) {\n                var deletedText= (deletedCounter>0) ? \"del: \"+deletedCounter+\" \" : \"\";\n                node.status({fill:\"green\",shape:\"dot\",text:client.counter+\". msg \"+ deletedText +\"(\"+client.uiParmeters.filterString+\")\"});\n            } else {\n                node.status({fill:\"green\",shape:\"dot\",text:counter+\". msg sent to \"+sentCounter+\" clients\"});\n            }\n        }\n    } else {\n        \n    }\n}","outputs":2,"noerr":0,"x":607,"y":272,"wires":[["63cf45e5.3e8d8c","fed0aeb3.a329d"],["4e5b6320.769b1c","9d305a21.304668"]],"outputLabels":["to ui-table","bypass"],"icon":"node-red/swap.svg","info":"# Format data to be displayed with ui-table\n\nUse this function node to format incomming data to be modified for ui-table\n\n## Example\n\n1. it corrects the time form UTC to local time\n\n```\nvar timestamp= new Date(Date.now());\ntimestamp= new Date(timestamp.getTime() - timestamp.getTimezoneOffset() * 60000);\nmsg.payload.timestamp= timestamp.toISOString();\n```\n\n2. format the \"addData\" command of tabulator to add a new row to the top of the table \n\n```\nvar msgOut={\n    \"payload\": {\n        \"command\": \"addData\",\n        \"arguments\": [msg.payload,true],\n        \"returnPromise\": true\n    }\n}\n```\n\n`command`: Tabulator command [see documentation](http://tabulator.info/docs/4.5/update#overview)\n\n`arguments`: Array with the arguments for the command function\n\n`returnPromise`: if `true` the ui-table will return the message if command sucessfully executed. Set to true to enable the saveUiControl subflow to store the data. otherwise it will not survive reload or tab changes.\n\n3. bypass ui-table if not currently visible\n4. fill host list for filtering\n"},{"id":"e6ca246c.97c3e8","type":"debug","z":"1e193208.71985e","name":"from ui-table","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1005,"y":136,"wires":[]},{"id":"bec529cb.a9bfc8","type":"ui_dropdown","z":"1e193208.71985e","name":"filterString","label":"Filter Host","tooltip":"","place":"Select Host","group":"51ce6aa1.620754","order":1,"width":"7","height":1,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"filterString","x":349,"y":459,"wires":[["c58cb32.f70fd5"]]},{"id":"938f3076.e84a8","type":"ui_button","z":"1e193208.71985e","name":"deleteRecords","group":"51ce6aa1.620754","order":5,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"deleteRecords","payloadType":"str","topic":"uiDeleteButton","x":369,"y":663,"wires":[["c3e235de.faff38"]]},{"id":"83669342.f1163","type":"inject","z":"d1227ddb.952f7","name":"msg.payload","topic":"","payload":"[{\"name\":\"MEQ0451495\",\"room\":\"Bathroom\",\"SET_TEMPERATURE-value\":22,\"ACTUAL_TEMPERATURE-value\":21.8,\"VALVE_STATE-value\":90,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":true,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875547\",\"room\":\"Living Room\",\"SET_TEMPERATURE-value\":12,\"ACTUAL_TEMPERATURE-value\":16.2,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":1},{\"name\":\"MEQ1875538\",\"room\":\"Living Room\",\"SET_TEMPERATURE-value\":18,\"ACTUAL_TEMPERATURE-value\":19.5,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.6,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":2},{\"name\":\"MEQ0447462\",\"room\":\"Kitchen\",\"SET_TEMPERATURE-value\":17,\"ACTUAL_TEMPERATURE-value\":22.2,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":10,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":3},{\"name\":\"MEQ1875551\",\"room\":\"Office\",\"SET_TEMPERATURE-value\":18,\"ACTUAL_TEMPERATURE-value\":20.2,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ0447425\",\"room\":\"Dining Room\",\"SET_TEMPERATURE-value\":19,\"ACTUAL_TEMPERATURE-value\":20.4,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875546\",\"room\":\"Dining Room\",\"SET_TEMPERATURE-value\":20,\"ACTUAL_TEMPERATURE-value\":18.8,\"VALVE_STATE-value\":99,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ0447483\",\"room\":\"Bedroom\",\"SET_TEMPERATURE-value\":17,\"ACTUAL_TEMPERATURE-value\":22.4,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875541\",\"room\":\"Child\",\"SET_TEMPERATURE-value\":18,\"ACTUAL_TEMPERATURE-value\":20.4,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":2.7,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},{\"name\":\"MEQ1875552\",\"room\":\"Guest Room\",\"SET_TEMPERATURE-value\":20,\"ACTUAL_TEMPERATURE-value\":21.1,\"VALVE_STATE-value\":9,\"BATTERY_STATE-value\":2.8,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0}]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":138,"y":170,"wires":[["c080b0c.71d925"]]},{"id":"f75fa4c9.e46168","type":"change","z":"d1227ddb.952f7","name":"ui_control","rules":[{"t":"set","p":"ui_control","pt":"msg","to":"{\"tabulator\":{\"columnResized\":\"function(column){     var newColumn = {         field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.field});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"groupHeader\":\"function (value, count, data, group) {return value + \\\"<span style='color:#d00; margin-left:10px;'>(\\\" + count + \\\" Termostat\\\"+((count>1) ? \\\"e\\\" : \\\"\\\") + \\\")</span>\\\";}\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"ROom\",\"field\":\"room\",\"width\":100,\"frozen\":true},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Device\",\"field\":\"name\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Type\",\"field\":\"deviceType\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Measurements\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"target\",\"field\":\"SET_TEMPERATURE-value\",\"formatter\":\"function(cell, formatterParams, onRendered){return cell.getValue()+'°C';}\",\"topCalc\":\"avg\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"min\":10,\"max\":25,\"color\":[\"blue\",\"green\",\"red\"],\"legend\":\"function (value) {return '&nbsp;&nbsp;'+value+'°C';}\",\"legendColor\":\"#101010\",\"legendAlign\":\"left\"},\"title\":\"current\",\"field\":\"ACTUAL_TEMPERATURE-value\",\"formatter\":\"progress\",\"topCalc\":\"avg\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"min\":0,\"max\":99,\"color\":[\"gray\",\"orange\",\"red\"],\"legend\":\"function (value) {return (value>0)? '&nbsp;&nbsp;'+value+' %' : '-';}\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Valve\",\"field\":\"VALVE_STATE-value\",\"formatter\":\"progress\",\"topCalc\":\"max\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"min\":1.5,\"max\":4.6,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {return value+' V';}\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Batt\",\"field\":\"BATTERY_STATE-value\",\"formatter\":\"progress\",\"topCalc\":\"min\",\"width\":100}]},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Settings\",\"columns\":[{\"formatterParams\":{\"target\":\"_blank\",\"min\":0,\"max\":30,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#101010;'>\\\"+value+\\\" min</span>\\\";     else         return \\\"<span style='color:#A0A0A0;'>aus</span>\\\"; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"Boost\",\"field\":\"BOOST_STATE-value\",\"formatter\":\"progress\",\"width\":100},{\"formatterParams\":{\"target\":\"_blank\",\"allowEmpty\":true,\"allowTruthy\":true,\"tickElement\":\"<i class='fa fa-clock-o'></i>\",\"crossElement\":\"<i class='fa fa-ban'></i>\"},\"title\":\"Auto\",\"field\":\"AUTO_MODE-value\",\"formatter\":\"tickCross\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\"},\"title\":\"Mode\",\"field\":\"CONTROL_MODE-value\",\"formatter\":\"function(cell, formatterParams, onRendered){     var html=\\\"<i class=\\\\\\\"\\\";     switch(cell.getValue()) {         case 0: html+=\\\"fa fa-calendar-check-o\\\"; break;         case 1: html+=\\\"fa fa-hand-o-up\\\"; break;         case 2: html+=\\\"fa fa-suitcase\\\"; break;         case 3: html+=\\\"fa fa-spinner fa-spin fa-fw\\\"; break;     }     html+='\\\\\\\"></i>';     return html; }\",\"width\":100,\"align\":\"center\"},{\"formatterParams\":{\"target\":\"_blank\",\"crossElement\":false},\"title\":\"Auto\",\"field\":\"AUTO_MODE-value\",\"formatter\":\"tickCross\",\"width\":100,\"align\":\"center\"}]}],\"layout\":\"fitColumns\",\"movableColumns\":true,\"groupBy\":\"\"},\"customHeight\":12}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":315,"y":119,"wires":[["c080b0c.71d925","cb0ec9e.9e9be38"]]},{"id":"7ee91b9d.c0c5b4","type":"debug","z":"d1227ddb.952f7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":679,"y":170,"wires":[]},{"id":"c080b0c.71d925","type":"ui_table","z":"d1227ddb.952f7","d":true,"group":"86d6c4d3.f4e698","name":"Thermostats","order":1,"width":"6","height":"4","columns":[],"outputs":1,"cts":true,"x":529,"y":170,"wires":[["7ee91b9d.c0c5b4"]]},{"id":"72f6f600.bcc8c8","type":"inject","z":"d1227ddb.952f7","name":"msg.ui_control","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":131,"y":119,"wires":[["f75fa4c9.e46168"]]},{"id":"843329f6.17a408","type":"change","z":"d1227ddb.952f7","name":"addData","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"command\":\"addData\",\"arguments\":[{\"name\":\"addedDevice\",\"room\":\"addedRoom\",\"SET_TEMPERATURE-value\":0,\"ACTUAL_TEMPERATURE-value\":0,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":0,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},true],\"returnPromise\":true}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":315,"y":357,"wires":[["81e4338d.2adfc"]]},{"id":"c381586a.c67858","type":"inject","z":"d1227ddb.952f7","name":"addData","topic":"","payload":"{\"command\":\"addData\",\"arguments\":[{\"name\":\"addedDevice\",\"room\":\"addedRoom\",\"SET_TEMPERATURE-value\":0,\"ACTUAL_TEMPERATURE-value\":0,\"VALVE_STATE-value\":0,\"BATTERY_STATE-value\":0,\"BOOST_STATE-value\":0,\"AUTO_MODE-value\":false,\"CONTROL_MODE-value\":0},true],\"returnPromise\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":128,"y":221,"wires":[["c080b0c.71d925","81e4338d.2adfc"]]},{"id":"81e4338d.2adfc","type":"debug","z":"d1227ddb.952f7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":221,"wires":[]},{"id":"cb0ec9e.9e9be38","type":"debug","z":"d1227ddb.952f7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":119,"wires":[]},{"id":"2b9bc827.b69618","type":"ui_numeric","z":"1e193208.71985e","name":"maxStoreLines","label":"maximum Store:","tooltip":"maximum amount of rows to be saved in context store (limited by server)","group":"51ce6aa1.620754","order":2,"width":5,"height":1,"wrap":false,"passthru":false,"topic":"maxStoreLines","format":"{{value}}","min":0,"max":"200","step":"10","x":369,"y":510,"wires":[["c58cb32.f70fd5"]]},{"id":"7b320c4e.9e0654","type":"ui_toast","z":"1e193208.71985e","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"OK/Cacel","x":706,"y":663,"wires":[["43a4caa3.06c034"]]},{"id":"c3e235de.faff38","type":"change","z":"1e193208.71985e","name":"Question","rules":[{"t":"set","p":"command","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"\"Do you like to delete all records?\"","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Delete?","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":553,"y":663,"wires":[["7b320c4e.9e0654"]]},{"id":"c58cb32.f70fd5","type":"change","z":"1e193208.71985e","name":"topic2command","rules":[{"t":"set","p":"command","pt":"msg","to":"topic","tot":"msg"},{"t":"set","p":"storeValue","pt":"msg","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":658,"y":561,"wires":[["43a4caa3.06c034"]]},{"id":"43a4caa3.06c034","type":"link out","z":"1e193208.71985e","name":"uiControlSettings","links":["41b7f798.8e6a48"],"x":865,"y":612,"wires":[]},{"id":"41b7f798.8e6a48","type":"link in","z":"1e193208.71985e","name":"uiControlSettings","links":["43a4caa3.06c034"],"x":117,"y":187,"wires":[["f96fd3f9.0f311","a8a0def.6ffd62"]]},{"id":"84e7d923.efb4d8","type":"ui_numeric","z":"1e193208.71985e","name":"maxDisplayLines","label":"Display:","tooltip":"maximum amount of rows to be displayed (limited by client memory)","group":"51ce6aa1.620754","order":3,"width":4,"height":1,"wrap":false,"passthru":false,"topic":"maxDisplayLines","format":"{{value}}","min":0,"max":"1000","step":"10","x":379,"y":561,"wires":[["c58cb32.f70fd5"]]},{"id":"c2999e05.72156","type":"ui_switch","z":"1e193208.71985e","name":"recordActive","label":"","tooltip":"","group":"51ce6aa1.620754","order":4,"width":2,"height":1,"passthru":false,"decouple":"true","topic":"recordActive","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":359,"y":612,"wires":[["c58cb32.f70fd5"]]},{"id":"a7c69580.a2cec8","type":"debug","z":"1e193208.71985e","name":"to input function","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":607,"y":323,"wires":[]},{"id":"d34f8292.cb3c","type":"switch","z":"1e193208.71985e","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"filterString","vt":"str"},{"t":"eq","v":"maxStoreLines","vt":"str"},{"t":"eq","v":"maxDisplayLines","vt":"str"},{"t":"eq","v":"recordActive","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":169,"y":544,"wires":[["bec529cb.a9bfc8"],["2b9bc827.b69618"],["84e7d923.efb4d8"],["c2999e05.72156"]]},{"id":"aafd2539.905ba8","type":"link out","z":"1e193208.71985e","name":"msgToUI","links":["566f70f.2d4579"],"x":1171,"y":255,"wires":[]},{"id":"566f70f.2d4579","type":"link in","z":"1e193208.71985e","name":"msgToUI","links":["aafd2539.905ba8","4608e26c.241b8c"],"x":66,"y":544,"wires":[["d34f8292.cb3c","e8795311.41f4a"]]},{"id":"4608e26c.241b8c","type":"link out","z":"1e193208.71985e","name":"msgToUI","links":["566f70f.2d4579"],"x":542,"y":374,"wires":[]},{"id":"a8a0def.6ffd62","type":"debug","z":"1e193208.71985e","name":"ui message","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":308,"y":221,"wires":[]},{"id":"fed0aeb3.a329d","type":"debug","z":"1e193208.71985e","name":"to ui-table","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":825,"y":170,"wires":[]},{"id":"e8795311.41f4a","type":"debug","z":"1e193208.71985e","name":"msgToUI","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":196,"y":697,"wires":[]},{"id":"9c91a876.eb3078","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"on","topic":"2cf432130f5f/light/on","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Christbaum","uiPlaceName":"","uiNode":"uiButtonSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#ff8040","uiColorOFF":"#408080","uiColorPredicted":"#9d3300","uiUseColorPredicted":false,"uiColorPredictedOff":"#1f3f3f","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"lightbulb_outline","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":219,"y":289,"wires":[["9bdc7463.35abc8"],[]]},{"id":"9bdc7463.35abc8","type":"ui_button","z":"afe0bd06.1f05","name":"","group":"dad2c6ff.66acf8","order":1,"width":0,"height":0,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"","payload":"toggle","payloadType":"str","topic":"","x":492,"y":221,"wires":[["9c91a876.eb3078"]]},{"id":"37587a97.53dad6","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"dimmer1","topic":"2cf432130f5f/light/dimmer1","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":239,"y":408,"wires":[["863cc41.ec19738"],[]]},{"id":"863cc41.ec19738","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":2,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":357,"wires":[["37587a97.53dad6"]]},{"id":"7c3d0b50.276f14","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"dimmer2","topic":"2cf432130f5f/light/dimmer2","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":239,"y":510,"wires":[["e02e0053.1e072"],[]]},{"id":"e02e0053.1e072","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":3,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":459,"wires":[["7c3d0b50.276f14"]]},{"id":"632b0dd.5146ef4","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"dimmer","topic":"2cf432130f5f/light/dimmer","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":229,"y":612,"wires":[["12310f6f.01e7c1"],[]]},{"id":"12310f6f.01e7c1","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":3,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":561,"wires":[["632b0dd.5146ef4"]]},{"id":"b1a27d73.a0e0c","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"2cf432130f5f","nodeID":"light","propertyID":"delay","topic":"2cf432130f5f/light/delay","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"property","labelTopic":false,"labelPayload":false,"labelName":"","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":229,"y":697,"wires":[["e5266c1e.91d7"],[]]},{"id":"e5266c1e.91d7","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"dad2c6ff.66acf8","order":3,"width":0,"height":0,"passthru":false,"outs":"all","topic":"","min":0,"max":10,"step":1,"x":492,"y":646,"wires":[["b1a27d73.a0e0c"]]},{"id":"9d305a21.304668","type":"debug","z":"1e193208.71985e","name":"to save","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":825,"y":289,"wires":[]},{"id":"7e94d6aa.c368c8","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"sonoffS20-01","nodeID":"Relais","propertyID":"switch","topic":"sonoffS20-01/Relais/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Relais","uiPlaceName":"","uiNode":"uiButtonSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#ff8040","uiColorOFF":"#408080","uiColorPredicted":"#9d3300","uiUseColorPredicted":true,"uiColorPredictedOff":"#1f3f3f","uiUseColorPredictedOff":true,"uiFormat":false,"uiTooltip":"","uiIcon1":"lightbulb_outline","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":902,"y":204,"wires":[["b45a570b.94bcd8"],[]]},{"id":"b45a570b.94bcd8","type":"ui_button","z":"afe0bd06.1f05","name":"","group":"6cd1ccc3.7b5b94","order":1,"width":0,"height":0,"passthru":false,"label":"{{msg.label}}","tooltip":"","color":"{{msg.ui_control.color}}","bgcolor":"{{msg.ui_control.bgcolor}}","icon":"","payload":"toggle","payloadType":"str","topic":"","x":1155,"y":136,"wires":[["7e94d6aa.c368c8"]]},{"id":"b761b98d.31ddf8","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"sonoffS20-01","nodeID":"Relais","propertyID":"switch","topic":"sonoffS20-01/Relais/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Relais","uiPlaceName":"","uiNode":"uiSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#ff8040","uiColorOFF":"#408080","uiColorPredicted":"#9d3300","uiUseColorPredicted":false,"uiColorPredictedOff":"#1f3f3f","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"lightbulb_outline","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":902,"y":306,"wires":[["d8edaae9.3525b8"],[]]},{"id":"d8edaae9.3525b8","type":"ui_switch","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"6cd1ccc3.7b5b94","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1155,"y":255,"wires":[["b761b98d.31ddf8"]]},{"id":"d98a4d1c.c11ab","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"Wanddimmer-01","nodeID":"Walldimmer","propertyID":"dimmer","topic":"Wanddimmer-01/Walldimmer/dimmer","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Dimmer","uiPlaceName":"","uiNode":"uiSlider","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":847,"y":459,"wires":[["8f5e82b6.289cf","9e8c7956.7d0788"],["bd97cf84.7729f"]]},{"id":"8f5e82b6.289cf","type":"ui_slider","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"b52e5a6.7c55ca8","order":3,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":"255","step":1,"x":1155,"y":408,"wires":[["d98a4d1c.c11ab"]]},{"id":"8e605e9a.76ab4","type":"homie-convention-device","z":"afe0bd06.1f05","broker":"3840d6b5.4291da","name":"","deviceID":"Wanddimmer-01","nodeID":"Walldimmer","propertyID":"switch","topic":"Wanddimmer-01/Walldimmer/switch","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":false,"labelPayload":false,"labelName":"Relais","uiPlaceName":"","uiNode":"uiSwitch","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#c0c0c0","uiColorON":"#ff8040","uiColorOFF":"#408080","uiColorPredicted":"#9d3300","uiUseColorPredicted":false,"uiColorPredictedOff":"#1f3f3f","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"lightbulb_outline","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":true,"x":888,"y":544,"wires":[["d83f13ee.23dc6"],[]]},{"id":"d83f13ee.23dc6","type":"ui_switch","z":"afe0bd06.1f05","name":"","label":"{{msg.label}}","tooltip":"","group":"b52e5a6.7c55ca8","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1155,"y":493,"wires":[["8e605e9a.76ab4"]]},{"id":"9e8c7956.7d0788","type":"debug","z":"afe0bd06.1f05","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1155,"y":357,"wires":[]},{"id":"bd97cf84.7729f","type":"debug","z":"afe0bd06.1f05","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1155,"y":595,"wires":[]},{"id":"6dbb0f83.0bf06","type":"syslog-input","z":"1e193208.71985e","name":"syslog","socktype":"udp","address":"","port":"514","topic":"","x":101,"y":272,"wires":[["d54606f7.055af8"]]},{"id":"581759d5.b11228","type":"homie-convention-device","z":"e74b5796.7b56d8","broker":"3840d6b5.4291da","name":"","deviceID":"ESP_Homie_Test","nodeID":"BME280","propertyID":"Temperature","topic":"ESP_Homie_Test/BME280/Temperature","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":true,"labelPayload":false,"labelName":"inside","uiPlaceName":"","uiNode":"uiChart","uiControlDropdown":false,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":194,"y":238,"wires":[["65bca2cd.46aefc","ea04e04f.ad002"],[]]},{"id":"505f7b0a.2b14c4","type":"ui_chart","z":"e74b5796.7b56d8","name":"","group":"b46bc9fc.6556d8","order":1,"width":"20","height":"12","label":"Temperatur","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1175,"y":204,"wires":[[]]},{"id":"3e8051c5.16ebee","type":"ui_ui_control","z":"e74b5796.7b56d8","name":"connect","events":"connect","x":485,"y":204,"wires":[["a6397015.48751"]]},{"id":"f2978c19.8a4a1","type":"function","z":"769e792f.5e92b8","name":"chart recorder","func":"// setup\nvar status={fill:\"yellow\",shape:\"dot\",text:msg.topic+\"=\"};\nconst statsValues=[\"min\",\"max\",\"avg\",\"count\"];\nconst oversamplingThreshold=61; \n// get store context\nvar store=env.get(\"store\");\nif (!store.hasOwnProperty(\"name\")) {\n    status.fill=\"red\"\n    status.text=\"store.name not defined\"\n    node.error(\"[chart recorder] \"+status.text);\n    return [{\"payload\":status},msg];\n}\n// get node name (it is possible to use multiple nodes in one store)\nvar nodeName=env.get(\"nodeName\");\nif (!nodeName) {\n    status.fill=\"red\"\n    status.text=\"nodeName not defined\"\n    node.error(\"[chart recorder] \"+status.text);\n    return [{\"payload\":status},msg];\n}\n// get limits\nvar maxTime=env.get(\"maxTime\") || 1440;\nvar maxMsgs=env.get(\"maxMsgs\") || 1000;\nvar accuracy=env.get(\"accuracy\") || 0.1;\nvar roundTo=env.get(\"roundTo\") || 2;\n\n// get context\nvar contextStore = flow.get(\"$parent.\"+store.name,store.provider);\nif (contextStore===undefined) {\n    contextStore = {};\n    flow.set(\"$parent.\"+store.name,contextStore,store.provider);\n}\nif (!contextStore.hasOwnProperty(nodeName)) {\n    node.warn(nodeName+\" initialized\");\n    contextStore[nodeName]={\"chart\":[{\"series\":[],\"data\":[],\"labels\":[]}]};    \n}\n\n// function to round a floating point value\ncontextStore.roundTo = function (value, precission) {\n    if (precission>0) {\n        roundTo=Math.pow(10,precission);\n        return Math.round(Number(value)*roundTo)/roundTo;\n    } else return value;\n}\n\n// function to push new data to chart respecting msxTime and maxMsgs\ncontextStore.pushValueToChart = function (chart,serie,label,value,maxTime,maxMsgs) {\n//    node.warn({\"function\":\"pushValueToChart\",\"chart\":chart,\"serie\":serie,\"label\":label,\"value\":value,\"maxTime\":maxTime,\"maxMsgs\":maxMsgs})\n\n    if (maxTime===undefined) maxTime=1440 // = 24h\n    if (maxMsgs===undefined) maxMsgs=1500 // = 1 msg per minute ~ 14h\n    if (!chart.series.includes(serie)) { // init chart if nessesary\n        chart.series.push(serie);\n        chart.data.push([]);\n        chart.label.push(label);\n    }\n    let dataColumn=chart.data[currentChart.series.indexOf(serie)];\n    let dateNow=Date.now();\n    \n    // add new line to data\n    dataColumn.push({\"x\":dateNow,\"y\":value});\n    \n    // delete lines if exeeds maxMsgs\n    if (dataColumn.length>maxMsgs) {\n        dataColumn.splice(0,dataColumn.length-maxMsgs);\n    }\n    // delete lines if older than maxTime\n    let timeLimit=dateNow-maxTime*60000;\n    let j=0;\n    while (dataColumn[j]!==undefined && dataColumn[j].x<timeLimit) j++;\n    if (j>0) dataColumn.splice(0,j);\n}\n\nvar currentContext=contextStore[nodeName];\nconst dateNow=Date.now();\nconst dateLimit=dateNow-(maxTime*60000);\nvar dataRow=0;\nvar deletedCount=0; // flag if more than one line was deleted\n\n// store values\nif (msg.hasOwnProperty(\"topic\") && msg.topic!==\"\") { // store data\n    var value=contextStore.roundTo(msg.payload,roundTo);\n    status.text+=value;\n    if (!currentContext.hasOwnProperty(msg.topic)) currentContext[msg.topic]={};\n    if (!currentContext[msg.topic].hasOwnProperty(\"last\")) currentContext[msg.topic].last=0;\n    var currentChart=currentContext.chart[0];\n    //node.warn([\"push\",value,currentContext[msg.topic].last,accuracy,currentChart])\n    if (Math.abs(value-currentContext[msg.topic].last)>accuracy) { // record only changed values\n        contextStore.pushValueToChart(currentChart,msg.topic,msg.label,value,maxTime,maxMsgs);\n        currentContext[msg.topic].last=value;\n        status.text+=\" stored\";\n    } else { // record only first and last reading\n        if (currentChart.data[dataRow].length>1 && Math.abs(currentChart.data[dataRow][currentChart.data[dataRow].length-2].y-value)>accuracy) { \n            currentChart.data[dataRow][currentChart.data[dataRow].length-1].x=dateNow; // expand constant period\n            status.text+=\" extended\";\n        } else {\n            contextStore.pushValueToChart(currentChart,msg.topic,msg.label,value,maxTime,maxMsgs);\n            status.text+=\" 2nd\";\n        }\n    }\n    status.fill=\"green\";\n} else if (msg.payload===\"connect\") { // restore historic data\n    status.fill=\"green\";\n    status.text=\"chart restored\";\n    return [{\"payload\":status},{\"payload\":currentContext.chart}];\n}\nreturn [{\"payload\":status},msg];","outputs":2,"noerr":0,"x":199,"y":119,"wires":[[],[]],"inputLabels":["trigger & data"],"outputLabels":["status","to dashboard"],"icon":"font-awesome/fa-database"},{"id":"a6397015.48751","type":"subflow:769e792f.5e92b8","z":"e74b5796.7b56d8","name":"","env":[{"name":"nodeName","value":"tempChart","type":"str"},{"name":"maxMsgs","value":"1500","type":"num"}],"x":733,"y":255,"wires":[["ce8d9cc1.30485","78fe3267.6f40cc"]]},{"id":"b09f90d2.a7395","type":"inject","z":"e74b5796.7b56d8","name":"connect","topic":"","payload":"connect","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":492,"y":153,"wires":[["a6397015.48751"]]},{"id":"bc5a5045.ffa17","type":"inject","z":"e74b5796.7b56d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":196,"y":680,"wires":[["121484e.345027b"]]},{"id":"121484e.345027b","type":"function","z":"e74b5796.7b56d8","name":"","func":"var chart = [{\n    \"series\":[\"A\",\"B\",\"C\"],\n    \"data\":[[{\"x\":1504029632890,\"y\":5},{\"x\":1504029636001,\"y\":4},{\"x\":1504029638656,\"y\":2}],[{\"x\":1504029633514,\"y\":6},{\"x\":1504029636622,\"y\":7},{\"x\":1504029639539,\"y\":6}],[{\"x\":1504029634400,\"y\":7},{\"x\":1504029637959,\"y\":9},{\"x\":1504029640317,\"y\":7}]],\n    \"labels\":[\"\"]\n}];\nmsg.payload = chart;\n\nreturn msg;","outputs":1,"noerr":0,"x":356,"y":680,"wires":[["4214e380.f1a2ac"]]},{"id":"4214e380.f1a2ac","type":"debug","z":"e74b5796.7b56d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":526,"y":680,"wires":[]},{"id":"7c8bdbc7.c68094","type":"switch","z":"e74b5796.7b56d8","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"min","vt":"str"},{"t":"eq","v":"max","vt":"str"},{"t":"eq","v":"quardAvg","vt":"str"},{"t":"eq","v":"trend","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":1342,"y":357,"wires":[["99ff80b2.63706"],["a4237f25.52eeb"],["d6e99aaa.4958a8"],["68db3034.bafea"]]},{"id":"99ff80b2.63706","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":2,"width":2,"height":"1","name":"","label":"minimum","format":"{{msg.payload | number : 2}}","layout":"col-center","x":1539,"y":289,"wires":[]},{"id":"a4237f25.52eeb","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":3,"width":2,"height":"1","name":"","label":"maximum","format":"{{msg.payload | number : 2}}","layout":"col-center","x":1539,"y":340,"wires":[]},{"id":"d6e99aaa.4958a8","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":4,"width":2,"height":"1","name":"","label":"average","format":"{{msg.payload | number : 2}}","layout":"col-center","x":1539,"y":391,"wires":[]},{"id":"68db3034.bafea","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":5,"width":"1","height":"1","name":"trend","label":"","format":"{{msg.payload | number : 2}}","layout":"row-spread","x":1546,"y":442,"wires":[]},{"id":"c6fdfee9.909c5","type":"homie-convention-device","z":"e74b5796.7b56d8","broker":"3840d6b5.4291da","name":"","deviceID":"Bewaesserung-3","nodeID":"BME280","propertyID":"Temperature","topic":"Bewaesserung-3/BME280/Temperature","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"custom","labelTopic":true,"labelPayload":false,"labelName":"outside","uiPlaceName":"Select Valve","uiNode":"uiChart","uiControlDropdown":true,"uiControlMinMax":false,"uiColor1":"#000000","uiBgColor1":"#000000","uiColorON":"#000000","uiColorOFF":"#000000","uiColorPredicted":"#000000","uiUseColorPredicted":false,"uiColorPredictedOff":"#000000","uiUseColorPredictedOff":false,"uiFormat":true,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#000000","uiSwitchColorPredictedOFF":"#000000","uiSwitchIconPredictedON":"","uiSwitchIconPredictedOFF":"","settable":false,"x":194,"y":289,"wires":[["65bca2cd.46aefc","ea04e04f.ad002"],[]]},{"id":"a383b8ee.9c5c88","type":"switch","z":"e74b5796.7b56d8","name":"serie","property":"serie","propertyType":"msg","rules":[{"t":"eq","v":"inside","vt":"str"},{"t":"eq","v":"outside","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1172,"y":459,"wires":[["7c8bdbc7.c68094"],["a1e7684a.c6d028"]]},{"id":"a1e7684a.c6d028","type":"switch","z":"e74b5796.7b56d8","name":"topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"min","vt":"str"},{"t":"eq","v":"max","vt":"str"},{"t":"eq","v":"quardAvg","vt":"str"},{"t":"eq","v":"trend","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":1342,"y":561,"wires":[["c2cd5bf.1a512a8"],["4f44d1c5.cf30d"],["c7060d09.154b9"],["9e557c2c.91746"]]},{"id":"c2cd5bf.1a512a8","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":6,"width":2,"height":"1","name":"","label":"minimum","format":"{{msg.payload | number : 2}}","layout":"col-center","x":1539,"y":493,"wires":[]},{"id":"4f44d1c5.cf30d","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":7,"width":2,"height":"1","name":"","label":"maximum","format":"{{msg.payload | number : 2}}","layout":"col-center","x":1539,"y":544,"wires":[]},{"id":"c7060d09.154b9","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":8,"width":2,"height":"1","name":"","label":"average","format":"{{msg.payload | number : 2}}","layout":"col-center","x":1539,"y":595,"wires":[]},{"id":"9e557c2c.91746","type":"ui_text","z":"e74b5796.7b56d8","group":"b46bc9fc.6556d8","order":9,"width":"1","height":"1","name":"trend","label":"","format":"{{msg.payload | number : 2}}","layout":"row-spread","x":1529,"y":646,"wires":[]},{"id":"26e69654.4d2e0a","type":"debug","z":"e74b5796.7b56d8","name":"chart","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1155,"y":272,"wires":[]},{"id":"467cbfa5.4a74a","type":"inject","z":"e74b5796.7b56d8","name":"","topic":"","payload":"inside","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":101,"y":357,"wires":[["a95fa9b.9c5ec58"]]},{"id":"a95fa9b.9c5ec58","type":"function","z":"e74b5796.7b56d8","name":"10-30°C","func":"msg.topic=msg.payload;  \nmsg.label=msg.payload;\nmsg.payload=20+(20*Math.random()-10);\nreturn msg;","outputs":1,"noerr":0,"x":264,"y":374,"wires":[["65bca2cd.46aefc"]]},{"id":"2b151182.18b89e","type":"function","z":"e74b5796.7b56d8","name":"20 °C","func":"msg.topic=msg.payload;  \nmsg.label=msg.payload;\nmsg.payload=20;\nreturn msg;","outputs":1,"noerr":0,"x":254,"y":442,"wires":[["65bca2cd.46aefc"]]},{"id":"82a0f02.9296f1","type":"inject","z":"e74b5796.7b56d8","name":"","topic":"","payload":"inside","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":101,"y":425,"wires":[["2b151182.18b89e"]]},{"id":"f905a17c.cf2ad","type":"inject","z":"e74b5796.7b56d8","name":"","topic":"","payload":"outside","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":101,"y":391,"wires":[["a95fa9b.9c5ec58"]]},{"id":"7f00e934.5a8478","type":"inject","z":"e74b5796.7b56d8","name":"","topic":"","payload":"outside","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":101,"y":459,"wires":[["2b151182.18b89e"]]},{"id":"e1fb9716.bb7e38","type":"function","z":"df1076cf.94d498","name":"chart sampler","func":"// setup\n// node.warn({\"msg\":msg});\nif (!msg.hasOwnProperty(\"topic\") || msg.topic===\"\") return [{\"payload\":{}},msg]; \nvar status={\"fill\":\"yellow\",\"shape\":\"dot\",\"text\":msg.topic};\nconst oversamplingThreshold=61; \n// get store context\nvar store=env.get(\"store\");\nif (!store.hasOwnProperty(\"name\")) {\n    status.fill=\"red\";\n    status.text=\"store.name not defined\";\n    node.error(\"[chart recorder] \"+status.text);\n    return [{\"payload\":status},msg];\n}\n// get node name (it is possible to use multiple nodes in one store)\nvar nodeName=env.get(\"nodeName\");\nif (!nodeName) {\n    status.fill=\"red\";\n    status.text=\"nodeName not defined\";\n    node.error(\"[chart recorder] \"+status.text);\n    return [{\"payload\":status},msg];\n}\n\n// get settings\nvar oversampling=env.get(\"oversampling\");\nvar roundTo=env.get(\"roundTo\") || 2;\nroundTo=Math.pow(10,roundTo);\nconst dateNow=Date.now();\nvar value=Math.round(Number(msg.payload)*roundTo)/roundTo;\n\n// get context\nvar contextStore = flow.get(\"$parent.\"+store.name,store.provider);\nif (contextStore===undefined) {\n    contextStore = {};\n    flow.set(\"$parent.\"+store.name,contextStore,store.provider);\n}\nif (!contextStore.hasOwnProperty(nodeName)) {\n    node.warn(nodeName+\" initialized\");\n    contextStore[nodeName]={\"chart\":[{\"series\":[],\"data\":[],\"labels\":[]}]};    \n}\n\nif (!contextStore[nodeName].hasOwnProperty(msg.topic)) contextStore[nodeName][msg.topic]={};\nvar context=contextStore[nodeName][msg.topic];\nif (!context.hasOwnProperty(\"samples\")) context.samples=[];\ncontext.samples.push({\"time\":dateNow,\"value\":value});\nif (oversampling<oversamplingThreshold) { // sample fix number of values\n    if (context.samples.length>oversampling) { // splice item(s) exeeding\n        context.samples.splice(0,context.samples.length-oversampling);\n    }\n} else { // sample over time\n    for (var i=0; i<context.samples.length; i++) { // determin how many items to be deleted\n        if (dateNow-context.samples[i].time<oversampling*1000) break;\n    }\n    if (i>0) {\n        context.samples.splice(0,i);\n    }\n}\n// claculate oversampled value\nvar sampleSum=0;\ncontext.samples.forEach(function (item,index){\n    sampleSum+=item.value;\n});\n// store oversampled data and modifiy payload\n// node.warn([\"sample\",context.samplesum,context.samples.length])\nmsg.payload=Math.round(sampleSum/context.samples.length*roundTo)/roundTo;\nstatus.text+=\" \"+context.samples.length+\"x oversampled=\"+value;\nstatus.fill=\"green\";\nreturn [{\"payload\":status},msg];\n\n","outputs":2,"noerr":0,"x":200,"y":85,"wires":[[],[]],"inputLabels":["in"],"outputLabels":["status","out"]},{"id":"65bca2cd.46aefc","type":"subflow:df1076cf.94d498","z":"e74b5796.7b56d8","name":"","env":[{"name":"nodeName","value":"tempChart","type":"str"}],"x":505,"y":255,"wires":[["a6397015.48751"]]},{"id":"ea04e04f.ad002","type":"debug","z":"e74b5796.7b56d8","name":"form Sensor","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":512,"y":340,"wires":[]},{"id":"3f590a0a.f481a6","type":"inject","z":"e74b5796.7b56d8","name":"clear","topic":"","payload":"[]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":934,"y":153,"wires":[["505f7b0a.2b14c4"]]},{"id":"8aa6990.4b4b668","type":"function","z":"8469bb42.e142f8","name":"chart statistics","func":" // push original message forward\nnode.send([null,msg,null]);\nif (msg.payload===undefined) return;\n// setup\nvar status={fill:\"yellow\",shape:\"dot\",text:msg.topic+\"=\"};\nconst statsValues=[\"min\",\"max\",\"avg\",\"quardAvg\",\"count\",\"delta\",\"trend\",\"total\"];\nconst oversamplingThreshold=61; \n// get store context\nvar store=env.get(\"store\");\nvar nodeName=env.get(\"nodeName\");\nif (!store.hasOwnProperty(\"name\") || !nodeName) {\n    status.fill=\"red\";\n    status.text+=(!store.hasOwnProperty(\"name\")) ? \"store.name not defined\" : \"\";\n    status.text+=(!nodeName) ? \"nodeName not defined\" : \"\";\n    node.error(\"[chart statistics] \"+ status.text);\n    return [{\"payload\":status},msg];\n}\n\n// get parameters\nvar liveChart=env.get(\"liveChart\") || true;\nconst toMs=60000; // minutes to ms;\nvar roundTo=env.get(\"roundTo\") || 2;\n\n// get context\nvar contextStore= flow.get(\"$parent.\"+store.name,store.provider);\n\nif (contextStore===undefined) {\n    contextStore={};\n    flow.set(\"$parent.\"+store.name,contextStore,store.provider);\n}\nif (!contextStore.hasOwnProperty(nodeName)) {\n    status.fill=\"yellow\";\n    status.text=nodeName+\" undefined in store\";\n    return [{\"payload\":status},msg];    \n}\nvar cStats=contextStore[nodeName];\nif (!cStats.hasOwnProperty(msg.topic)) {\n    status.fill=\"yellow\";\n    status.text=msg.topic+\" undefined in store\";\n    return [{\"payload\":status},msg];    \n}\nvar statsStore=cStats[msg.topic];\n\nconst dateNow=Date.now();\nvar sampleTime=env.get(\"sampleTime\") || 10; // in minutes\nvar dateLimit=dateNow-(sampleTime*toMs);\n\n// initialize statistic carts\nvar config=env.get(\"config\");\n\nfor (let output in config) {\n    if (!statsStore.hasOwnProperty(output)) statsStore[output]={};\n    for (let label of statsValues) {\n        if (config[output].hasOwnProperty(label)) {\n            if (!statsStore[output].hasOwnProperty(label)) {\n                statsStore[output][label]={\"value\":0};\n            }\n            statsStore[output][label].value=0;\n            statsStore[output][label].sampleTime=dateNow-(config[output][label].sampleTime*toMs);\n            statsStore[output][label].maxTime=config[output][label].maxTime || 1440;\n            statsStore[output][label].maxMsgs=config[output][label].maxMsgs || 1500;\n        }\n    }\n}\n\nvar currentChart=cStats.chart[0];\nvar dataRow=currentChart.series.indexOf(msg.topic);\nif (dataRow<0) {\n    status.fill=\"red\"\n    status.text=\"series \"+msg.topic+\" not found\";\n    node.error(\"[chart statistics] \"+status.text);\n    return [{\"payload\":status},msg];\n}\n\n// definition of calculation functions these can be configured in config json\n// all accumulationg form latest back to time limit\nvar calc={};\n\ncalc[\"min\"] = function(chartData,timeLimit) {\n    let min=Number.MAX_VALUE;\n    for (let i=chartData.length-1; i>-1; --i) {\n        if (chartData[i].y<min) min=chartData[i].y;\n        if (chartData[i].x<timeLimit) break;\n    }\n    return min;\n}\n\ncalc[\"max\"] = function(chartData,timeLimit) {\n    let max=-Number.MAX_VALUE;\n    for (let i=chartData.length-1; i>-1; --i) {\n        if (chartData[i].y>max) max=chartData[i].y;\n        if (chartData[i].x<timeLimit) break;\n    }\n    return max;\n}\n\ncalc[\"avg\"] = function(chartData,timeLimit) {\n    let sum=0, count=0;\n    for (let i=chartData.length-1; i>-1; --i) {\n        sum+=chartData[i].y;\n        count++;\n        if (chartData[i].x<timeLimit) break;\n    }\n    return sum/count;\n}\n\ncalc[\"quardAvg\"] = function(chartData,timeLimit) {\n    let sum=0; i=chartData.length-1;\n    let endTime=chartData[i].x;\n    let lastTime=endTime;\n    for (i; i>-1; --i) {\n        sum+=chartData[i].y*(lastTime-chartData[i].x);\n        lastTime=chartData[i].x;\n        if (chartData[i].x<timeLimit) break;\n    }\n    if (i<0) i=0;\n//    node.warn([\"qAvrg\",chartData,timeLimit,endTime,i,sum])\n    let divider=endTime-chartData[i].x;\n    if (divider===0) divider=1;\n    return sum/(divider);\n}\n\ncalc[\"delta\"] = function(chartData,timeLimit) {\n    let i=0;\n    for (i=chartData.length-1; i>-1; --i) {\n        if (chartData[i].x<timeLimit) break;\n    }\n    if (i<0) i=0;\n    return chartData[chartData.length-1].y-chartData[i].y;\n}\n\ncalc[\"trend\"] = function(chartData,timeLimit) {\n    let i=0;\n    for (i=chartData.length-1; i>-1; --i) {\n        if (chartData[i].x<timeLimit) break;\n    }\n    if (i<0) i=0;\n    return chartData[chartData.length-1].y-chartData[i].y;\n}\n\ncalc[\"total\"] = function(chartData,timeLimit) {\n    let total=0\n    for (let i=chartData.length-1; i>-1; --i) {\n        total+=chartData[i].y;\n        if (chartData[i].x<timeLimit) break;\n    }\n    return total;\n}\n// calling all confingured satistics by output and statistic value;\nlet currentStat, currentConfig;\nlet calcCounter={\"chart\":0,\"value\":0};\ncurrentChart=cStats.chart[0];\nif (liveChart || currentChart.data[dataRow][currentChart.data[dataRow].length-1].x<dateLimit) {\n    for (let output in config) {\n        for (let statProperty of statsValues) {\n            var currentStats=statsStore[output][statProperty];\n            // node.warn([config[output],statProperty,statsStore[statProperty]])\n            if (config[output].hasOwnProperty(statProperty) && calc.hasOwnProperty(statProperty)) {\n                // node.warn({\"Function\":\"Calc:\",\"output\":output,\"property\":statProperty,\"settings\":currentStats,\"data\":currentChart.data[dataRow]});\n                currentStats.value=contextStore.roundTo(calc[statProperty](currentChart.data[dataRow],currentStats.sampleTime),roundTo);\n                \n                if (output===\"chart\") {\n                    dateLimit=dateNow-(currentStats.sampleTime*toMs); \n                    label=msg.topic+config.chart[statProperty].label;\n                    // node.warn([currentChart,label,label,currentStats.value,currentStats.maxTime,currentStats.maxMsgs,dateLimit+sampleTime]);\n                    if (!currentChart.series.includes(label)) { // first Entry = allways push\n                        contextStore.pushValueToChart(currentChart,label,label,currentStats.value,currentStats.maxTime,currentStats.maxMsgs,dateLimit+sampleTime);\n                    } else { // next Entry = only push after sampleTime exceeded\n                        if(currentChart.data[dataRow][currentChart.data[dataRow].length-1].x<dateLimit) {\n                            contextStore.pushValueToChart(currentChart,label,label,currentStats.value,currentStats.maxTime,currentStats.maxMsgs,dateLimit+sampleTime/2);\n                        }\n                    }\n                    if (liveChart || currentChart.data[dataRow][currentChart.data[dataRow].length-1].x<dateLimit) {\n                        node.send([null,{\"topic\":label,\"payload\":currentStats.value}]);\n                    }\n                    calcCounter[output]++;\n                }\n                if (output===\"value\") {\n                    node.send([null,null,{\"topic\":statProperty,\"serie\":msg.topic,\"payload\":currentStats.value}]);\n                    calcCounter[output]++;\n                }\n            }\n        }\n    }\n}\n\nstatus.fill=\"green\"\nstatus.text+=msg.topic+\" updated (\"+calcCounter.chart+\"/\"+calcCounter.value+\")\";\nreturn [{\"payload\":status}];\n\n","outputs":3,"noerr":0,"x":199,"y":119,"wires":[[],[],[]],"inputLabels":["trigger & data"],"outputLabels":["status","to dashboard",""],"icon":"font-awesome/fa-database"},{"id":"ce8d9cc1.30485","type":"subflow:8469bb42.e142f8","z":"e74b5796.7b56d8","name":"","env":[{"name":"nodeName","value":"tempChart","type":"str"},{"name":"sampleTime","value":"60","type":"num"},{"name":"statLabels","value":"{\"min\":{\"label\":\" (min)\",\"chart\":true,\"sampleChart\":60,\"sampleValue\":1440},\"max\":{\"label\":\" (max)\",\"chart\":true,\"sampleChart\":60,\"sampleValue\":1440},\"avg\":{\"label\":\" (avg)\",\"chart\":true,\"sampleChart\":60,\"sampleValue\":1440}}","type":"json"},{"name":"accurateAvg","value":"false","type":"bool"}],"x":930,"y":255,"wires":[["505f7b0a.2b14c4","26e69654.4d2e0a"],["a383b8ee.9c5c88","5b735de6.8d5a14"]]},{"id":"5b735de6.8d5a14","type":"debug","z":"e74b5796.7b56d8","name":"stats","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1155,"y":323,"wires":[]},{"id":"35a8475.890a7b8","type":"ui_text","z":"e74b5796.7b56d8","group":"9ce06846.951a68","order":6,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","x":1088,"y":850,"wires":[]},{"id":"4cb4e82f.c94878","type":"change","z":"e74b5796.7b56d8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":578,"wires":[[]]},{"id":"78fe3267.6f40cc","type":"debug","z":"e74b5796.7b56d8","name":"msg","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":917,"y":323,"wires":[]},{"id":"ee4d0fdf.4f155","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":543,"y":102,"wires":[]},{"id":"e33f1364.629b4","type":"debug","z":"833d7b75.5dd878","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":696,"y":34,"wires":[]},{"id":"5eb0bd6b.74b794","type":"function","z":"2924702c.b33a7","name":"handle tableData","func":"var status = {fill:\"red\",shape:\"dot\",text: \"payload \"};\nvar tableIndex = env.get(\"tableIndex\") || \"$topic\";\nvar tableDataProp = env.get(\"tableDataProp\") || \"row\";\nvar tableContext = env.get(\"tableContext\");\nvar dashboard = env.get(\"dashboard\");\nif (!tableContext.hasOwnProperty(\"tableData\") || !tableContext.hasOwnProperty(\"tableConfig\")) {\n    status.text=\"tableContext not defined\";\n    node.error(status.text);\n    return [{payload:status},null];\n}\n\n// context store to cache table data (memoryOnly prefered)\nvar tableData = flow.get(\"$parent.\"+tableContext.tableData.name,tableContext.tableData.storage);\nif (tableData===undefined) {\n    node.warn(\"[ui-table handler] tableData initialized!\");\n    tableData={};\n    flow.set(\"$parent.\"+tableContext.tableData.name,tableData,tableContext.tableData.storage);\n}\n\n// context Store to save table configuration (file)\nvar tableConfig = flow.get(\"$parent.\"+tableContext.tableConfig.name,tableContext.tableConfig.storage);\nif (tableConfig===undefined) {\n    node.warn(\"[ui-table handler] tableConfig initialized!\");\n    tableConfig={ResponsiveLayout:true};\n    flow.set(\"$parent.\"+tableContext.tableConfig.name,tableConfig,tableContext.tableConfig.storage);\n}\n\n// context Store to save table configuration (file)\nvar tableEdit;\nif (tableContext.hasOwnProperty(\"tableEdit\")) {\n    tableEdit = flow.get(\"$parent.\"+tableContext.tableEdit.name,tableContext.tableEdit.storage);\n    if (tableEdit===undefined) {\n        node.warn(\"[ui-table handler] tableEdit initialized!\");\n        tableEdit={};\n        flow.set(\"$parent.\"+tableContext.tableEdit.name,tableEdit,tableContext.tableEdit.storage);\n    }\n}\n\n// function to merge partial data into existing table row\nvar mergeObject = function (destination, source, filter) {\n    for (let currentSource in source) {\n        if (source.hasOwnProperty(currentSource)) {\n            if (filter!==undefined && tableEdit && tableEdit.hasOwnProperty(filter) && tableEdit[filter].hasOwnProperty(currentSource)) {\n                destination[currentSource]= tableEdit[filter][currentSource];\n                source[currentSource]=tableEdit[filter][currentSource];\n            } else {\n                destination[currentSource]= source[currentSource];\n            }\n        }    \n    }\n    return source;\n};\n    \n// deep search for a column\nvar searchTabulatorColumn = function (columns,key,match) {\n    var result;\n    for (let column of columns) {\n        if (column.hasOwnProperty(\"columns\")) {\n            result = searchTabulatorColumn(column.columns,key,match);\n            if (result!==undefined) return result;\n        } else if (column.hasOwnProperty(key) && column[key]===match) {\n            return column;\n        }\n    }\n};\n\n// command message to update add or update data on ui-table\nvar msgToTable={};\nmsgToTable.payload={\n    \"command\":\"updateOrAddData\",\n    \"arguments\": [],\n    \"returnPromise\": false\n};\n\nif (msg.hasOwnProperty(tableDataProp)) {\n    // store data for later recover\n    if (!msg.hasOwnProperty(\"topic\")) { // check if index existst\n        status.text=\"msg.topic not defined!\";\n        return [{payload:status},null];\n    }\n    if (!tableData.hasOwnProperty(msg.topic)){ // first seen\n        tableData[msg.topic]={};\n        if (tableEdit && tableEdit.hasOwnProperty(msg.topic)) { // table edits available!\n            Object.keys(tableEdit[msg.topic]).forEach((key) => {\n                msg[tableDataProp][key]=tableEdit[msg.topic][key];\n                tableData[msg.topic][key]=tableEdit[msg.topic][key];\n            })\n        }\n    }\n    if (!tableData[msg.topic].hasOwnProperty(tableIndex)) tableData[msg.topic][tableIndex]=msg.topic;\n    msg[tableDataProp]=mergeObject(tableData[msg.topic],msg[tableDataProp],msg.topic);\n    msg[tableDataProp][tableIndex]=msg.topic;\n    msgToTable.payload.arguments=[[msg[tableDataProp]]];\n    status.fill=\"green\";\n    status.text=msg.topic+\" updated\";\n    return [{payload:status},msgToTable,null];\n} if (msg.payload===\"connect\" || (msg.payload===\"change\" && msg.name===dashboard) || (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\"))) { \n    if (!msg.hasOwnProperty(\"ui_control\")) {\n        msg.ui_control = env.get('tabulator');\n        status.text+=\" ui_control added\";\n    }\n    //process commands\n    //node.warn({\"command\":msg.payload.command,\"msg\":msg,\"object\":msg.payload.object})\n    if (msg.payload.hasOwnProperty(\"command\")) {\n        status.fill=\"blue\";\n        switch(msg.payload.command) {\n            case 'deleteTable':\n                flow.set(\"$parent.\"+tableContext.tableData.name,undefined,tableContext.tableData.storage);\n                tableData={};\n                status.text=\"tabledata deleted\";\n                node.warn(\"[ui-table handler] \"+\"tabledata deleted\");\n                break;\n            case 'deleteDevice':\n                if (tableData.hasOwnProperty(msg.payload.object)) {\n                    delete tableData[msg.payload.object];\n                    status.text=msg.payload.object+\" deleted\";\n                } else {\n                    status.fill=\"yellow\";\n                    status.text=msg.payload.object+\" undefined\";\n                }\n                break;\n            case 'ignoreDevice':\n                if (tableData.hasOwnProperty(msg.payload.object)) {\n                    delete tableData[msg.payload.object];\n                    status.text=msg.payload.object+\" will be ignored\";\n                    if (!tableConfig.hasOwnProperty('ignoreDevice')) tableConfig.ignoreDevice={};\n                    tableConfig.ignoreDevice[msg.payload.object]=true;\n                }\n                break;\n            case 'unIgnoreDevice':\n                if (tableConfig.hasOwnProperty('ignoreDevice')) {\n                    delete tableConfig.ignoreDevice[msg.payload.object];\n                }\n                break;\n            case 'unIgnoreDevices':\n                delete tableConfig.ignoreDevice;\n                break;\n            case 'updateData':\n                status.text=\"column \"+msg.payload.column+\" updated\";\n                return [{payload:status},msg];\n            case 'updateTable':\n                status.text=msg.payload.command+\": \";\n                break;\n            case 'columnHide':\n                if (!tableConfig.hasOwnProperty('columnVisible')) tableConfig.columnVisible={};\n                tableConfig.columnVisible[msg.payload.object]=false;\n                break;\n            case 'columnUnHide':\n                if (!tableConfig.hasOwnProperty('columnVisible')) tableConfig.columnVisible={};\n                tableConfig.columnVisible[msg.payload.object]=true;\n                break;\n            case 'columnsUnHide':\n                for (let column in tableConfig.columnVisible) {\n                    if (tableConfig.columnVisible.hasOwnProperty(column)) tableConfig.columnVisible[column]=true;\n                }\n                break;\n            case 'refreshTable':\n                break;\n            case 'restoreColumnOrder':\n                delete tableConfig.columns;\n                break;\n            case 'resetColumnWidth':\n                delete tableConfig.columnWidths;\n                break;\n            case 'setResponsiveLayout':\n                tableConfig.ResponsiveLayout=!tableConfig.ResponsiveLayout;\n                break;\n            default:\n                status.fill=\"red\";\n                status.text=\"unknown command \"+msg.payload.command;\n                node.warn(\"[ui-table handler] \"+status.text);\n                break;\n        }\n        flow.set(\"$parent.\"+tableContext.tableConfig.name,tableConfig,tableContext.tableConfig.storage);\n        node.send([{payload:status},null,null]);\n    }\n\n    // crawl through tabulator arrays and updated user defined values\n    var crawlTabulator = function (columns,match,config,property) {\n        for (let column of columns) {\n            if (column.hasOwnProperty(\"columns\")) {\n                crawlTabulator(column.columns,match,config,property);\n            } else if (config.hasOwnProperty(column[match])) column[property]=config[column.field];\n        }\n    };\n    \n    // restore custom column width\n    if (tableConfig.hasOwnProperty(\"columnWidths\") && msg.hasOwnProperty(\"ui_control\")) {\n        crawlTabulator(msg.ui_control.tabulator.columns,\"field\",tableConfig.columnWidths,\"width\");\n    }\n    \n    // restore custom column hide/show\n    if (tableConfig.hasOwnProperty(\"columnVisible\") && msg.hasOwnProperty(\"ui_control\")) {\n        crawlTabulator(msg.ui_control.tabulator.columns,\"field\",tableConfig.columnVisible,\"visible\");\n    }\n    \n    // restore custom responsive / standard view\n    if (tableConfig.hasOwnProperty(\"ResponsiveLayout\")) {\n        if (!tableConfig.ResponsiveLayout) {\n            msg.ui_control.tabulator.responsiveLayout=false;\n        }\n        msg.ui_control.tabulator.columns.forEach((column,index) => {\n            if (column.formatter===\"responsiveCollapse\") { // hide expand column on any position\n                column.visible=tableConfig.ResponsiveLayout;\n                return;\n            }\n        });\n    }\n\n    // sort columns\n    if (tableConfig.hasOwnProperty(\"columns\") && msg.hasOwnProperty(\"ui_control\") && msg.ui_control.hasOwnProperty(\"tabulator\")) {\n        var addedColumns = 0;\n        var sortColumnsByLayout = function (sortColumns, columnsLayout, targetColumns) {\n            for (var layoutColumn=0;  layoutColumn<columnsLayout.length; layoutColumn++) {\n                for (var sortColumn in sortColumns) {\n                    if (sortColumns[sortColumn].hasOwnProperty(\"columns\")) {\n                        targetColumns.push({\"title\":sortColumns[sortColumn].title, \"columns\":[]});\n                        sortColumnsByLayout(sortColumns[sortColumn].columns,columnsLayout,targetColumns[targetColumns.length-1].columns);\n                        layoutColumn=addedColumns; // jump forward after childes added\n                    } else {\n                        if (columnsLayout[layoutColumn].field===sortColumns[sortColumn].field){\n                            targetColumns.push(sortColumns[sortColumn]);\n                            addedColumns++;\n                            break;\n                        }\n                    }\n                }\n            }\n        };                 \n        var newColumns=[];\n        sortColumnsByLayout(msg.ui_control.tabulator.columns,tableConfig.columns,newColumns);\n        msg.ui_control.tabulator.columns=newColumns;\n    }\n\n    // restore stored lines after connect\n    msg.payload=[];\n    for (let device in tableData) {\n        if (tableConfig && tableConfig.hasOwnProperty(\"ignoreDevice\") && tableConfig.ignoreDevice[device]) {\n            continue;\n        }\n        // merge edits into table\n        if (tableEdit && tableEdit.hasOwnProperty(device)) {\n            let tableRow = RED.util.cloneMessage(tableData[device]);\n            Object.keys(tableEdit[device]).forEach((field) => {\n                tableRow[field]=tableEdit[device][field];\n            });\n            msg.payload.push(tableRow);\n        } else {\n            msg.payload.push(tableData[device]);\n        }\n    }\n    \n    status.fill=\"blue\";\n    status.text+=\" \"+msg.payload.length+\" rows restored\";\n    return [{payload:status},msg];\n} if (msg.hasOwnProperty(\"ui_control\")) {\n    // callback from tabulator\n    status.fill=\"blue\";\n    status.text=\"unknown callback \"+msg.ui_control.callback;\n    switch(msg.ui_control.callback) {\n        case \"columnResized\": // save new column width\n            if (tableConfig.columnWidths===undefined) tableConfig.columnWidths={};\n            tableConfig.columnWidths[msg.ui_control.columnWidths.field]=msg.ui_control.columnWidths.width;\n            flow.set(\"$parent.\"+tableContext.tableConfig.name,tableConfig,tableContext.tableConfig.storage);\n            status.text=msg.ui_control.columnWidths.field+\"=\"+msg.ui_control.columnWidths.width+\"px\";\n            break;\n        case \"columnMoved\": // save new column order\n            if (tableConfig.columns===undefined) tableConfig.columns=[];\n            tableConfig.columns=msg.ui_control.columns;\n            flow.set(\"$parent.\"+tableContext.tableConfig.name,tableConfig,tableContext.tableConfig.storage);\n            status.text=\"new column order\";\n            break;\n        case \"cellEdited\":\n            if (tableEdit) {\n                if (!tableEdit.hasOwnProperty(msg[tableIndex])) tableEdit[msg[tableIndex]]={};\n                tableEdit[msg[tableIndex]][msg.field] = msg.payload; // save data and mark es edited field\n                flow.set(\"$parent.\"+tableContext.tableEdit.name,tableEdit,tableContext.tableEdit.storage);\n                status.text=msg[tableIndex]+\" \"+msg.field+\" edited to \"+msg.payload;\n                msg[tableDataProp]={};\n                msg[tableDataProp][tableIndex]=msg[tableIndex];\n                msg[tableDataProp][msg.field]=msg.payload;\n                msgToTable.payload.arguments=[[msg[tableDataProp]]];\n                node.send([{payload:status},msgToTable,msg]);\n            } else {\n                node.error(\"[ui-table handler] no tableEdit store defined!\")\n            }\n            break;\n        case \"rowContext\":\n            msg.ignoredDevices=[];\n            for (let device in tableConfig.ignoreDevice) {\n                if (tableConfig.ignoreDevice.hasOwnProperty(device)) {\n                    msg.ignoredDevices.push({\"text\":device,\"icon\":\"fa fa-plug\",\"topic\":\"unIgnoreDevice\",\"payload\":device})  \n                }\n            }\n            break;\n        case \"headerContext\":\n            msg.hiddenColumns=[];\n            let tabulatorConfig = env.get('tabulator');\n            for (let column in tableConfig.columnVisible) {\n                if (tableConfig.columnVisible.hasOwnProperty(column) &&\n                    !tableConfig.columnVisible[column]) {\n                    let configColumn=searchTabulatorColumn(tabulatorConfig.tabulator.columns,\"field\",column);\n                    let icon;\n                    if (configColumn.hasOwnProperty('title') && configColumn.title.toLowerCase().includes('</i>')) {\n                        // <i class='fa fa-star-half-o'></i> State\n                        let start=configColumn.title.indexOf(\"'fa \");\n                        let end=configColumn.title.indexOf(\"'\",start+1);\n                        icon=configColumn.title.substring(start+4,end);\n                    }\n                    msg.hiddenColumns.push({\"text\":column,\"icon\":icon,\"topic\":\"columnUnHide\",\"payload\":configColumn.field})  \n                }\n            }\n            break;\n        default:\n            // if rowIndex exists pass complete object\n            if (msg.hasOwnProperty(tableIndex)) {\n                msg.rowData=tableData[msg[tableIndex]];\n            }\n            status.text=\"pass message\";\n    }\n    return [{payload:status},null,msg];\n}\n// nothing to do bejond this point\nstatus.text+=\" [\"+msg.payload+\"]\";\nreturn [{payload:status},null];\n","outputs":3,"noerr":0,"x":192,"y":85,"wires":[[],[],[]],"icon":"font-awesome/fa-table"},{"id":"378305fa.cef78a","type":"homie-convention-state","z":"9d52d40a.a63668","broker":"3840d6b5.4291da","name":"mosquitto@home","stateDeviceID":"[any]","infoFw":true,"infoStats":true,"infoTiming":false,"infoError":false,"x":209,"y":68,"wires":[["677977e5.f274b8","52619ce0.5df084"]]},{"id":"90e3c8cd.8287a8","type":"ui_table","z":"9d52d40a.a63668","group":"3e8e6acd.3587c6","name":"","order":7,"width":"19","height":"10","columns":[],"outputs":1,"cts":true,"x":611,"y":1207,"wires":[["b8393c0b.3d7ec"]]},{"id":"9baf06cf.ca3ff8","type":"ui_ui_control","z":"9d52d40a.a63668","name":"","events":"all","x":179,"y":1258,"wires":[["7adad4ad.104b3c"]]},{"id":"db94aa7b.554e88","type":"function","z":"9d52d40a.a63668","name":"add icons","func":"var icons= {\n    \"$state\":[\n        {\"value\":\"init\",\"icon\":\"fa fa-cog fa-spin\"},\n        {\"value\":\"ready\",\"icon\":\"fa fa-spinner fa-spin\"},\n        {\"value\":\"disconnected\",\"icon\":\"fa fa-times\"},\n        {\"value\":\"sleeping\",\"icon\":\"fa fa-moon-o\"},\n        {\"value\":\"lost\",\"icon\":\"fa fa-question-circle\"},\n        {\"value\":\"lostBroker\",\"icon\":\"fa fa-exclamation-triangle\"},\n        {\"value\":\"alert\",\"icon\":\"fa fa-exclamation-triangle\"}\n    ],\n    \"signal\":[\n        {\"value\":10,\"icon\":\"perm_scan_wifi\",\"style\":\"color:#cc0000\"},\n        {\"value\":20,\"icon\":\"wifi\",\"style\":\"color:#cc3300\"},\n        {\"value\":30,\"icon\":\"wifi\",\"style\":\"color:#cc6600\"},\n        {\"value\":40,\"icon\":\"wifi\",\"style\":\"color:#cc9900\"},\n        {\"value\":50,\"icon\":\"wifi\",\"style\":\"color:#cccc00\"},\n        {\"value\":60,\"icon\":\"wifi\",\"style\":\"color:#99cc00\"},\n        {\"value\":70,\"icon\":\"wifi\",\"style\":\"color:#66cc00\"},\n        {\"value\":80,\"icon\":\"wifi\",\"style\":\"color:#33cc00\"},\n        {\"value\":100,\"icon\":\"signal_wifi_4_bar\",\"style\":\"color:#00cc00\"},\n    ],\n    \"battery\":[\n        {\"value\":10,\"icon\":\"battery-alert\",\"style\":\"color:#cc0000\"},\n        {\"value\":20,\"icon\":\"battery_20\"},\n        {\"value\":30,\"icon\":\"battery_30\"},\n        {\"value\":50,\"icon\":\"battery_50\"},\n        {\"value\":60,\"icon\":\"battery_60\"},\n        {\"value\":70,\"icon\":\"battery_70\"},\n        {\"value\":80,\"icon\":\"battery_80\"},\n        {\"value\":90,\"icon\":\"battery_90\"},\n        {\"value\":100,\"icon\":\"battery_full\",\"style\":\"color:#00cc00\"},\n    ]\n};\n\nvar status = {fill:\"yellow\",shape:\"dot\",text: \"no msg.state\"};\nif (msg.hasOwnProperty(\"state\")) {\n    status.text=\"device=\";\n    status.text+=(msg.state.$name) ? msg.state.$name : msg.topic;\n    var formatHtml=function(icon) {\n        var html=\"\"\n        if (icon.icon.startsWith('fa')) {\n            html = \"<i class=\\\"\"+icon.icon+'\\\"></i>'; \n        } else {\n            html+='<i class=\"material-icons\"';\n            if (icon.hasOwnProperty(\"style\")) html+=' style=\"'+icon.style+'\"';\n            html+='>'+icon.icon+'</i>';                               \n        }\n        return html;\n    }\n    nextProperty: \n    for (var state in msg.state) {\n        if (icons.hasOwnProperty(state)) {\n            for (var icon of icons[state]) {\n                switch (typeof msg.state[state]) {\n                    case \"string\":\n                        if (msg.state[state]===icon.value) {\n                            msg.state[state+\"Icon\"]=formatHtml(icon);\n                            status.fill=\"green\";\n                            status.text+=state+\" \";\n                            continue nextProperty;\n                        }\n                        break;    \n                    case \"number\":\n                        if (msg.state[state]<=icon.value) {\n                            msg.state[state+\"Icon\"]=formatHtml(icon);\n                            status.fill=\"green\";\n                            status.text+=state+\" \";\n                            continue nextProperty;\n                        }\n                        break;\n                }\n            }\n        }\n    }    \n}\nnode.status(status);\nreturn msg;","outputs":1,"noerr":0,"x":366,"y":918,"wires":[["248e0178.34da0e"]],"icon":"font-awesome/fa-wifi","info":"# Add and format icons\n- This node is configured by a json object. \n- All incomming data inside `msg.state`is inspected to the parent keys of this object. \n- The value contains an array of objects defining differend icons and styles to be added.\n- a html formatted string is added to `msg.state.[key+\"Icon\"]`\n- the current version supports font awesome icons supported by the dshboard and material icons including the style and size [ToDo] property\n- Sting values will be compared for a case sensitive match\n- values will be compared `<=`. So arrange the objects in a increasing order.\n\n## configuration object\n- defining the keys to be triggered\n```json\n{\n    \"$state\":[],\n    \"signal\":[],\n    \"battery\":[]\n}\n```\n- to trigger on a the value \"init\" to get a font awsome icon plce ´fa´ at the beginning of the `icon` value\n```json\n{\n    \"value\":\"init\",\n    \"icon\":\"fa fa-cog fa-spin\"\n}\n```\nfor material icons you can use\n```json\n{\n    \"value\":10,\n    \"icon\":\"perm_scan_wifi\",\n    \"style\":\"color:#cc0000\"\n}\n```\n"},{"id":"ab516c03.7241c","type":"homie-convention-device","z":"9d52d40a.a63668","broker":"3840d6b5.4291da","name":"","deviceID":"[any]","nodeID":"System_Info","propertyID":"[any]","topic":"[any]/System_Info/[any]","infoAttributes":true,"infoTiming":true,"infoError":true,"addLabel":"none","labelTopic":false,"labelPayload":true,"labelName":"","uiPlaceName":"","uiNode":"none","uiControlDropdown":true,"uiControlMinMax":true,"uiColor1":"#ffffff","uiBgColor1":"#ffffff","uiColorON":"#ffffff","uiColorOFF":"#ffffff","uiColorPredicted":"#ffffff","uiUseColorPredicted":false,"uiColorPredictedOff":"#ffffff","uiUseColorPredictedOff":false,"uiFormat":false,"uiTooltip":"","uiIcon1":"","uiIconON":"","uiIconOFF":"","uiSwitchPredicted":false,"uiSwitchColorPredictedON":"#aaaaaa","uiSwitchColorPredictedOFF":"#aaaaaa","uiSwitchIconPredictedON":"fa-toggle-on","uiSwitchIconPredictedOFF":"fa-toggle-off","uiFormatColor":"homieString","settable":false,"x":212,"y":204,"wires":[["a89f27b1.0d13d8"],[]]},{"id":"a89f27b1.0d13d8","type":"function","z":"9d52d40a.a63668","name":"translate homie","func":"\n// IMPORTTANT! \n// Make shure that the topic matches the topit of homie state node that the extra data is merged correctly!\nmsg.topic=\"mqtt://192.168.2.14:1883/homie/\"+msg.deviceId;\n// if you do not use the homie convention choose a unique indetifier as msg.topic:\n// msg.topic=msg.payload.System[\"Unit Name\"];\n\nmsg.state={\"$name\":msg.deviceId,\"$state\":\"ready\"};\nswitch (msg.propertyId.toLowerCase()) {\n    // messages that need conversion\n    case ('rssi'):\n        msg.state.signal=Math.min(Math.max(2 * (msg.value + 100), 0), 100)\n        break;\n    // all messages that can be translated 1:1    \n    case ('freeheap'):\n    case ('uptime'):\n        msg.state[msg.propertyId]=msg.value;\n        break;\n    default: // drop message\n        return;\n}\nreturn msg;","outputs":1,"noerr":0,"x":437,"y":187,"wires":[["9e278daa.10534","f6956de0.9b59d"]],"icon":"node-red/swap.svg"},{"id":"9d9d213d.09396","type":"function","z":"9d52d40a.a63668","name":"lastSeen","func":"if (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\")) {\n    switch (msg.payload.command) {\n        case \"deleteTable\":\n            context.set(\"lastSeen\",undefined);\n            context.set(\"lastState\",undefined);\n            node.status({fill:\"yellow\",shape:\"dot\",text:\"lastSeen&lastState deleted\"});\n            node.warn(\"[lastSeen] lastSeen&lastState deleted\");\n            return msg;\n    }\n}\n\nif (msg.hasOwnProperty(\"topic\") && (msg.hasOwnProperty(\"state\") || msg.payload.hasOwnProperty(\"command\"))) {\n    var lastSeen = context.get(\"lastSeen\");\n    if (lastSeen===undefined) {\n        lastSeen={};\n        context.set(\"lastSeen\",lastSeen);\n    }\n    var lastState = context.get(\"lastState\");\n    if (lastState===undefined) {\n        lastState={};\n        context.set(\"lastState\",lastState);\n    }\n    \n    var pad = function (num) {\n        return (\"0\"+num).slice(-2);\n    };\n    var formatLastSeen = function(lastSeen){\n        if (lastSeen>0) {\n            var secs = Math.floor((Date.now() - lastSeen) / 1000);\n            var minutes = Math.floor(secs / 60);\n            secs = secs%60;\n            var hours = Math.floor(minutes/60);\n            minutes = minutes%60;\n            var days = Math.floor(hours/24);\n            hours = hours%24;\n            if (days>0) {\n                return days+\"days \"+hours+\"hours ago\";\n            } else if (hours>0) {\n                return pad(hours)+\":\"+pad(minutes)+\" ago\";\n            } else if (minutes>0) {\n                return minutes+\"min ago\";\n            } else {\n                return secs+\"s ago\";\n            }\n        }\n        return \"n/a\";\n    }\n    \n    if (msg.hasOwnProperty(\"state\")) {\n        if (msg.state.hasOwnProperty(\"$state\")) {\n            // do not add timestamp if $status==\"lost\" (this is the LWT form the broker)\n            if (!lastSeen.hasOwnProperty(msg.topic)) lastSeen[msg.topic]={};\n            lastState[msg.topic]=msg.state.$state;\n            \n            if (msg.state.$state===\"lost\"){\n                if (lastSeen.hasOwnProperty(msg.topic)) {\n                    msg.state.lastSeenreadyFormatted=\"lost \"+formatLastSeen(lastSeen[msg.topic].ready);\n                } else {\n                    msg.state.lastSeenreadyFormatted=\"never seen\";\n                }\n            } else {\n                msg.state[\"lastSeen\"+msg.state.$state]=Date.now();\n                msg.state[\"lastSeen\"+msg.state.$state+\"Formatted\"]=formatLastSeen(lastSeen[msg.topic][msg.state.$state]);\n                lastSeen[msg.topic][msg.state.$state]=msg.state[\"lastSeen\"+msg.state.$state];\n            }\n        }\n    } else if (msg.payload.hasOwnProperty(\"command\")) {\n        switch (msg.payload.command) {\n            case \"updateData\":\n                msg.payload.arguments=[[]];\n                for (let topic in lastSeen) {\n                    if (lastSeen.hasOwnProperty(topic)) {\n                        let lineData={\"$topic\":topic};\n                        for (let value in lastSeen[topic]) {\n                            if (lastSeen[topic].hasOwnProperty(value)) {\n                                lineData[\"lastSeen\"+value]=lastSeen[topic][value];\n                                lineData[\"lastSeen\"+value+\"Formatted\"]=formatLastSeen(lastSeen[topic][value]);\n                            }\n                        }\n                        if (lastState[topic]===\"lost\") {\n                            if (lastSeen[topic].hasOwnProperty(\"ready\")) {\n                                lineData[\"lastSeenreadyFormatted\"]=\"lost \"+formatLastSeen(lastSeen[topic].ready); \n                            } else {\n                                lineData[\"lastSeenreadyFormatted\"]=\"never seen\";\n                            }\n                        }\n                        msg.payload.arguments[0].push(lineData);\n                    }\n                }\n                break;\n            default:\n                break;\n        }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":366,"y":816,"wires":[["fedff381.7c035"]],"icon":"node-red/timer.svg","info":"# build last seen timestamps\n## description\nThis function looks for msg.state.$state messages and add a timestamp (absolute and difference from last occurence)\n## how to use\n- Place this node in your data stream before the `handle tableData` node. The payload must be like this to be activated. Other messages will be passed through\n```\nmsg.payload.state={\n    $name : \"deviceName\",\n    $state : \"anyState\"\n}\n```\n\n- Place a inject node infront with msg.payload\n```json\n{\n    \"command\": \"updateData\",\n    \"column\": \"lastSeen\"\n}\n```\nto get the formatted last seen string updtated the inject node should repead every mnute or so. \n\n### last seen formatted\na formatted string is generated out of the last known timestamp saved in node context and the actual one. The difference between last occurance and the current time is formatted as a human readable string. This ist especially usefull to track `lost` or `sleeping` devices. As this string will change over time even when the value stays constant and is not updated by the mqtt the inject node should trigger every minute.\nThe `lost` state is handeled a little bit different as this is issued by the broker as a LWT (last will topic). in this case the timestamp is irrelevant because it is not issued by the device. The last seen timestamp of the `ready` state is used instead to issue the last time the device is seen. If the device was never seeen in since the start of this flow `never`will be sent.\n\nExample:\n\n- Input:\n```\nmsg.payload.state={\n    $name : \"deviceName\",\n    $state : \"ready\"\n}\n```\n- Output\n```\nmsg.payload.state={\n    $name : \"deviceName\",\n    $state : \"ready\",\n    lastSeenready : unixTimeStamp,\n    lastSeenreadyFormatted : \"01:10 ago\"\n}\n```\n\n### data storage\nNo database is required. Al data is stored in the **node context** on `default` context provider. As all data is **live** and automaticaly rebuild after restart is is not nessesary and not recomended that anything else than `memory Only` is used.\n\n- `lastSeen` _object_ stores all last seen values  to compare against new values to format the human readable string\n- `lastState` _object_ stores all last values of $state in order to handle the special `$state='lost'` "},{"id":"1ded8052.c14b7","type":"inject","z":"9d52d40a.a63668","name":"update","topic":"updateColumn","payload":"{\"command\":\"updateData\",\"column\":\"lastSeen\"}","payloadType":"json","repeat":"60","crontab":"","once":true,"onceDelay":0.1,"x":179,"y":850,"wires":[["9d9d213d.09396"]]},{"id":"fec472fd.6a62e","type":"comment","z":"9d52d40a.a63668","name":"alternative HOMIE source","info":"","x":212,"y":170,"wires":[]},{"id":"5d93437e.17edac","type":"comment","z":"9d52d40a.a63668","name":"Homie convention source","info":"# homie convention source\n## introduction\nthe homie convention defines some statistic and firmware topics. The remote-device-table originates using the $stats and $fw properties defined in the homie convention 3.0.0 and later made available in version 4.0.0 through so called extensions.\nIf an alternative source provides all or some of the data it should first try to use the existing properties and perform conversions if nessesary.\n\n## reserved properties\nproperty | description | type    | format \n-------- | ----------- | ------- | ------ \n$homie | The implemented Homie convention version | **string** | \"4.0.0\"\n$name | the **unique** name of the device. This name is used to identify the device in the table. | string | \"myDevice\"\n$state | current or last state of the device | string | [\"ready\", \"lost\", \"init\", \"sleeping\", \"disconnected\", \"alert\"]\n$nodes\t| Nodes the device exposes | array | comma seperated list\n$extensions\t| Supported extensions | array | comma seperated list\n$implementation | An identifier for the Homie implementation | string | \"esp8266\"\n\n\n\ndefined by [**Legacy Firmware**](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_firmware_extension.md)\n\nproperty | description | type    | format\n-------- | ----------- | ------- | ------\n$localip | IP of the device on the local network | string | \"127.0.0.1\"\n$mac | Mac address of the device network interface | string | The format MUST be of the type `A1:B2:C3:D4:E5:F6`\nname | Name of the firmware running on the device. | string | Allowed characters are the same as the device ID\nversion | Version of the firmware running on the device. | string | \"1.0.0\"\n\n\ndefined by [**Legacy Stats**](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_stats_extension.md)\n\nproperty | description | type    | format\n-------- | ----------- | ------- | ------\ninterval | Interval in seconds at which the device refreshes its `$stats/+` | integer | Positive greater 0\nuptime | Time elapsed in seconds since the boot of the device | integer | seconds\nsignal | Signal strength | Integer | in %\ncputemp | CPU Temperature | Float | in °C\ncpuload | CPU Load in. Average of last $stats\\interval including all CPUs | Integer | %. \nbattery | Battery level. | Integer | in %\nfreeheap | Free heap. |\tPositive Integer | in bytes\nsupply | Supply Voltage | Float | in V\n\n","x":212,"y":34,"wires":[]},{"id":"f93d14b4.dbabf8","type":"comment","z":"9d52d40a.a63668","name":"alternative HTTP source","info":"","x":212,"y":442,"wires":[]},{"id":"5b5d7c00.8b9f34","type":"http request","z":"9d52d40a.a63668","name":"http get","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":570,"y":493,"wires":[["96dbdf73.29262"]]},{"id":"ffa780bb.8fd62","type":"function","z":"e0e6e559.8f30d8","name":"scan subnet","func":"var ipString = env.get('ipString') || '';\nvar start = env.get('start') || 1;\nvar end = env.get('end') || 255;\nvar suffix = env.get('suffix') || '/json';\n\nif (!msg.payload.hasOwnProperty(\"command\")) { // if no command scan complete subnet\n    for (let i=start; i<end+1; i++){\n        node.send({\"url\":ipString+i+\"/json\"})\n    }\n} else { // message form popup menue\n    switch (msg.payload.command){\n        case \"updateDevice\":\n            if (msg.payload.hasOwnProperty(\"$localip\") && \n                msg.payload.name===\"ESP Easy Mega\") {\n                    node.status({fill:\"green\", shape:\"dot\", text:\"scan \"+msg.payload.$localip})\n                    return({\"url\":\"http://\"+msg.payload.$localip+\"/json\"});\n            }\n            break;\n        case \"updateDevices\":\n            for (let i=start; i<end+1; i++){\n                node.send({\"url\":ipString+i+\"/json\"})\n            }\n            break;\n    }\n}","outputs":1,"noerr":0,"x":206,"y":85,"wires":[[]],"icon":"node-red/white-globe.svg"},{"id":"b20bd82e.30d678","type":"inject","z":"9d52d40a.a63668","name":"scan every hour","topic":"","payload":"scan","payloadType":"str","repeat":"3600","crontab":"","once":true,"onceDelay":"600","x":192,"y":476,"wires":[["923430d4.60b79"]]},{"id":"9db011a0.9b2f8","type":"json","z":"9d52d40a.a63668","name":"","property":"payload","action":"","pretty":false,"x":900,"y":493,"wires":[["6cdb8ecf.f3af8"]]},{"id":"96dbdf73.29262","type":"switch","z":"9d52d40a.a63668","name":"status == 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":743,"y":493,"wires":[["9db011a0.9b2f8"]]},{"id":"6cdb8ecf.f3af8","type":"function","z":"9d52d40a.a63668","name":"translate ESPEasy","func":"// translate decoded JSON received by ESPEasy\nif (msg.payload.hasOwnProperty(\"System\")) {\n \n    // IMPORTTANT! \n    // Make shure that the topic matches the topic of homie state node that the extra data is merged correctly!\n    msg.topic=\"mqtt://192.168.2.14:1883/homie/\"+msg.payload.System[\"Unit Name\"];\n    // if you do not use the homie convention choose a unique indetifier as msg.topic:\n    // msg.topic=msg.payload.System[\"Unit Name\"];\n    \n    msg.state={\"$name\":msg.payload.System[\"Unit Name\"]};\n    msg.state.freeheap=msg.payload.System[\"Free RAM\"];\n    msg.state.uptime=msg.payload.System[\"Uptime\"];\n    msg.state.cpuload=msg.payload.System.Load;\n    msg.state.lastBootCause=msg.payload.System[\"Last Boot Cause\"];\n    msg.state.resetReason=msg.payload.System[\"Reset Reason\"];\n    msg.state.version=msg.payload.System.Build;\n    msg.state.name=\"ESP Easy Mega\";\n\n    if (msg.payload.hasOwnProperty(\"WiFi\")) {\n        msg.state.signal=Math.min(Math.max(2 * (msg.payload.WiFi.RSSI + 100), 0), 100)\n        msg.state.$localip=msg.payload.WiFi[\"IP Address\"];\n        msg.state.$mac=msg.payload.WiFi[\"STA MAC\"];\n        msg.state.SSID=msg.payload.WiFi.SSID;\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1059,"y":493,"wires":[["9cd8d3a8.dbb3d","e917f701.848748"]],"icon":"node-red/swap.svg"},{"id":"b8393c0b.3d7ec","type":"switch","z":"9d52d40a.a63668","name":"filter callbacks","property":"$exists(ui_control)","propertyType":"jsonata","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":777,"y":1207,"wires":[["6f074131.3df08"],["7adad4ad.104b3c","7f8fa749.5b4478"]]},{"id":"f56ba748.951e28","type":"comment","z":"9d52d40a.a63668","name":"alternative MQTT source","info":"","x":212,"y":272,"wires":[]},{"id":"b9e8b34b.6ff15","type":"mqtt in","z":"9d52d40a.a63668","d":true,"name":"","topic":"homie/+/System_Info/#","qos":"2","datatype":"utf8","broker":"6389f524.8a4e3c","x":202,"y":306,"wires":[["31d656fb.78f2ca"]]},{"id":"31d656fb.78f2ca","type":"function","z":"9d52d40a.a63668","name":"translate mqtt (ESPEasy SystemInfo plugin)","func":"var topicSplitted = msg.topic.split('/');\n\n// IMPORTTANT! \n// Make shure that the topic matches the topit of homie state node that the extra data is merged correctly!\nmsg.topic=\"mqtt://192.168.2.14:1883/\"+topicSplitted[0]+\"/\"+topicSplitted[1];\n\nmsg.state={\"$name\":topicSplitted[1]};\nswitch (topicSplitted[3].toLowerCase()) {\n    // messages that need conversion\n    case ('rssi'):\n        msg.state.signal=Math.min(Math.max(2 * (Number(msg.payload) + 100), 0), 100)\n        break;\n    case ('uptime'):\n        // ESPEasy sends uptime in minutes home defines uptime in seconds!\n        msg.state[topicSplitted[3]]=Number(msg.payload)*60;\n        break;\n    // all messages that can be translated 1:1    \n    case ('freestack'):\n    case ('freeheap'):\n        msg.state[topicSplitted[3]]=Number(msg.payload);\n        break;\n    default: // drop message\n        return;\n}\nreturn msg;","outputs":1,"noerr":0,"x":527,"y":306,"wires":[["fd874c09.b60e4","5e8155d9.d2b8bc"]],"icon":"node-red/swap.svg"},{"id":"3259206b.ed212","type":"comment","z":"9d52d40a.a63668","name":"homematic source","info":"","x":192,"y":578,"wires":[]},{"id":"23955b94.65ddd4","type":"ccu-rpc-event","z":"9d52d40a.a63668","name":"all devices","iface":"","ccuConfig":"dcd63e8.d157fc","rooms":"","roomsRx":"str","functions":"","functionsRx":"str","device":"","deviceRx":"str","deviceName":"","deviceNameRx":"str","deviceType":"","deviceTypeRx":"str","channel":"","channelRx":"str","channelName":"","channelNameRx":"str","channelType":"","channelTypeRx":"str","channelIndex":"","channelIndexRx":"str","datapoint":"","datapointRx":"str","change":true,"working":false,"cache":true,"topic":"${device}/${datapoint}","x":162,"y":612,"wires":[["b85c285e.bbe608","f28d6d58.f27d8"]]},{"id":"b85c285e.bbe608","type":"function","z":"9d52d40a.a63668","name":"translate homematic","func":"const never=0;\nconst onChange=1;\nconst allways=2;\n\n// -----------------------------------------------------------------\n// example of a generic translator for msg.objects into state values\n//\n// this is WORK IN PROGRESS!\n// share improvements if you think they can be usefull to others\n//\n// -----------------------------------------------------------------\n\nvar translator={\n    \"$topic\":{\"properties\":[\"deviceType\",\"device\"],\"requited\":true,\"send\":allways},\n    \"$name\":{\"property\":\"deviceName\",\"default\":\"\",\"format\":\"\",\"requited\":true,\"send\":allways},\n    \"$state\":{\"property\":\"\",\"default\":\"ready\",\"format\":\"\",\"requited\":false,\"send\":allways},\n    \"$localip\":{\"property\":\"ccu\",\"default\":\"127.0.0.1\",\"format\":\"\",\"requited\":false,\"send\":onChange},\n    \"$mac\":{\"property\":\"\",\"default\":\"FF:FF:FF:FF:FF:FF\",\"format\":\"\",\"requited\":false,\"send\":never},\n    \"$implementation\":{\"property\":\"\",\"default\":\"Homematic\",\"format\":\"\",\"requited\":false,\"send\":onChange},\n    \"$nodes\":{\"property\":\"\",\"default\":[],\"format\":\"\",\"requited\":false,\"send\":never},\n    \"uptime\":{\"property\":\"\",\"default\":0,\"format\":\"\",\"requited\":false,\"send\":never},\n    \"interval\":[\n        {\"property\":\"deviceType=HM-RCV-50\",\"value\":\"\",\"default\":0,\"format\":\"\",\"requited\":false,\"send\":allways},\n        {\"property\":\"deviceType=HM-CC-RT-DN\",\"value\":\"\",\"default\":1200,\"format\":\"\",\"requited\":false,\"send\":allways},\n        {\"property\":\"deviceType=HM-WDS30-OT2-SM\",\"value\":\"\",\"default\":1800,\"format\":\"\",\"requited\":false,\"send\":allways},\n        {\"property\":\"deviceType=HMIP-PSM\",\"value\":\"\",\"default\":600,\"format\":\"\",\"requited\":false,\"send\":allways},\n        {\"property\":\"deviceType=HMIP-PS\",\"value\":\"\",\"default\":0,\"format\":\"\",\"requited\":false,\"send\":allways},\n        {\"property\":\"deviceType=HM-Sec-SCo\",\"value\":\"\",\"default\":0,\"format\":\"\",\"requited\":false,\"send\":allways}\n    ],\n    \"freeheap\":{\"property\":\"\",\"default\":0,\"format\":\"\",\"requited\":false,\"send\":never},\n    \"cpuload\":{\"property\":\"\",\"default\":0,\"format\":\"\",\"requited\":false,\"send\":never},\n    \"battery\":[\n        {\"property\":\"datapoint=BATTERY_STATE\",\"value\":\"value\",\"default\":0,\"format\":\"1.5:3.1\",\"translate\":\"%\",\"requited\":false,\"send\":allways},\n        {\"property\":\"datapoint=LOWBAT\",\"value\":\"value\",\"default\":false,\"format\":\"true:false\",\"translate\":\"%\",\"requited\":false,\"send\":allways}\n    ],\n    \"supply\":{\"property\":\"datapoint=BATTERY_STATE\",\"value\":\"value\",\"default\":0,\"format\":\"1.5:4.6\",\"requited\":false,\"send\":allways},\n    \"signal\":{\"property\":\"RSSI_PEER\",\"default\":0,\"format\":\"0:100\",\"requited\":false,\"send\":allways},\n    \"name\":{\"property\":\"deviceType\",\"default\":\"Homematic\",\"format\":\"\",\"requited\":false,\"send\":onChange},\n    \"version\":{\"property\":\"iface\",\"default\":\"0.0.1\",\"format\":\"\",\"requited\":false,\"send\":onChange},\n    \"room\":{\"property\":\"room\",\"default\":\"\",\"format\":\"\",\"requited\":false,\"send\":onChange}\n}\n\nvar status = {fill:\"red\",shape:\"dot\",text: \"payload=\"+msg.payload};\nvar getValue = function (theMsg,property) {\n    if (typeof property === \"string\") {\n        var splitted = property.split('.');\n        for (let currentObject of splitted) {\n            if (theMsg.hasOwnProperty(currentObject)) {\n                theMsg=theMsg[currentObject];\n            } else {\n                return undefined;\n            }\n        }\n        return theMsg;\n    } else node.error(\"[translate] property:'\"+property+\"' not a string\");\n}\n\nvar currentProperty = {};\nvar value;\nvar sendStore=context.get(\"sendStore\") || {};\nvar index;\n\nif (!msg.hasOwnProperty(\"state\")) msg.state={};\nfor (let property in translator) {\n    if (translator.hasOwnProperty(property)) {\n        properties = (Array.isArray(translator[property])) ? translator[property] : [translator[property]]\n        for (currentProperty of properties) {\n            if (property===\"$topic\" && (Array.isArray(currentProperty.properties))) {\n                msg.state[property]=\"\"\n                for (let element of currentProperty.properties) {\n                    value = getValue(msg,element);\n                    if (value !== undefined) msg.state[property]+=value;\n                }\n                index=msg.state[property];\n            } else {\n                if (currentProperty.hasOwnProperty(\"property\")) {\n                    if (currentProperty.property!==\"\") {\n                        \n                        // if there is a conditional property defined\n                        if (currentProperty.property.includes(\"=\")) {\n                            //node.warn([currentProperty.property,typeof currentProperty.property]);\n                            let propertySplitted=currentProperty.property.split(\"=\");\n                            if (getValue(msg,propertySplitted[0])===propertySplitted[1]) {\n                                if (currentProperty.translate===\"%\") { // if Translator for %\n                                    let formatSplitted=currentProperty.format.split(\":\");\n                                    if (formatSplitted[0]===\"true\" || formatSplitted[0]===\"false\") {\n                                        let min=(formatSplitted[0]===\"true\") ? true : false;\n                                        if (getValue(msg,currentProperty.value)===min) { // set % values for boolean values\n                                            msg.state[property]=25;\n                                        } else {\n                                            msg.state[property]=75;\n                                        }\n                                    } else {\n                                        // rescale percentage to given format \"min:max\"\n                                        let min=Number(formatSplitted[0]);\n                                        let max=Number(formatSplitted[1]);\n                                        msg.state[property]=Math.floor(100/(max-min)*(Number(getValue(msg,currentProperty.value))-min));\n                                    }\n                                } else {\n                                    if (currentProperty.value!==\"\") {\n                                        msg.state[property]=getValue(msg,currentProperty.value);\n                                    } else {\n                                        msg.state[property]=currentProperty.default;\n                                    }\n                                }\n                            }\n                        } else {\n                            if (currentProperty.property!=='') {\n                                msg.state[property]=getValue(msg,currentProperty.property);\n                            } else {\n                                msg.state[property]=currentProperty.default;\n                            }\n                        }\n                    } else {\n                        msg.state[property]=currentProperty.default;\n                    }\n                    if (currentProperty.send===onChange) {\n                        if (!sendStore.hasOwnProperty(index)) sendStore[index]={};\n                        if (!sendStore[index].hasOwnProperty(property) || sendStore[index][property]===null) {\n                            sendStore[index][property]=msg.state[property];\n                            context.set(\"sendStore\",sendStore);\n                        } else {\n                            if (sendStore[index][property]===msg.state[property]) {\n                                // node.warn([\"delete onChange\",index,property,sendStore[index],sendStore[index].hasOwnProperty(property),sendStore[index][property]]);\n                                delete msg.state[property]\n                            } else {\n                                sendStore[index][property]=msg.state[property];\n                            }\n                        }\n                    } \n                    if (currentProperty.send===never) {\n                        delete msg.state[property]\n                    }\n                }\n                if (property===\"$name\") {\n                    status.fill=\"green\";\n                    status.text=msg.state[property]+\"=\"+msg.state[property];\n                }\n            }\n            if (currentProperty.required && !msg.state.hasOwnProperty(property)) {\n                status.text=\"required \"+property+\" \"+msg.state[property];\n            }\n        }\n    }\n}\n// check if required attributes exists\nfor (let property in translator) {\n    if (translator[property].required) { // if any requitred property is missing dispose complete msg.state\n        if (!msg.state.hasOwnProperty(property)) {\n            node.warn([property+\" undefined\",msg.payload]);\n            status.fill=\"red\";\n            status.text=\"required \"+property+\" undefined\";\n            delete msg.state;\n            break;\n        }\n    }\n}\nmsg.topic=msg.state.$topic;\nnode.status(status);\nreturn msg;","outputs":1,"noerr":0,"x":372,"y":612,"wires":[["5ec354ef.9218cc","b4f3194a.c9e198"]],"info":"# generic translator (here for Homematic devices)\n\nThis function node is a generic translator for data comming in as a msg object. As an example the converting data from the homematic in node to msg.state is performed.\n\n## theory of operation\n\nThe remote device table originates in the [homie convention](https://homieiot.github.io) but can be relatively easyly adapted for other systems. If ever possible the data from other systems should be merged into the homie convention properties to keep the amount of columns in the table low and make it easy to be compared, sorted and filtered. But feel free to add additional proerties as you like. Some properties a essential and should not be changed\n\n** required properties **\n- **$topic** essential is a unique index. Unique in this case means unique for ALL remote devices. Otherwise you will get different devices merged into each other. `msg.state.$topic` will be copied into msg.topic to make it easier to access\n- **$name** should be unique and will be inside one mqtt base topic but as every row is identified by $topic it could be edited.\n- **$state** current or last known state of the device | string | [\"ready\", \"lost\", \"init\", \"sleeping\", \"disconnected\", \"alert\"\n\n** special properties **\n\n- **interval** If your device do not provide the inteval ime (on seconds) it could be expected to send updates you should set the fefault to an apropiate time. The `$state watchdog` uses this to set a individual timeout for each device. Set it to 0 when you do not expect regular updates.\n \n## suggested / reserved properties\n\nThis properties are defined by the homie convention and should be used if possible!\n\nproperty | description | type    | format \n-------- | ----------- | ------- | ------ \n$homie | The implemented Homie convention version | **string** | \"4.0.0\"\n$name | the **unique** name of the device. This name is used to identify the device in the table. | string | \"myDevice\"\n$state | current or last state of the device | string | [\"ready\", \"lost\", \"init\", \"sleeping\", \"disconnected\", \"alert\"]\n$nodes\t| Nodes the device exposes | array | comma seperated list\n$extensions\t| Supported extensions | array | comma seperated list\n$implementation | An identifier for the Homie implementation | string | \"esp8266\"\n\n\n\ndefined by [**Legacy Firmware**](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_firmware_extension.md)\n\nproperty | description | type    | format\n-------- | ----------- | ------- | ------\n$localip | IP of the device on the local network | string | \"127.0.0.1\"\n$mac | Mac address of the device network interface | string | The format MUST be of the type `A1:B2:C3:D4:E5:F6`\nname | Name of the firmware running on the device. | string | Allowed characters are the same as the device ID\nversion | Version of the firmware running on the device. | string | \"1.0.0\"\n\n\ndefined by [**Legacy Stats**](https://github.com/homieiot/convention/blob/develop/extensions/documents/homie_legacy_stats_extension.md)\n\nproperty | description | type    | format\n-------- | ----------- | ------- | ------\ninterval | Interval in seconds at which the device refreshes its `$stats/+` | integer | Positive greater 0\nuptime | Time elapsed in seconds since the boot of the device | integer | seconds\nsignal | Signal strength | Integer | in %\ncputemp | CPU Temperature | Float | in °C\ncpuload | CPU Load in. Average of last $stats\\interval including all CPUs | Integer | %. \nbattery | Battery level. | Integer | in %\nfreeheap | Free heap. |\tPositive Integer | in bytes\nsupply | Supply Voltage | Float | in V\n\n"},{"id":"677977e5.f274b8","type":"link out","z":"9d52d40a.a63668","name":"toPlugins","links":["c9b41f12.1c433"],"x":389,"y":68,"wires":[]},{"id":"9e278daa.10534","type":"link out","z":"9d52d40a.a63668","name":"toPlugins","links":["c9b41f12.1c433"],"x":576,"y":187,"wires":[]},{"id":"fd874c09.b60e4","type":"link out","z":"9d52d40a.a63668","name":"toPlugins","links":["c9b41f12.1c433"],"x":746,"y":306,"wires":[]},{"id":"b563fdad.d0b7c","type":"link in","z":"9d52d40a.a63668","name":"Watchdog","links":["466c4805.365698","5ec354ef.9218cc","13055b32.2932e5"],"x":134,"y":765,"wires":[["84e3502f.6ee37"]]},{"id":"9cd8d3a8.dbb3d","type":"link out","z":"9d52d40a.a63668","name":"toPlugins","links":["c9b41f12.1c433"],"x":1188,"y":493,"wires":[]},{"id":"5ec354ef.9218cc","type":"link out","z":"9d52d40a.a63668","name":"toPlugins","links":["b563fdad.d0b7c"],"x":559,"y":612,"wires":[]},{"id":"1a9973b1.ea925c","type":"link out","z":"9d52d40a.a63668","name":"toTable","links":["b1750dea.ac9c2"],"x":525,"y":1071,"wires":[]},{"id":"b1750dea.ac9c2","type":"link in","z":"9d52d40a.a63668","name":"Table","links":["1a9973b1.ea925c","c7c4ccfa.7acd8","c59b8c64.16dc7"],"x":236,"y":1309,"wires":[["7adad4ad.104b3c"]]},{"id":"2e57f70c.496118","type":"comment","z":"9d52d40a.a63668","name":"Plugins","info":"","x":152,"y":714,"wires":[]},{"id":"248e0178.34da0e","type":"function","z":"9d52d40a.a63668","name":"resetCounter","func":"if (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\")) {\n    switch (msg.payload.command) {\n        case \"deleteTable\":\n            context.set(\"tableData\",undefined);\n            node.status({fill:\"yellow\",shape:\"dot\",text:\"tableData deleted\"});\n            node.warn(\"[resetCounter] tableData deleted\");\n            return msg;\n    }\n}\nconst pluginName=\"resetCounter\";\nconst triggerProperty=\"uptime\";\n\nvar status = {fill:\"red\",shape:\"dot\",text: \"payload=\"+msg.payload};\n// only trigger if msg.state exits and contains the property $name as a unique identifier\nif (msg.hasOwnProperty(\"state\") && msg.topic!==undefined && msg.topic!==\"\") {\n    status.text=\"device=\";\n    status.text+=(msg.state.$name) ? msg.state.$name : msg.topic;\n    status.fill=\"yellow\";\n    // if the plugin needs to save context data\n    var deviceName = msg.topic;\n    var tableData = context.get(\"tableData\",\"file\");\n    if (tableData===undefined) {\n        tableData={};\n        context.set(\"tableData\",tableData,\"file\");\n    }\n    // if the plugin only reacts on certain values (i.e. uptime)\n    if (msg.state.hasOwnProperty(triggerProperty)) {\n        if (!tableData.hasOwnProperty(deviceName)) {\n            tableData[deviceName]={\n                \"resetTotal\":0,\n                \"totalRuntime\":0\n            }\n        }\n        var tableRow=tableData[deviceName];\n        var success=false;\n        \n        // -------------------------------------------------\n        var dateNow=Date.now();\n        if (msg.state.hasOwnProperty(\"$status\")) {\n            switch (msg.state.$status) {\n                case \"sleeping\":\n                    //tableRow.totalRuntime+=tableRow.lastUptime;\n                    tableRow.lastUptime=0;\n                    status.text=\" sleeping\";\n                    break;\n                case \"lost\":\n                    tableRow.lostSince=dateNow;\n                    break;\n            }\n        }\n        if (tableRow.hasOwnProperty(\"lastUptime\")) {\n            // node.warn([msg.state.uptime,tableRow.lastUptime]);\n            if (Number(msg.state.uptime) < tableRow.lastUptime) { // reset detected!\n                if (tableRow.hasOwnProperty(\"lostSince\")) {\n                    tableRow.resetPeriodLast = tableRow.lostSince-tableRow.resetLast;\n                    delete tableRow.resetLast;\n                    delete tableRow.lostSince;\n                }\n                if (tableRow.hasOwnProperty(\"resetLast\")) {\n                    tableRow.resetPeriodLast = dateNow-tableRow.resetLast;\n                }\n                if (tableRow.resetTotal>0) {\n                    tableRow.resetAverage = Math.floor(tableRow.totalRuntime / tableRow.resetTotal);\n                    msg.state.resetAverage=tableRow.resetAverage;\n                    msg.state.resetTotal=tableRow.resetTotal;\n                    msg.state.resetLast=tableRow.resetLast;\n                    msg.state.totalRuntime=tableRow.totalRuntime;\n                }\n            \n                tableRow.resetLast=dateNow;\n                ++tableRow.resetTotal;\n            } else { // device alive - counting up\n                tableRow.totalRuntime += Number(msg.state.uptime)-tableRow.lastUptime;\n            }\n            tableRow.lastUptime=Number(msg.state.uptime);\n        } else { // first recorded uptime + first seen\n            tableRow.lastUptime=Number(msg.state.uptime);\n            tableRow.totalRuntime=tableRow.lastUptime;\n            if (!tableRow.hasOwnProperty(\"firstSeen\")) {\n                tableRow.firstSeen=dateNow;\n                msg.state.firstSeen=dateNow;\n            }\n        }\n        success=true;\n        // -------------------------------------------------\n        \n        if (success) {\n            if (msg.state.hasOwnProperty(\"resetTotal\")) {\n                status.fill=\"green\"\n                status.text=msg.topic+\" resets=\"+msg.state.resetTotal;\n                node.status(status);\n            }\n        } else {\n            status.error({\"pluginName\":pluginName,triggerProperty:msg.state[triggerProperty],\"state\":msg.state})\n            status.text=\"Error device:\"+msg.topic+\" \"+triggerProperty+\"=\"+msg.state[triggerProperty];\n            node.status(status);           \n        }\n    }\n}\n// always pass the original message (+ additional data as suitable)\n// node.warn([\"reset\",msg.topic])\nreturn msg;","outputs":1,"noerr":0,"x":376,"y":969,"wires":[["eca05dcd.06bd4"]],"info":"# reset counter\nDetection of device resets. A reset of a device delivering a uptime value can be detected if the delivered uptime value is lower than the value before.\nIf `msg.state.$state==\"lost\"` is detected a timestamp is recorded. if a new `uptime<lastUptime` is detected the recorded \"lost\" timestamp is used insted of `date.now()`\nif `msg.state.$sate==\"sleeping\"` is detected a timestamp is recorded. On next `ready` the lastUptime is set to 0 so the lower `uptime` does not count as a reset.\n\n## context store\n\n`tabledata` in node context. As the totalRuntime should be calculated over flow restart / reset it shoul be saved to persistent memory\n\n## property trigger\n`msg.state.uptime` period between boot and now _in seconds_\n\n## properties used / required\nproperty | required | unique\n-------- | -------- | -------\n`msg.state.$name` | **required** | **unique**\n`msg.state.uptime` | **required** |\n`msg.state.$lost` | **optional** |\n\n\n## values added\nproperty | description | unit\n-------- | ----------- | ----\n`msg.state.resetAverage` | average period between resets | _in ms_\n`msg.state.resetTotal` | total resets detected | _integer_\n`msg.state.resetLast` | last reset detected | _unix timestamp_\n`msg.state.totalRuntime` | total runtime from first detection to now | _in ms_"},{"id":"eca05dcd.06bd4","type":"function","z":"9d52d40a.a63668","name":"sleepTimer","func":"const pluginName=\"sleepTimer\"; // give the plugin a unique name\nconst triggerProperty=\"$state\"; // if the plugin triggers on one specific property you can specifie it here\nconst contextName=\"tableData\"; // name of context store\n\nif (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\")) {\n    switch (msg.payload.command) {\n        case \"deleteTable\":\n            context.set(contextName,undefined);\n            node.status({fill:\"yellow\",shape:\"dot\",text:contextName+\" deleted\"});\n            node.warn(\"[\"+pluginName+\"] \"+contextName+\"deleted\");\n            return msg;\n    }\n}\n\nvar status = {fill:\"red\",shape:\"dot\",text: \"payload=\"+msg.payload};\n// only trigger if msg.state exitst and contains the property $name as a unique identifier\nif (msg.hasOwnProperty(\"state\") && msg.topic!==undefined && msg.topic!==\"\") {\n    status.text=\"device=\";\n    status.text+=(msg.state.$name) ? msg.state.$name : msg.topic;\n    status.fill=\"yellow\";\n    // if the plugin needs to save context data\n    var deviceName = msg.topic;\n    var tableData = context.get(contextName);\n    if (tableData===undefined) {\n        tableData={};\n        context.set(contextName,tableData);\n    }\n    // if the plugin only reacts on certain values (i.e. uptime)\n    if (msg.state.hasOwnProperty(triggerProperty)) { // add additional triggers here\n        if (!tableData.hasOwnProperty(deviceName)) {\n            if (msg.state[triggerProperty]==='sleeping') { // only activate if device is sleeping once\n                tableData[deviceName]={};\n                msg.state.sleepMode=true;\n            } else {\n                msg.state.sleepMode=false;\n                return msg; // sleepMode not enabled yet\n            }\n        }\n        var tableRow=tableData[deviceName];\n        var success=false;\n        \n        // -------------------------------------------------\n        var dateNow=Date.now();\n        switch (msg.state[triggerProperty]) {\n            case 'sleeping':\n                if (tableRow.lastEvent==='ready' && tableRow.hasOwnProperty('awakeTimestamp')) {\n                    tableRow.awakeTime=Math.floor((dateNow - tableRow.awakeTimestamp)/1000); // in seconds\n                }\n                if (tableRow.lastEvent!=='sleeping') {\n                    tableRow.sleepTimestamp=dateNow;\n                    tableRow.lastEvent='sleeping';\n                }\n                break;\n            case 'ready':\n                if (tableRow.lastEvent==='sleeping' && tableRow.hasOwnProperty('sleepTimestamp')) {\n                    tableRow.sleepTime=Math.floor((dateNow - tableRow.sleepTimestamp)/1000); // in seconds\n                }\n                if (tableRow.lastEvent!=='ready') {\n                    tableRow.awakeTimestamp=dateNow;\n                    tableRow.lastEvent='ready';\n                }\n                break;\n            case 'lost':\n                if (tableRow.lastEvent!=='lost') {\n                    // device went from sleeping to lost\n                    if (tableRow.lastEvent==='sleeping' && tableRow.hasOwnProperty('sleepTimestamp')) {\n                        tableRow.sleepTime=Math.floor((dateNow - tableRow.sleepTimestamp)/1000); // in seconds\n                        delete tableRow.sleepTimestamp;\n                    }\n                    // device went form ready to lost\n                    if (tableRow.lastEvent==='ready' && tableRow.hasOwnProperty('awakeTimestamp')) {\n                        tableRow.awakeTime=Math.floor((dateNow - tableRow.awakeTimestamp)/1000); // in seconds\n                        delete tableRow.awakeTimestamp;\n                    }\n                    tableRow.lastEvent='lost';\n                }\n                break;\n            case 'diconnected':\n                delete tableData[deviceName];\n                status.text+=\" disconnected\";\n                break;\n        }\n        if (tableRow.hasOwnProperty('sleepTime') && tableRow.hasOwnProperty('awakeTime')) {\n            msg.state.sleepRatio=tableRow.awakeTime / tableRow.sleepTime * 100;\n            // msg.state.sleepTime=msg.sleepTime;\n            // msg.state.awakeTime.msg.awakeTime;\n        }\n        success=true;\n        // -------------------------------------------------\n        \n        if (success) {\n            status.fill=\"green\"\n            status.text+=\" \"+triggerProperty+\"=\"+msg.state[triggerProperty];\n            node.status(status);\n        } else {\n            status.error({\"pluginName\":pluginName,triggerProperty:msg.state[triggerProperty],\"state\":msg.state})\n            status.text+=\" Error \"+triggerProperty+\"=\"+msg.state[triggerProperty];\n            node.status(status);           \n        }\n    }\n}\n// allways pass the original message (+ additional data as suitable)\nreturn msg;","outputs":1,"noerr":0,"x":376,"y":1020,"wires":[["c03f0c10.6229f"]],"info":"# sleep timer\nMeasures the sleep and awake time and gives a ratio in %\n\n## context store\n\n`tableData` in node context to store sleep and awake events\n\n## property trigger\n`$state` state changes:\n- `sleeping` begin of sleep period\n- `ready` or `init` begin of awake period\n- `lost` device offline period not added to calculation\n- `diconnected` delete value in tableData\n\n## properties used / required\nproperty | required | unique\n-------- | -------- | -------\n`msg.state.$name` | **required** | **unique**\n\n\n## values added or modified\n\nproperty | modification | description | unit\n-------- | ------------ | ----------- | ----\n`msg.state.sleepMode` | new | device usiong sleep mode | *boolean*\n`msg.state.sleepRatio` | new | percentage of time running | *integer* _in %_\n`msg.state.sleepTime` | optional | time sleeping | *integer* _in seconds_\n`msg.state.awakeTime` | optional | time awake | *integer* _in seconds_"},{"id":"c03f0c10.6229f","type":"function","z":"9d52d40a.a63668","name":"pluginTemplate","func":"const pluginName=\"pluginTemplate\"; // give the plugin a unique name\nconst triggerProperty=\"uptime\"; // if the plugin triggers on one specific property you can specifie it here\nconst contextName=\"tableData\"; // name of context store\n\nif (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\")) {\n    switch (msg.payload.command) {\n        case \"deleteTable\":\n            context.set(contextName,undefined);\n            node.status({fill:\"yellow\",shape:\"dot\",text:contextName+\" deleted\"});\n            node.warn(\"[\"+pluginName+\"] \"+contextName+\"deleted\");\n            return msg;\n    }\n}\n\nvar status = {fill:\"red\",shape:\"dot\",text: \"payload=\"+msg.payload};\n// only trigger if msg.state exitst and contains the property $name as a unique identifier\nif (msg.hasOwnProperty(\"state\") && msg.topic!==undefined && msg.topic!==\"\") {\n    status.text=\"device=\";\n    status.text+=(msg.state.$name) ? msg.state.$name : msg.topic;\n    status.fill=\"yellow\";\n    // if the plugin needs to save context data\n    var deviceName = msg.topic;\n    var tableData = context.get(contextName);\n    if (tableData===undefined) {\n        tableData={};\n        context.set(contextName,tableData);\n    }\n    // if the plugin only reacts on certain values (i.e. uptime)\n    if (msg.state.hasOwnProperty(triggerProperty)) { // add additional triggers here\n        if (!tableData.hasOwnProperty(deviceName)) tableData[deviceName]={}\n        var tableRow=tableData[deviceName];\n        var success=false;\n        \n        // -------------------------------------------------\n        // place your code here\n        // if success leave with\n        success=true;\n        // -------------------------------------------------\n        \n        if (success) {\n            status.fill=\"green\"\n            status.text+=\" \"+triggerProperty+\"=\"+msg.state[triggerProperty];\n            node.status(status);\n        } else {\n            status.error({\"pluginName\":pluginName,triggerProperty:msg.state[triggerProperty],\"state\":msg.state})\n            status.text+=\" Error \"+triggerProperty+\"=\"+msg.state[triggerProperty];\n            node.status(status);           \n        }\n    }\n}\n// allways pass the original message (+ additional data as suitable)\nreturn msg;","outputs":1,"noerr":0,"x":386,"y":1071,"wires":[["1a9973b1.ea925c","2074fe0f.a481a2"]],"info":"# plugin template\nYou can use this template to write your own plugin. Please take the time and publish plugins others might like to use.\n\n## context store\n\n`tabledata` in node context. Using memory only (recomended unless usefull)\n\n## property trigger\n`uptime` period between boot and now _in seconds_\n\n## properties used / required\nproperty | required | unique\n-------- | -------- | -------\n`msg.state.$name` | **required** | **unique**\n`msg.state.uptime` | **required** |\n`msg.state.$lost` | **optional** |\n\n\n## values added or modified\nif the plugin modifies existing properties please make sure that the following flow and the table are aware!\nproperty | modification | description | unit\n-------- | ------------ | ----------- | ----\n`msg.state.newProperty` | new | average period between resets | _in ms_\n"},{"id":"7adad4ad.104b3c","type":"subflow:2924702c.b33a7","z":"9d52d40a.a63668","name":"","env":[{"name":"tabulator","value":"{\"customHeight\":18,\"tabulator\":{\"responsiveLayout\":\"collapse\",\"responsiveLayoutCollapseStartOpen\":false,\"index\":\"$topic\",\"layout\":\"fitColumns\",\"movableColumns\":true,\"groupBy\":\"\",\"columns\":[{\"formatter\":\"responsiveCollapse\",\"width\":30,\"minWidth\":30,\"align\":\"center\",\"resizable\":false,\"headerSort\":false,\"frozen\":true,\"title\":\"Expand&nbsp;&nbsp;<i class='fa fa-plus-circle'></i> \",\"field\":\"expand\",\"headerVertical\":\"flip\",\"headerTooltip\":\"click to expand more details\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatter\":\"function(cell, formatterParams, onRendered) {      var html = cell.getValue(); return html;  }\",\"title\":\"State&nbsp;&nbsp;<i class='fa fa-bolt fa-rotate-90'></i>\",\"field\":\"$stateIcon\",\"width\":40,\"align\":\"center\",\"frozen\":true,\"headerVertical\":\"flip\",\"headerTooltip\":\"current state as icon: init, ready, lost, sleeping, disconnected or alert\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatter\":\"function(cell, formatterParams, onRendered) {     var html = cell.getValue(); return html;  }\",\"title\":\"Signal&nbsp;&nbsp;<i class='fa fa-signal fa-rotate-90'></i>\",\"field\":\"signalIcon\",\"width\":40,\"align\":\"center\",\"frozen\":true,\"headerVertical\":\"flip\",\"headerTooltip\":\"signal quality for wireless devices (signalIcon)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"Name&nbsp;&nbsp;<i class='fa fa-tag fa-rotate-90'></i>\",\"field\":\"$name\",\"width\":140,\"frozen\":true,\"tooltip\":true,\"headerVertical\":\"flip\",\"headerTooltip\":\"name of the device ($name)\",\"editor\":\"input\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContextNoHide'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"State&nbsp;&nbsp;<i class='fa fa-star-half-o'></i> \",\"field\":\"$state\",\"width\":65,\"align\":\"center\",\"headerVertical\":\"flip\",\"headerTooltip\":\"current state: init, ready, lost, sleeping, disconnected or alert\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"last seen&nbsp;&nbsp;<i class='fa fa-clock-o fa-rotate-90'></i>\",\"field\":\"lastSeenreadyFormatted\",\"width\":80,\"align\":\"right\",\"tooltip\":true,\"headerVertical\":\"flip\",\"headerTooltip\":\"time since the device was sending $state updates\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"Location&nbsp;&nbsp;<i class='fa fa-map-marker fa-rotate-90'></i>\",\"field\":\"room\",\"width\":100,\"headerTooltip\":\"location of the device (room)\",\"tooltip\":true,\"headerVertical\":\"flip\",\"editor\":\"autocomplete\",\"editorParams\":{\"freetext\":true,\"allowEmpty\":true,\"showListOnEmpty\":true,\"values\":true},\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"<i class='fa fa-area-chart'></i> Statistics\",\"columns\":[{\"title\":\"interval&nbsp;&nbsp;<i class='fa fa-undo'></i>\",\"field\":\"interval\",\"width\":40,\"headerVertical\":\"flip\",\"headerTooltip\":\"device update interval\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"outputFormat\":\"d hh:mm:ss\",\"inputFormat\":\"seconds\",\"invalidPlaceholder\":\"(unknown)\"},\"title\":\"uptime&nbsp;&nbsp;<i class='fa fa-clock-o'></i>\",\"field\":\"uptime\",\"formatter\":\"function(cell, formatterParams, onRendered){     var pad = function (num) {         return (\\\"0\\\"+num).slice(-2);     };     var secs = Number(cell.getValue());     if (Number.isNaN(secs)) return;     var minutes = Math.floor(secs / 60);     secs = secs%60;     var hours = Math.floor(minutes/60);     minutes = minutes%60;     var days = Math.floor(hours/24);     hours = hours%24;     if (days>0)         return days+\\\"d \\\"+pad(hours)+\\\":\\\"+pad(minutes);     else         return pad(hours)+\\\":\\\"+pad(minutes)+\\\":\\\"+pad(secs); }\",\"width\":75,\"headerVertical\":\"flip\",\"headerTooltip\":\"device uptime\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" %</span>\\\"; else return; }\",\"legendColor\":\"#FFFFFF\",\"legendAlign\":\"center\"},\"title\":\"signal&nbsp;&nbsp;<i class='fa fa-wifi'></i>\",\"field\":\"signal\",\"formatter\":\"progress\",\"width\":70,\"headerVertical\":\"flip\",\"headerTooltip\":\"device wireless signal quality\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":2.5,\"max\":3.5,\"color\":[\"red\",\"green\",\"red\"],\"legend\":\"function (value) { if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" V</span>\\\"; else return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"supply&nbsp;&nbsp;<i class='fa fa-plug'></i>\",\"field\":\"supply\",\"formatter\":\"progress\",\"width\":70,\"headerVertical\":\"flip\",\"headerTooltip\":\"device supply voltage\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" %</span>\\\";     else         return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"title\":\"battery&nbsp;&nbsp;<i class='fa fa-battery-2'></i>\",\"field\":\"battery\",\"formatter\":\"progress\",\"width\":70,\"headerVertical\":\"flip\",\"headerTooltip\":\"device battery level in %\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":0,\"max\":100000,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) { if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+(value/1024).toFixed(2)+\\\" kB</span>\\\"; else return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"right\"},\"title\":\"memory&nbsp;&nbsp;<i class='fa fa-microchip'></i>\",\"field\":\"freeheap\",\"formatter\":\"progress\",\"width\":70,\"headerVertical\":\"flip\",\"headerTooltip\":\"device free heap memory in kb\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" %</span>\\\";     else         return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"right\"},\"title\":\"load&nbsp;&nbsp;<i class='fa fa-tasks'></i>\",\"field\":\"cpuload\",\"formatter\":\"progress\",\"width\":70,\"headerVertical\":\"flip\",\"headerTooltip\":\"device cpu load in %\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":20,\"max\":60,\"color\":[\"green\",\"orange\",\"red\"],\"legend\":\"function (value) { if (value>0) return \\\"<span style='color:#FFFFFF;'>\\\"+value+\\\" °C</span>\\\"; else return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"right\"},\"title\":\"temp&nbsp;&nbsp;<i class='fa fa-thermometer-half'></i>\",\"field\":\"cputemp\",\"formatter\":\"progress\",\"width\":70,\"headerVertical\":\"flip\",\"headerTooltip\":\"device cpu temperature in °C\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"}]},{\"title\":\"<i class='fa fa-code'></i>Firmware\",\"columns\":[{\"formatter\":\"link\",\"formatterParams\":{\"labelField\":\"$localip\",\"urlPrefix\":\"http://\",\"target\":\"_blank\"},\"title\":\"ip&nbsp;&nbsp;<i class='fa fa-globe'></i>\",\"field\":\"$localip\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"device local IP-Address ($localip)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"mac&nbsp;&nbsp;<i class='fa fa-barcode'></i>\",\"field\":\"$mac\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"device mac address ($mac)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"SSID&nbsp;&nbsp;<i class='fa fa-wifi'></i>\",\"field\":\"SSID\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"access point the device device is connected to (provided by http json request)\"},{\"title\":\"firmware&nbsp;&nbsp;<i class='fa fa-code'></i>\",\"field\":\"name\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"name of the firmware ($fw/name)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"version&nbsp;&nbsp;<i class='fa fa-code-fork'></i>\",\"field\":\"version\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"version of the firmware ($fw/version)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"homie&nbsp;&nbsp;<i class='fa fa-rss-square'></i>\",\"field\":\"$homie\",\"width\":100,\"align\":\"left\",\"headerVertical\":\"flip\",\"headerTooltip\":\"homie version ($version)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"platform&nbsp;&nbsp;<i class='fa fa-microchip'></i>\",\"field\":\"$implementation\",\"width\":100,\"align\":\"left\",\"headerVertical\":\"flip\",\"headerTooltip\":\"name of the platform ($implementation)\",\"tooltip\":true,\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"boot&nbsp;&nbsp;<i class='fa  fa-exclamation-triangle'></i>\",\"field\":\"lastBootCause\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"last cause of reboot (provided by http json request)\"},{\"title\":\"reset&nbsp;&nbsp;<i class='fa fa-power-off'></i>\",\"field\":\"resetReason\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"last reason of reset (provided by http json request)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"reset #&nbsp;&nbsp;<i class='fa fa-sort-numeric-asc'>\",\"field\":\"resetTotal\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"number of resets (provided by resetCounter node)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"title\":\"a.uptime&nbsp;&nbsp;<i class='fa fa-clock-o'>\",\"field\":\"resetAverage\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"average uptime between resets (provided by resetCounter node)\",\"formatter\":\"function(cell, formatterParams, onRendered){     var pad = function (num) {         return (\\\"0\\\"+num).slice(-2);     };     var secs = Number(cell.getValue());     if (Number.isNaN(secs)) return;     var minutes = Math.floor(secs / 60);     secs = secs%60;     var hours = Math.floor(minutes/60);     minutes = minutes%60;     var days = Math.floor(hours/24);     hours = hours%24;     if (days>0)         return days+\\\"d \\\"+pad(hours)+\\\":\\\"+pad(minutes);     else         return pad(hours)+\\\":\\\"+pad(minutes)+\\\":\\\"+pad(secs); }\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"},{\"formatterParams\":{\"min\":0,\"max\":100,\"color\":[\"red\",\"orange\",\"green\"],\"legend\":\"function (value) {     if (value>0)         return \\\"<span style='color:#FFFFFF;'>\\\"+Number(value).toFixed(2)+\\\" %</span>\\\";     else         return; }\",\"legendColor\":\"#101010\",\"legendAlign\":\"center\"},\"formatter\":\"progress\",\"title\":\"sleep %&nbsp;&nbsp;<i class='fa fa-moon-o'></i>\",\"field\":\"sleepRatio\",\"width\":100,\"headerVertical\":\"flip\",\"headerTooltip\":\"ratio between sleep and awake (provided by sleepTimer node)\",\"headerContext\":\"function(e,column){ this.send({ui_control:{callback:'headerContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:column._column.field}); e.preventDefault(); }\"}]}],\"columnResized\":\"function(column){     var newColumn = {         field: column._column.field,         visible: column._column.visible,         width: column._column.width,         widthFixed: column._column.widthFixed,         widthStyled: column._column.widthStyled     }; this.send({topic:this.config.topic,ui_control:{callback:'columnResized',columnWidths:newColumn}}); }\",\"columnMoved\":\"function(column, columns){     var newColumns=[];     columns.forEach(function (column) {         newColumns.push({'field': column._column.definition.field, 'title': column._column.definition.title});     });     this.send({topic:this.config.topic,ui_control:{callback:'columnMoved',columns:newColumns}}); }\",\"rowFormatter\":\"function(row){     var data = row.getData();     switch (data.$state) {         case \\\"lost\\\":             row.getElement().style.backgroundColor = \\\"#9e2e66\\\";             row.getElement().style.color = \\\"#a6a6a6\\\";             break;         case \\\"sleeping\\\":             row.getElement().style.backgroundColor = \\\"#336699\\\";             break;         case \\\"disconnected\\\":             row.getElement().style.backgroundColor = \\\"#cc3300\\\";             row.getElement().style.color = \\\"#a6a6a6\\\";             break;         case \\\"alert\\\":             row.getElement().style.backgroundColor = \\\"#A6A6DF\\\";             break;         case \\\"init\\\":             row.getElement().style.backgroundColor = \\\"#f2f20d\\\";             break;         case \\\"ready\\\":             row.getElement().style.backgroundColor = \\\"\\\";             row.getElement().style.color = \\\"\\\";             break;         } }\",\"rowContext\":\"function(e, row){     this.send({ui_control:{callback:'rowContext'},position:{\\\"x\\\":e.x,\\\"y\\\":e.y},payload:{\\\"$name\\\":row._row.data.$name,\\\"$localip\\\":row._row.data.$localip,\\\"name\\\":row._row.data.name},\\\"topic\\\":row._row.data.$topic});     e.preventDefault(); }\",\"cellEdited\":\"function(cell){     this.send({ui_control:{callback:'cellEdited'},         payload:cell._cell.value,         \\\"oldValue\\\":cell._cell.oldValue,         \\\"field\\\":cell._cell.column.field,         \\\"$topic\\\":cell._cell.row.data.$topic}); }\"}}","type":"json"},{"name":"tableDataProp","value":"state","type":"str"}],"x":408,"y":1292,"wires":[["90e3c8cd.8287a8","85c3998c.c6d768"],["69cccd2b.cae4c4"]]},{"id":"c5450f7d.ea00c","type":"link out","z":"b66f2c73.9297e","name":"setLight","links":["31915d49.c1d6a2","f8f7631f.da37b"],"x":1086,"y":68,"wires":[]},{"id":"add140f5.cb0c7","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Nachttischleuche Jomo","serviceName":"Lightbulb","topic":"147626f2-d8a9-642b-8de4-24445f521c19","filter":false,"manufacturer":"Node-RED","model":"milight","serialNo":"1234","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n    \"Brightness\":true,\n    \"Hue\":true,\n    \"Saturation\":true\n}","x":722,"y":595,"wires":[["e8cb2f05.2881"],[]]},{"id":"e6740516.9b1688","type":"switch","z":"9d52d40a.a63668","name":"callback","property":"ui_control.callback","propertyType":"msg","rules":[{"t":"eq","v":"rowContext","vt":"str"},{"t":"eq","v":"headerContext","vt":"str"},{"t":"eq","v":"cellEdited","vt":"str"},{"t":"eq","v":"columnMoved","vt":"str"},{"t":"eq","v":"columnResized","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":179,"y":1530,"wires":[["5bf60e7.23625f"],["f246c2d4.aa89c"],[],[],[]]},{"id":"749057bc.c4a6d8","type":"switch","z":"9d52d40a.a63668","name":"","property":"payload.command","propertyType":"msg","rules":[{"t":"eq","v":"updateDevice","vt":"str"},{"t":"eq","v":"updateDevices","vt":"str"},{"t":"eq","v":"deleteDevice","vt":"str"},{"t":"eq","v":"ignoreDevice","vt":"str"},{"t":"eq","v":"unIgnoreDevice","vt":"str"},{"t":"eq","v":"refreshTable","vt":"str"},{"t":"eq","v":"deleteTable","vt":"str"},{"t":"eq","v":"columnHide","vt":"str"},{"t":"eq","v":"columnsUnHide","vt":"str"},{"t":"eq","v":"columnUnHide","vt":"str"},{"t":"eq","v":"restoreColumnOrder","vt":"str"},{"t":"eq","v":"resetColumnWidth","vt":"str"},{"t":"eq","v":"setResponsiveLayout","vt":"str"}],"checkall":"false","repair":false,"outputs":13,"x":781,"y":1530,"wires":[["28af0304.acdeec"],["28af0304.acdeec"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["710ae3ea.b5244c"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["c59b8c64.16dc7"],["c59b8c64.16dc7"]]},{"id":"c59b8c64.16dc7","type":"link out","z":"9d52d40a.a63668","name":"toTable","links":["b1750dea.ac9c2"],"x":950,"y":1530,"wires":[]},{"id":"bfbc2876.2e7748","type":"link in","z":"9d52d40a.a63668","name":"aquire","links":["28af0304.acdeec"],"x":253,"y":510,"wires":[["923430d4.60b79"]]},{"id":"28af0304.acdeec","type":"link out","z":"9d52d40a.a63668","name":"toAquire","links":["bfbc2876.2e7748","82fc1784.d3c078"],"x":950,"y":1445,"wires":[]},{"id":"13055b32.2932e5","type":"link out","z":"9d52d40a.a63668","name":"toPlugins","links":["b563fdad.d0b7c"],"x":1171,"y":1683,"wires":[]},{"id":"418512d5.1f8b6c","type":"function","z":"9d52d40a.a63668","name":"rowCommand","func":"// as this feeds back to the beginning of the flow it is time for a new message object\n// otherwise new and old data mix\n// all command data fills into a payload so it would unlikly survice verry long ;)\n\nvar msgOut={};\nswitch (msg.topic){\n    case 'unIgnoreDevice':\n        msgOut={\n            topic:msg.payload,\n            payload:{\n                \"command\":msg.topic,\n                \"object\":msg.payload\n            }\n        };\n        break;\n    case 'deleteTable':\n    case 'updateDevice':\n    case 'deleteDevice':\n    case 'ignoreDevice':\n        msgOut={\n            topic:msg.sourceMsg.topic,\n            socketid:msg.socketid,\n            payload:{\n                \"command\":msg.topic,\n                \"object\":msg.sourceMsg.topic,\n                \"$localip\":msg.sourceMsg.payload.$localip,\n                \"$name\":msg.sourceMsg.payload.$name,\n                \"name\":msg.sourceMsg.payload.name\n            }\n        };\n        break;\n    default:\n        msgOut={\n            topic:msg.sourceMsg.rowData.$topic,\n            payload:{\n                \"command\":msg.topic,\n                \"object\":msg.sourceMsg.$topic,\n                \"$localip\":msg.sourceMsg.payload.$localip,\n                \"$name\":msg.sourceMsg.payload.$name,\n                \"name\":msg.sourceMsg.payload.name,\n            }\n        }\n}\nnode.status({fill:\"green\",shape:\"dot\",text:msgOut.payload.command});\nreturn msgOut;","outputs":1,"noerr":0,"x":607,"y":1513,"wires":[["749057bc.c4a6d8","61b6cd67.e87d74"]]},{"id":"bc9395ce.412d28","type":"mqtt in","z":"9d52d40a.a63668","name":"","topic":"wallpanel/#","qos":"2","datatype":"utf8","broker":"6389f524.8a4e3c","x":162,"y":374,"wires":[["9908423d.9f0a"]]},{"id":"466c4805.365698","type":"link out","z":"9d52d40a.a63668","name":"toWatchdog","links":["b563fdad.d0b7c"],"x":644,"y":374,"wires":[]},{"id":"f6219bae.e768e8","type":"function","z":"9d52d40a.a63668","name":"translate mqtt (wallpanel)","func":"var topicSplitted = msg.topic.split('/');\n\n// IMPORTTANT! \n// Make shure that the topic matches the topic of homie state node that the extra data is merged correctly!\nmsg.topic=\"mqtt://192.168.2.14:1883/\"+topicSplitted[0]+\"/\"+topicSplitted[1];\n\n// -------------------------------------------------------------------\n// this function node can be used as a template for json data via mqtt\n// assumes a topic structure as <base>/<deviceName>/...\n// -------------------------------------------------------------------\n\n// transloator definition (json objects -> state data)\n// leave \"translateTo\" empty if the value should be droped\n// property = proeprty of source\n// translateTo = property of msg.state[translateTo]\n\nvar translator = {\n    \"state\":{\n        \"currentUrl\":{\"translateTo\":\"$localip\"},\n        \"screenOn\":{\"translateTo\":\"screenOn\"},\n        \"brightness\":{\"translateTo\":\"brightness\"}\n    },\n    \"sensor\":{\n        \"battery\":{\n            \"value\":{\"translateTo\":\"battery\"},\n            \"unit\":{\"translateTo\":\"\"},\n            \"charging\":{\"translateTo\":\"charging\"},\n            \"acPlugged\":{\"translateTo\":\"acPlugged\"},\n            \"usbPlugged\":{\"translateTo\":\"usbPlugged\"}\n        },\n        \"motion\":{\n            \"value\":{\"translateTo\":\"motion\"}\n        }\n    }\n}\n\n// --------------------------------------------------\n// other defaults not related to json data\n\nmsg.state={\"$name\":topicSplitted[1]};\nmsg.state.$implementation=\"WallPanel\";\nmsg.state.name=\"Android App\";\nmsg.state.version=\"0.9.1 Build 0\";\nmsg.state.$state=\"ready\";\n\n// --------------------------------------------------\nvar readValues = function(currentTranslator,level) {\n    for (var property in currentTranslator) {\n        if (currentTranslator.hasOwnProperty(property)) {\n            if (level===topicSplitted.length) { // end of branch, we expect data here\n                if (currentTranslator[property].translateTo!==\"\"){\n                    msg.state[currentTranslator[property].translateTo]=msg.payload[property];\n                }\n            } else if (topicSplitted[level]===property) { // step up to next branch\n                readValues(currentTranslator[property],level+1)\n            }\n        }\n    }\n}\nreadValues(translator,2); // start on level 2 -> this is where the data should start\n\nreturn msg;","outputs":1,"noerr":0,"x":484,"y":374,"wires":[["466c4805.365698","f73e708e.f0b8"]],"icon":"node-red/swap.svg","info":"# translator for the wallpanel android app\n## decription\nWallpanel is a fantastic open source android app to show the Node-RED dashboard on any android device in kiosk mode. In addition it comes with mqtt support to read sensor data depending of the capabilities of your device and the ability to receive commnads\nfor more information you find the project here (https://thanksmister.com/wallpanel-android/)\n\n## limitations\n- **wallpanel** do not offer LWT support jet. So detection of $state is verry difficult epecially when your android device is not offering sensor data to detect a timeout. Use the $sate watchdog to emulate LWT\n- **wallpanel** do not offer signal strength readings (WiFi)\n- **no data conversion** Data conversion (i.e. voltage in %). Example can be found in the gerneric translator\n\n## homie features\n- `$name` *string* Name of the device\n- `battery` *integer* Status of the battery in %\n- `$localip` *string* the dashboard the wallpanel is pointing at. *this is not the ip of the android device!*\n\n## extended features\n- `charging` *boolean* indicator if the battery is charging\n- `acPlugged` *boolean* indicator if the device is plugged it ac power (?)\n- `usbPlugged` *boolean* indicator if the device is plugged into usb (?)\n- `screenOn` *boolean* state of the screen (you can use a camera based motion detection, great!)\n- `screenBrightness` *integer* current brightness of the screen\n- `motion` *boolean* state of the motion sensor"},{"id":"9908423d.9f0a","type":"json","z":"9d52d40a.a63668","name":"","property":"payload","action":"","pretty":false,"x":288,"y":374,"wires":[["f6219bae.e768e8","d96e0b5b.ae6ae8"]]},{"id":"4b103b82.d5f934","type":"function","z":"9d52d40a.a63668","name":"colCommand","func":"// as this feeds back to the beginning of the flow it is time for a new message object\n// otherwise new and old data mix\n// all command data fills into a payload so it would unlikly survice verry long ;)\n\nvar msgOut={\n    topic:\"columnRightClick\",\n    payload:{\n        \"command\":msg.topic,\n        \"object\":msg.payload\n    }\n}\n\n// some commands need the column from the prosition where the context menu was triggered\n\nswitch (msg.topic){\n    case \"columnHide\":\n        msgOut.payload.object=msg.sourceMsg.payload;\n        break;\n}\nnode.status({fill:\"green\",shape:\"dot\",text:msgOut.payload.command});\nreturn msgOut;","outputs":1,"noerr":0,"x":614,"y":1564,"wires":[["749057bc.c4a6d8","b6f10d4c.dde98"]]},{"id":"430f3c7c.5622d4","type":"ui_context_menu","z":"9d52d40a.a63668","group":"3e8e6acd.3587c6","order":1,"width":0,"height":-1,"fontSize":16,"position":"msg","outputField":"payload","xCoordinate":"500","yCoordinate":"450","menu":"msg","menuItems":[{"id":"2","icon":"fa-plus-square","label":"unhide all columns","topic":"columnsUnHide","payload":"","payloadType":"str","visible":true,"enabled":true},{"id":"3","icon":"fa-recycle","label":"refresh Table","topic":"refreshTable","payload":"","payloadType":"str","visible":true,"enabled":true},{"id":"4","icon":"fa-table","label":"delete table","topic":"deleteTable","payload":"","payloadType":"str","visible":true,"enabled":true}],"colors":"theme","textColor":"#000000","backgroundColor":"#ffffff","borderColor":"#626262","intervalLength":"2","intervalUnit":"secs","startTimerAtOpen":false,"startTimerAtLeave":true,"stopTimerAtEnter":true,"name":"msgBased","x":410,"y":1615,"wires":[["4b103b82.d5f934"]]},{"id":"84e3502f.6ee37","type":"function","z":"9d52d40a.a63668","name":"$state watchdog","func":"// -------------------------------------------------------------------\n// this function provides a timeOut function to emulate the LWT functionality\n// for $state=\"lost\". on every received msg.state.$state it resets the timer\n// if the timer runs out it issues msg.state.$state=\"lost\" and a message to \n// the extra filed msg.state.resetReason\n// can be configured by:\n// msg.state.interval in seconds\n// -------------------------------------------------------------------\n\nif (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\")) {\n    switch (msg.payload.command) {\n        case \"deleteTable\":\n            let lostTimers = context.get(\"lostTimers\") || {};\n            Object.keys(lostTimers).forEach((key,index) => {\n                clearTimeout(lostTimers[key].timer);\n            });\n            context.set(\"lostTimers\",undefined);\n            node.status({fill:\"yellow\",shape:\"dot\",text:\"All timers deleted\"});\n            node.warn(\"[$state watchdog] All timers deleted\");\n            return msg;\n    }\n}\n\nvar timeout=120     // in seconds (set to 0 if you want to disable this feature)\nvar graceTime=60    // give a little extra to avoid false alarms\n\nvar status={fill:\"red\",shape:\"dot\",text:\"\"};\nif (msg.hasOwnProperty(\"state\") && msg.state.hasOwnProperty(\"interval\")) {\n    if (!Number.isNaN(Number(msg.state.interval))) {\n        timeout=Number(msg.state.interval); //*1.5 \n    } else {\n        status.text=\"[$state watchdog] msg.state.interval is NaN\";\n        node.error([status.text,msg]);\n        node.status(status);\n        return msg;\n    }\n}\nvar resetReason=\"device lost! No refresh the last \"+timeout+\"sec\"\n\n// ------------------------------------------------------\n// emulate timeout for $state=\"lost\"\n// ------------------------------------------------------\nfunction mqttTimeout(arg) {\n    arg.node.send(arg.msg);\n}\n    \nif (timeout>0 && msg.hasOwnProperty(\"topic\")) {\n    // we have to keep track on existing timers\n    let lostTimers = context.get(\"lostTimers\"); // allways memoryOnly as the timers do not extist after restart\n    if (lostTimers===undefined) {\n        lostTimers={};\n        context.set(\"lostTimers\",lostTimers);\n    }\n    if (lostTimers.hasOwnProperty(msg.topic)) { // timer exists so clear it first\n        clearTimeout(lostTimers[msg.topic].timer);\n    }\n    if (!lostTimers.hasOwnProperty(msg.topic)) lostTimers[msg.topic]={};\n    lostTimers[msg.topic].timeout=timeout;\n    lostTimers[msg.topic].timer=setTimeout(mqttTimeout+graceTime, timeout*1000, \n        {\n            \"node\":node,\n            \"msg\":{\n                \"topic\":msg.topic,\n                \"state\":{\n                    \"$state\":\"lost\",\n                    \"resetReason\":resetReason\n                }\n                \n            }\n        }\n    );\n    node.status({fill:\"green\",shape:\"dot\",text:msg.topic+\"=\"+timeout+\"s\"});\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":386,"y":765,"wires":[["9d9d213d.09396"]],"icon":"node-red/swap.svg","info":"# msg.state.$state watchdog\n## decription\nthis function provides a timeOut function (watchdog) to emulate the LWT functionality\nissueing $state=\"lost\" if a device did not update in time. \non every received msg.state.$state it resets the timer\nif the timer runs out it issues `msg.state.$state=\"lost\"` and a message to \nthe extra filed `msg.state.resetReason`\n\nyou can find more about the [homie convention device lifecyle here](https://homieiot.github.io/specification/#device-lifecycle).\n\n## how to use\n- place it in the main plugin list if you like to have a watchdog for every device with the same timeout\n- place it after a translator / data source if only some devices need a watchdog because they do not supprt mqtt LWT or similar techniques to detect offline devices and set the msg.state.$state correcty over the complete lifecycle.\n- place diffent watchdogs in the aquisition area behind translators if you need **individual timeout durations**.\n- edit the `timeout` variable in the code or\n- send msg.state.interval to set individual timeout by message\n\n## do do / issues\n- have to find out if a clearTimeout / setTimeout on every message is the most efficient way.\n- perhaps own code with one interval timer more efficient for a bigger number of devices\n\n## homie features\n- `$state` *string* current state of the device\n- `interval` *integer* in sec \n\n## extended features\n- `resetReason` *string* description that the device was flaged by the watchdog"},{"id":"f246c2d4.aa89c","type":"function","z":"9d52d40a.a63668","name":"build column menu","func":"msg.menu=[\n    {\n        \"text\": \"update devices\",\n        \"icon\": \"fa-undo\",\n        \"enabled\": true,\n        \"topic\": \"updateDevices\",\n    },\n    {\n        \"text\": \"---\"\n    },\n    {\n        \"text\": \"hide column\",\n        \"icon\": \"fa-minus-square\",\n        \"enabled\": true,\n        \"topic\": \"columnHide\",\n    },\n    {\n        \"text\": \"unhide column\",\n        \"icon\": \"fa-minus-square-o\",\n        \"enabled\": (msg.hiddenColumns.length>0) ? true : false,\n        \"sub\": msg.hiddenColumns\n    },\n    {\n        \"text\": \"unhide all columns\",\n        \"icon\": \"fa-minus-square\",\n        \"enabled\": true,\n        \"topic\": \"columnsUnHide\",\n    },\n    {\n        \"text\": \"---\"\n    },\n    {\n        \"text\": \"restore column order\",\n        \"icon\": \"fa-sort fa-rotate-90\",\n        \"enabled\": true,\n        \"topic\": \"restoreColumnOrder\"\n    },\n    {\n        \"text\": \"reset column width\",\n        \"icon\": \"fa-arrows-h\",\n        \"enabled\": true,\n        \"topic\": \"resetColumnWidth\"\n    },\n    {\n        \"text\": \"rersponsive layout\",\n        \"icon\": \"fa-mobile\",\n        \"enabled\": true,\n        \"topic\": \"setResponsiveLayout\"\n    },\n    {\n        \"text\": \"refresh table\",\n        \"icon\": \"fa-recycle\",\n        \"enabled\": true,\n        \"topic\": \"refreshTable\"\n    },\n    {\n        \"text\": \"clear table\",\n        \"icon\": \"fa-trash\",\n        \"enabled\": true,\n        \"topic\": \"deleteTable\"\n    }\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":379,"y":1564,"wires":[["430f3c7c.5622d4","90341f51.c352c"]]},{"id":"c9b41f12.1c433","type":"link in","z":"9d52d40a.a63668","name":"Plugins","links":["677977e5.f274b8","9cd8d3a8.dbb3d","9e278daa.10534","fd874c09.b60e4"],"x":134,"y":816,"wires":[["9d9d213d.09396"]]},{"id":"f9962a15.0fb1e8","type":"comment","z":"9d52d40a.a63668","name":"callbacks & context menus","info":"","x":229,"y":1411,"wires":[]},{"id":"7c3afb42.1732b4","type":"comment","z":"9d52d40a.a63668","name":"ui-tabel","info":"","x":169,"y":1190,"wires":[]},{"id":"b075d2ac.a69f3","type":"ui_table","z":"292ca715.a2db08","group":"237da972.5d69a6","name":"","order":0,"width":"17","height":"9","columns":[{"field":"id","title":"id`s","width":"","align":"right","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"timestamp","title":"Timestamp","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"text","title":"Text","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":866,"y":425,"wires":[["588f316.0b070d","76c4495f.da70f8"]]},{"id":"f8a9323b.fedf4","type":"inject","z":"292ca715.a2db08","name":"add @ top","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":323,"wires":[["eb577b4b.510388"]]},{"id":"b54f6ce8.3b1a4","type":"debug","z":"292ca715.a2db08","name":"addRow","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":451,"y":425,"wires":[]},{"id":"eb577b4b.510388","type":"function","z":"292ca715.a2db08","name":"addRow @ top","func":"var id=flow.get(\"lastId\") || 0;\n++id;\nmsg.payload={\n    command:\"addRow\",\n    arguments: [\n        [\n            {\n            \"id\":id,\n            \"timestamp\":msg.payload,\n            \"text\":\"addRow @ top (#\"+id+\")\"\n            }\n        ],\n        true\n    ],\n    returnPromise: true\n}\nflow.set(\"lastId\",id);\nreturn msg;","outputs":1,"noerr":0,"x":471,"y":289,"wires":[["b54f6ce8.3b1a4","b075d2ac.a69f3"]],"info":"# addRow([row],onTop)\n\n`onTop=true`\n\nadds a new Row on top of the table"},{"id":"588f316.0b070d","type":"debug","z":"292ca715.a2db08","name":"response from ui-table","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1171,"y":425,"wires":[]},{"id":"12606591.7a3dca","type":"inject","z":"292ca715.a2db08","name":"Init 20 rows","topic":"","payload":"20","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":153,"wires":[["d4dce9b4.1f2588"]]},{"id":"d4dce9b4.1f2588","type":"function","z":"292ca715.a2db08","name":"table with n rows as array","func":"var numberOfRows = msg.payload;\nflow.set(\"lastId\",numberOfRows);\nmsg.payload=[];\nfor (let i=1; i<=numberOfRows; i++) {\n    msg.payload.push({\"id\":i,\"timestamp\":Date.now(),\"text\":\"It's line\"+i})\n}\nreturn msg;","outputs":1,"noerr":0,"x":501,"y":119,"wires":[["b075d2ac.a69f3","f9bfd98.abe1a28","76c4495f.da70f8"]]},{"id":"8254f2d2.eeaa1","type":"function","z":"292ca715.a2db08","name":"updateOrAddData (add)","func":"var id=flow.get(\"lastId\") || 0;\n++id;\nmsg.payload={\n    command:\"updateOrAddData\",\n    arguments: [\n        [\n            {\n            \"id\":id,\n            \"timestamp\":msg.payload,\n            \"text\":\"updateOrAddData (add) (#\"+id+\")\"\n            }\n        ]\n    ],\n    returnPromise: true\n}\nflow.set(\"lastId\",id);\nreturn msg;","outputs":1,"noerr":0,"x":501,"y":476,"wires":[["570e922d.1d465c","b075d2ac.a69f3"]],"info":"# updateOrAddData([row])\n\nadds a the row with a new id (same as addRow)"},{"id":"cbd6baa0.fa7d78","type":"inject","z":"292ca715.a2db08","name":"add","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":510,"wires":[["8254f2d2.eeaa1"]]},{"id":"570e922d.1d465c","type":"debug","z":"292ca715.a2db08","name":"updateOrAddData","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":481,"y":595,"wires":[]},{"id":"782ab41e.cbb66c","type":"inject","z":"292ca715.a2db08","name":"add @ end","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":408,"wires":[["760fde70.028f"]]},{"id":"760fde70.028f","type":"function","z":"292ca715.a2db08","name":"addRow @ end","func":"var id=flow.get(\"lastId\") || 0;\n++id;\nmsg.payload={\n    command:\"addRow\",\n    arguments: [\n        [\n            {\n            \"id\":id,\n            \"timestamp\":msg.payload,\n            \"text\":\"addRow @ end (#\"+id+\")\"\n            }\n        ],\n        false\n    ],\n    returnPromise: true\n}\nflow.set(\"lastId\",id);\nreturn msg;","outputs":1,"noerr":0,"x":471,"y":374,"wires":[["b54f6ce8.3b1a4","b075d2ac.a69f3"]],"info":"# addRow([row],onTop)\n\n`onTop=false`\n\nadds a new Row on top of the table"},{"id":"deeff963.289f08","type":"function","z":"292ca715.a2db08","name":"updateOrAddData (update)","func":"var id=flow.get(\"lastId\") || 0;\nif (id<2) {\n    node.error(\"use only if minimum of 2 Lines existing!\")\n    return;\n}\n\nid=Math.floor(id/2); //\nmsg.payload={\n    command:\"updateOrAddData\",\n    arguments: [\n        [\n            {\n            \"id\":id,\n            \"timestamp\":msg.payload,\n            \"text\":\"updateOrAddData (update) (#\"+id+\")\"\n            }\n        ]\n    ],\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"x":511,"y":544,"wires":[["570e922d.1d465c","b075d2ac.a69f3"]],"info":"# updateOrAddData([row])\n\nupdates a the row with an id in the middle from 1 to lastId, hope it exists!\nIf not a row will be added"},{"id":"557e109d.f9d7e","type":"comment","z":"292ca715.a2db08","name":"update ui-table by passing the complete tableData as array","info":"","x":363,"y":68,"wires":[]},{"id":"6a095f36.8f13a","type":"comment","z":"292ca715.a2db08","name":"update ui-table by using commands","info":"","x":293,"y":238,"wires":[]},{"id":"f08308d6.c66f68","type":"inject","z":"292ca715.a2db08","name":"update","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":578,"wires":[["deeff963.289f08"]]},{"id":"77b4d006.543ed","type":"function","z":"292ca715.a2db08","name":"deleteRow","func":"var id=flow.get(\"lastId\") || 0;\nif (id<2) {\n    node.error(\"use only if minimum of 2 Lines existing!\")\n    return;\n}\n\nid=Math.floor(id/2); //\nmsg.payload={\n    command:\"deleteRow\",\n    arguments: [id],\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"x":461,"y":697,"wires":[["e34a75a3.9f0188","b075d2ac.a69f3"]],"info":"# deleteRow(row / [rows])\n\n`row=singleId`\n\nor\n\n`row=[array of IDs]` // seems there is a bug/issue in tabulator\n\ndelete a single the row with an id in the middle from 1 to lastId, hope it exists.\n\nWill fail on the second hit if you inject this two times because the id wad deleteted on the first"},{"id":"936c8219.458bc","type":"inject","z":"292ca715.a2db08","name":"delete","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":731,"wires":[["77b4d006.543ed"]]},{"id":"e34a75a3.9f0188","type":"debug","z":"292ca715.a2db08","name":"deleteRow","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":461,"y":816,"wires":[]},{"id":"fafa24f8.577d28","type":"comment","z":"292ca715.a2db08","name":"deleteRow will punch holes in table!","info":"","x":293,"y":646,"wires":[]},{"id":"f9bfd98.abe1a28","type":"debug","z":"292ca715.a2db08","name":"addRow","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":451,"y":170,"wires":[]},{"id":"76c4495f.da70f8","type":"function","z":"292ca715.a2db08","name":"table recorder","func":"var status = {fill:\"red\",shape:\"ring\",text:\"an error occured\"};\nvar success = (msg.topic && msg.topic===\"success\") || false;\nvar tableData = flow.get(\"tableData\");\nif (tableData === undefined) {\n    tableData = [];\n    flow.set(\"tableData\",tableData);\n}\n\n// find the index for a row in tableData for a given index (id)\nfunction checkIndex(id) {\n    let matchRow=-1\n    tableData.forEach(function (row,index){\n        if (row.id === id){\n            matchRow=index;\n            return matchRow;\n        }\n    })\n    return matchRow;\n}\n\n// flat merge one row \nfunction mergeRow(dest,source) {\n    Object.keys(source).forEach(function(key) {\n        dest[key]=source[key];\n    })\n}\n\n//merge or add one or many rows into tableData \nfunction mergeData(newData,toTop) {\n    newData.forEach(function (item,index) {\n        node.warn([\"findIndex\",item]);\n        let row=checkIndex(item.id);\n        if (row<0) { // row do not existst in tableData\n            if (toTop) {\n                tableData.push(item);\n                status.text+=\"newRow @ top\";\n            } else {\n                tableData.unshift(item);\n                status.text+=\"newRow @ bottom\";\n            }\n            return;\n        } else { // row exists so update\n            mergeRow(tableData[row],item);\n            status.text+=\"row updated\";\n            return;\n        }\n        if (status.text!==\"\") node.status(status);\n    });\n}\n\nswitch (typeof msg.payload){\n    case \"string\":\n        node.warn([\"[table recorder] \",(typeof msg.payload),msg.payload]);\n        switch (msg.payload){\n            case \"change\":\n                status={fill:\"green\",shape:\"dot\",text:\"table restored \"+tableData.length+\" rows\"};\n                msg.payload=tableData;\n                break;\n        }\n        break;\n    case \"object\":\n        node.warn([\"[table recorder] \",(typeof msg.payload),msg.payload]);\n        if (Array.isArray(msg.payload)) { // replace all tableData\n            status={fill:\"green\",shape:\"dot\",text:\"table replaced \"+msg.payload.length+\" rows\"};\n            tableData=RED.util.cloneMessage(msg.payload); \n        } else {\n            switch (msg.payload.command) { // clearData does not return a promise!\n                case \"clearData\":\n                    status={fill:\"green\",shape:\"dot\",text:\"clearData: done\"};\n                    tableData=[];\n                    flow.set(\"lastId\",0);\n                    break;                \n            }\n        }\n        break;\n    default: // likely a msg fom a ui-table command or callback\n        if (msg.hasOwnProperty(\"topic\")&&\n            msg.hasOwnProperty(\"ui_control\") && \n            msg.ui_control.hasOwnProperty(\"callback\") &&\n            msg.hasOwnProperty(\"return\")) { // message originates from a ui-table callback\n            if (success) {\n                switch(msg.return.command) {\n                    case \"addRow\":\n                        status.text=\"addRow: \";\n                        mergeData(msg.return.arguments[0],msg.return.arguments[1]);\n                        status.shape=\"dot\";\n                        break;\n                    case \"updateOrAddData\":\n                        status.text=\"updateOrAddData: \";\n                        mergeData(msg.return.arguments[0]);\n                        break;\n                    case \"deleteRow\":\n                        let row=checkIndex(msg.return.arguments[0]);\n                        tableData.splice(row,1);\n                        status.shape=\"dot\";\n                        status.text=\"deleteRow: \"+row+\" deleted\";\n                        break;\n                    default:\n                        status={fill:\"yellow\",shape:\"dot\",text:msg.return.command + \" unknown!\"};\n                        break;         \n                }\n            } else {\n                status.text=msg.topic+\" \"+msg.error;\n            }\n        }\n        break;\n}\nif (success) status.fill=\"green\";\nflow.set(\"tableData\",tableData);\nnode.status(status);\nreturn msg;","outputs":1,"noerr":0,"x":1151,"y":493,"wires":[["b075d2ac.a69f3"]],"icon":"font-awesome/fa-database","info":"# simple ui-table handler\n## abstract\nUsing ui-table with commands offer the hole flexibilty of tabulator. The table can be manipulated down to cell level.\nAs the ui-table node only passes the commands to tabulator and receives promises back the node does not hold the table data. If the data should be available after refresh, tab change, new connections the flow is responsible to cache the data and all the manipulations.\nThis node takes care of most simple data manipulation commands and holds a copy of the data in `flow.context.tabledata`\n\n## details\n\n### row index (id)\n\nTo identify a [row a index](http://tabulator.info/docs/4.5/data#overview) column has to be defined. This colum defaults to `id` but can be changed by specifing a **field** by using `msg.ui_control`. In this example the row index is a simple counter adding up by one if a new line is added.\n\n### addRow command\n\n[details @ tabulator addRow docs](http://tabulator.info/docs/4.5/update#alter-add)\n\nYou can add a row by sending the `addRow` command. You can decide if the row adds on the top or at the bottom of table.\n\n### addOrUpdate command\n\n[details @ tabulator addOrUpdate docs](http://tabulator.info/docs/4.5/update#alter-update)\n\nTo update data the best way is to use the `addOrUpdate` command. If the row indetified by the index is not exeisting a new row will be added automatically\n\n### deleteRow command\n\n[details @ tabulator deleteRow docs](http://tabulator.info/docs/4.5/update#row)\n\nDelete one or more rows (passing an array always results in \"row not found error\"! I think there is an issue in tabulator)\n\n### clearData\n\n[details @ tabulator clearData docs](http://tabulator.info/docs/4.5/update#alter-empty)\n\nunfortunately this command (currently) do not send a promise back! So we have to pass it directly to the table handler"},{"id":"7b1c27f4.36a718","type":"ui_ui_control","z":"292ca715.a2db08","name":"","events":"all","x":876,"y":493,"wires":[["76c4495f.da70f8"]]},{"id":"8b79840b.aff7e8","type":"inject","z":"292ca715.a2db08","d":true,"name":"delete 1-5","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":765,"wires":[["fee8b78d.068f98"]]},{"id":"fee8b78d.068f98","type":"function","z":"292ca715.a2db08","d":true,"name":"delete Rows [2,4,6,8,10]","func":"var id=flow.get(\"lastId\") || 0;\nif (id<10) {\n    node.error(\"use only if minimum of 10 Lines existing!\")\n    return;\n}\n\nid=Math.floor(id/2); //\nmsg.payload={\n    command:\"deleteRow\",\n    arguments: [[2,4,6,8,10]],\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"x":501,"y":765,"wires":[["b075d2ac.a69f3","e34a75a3.9f0188"]],"info":"# deleteRow(row / [rows])\n\n`row=singleId`\n\nor\n\n`row=[array of IDs]` // seems there is a bug/issue in tabulator\n\ndelete a single the row with an id in the middle from 1 to lastId, hope it exists.\n\nWill fail on the second hit if you inject this two times because the id wad deleteted on the first"},{"id":"fe4ba122.df8fb","type":"function","z":"292ca715.a2db08","name":"clearData","func":"\nmsg.payload={\n    command:\"clearData\",\n    arguments: [],\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"x":451,"y":935,"wires":[["6e49e266.f72b6c","b075d2ac.a69f3","76c4495f.da70f8"]],"info":"# clear data\n\nunfortunately this command (currently) do not send a promise back! So we have to pass it directly to the table handler"},{"id":"82194704.7ab2d8","type":"inject","z":"292ca715.a2db08","name":"clear","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":969,"wires":[["fe4ba122.df8fb"]]},{"id":"df623146.8270a","type":"comment","z":"292ca715.a2db08","name":"Erase all data by using clearData command","info":"","x":323,"y":884,"wires":[]},{"id":"6e49e266.f72b6c","type":"debug","z":"292ca715.a2db08","name":"clearData","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":451,"y":986,"wires":[]},{"id":"d404def3.39a63","type":"inject","z":"292ca715.a2db08","name":"change","topic":"","payload":"change","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":866,"y":561,"wires":[["76c4495f.da70f8"]]},{"id":"36be75f0.115c6a","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":1,"width":0,"height":0,"passthru":false,"label":"Init 20 rows","tooltip":"init table by passing the hole table array (default way)","color":"","bgcolor":"","icon":"","payload":"20","payloadType":"num","topic":"","x":240,"y":119,"wires":[["d4dce9b4.1f2588"]]},{"id":"b496aa6a.32f2d8","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":2,"width":0,"height":0,"passthru":false,"label":"add one row @ top","tooltip":"add a new row to the top","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":260,"y":289,"wires":[["eb577b4b.510388"]]},{"id":"79d05aaa.e2c7d4","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":3,"width":0,"height":0,"passthru":false,"label":"add one row @ end","tooltip":"add a new row at the end ","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":260,"y":374,"wires":[["760fde70.028f"]]},{"id":"d37bf3a8.373dd","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":4,"width":0,"height":0,"passthru":false,"label":"addOrUpdate (add)","tooltip":"add a new row by passing a new id","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":260,"y":476,"wires":[["8254f2d2.eeaa1"]]},{"id":"d31c2ac7.05bed8","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":5,"width":0,"height":0,"passthru":false,"label":"addOrUpdate (update)","tooltip":"update the row in the middle (or add if a row with that id not exists)","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":270,"y":544,"wires":[["deeff963.289f08"]]},{"id":"c637efb3.9c38c","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":6,"width":0,"height":0,"passthru":false,"label":"delete (middle)","tooltip":"delate the row with the id=maxId/2. Will result an error if not existing","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":250,"y":697,"wires":[["77b4d006.543ed"]]},{"id":"5531f2d0.fb913c","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":7,"width":0,"height":0,"passthru":false,"label":"clear","tooltip":"clear all table data","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":220,"y":935,"wires":[["fe4ba122.df8fb"]]},{"id":"858a6bc2.0384e8","type":"ui_text","z":"292ca715.a2db08","group":"c91332c0.50c11","order":9,"width":0,"height":0,"name":"","label":"status","format":"{{status.text}}","layout":"col-center","x":1036,"y":731,"wires":[]},{"id":"213d641a.12a53c","type":"status","z":"292ca715.a2db08","name":"","scope":["76c4495f.da70f8"],"x":875,"y":731,"wires":[["858a6bc2.0384e8"]]},{"id":"e7d10007.d6e73","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":8,"width":0,"height":0,"passthru":false,"label":"refresh (change)","tooltip":"Same as ui-control sending a change message","color":"","bgcolor":"","icon":"","payload":"change","payloadType":"str","topic":"","x":896,"y":527,"wires":[["76c4495f.da70f8"]]},{"id":"8386c3a7.41ead","type":"inject","z":"292ca715.a2db08","name":"format table","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":1122,"wires":[["8ae898e7.418068"]]},{"id":"f59e9830.e23608","type":"comment","z":"292ca715.a2db08","name":"Format Table using ui_control","info":"","x":273,"y":1037,"wires":[]},{"id":"19e88f0.0c32071","type":"debug","z":"292ca715.a2db08","name":"clearData","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":451,"y":1139,"wires":[]},{"id":"ea064e3c.22437","type":"ui_button","z":"292ca715.a2db08","name":"","group":"c91332c0.50c11","order":7,"width":0,"height":0,"passthru":false,"label":"format table","tooltip":"Formats the table using msg.ui_control","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":240,"y":1088,"wires":[["8ae898e7.418068"]]},{"id":"8ae898e7.418068","type":"change","z":"292ca715.a2db08","name":"","rules":[{"t":"set","p":"ui_control","pt":"msg","to":"{\"customHeight\":18,\"tabulator\":{\"layout\":\"fitColumns\",\"movableColumns\":false,\"index\":\"id\",\"columns\":[{\"title\":\"ID\",\"field\":\"id\",\"formatter\":\"text\",\"headerTooltip\":\"id number act as row index\"},{\"formatterParams\":{\"outputFormat\":\"HH:mm:ss.SSS\",\"inputFormat\":\"x\",\"invalidPlaceholder\":\"(unknown)\"},\"title\":\"Timestamp\",\"field\":\"timestamp\",\"formatter\":\"datetime\",\"headerTooltip\":\"timestamp of last change\"},{\"title\":\"Text\",\"field\":\"text\",\"headerTooltip\":\"last cause of reboot (provided by http json request)\"}]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":481,"y":1088,"wires":[["19e88f0.0c32071","b075d2ac.a69f3","6bd61b7.a6a56e4"]]},{"id":"6bd61b7.a6a56e4","type":"change","z":"292ca715.a2db08","name":"change","rules":[{"t":"delete","p":"ui_control","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"change","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":689,"y":1088,"wires":[["76c4495f.da70f8"]]},{"id":"5bf60e7.23625f","type":"function","z":"9d52d40a.a63668","name":"build row menu","func":"msg.menu=[\n    {\n        \"text\": \"update device\",\n        \"icon\": \"fa-undo\",\n        \"enabled\": true,\n        \"topic\": \"updateDevice\",\n    },\n    {\n        \"text\": \"---\"\n    },\n    {\n        \"text\": \"delete device\",\n        \"icon\": \"fa-trash\",\n        \"enabled\": true,\n        \"topic\": \"deleteDevice\",\n    },\n    {\n        \"text\": \"ignore device\",\n        \"icon\": \"fa-minus-square-o\",\n        \"enabled\": true,\n        \"topic\": \"ignoreDevice\",\n    },\n    {\n        \"text\": \"unignore devices\",\n        \"icon\": \"fa-plus-square-o\",\n        \"enabled\": (msg.ignoredDevices.length>0) ? true : false,\n        \"sub\": msg.ignoredDevices\n    },\n    {\n        \"text\": \"unignore all devices\",\n        \"icon\": \"fa-plus-square\",\n        \"enabled\": true,\n        \"topic\": \"unIgnoreDevices\",\n    },\n    {\n        \"text\": \"---\"\n    },\n    {\n        \"text\": \"refresh table\",\n        \"icon\": \"fa-recycle\",\n        \"enabled\": true,\n        \"topic\": \"refreshTable\"\n    },\n    {\n        \"text\": \"clear table\",\n        \"icon\": \"fa-trash\",\n        \"enabled\": true,\n        \"topic\": \"deleteTable\"\n    }\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":369,"y":1462,"wires":[["19e8fb55.948665","4b6a4466.69800c"]]},{"id":"19e8fb55.948665","type":"ui_context_menu","z":"9d52d40a.a63668","group":"3e8e6acd.3587c6","order":1,"width":0,"height":-1,"fontSize":16,"position":"msg","outputField":"payload","xCoordinate":"500","yCoordinate":"450","menu":"msg","menuItems":[{"id":"2","icon":"fa-plus-square","label":"unhide all columns","topic":"columnsUnHide","payload":"","payloadType":"str","visible":true,"enabled":true},{"id":"3","icon":"fa-recycle","label":"refresh Table","topic":"refreshTable","payload":"","payloadType":"str","visible":true,"enabled":true},{"id":"4","icon":"fa-table","label":"delete table","topic":"deleteTable","payload":"","payloadType":"str","visible":true,"enabled":true}],"colors":"theme","textColor":"#000000","backgroundColor":"#ffffff","borderColor":"#626262","intervalLength":"2","intervalUnit":"secs","startTimerAtOpen":false,"startTimerAtLeave":true,"stopTimerAtEnter":true,"name":"msgBased","x":410,"y":1513,"wires":[["418512d5.1f8b6c"]]},{"id":"f28d6d58.f27d8","type":"debug","z":"9d52d40a.a63668","name":"ccuOut","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":332,"y":663,"wires":[]},{"id":"b4f3194a.c9e198","type":"debug","z":"9d52d40a.a63668","name":"ccuOut translated","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":634,"y":663,"wires":[]},{"id":"e917f701.848748","type":"debug","z":"9d52d40a.a63668","name":"httpOut translated","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1059,"y":544,"wires":[]},{"id":"d96e0b5b.ae6ae8","type":"debug","z":"9d52d40a.a63668","name":"json in (mqtt)","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":444,"y":408,"wires":[]},{"id":"f73e708e.f0b8","type":"debug","z":"9d52d40a.a63668","name":"json translated","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":709,"y":408,"wires":[]},{"id":"5e8155d9.d2b8bc","type":"debug","z":"9d52d40a.a63668","name":"simple mqtt","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":801,"y":340,"wires":[]},{"id":"f6956de0.9b59d","type":"debug","z":"9d52d40a.a63668","name":"homie device","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":631,"y":221,"wires":[]},{"id":"52619ce0.5df084","type":"debug","z":"9d52d40a.a63668","name":"homie state","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":444,"y":34,"wires":[]},{"id":"2074fe0f.a481a2","type":"debug","z":"9d52d40a.a63668","name":"to ui_table handler","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":600,"y":1122,"wires":[]},{"id":"6f074131.3df08","type":"debug","z":"9d52d40a.a63668","name":"clicked on cell","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":998,"y":1190,"wires":[]},{"id":"ab78269b.859828","type":"link in","z":"9d52d40a.a63668","name":"callbacksIn","links":["69cccd2b.cae4c4"],"x":66,"y":1530,"wires":[["e6740516.9b1688","620ab579.114dbc"]]},{"id":"69cccd2b.cae4c4","type":"link out","z":"9d52d40a.a63668","name":"callbacksOut","links":["ab78269b.859828"],"x":576,"y":1343,"wires":[]},{"id":"b6f10d4c.dde98","type":"debug","z":"9d52d40a.a63668","name":"colCommand","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":801,"y":1649,"wires":[]},{"id":"7f8fa749.5b4478","type":"debug","z":"9d52d40a.a63668","name":"table callback","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":998,"y":1224,"wires":[]},{"id":"85c3998c.c6d768","type":"debug","z":"9d52d40a.a63668","name":"to ui-table","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":621,"y":1275,"wires":[]},{"id":"61b6cd67.e87d74","type":"debug","z":"9d52d40a.a63668","name":"rowCommand","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":811,"y":1411,"wires":[]},{"id":"620ab579.114dbc","type":"debug","z":"9d52d40a.a63668","name":"callback","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":179,"y":1598,"wires":[]},{"id":"f805d1d2.b99ea","type":"function","z":"9d52d40a.a63668","name":"extract IP form msg.topic","func":"if (msg.hasOwnProperty(\"topic\")) {\n    let topicSplitted=msg.topic.split('/');\n    for (let i=0; i<topicSplitted.length; i++) {\n        let partSplitted=topicSplitted[i].split('.');\n        if (partSplitted.length===4) {\n            let ipSplitted=topicSplitted[i].split(':');\n            msg.payload=ipSplitted[0];\n            node.status({fill:\"green\",shape:\"dot\",text:\"request:\"+msg.payload});\n            return msg;\n        }\n    }\n}\nnode.status({fill:\"red\",shape:\"dot\",text:\"noIP found:\"+msg.topic});","outputs":1,"noerr":0,"x":246,"y":1802,"wires":[[]]},{"id":"7557f75b.5e7358","type":"comment","z":"9d52d40a.a63668","name":"Toolbox","info":"","x":169,"y":1751,"wires":[]},{"id":"edbc167b.5a5748","type":"ui_toast","z":"9d52d40a.a63668","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"OK / Cancel","x":1226,"y":1598,"wires":[["710ae3ea.b5244c"]]},{"id":"6a44f1d4.72a75","type":"function","z":"fd36bbc4.fe50d8","name":"confirm","func":"var status={fill:\"\",shape:\"dot\",text:\"\"};\nif (msg!==undefined && !msg.hasOwnProperty(\"dialogHelperOrgMsg\")) { // no message in queue\n    var dialogMsg={\n        topic:env.get('title'),\n        payload:env.get('message'),\n        socketid:msg.socketid,\n        dialogHelperOrgMsg:RED.util.cloneMessage(msg)\n    };\n    status={fill:\"yellow\",shape:\"dot\",text:\"waiting for response\"};\n    return [{payload:status},dialogMsg,null];\n} else {\n    if (msg.payload===env.get('passPayload')) {\n        status={fill:\"green\",shape:\"dot\",text:\"message passed\"};\n        return [{payload:status},null,msg.dialogHelperOrgMsg];\n    } else {\n        status={fill:\"blue\",shape:\"dot\",text:msg.payload+\" (!\"+env.get('passPayload')+\") message droped\"};\n        return [{payload:status},null,null];\n    }\n}","outputs":3,"noerr":0,"x":196,"y":85,"wires":[[],[],[]],"info":"# OK/Cancel dialog helper function\n\n## description\n\nThis is a little helper to make OK/Cancel dialogs easy to implement inside a data stream\n\n## how it works\n\nIf a message arrives at the **imput** a message dialog box is triggered. The original Message is cloned into `msg.dialogHelperOrgMsg`. If the dialog sends `msg.payload` with the **passPayload** the original message is released on the second output.\n\n## envioment variables\n\n- **title** ***optional** a string displayed on the title of the dialog\n- **message** message to be displayed\n- **passPayload** the `msg.payload` expected on the imput to release to original message."},{"id":"4b6a4466.69800c","type":"debug","z":"9d52d40a.a63668","name":"rowMenu","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":587,"y":1462,"wires":[]},{"id":"90341f51.c352c","type":"debug","z":"9d52d40a.a63668","name":"rowMenu","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":587,"y":1615,"wires":[]},{"id":"82fc1784.d3c078","type":"link in","z":"9d52d40a.a63668","name":"aquire","links":["28af0304.acdeec"],"x":117,"y":119,"wires":[["4a08e633.a96bc8"]]},{"id":"4a08e633.a96bc8","type":"function","z":"9d52d40a.a63668","name":"ask homie for update","func":"var msgOut={};\nswitch (msg.payload.command){\n    case \"updateDevice\":\n        if (msg.topic && msg.topic.includes('/homie/')) { // seams to be a homie message\n            msgOut = {\n                \"topic\":msg.topic,\n                \"broker\":msg.topic.substring(0,msg.topic.indexOf('/homie/')),\n                \"payload\":msg.payload.$name\n            }\n            return msgOut;\n        }\n        break;\n    case \"updateDevices\":\n        msgOut = {\n            \"topic\":msg.topic,\n            \"payload\":\"[any]\"\n        }\n        return msgOut;\n}\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":119,"wires":[["378305fa.cef78a"]]},{"id":"923430d4.60b79","type":"subflow:e0e6e559.8f30d8","z":"9d52d40a.a63668","name":"","env":[],"x":408,"y":493,"wires":[["5b5d7c00.8b9f34"]]},{"id":"8ef78348.73dce","type":"debug","z":"9831cab2.382058","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1136,"y":408,"wires":[]},{"id":"f8f7631f.da37b","type":"link in","z":"5b6fa421.88b5bc","name":"setLight","links":["1581eb1f.859c75","f669e0e2.6f196","c07b76a5.fce788","9194a4d8.035d58","511d94e8.4e555c","2310ff72.1a31c","8e4d3523.343658","c5450f7d.ea00c"],"x":100,"y":663,"wires":[["e2cfa21e.52558","5cb0ff4c.7b432"]]},{"id":"8c2eab52.6421d8","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Schreibtischleuchte","serviceName":"Lightbulb","topic":"0c2a7b26-5fd6-5e3f-6eec-5295804ba98f","filter":false,"manufacturer":"Node-RED","model":"milight","serialNo":"1002","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n    \"Brightness\":true,\n    \"Hue\":true,\n    \"Saturation\":true\n}","x":702,"y":544,"wires":[["e8cb2f05.2881","89564a3f.9927d8"],[]]},{"id":"e2cfa21e.52558","type":"function","z":"5b6fa421.88b5bc","name":"translate Homekit","func":"var msgOut={\"topic\":msg.property.uuid};\nvar topicSplitted=msg.topic.split('.');\nswitch (topicSplitted[topicSplitted.length-1]) {\n    case 'defaultSwitch':\n        msgOut.payload={\"On\":msg.payload};\n        break;\n    case 'defaultDimmer':\n        msgOut.payload={\"Brightness\":msg.payload};\n        break;\n    case 'defaultColor':\n        msgOut.payload={\"Hue\":msg.payload.h};\n        node.send(msgOut);\n        msgOut.payload={\"Saturation\":msg.payload.s*100};\n        node.send(msgOut);\n        msgOut.payload={\"Brightness\":msg.payload.v*100};\n        break;\n}\nreturn msgOut;","outputs":1,"noerr":0,"x":261,"y":663,"wires":[["422a873b.040d58","4e935af0.2b2e34"]]},{"id":"5a90469f.f195c8","type":"debug","z":"5b6fa421.88b5bc","name":"from Homekit","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1175,"y":595,"wires":[]},{"id":"422a873b.040d58","type":"switch","z":"5b6fa421.88b5bc","name":"by uuid","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"0c2a7b26-5fd6-5e3f-6eec-5295804ba98f","vt":"str"},{"t":"eq","v":"147626f2-d8a9-642b-8de4-24445f521c19","vt":"str"},{"t":"eq","v":"65911eb5-032b-17e9-822e-a2df695f158f","vt":"str"},{"t":"eq","v":"c3f1aab3-d959-4275-fd56-b28b856b6ebf","vt":"str"},{"t":"eq","v":"8a91a9b8-226f-3c0d-fb37-3e490bc714bc","vt":"str"},{"t":"eq","v":"b4b4025b-9a05-b3a3-6e7b-dd81caa15899","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":468,"y":663,"wires":[["8c2eab52.6421d8"],["add140f5.cb0c7"],["e084b2a7.1386e"],["62ece6b.4cfe818"],["cb0b65e.a534798"],["eb09ea1e.8eb028"]],"outputLabels":["Schreibtischleuchte","Nachttischlampe Jomo","Nachttischlampe Chris","Kugel Bad","Kugel Fenster","Stehleuchte"]},{"id":"a58a7bf7.b64008","type":"function","z":"f3635ff.5072da","name":"from Homekit","func":"var path=env.get(\"path\");\nvar contextStore=env.get(\"contextStore\");\nvar status={fill:\"red\",shape:\"dot\",text:\"\"};\nvar msgOut;\nvar currentStatus=flow.get('$parent.'+contextStore.currentStatusName,contextStore.currentStatusStore) || {};\nif (!path) {\n    status.text=\"path must be specified!\";\n    node.error(\"[form homekit] \"+status.text);\n} else {\n    msgOut={\"property\":{}};\n    msgOut.name=msg.name;\n    msgOut.topic=path+\".default\";\n    var topicParts=msgOut.topic.split('.');\n    var currentObject= global.get(topicParts[0],\"file\");\n    var currentProperty=currentObject.getEntry(msgOut.topic,msg.topic);\n    node.warn(currentProperty);\n    //add system information\n    var addLightDevice = function (){\n        msgOut.property.uuid=msg.topic;\n        msgOut.property.system=currentProperty.system;\n        msgOut.property.type=currentProperty.type;\n        msgOut.property.room=currentProperty.room;\n    }\n    \n    if (!currentStatus.hasOwnProperty(msg.topic)) {\n        currentStatus[msg.topic]={\"name\":msg.name,\"defaultSwitch\":false,\"defaultDimmer\":100,\"defaultColor\":{\"h\":0,\"s\":1,\"v\":1}};\n    }\n    let keys=Object.keys(msg.payload);\n    switch (keys[0]){\n        case 'On':\n            msgOut.topic=path+\".defaultSwitch\";\n            currentStatus[msg.topic].defaultSwitch=msg.payload[keys[0]];\n            addLightDevice();\n            status.fill=\"green\";\n            break;\n        case 'Saturation':\n            msgOut.topic=path+\".defaultColor\";\n            currentStatus[msg.topic].defaultColor.s=msg.payload[keys[0]]/100;\n            addLightDevice();\n            status.fill=\"green\";\n            break;\n        case 'Hue':\n            msgOut.topic=path+\".defaultColor\";\n            currentStatus[msg.topic].defaultColor.h=msg.payload[keys[0]];\n            addLightDevice();\n            status.fill=\"green\";\n            break;\n        case 'Brightness':\n            msgOut.topic=path+\".defaultDimmer\";\n            currentStatus[msg.topic].defaultDimmer=msg.payload[keys[0]];\n            currentStatus[msg.topic].defaultColor.v=msg.payload[keys[0]]/100;\n            status.fill=\"green\";\n            break;\n            \n    }\n    msgOut.property=RED.util.cloneMessage(currentStatus[msg.topic]);\n    addLightDevice();\n    status.text=msg.name+\" \"+keys[0]+\":\"+msg.payload[keys[0]];\n    \n    \n}\nflow.set('$parent.'+contextStore.currentStatusName,currentStatus,contextStore.currentStatusStore);\n\nreturn [{payload:status},msgOut];","outputs":2,"noerr":0,"x":206,"y":85,"wires":[[],[]]},{"id":"e8cb2f05.2881","type":"subflow:f3635ff.5072da","z":"5b6fa421.88b5bc","name":"","env":[],"x":988,"y":646,"wires":[["5a90469f.f195c8","2a46f326.e0eb6c"]]},{"id":"89564a3f.9927d8","type":"debug","z":"5b6fa421.88b5bc","name":"HomeKit Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":903,"y":476,"wires":[]},{"id":"5cb0ff4c.7b432","type":"debug","z":"5b6fa421.88b5bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":220,"y":714,"wires":[]},{"id":"4e935af0.2b2e34","type":"debug","z":"5b6fa421.88b5bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":475,"y":833,"wires":[]},{"id":"e084b2a7.1386e","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Nachttischleuchte Chris","serviceName":"Lightbulb","topic":"65911eb5-032b-17e9-822e-a2df695f158f","filter":false,"manufacturer":"Node-RED","model":"milight","serialNo":"1003","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n    \"Brightness\":true,\n    \"Hue\":true,\n    \"Saturation\":true\n}","x":722,"y":646,"wires":[["e8cb2f05.2881"],[]]},{"id":"2a46f326.e0eb6c","type":"link out","z":"5b6fa421.88b5bc","name":"setLight","links":["31915d49.c1d6a2"],"x":1120,"y":646,"wires":[]},{"id":"fedff381.7c035","type":"function","z":"9d52d40a.a63668","name":"$state=\"alarm\" watchdog","func":"// -------------------------------------------------------------------\n// this function provides a timeOut function send an Alarm if configured\n// devices did not send any $state messages\n// On every received msg.state.$state it resets the timer\n// if the timer runs out it issues msg.state.$state=\"alarm\" and a message to \n// the extra filed msg.state.resetReason\n// can be configured by:\n// flow.tableData[deviceId].state.alarmTimeout in seconds\n// -------------------------------------------------------------------\n\nif (msg.hasOwnProperty(\"payload\") && msg.payload.hasOwnProperty(\"command\")) {\n    switch (msg.payload.command) {\n        case \"deleteTable\":\n            let alarmTimers = context.get(\"alarmTimers\") || {};\n            Object.keys(alarmTimers).forEach((key,index) => {\n                clearTimeout(alarmTimers[key].timer);\n            });\n            context.set(\"alarmTimers\",undefined);\n            node.status({fill:\"yellow\",shape:\"dot\",text:\"All timers deleted\"});\n            node.warn(\"[$state=\\\"alarm\\\" watchdog] All timers deleted\");\n            return [msg,null];\n    }\n}\n\nvar timeout=0     // in seconds (set to 0 because this feature should be activated by an msg.state.alarmTimeout)\n\nvar status={fill:\"red\",shape:\"dot\",text:\"\"};\nif (msg.hasOwnProperty(\"state\") && msg.state.hasOwnProperty(\"alarmTimeout\")) {\n    if (!Number.isNaN(Number(msg.state.interval))) {\n        timeout=Number(msg.state.interval);\n    } else {\n        status.text=\"[$state watchdog] msg.state.interval is NaN\";\n        node.error([status.text,msg]);\n        node.status(status);\n        return msg;\n    }\n}\nvar resetReason=\"device in alarm state! No refresh the last \"+timeout+\"sec\"\n\n// ------------------------------------------------------\n// emulate timeout for $state=\"alarm\"\n// ------------------------------------------------------\nfunction mqttTimeout(arg) {\n    arg.node.send([arg.msg,arg.msg]);\n}\n    \nif (timeout>0 && msg.hasOwnProperty(\"topic\")) {\n    // we have to keep track on existing timers\n    let alarmTimers = context.get(\"alarmTimers\"); // allways memoryOnly as the timers do not extist after restart\n    if (alarmTimers===undefined) {\n        alarmTimers={};\n        context.set(\"alarmTimers\",alarmTimers);\n    }\n    if (alarmTimers.hasOwnProperty(msg.topic)) { // timer exists so clear it first\n        clearTimeout(alarmTimers[msg.topic].timer);\n    }\n    if (!alarmTimers.hasOwnProperty(msg.topic)) alarmTimers[msg.topic]={};\n    alarmTimers[msg.topic].timeout=timeout;\n    alarmTimers[msg.topic].timer=setTimeout(mqttTimeout, timeout*1000, \n        {\n            \"node\":node,\n            \"msg\":{\n                \"topic\":msg.topic,\n                \"state\":{\n                    \"$state\":\"alarm\",\n                    \"resetReason\":resetReason\n                }\n                \n            }\n        }\n    );\n    node.status({fill:\"green\",shape:\"dot\",text:msg.topic+\"=\"+timeout+\"s\"});\n}\n\nreturn [msg,null];","outputs":2,"noerr":0,"x":416,"y":867,"wires":[["db94aa7b.554e88"],[]],"icon":"node-red/swap.svg","info":"# msg.state.$state watchdog\n## decription\n* this function provides a timeOut function (watchdog) to emulate the LWT functionality\nissueing $state=\"alarm\" if a device did not update in time. \n* On every received msg.state.$state it resets the timer\n* If the timer runs out it issues `msg.state.$state=\"alarm\"` and a message to \nthe extra filed `msg.state.resetReason`\n* There is no property defined in the homie convention to specify a alarm duration. It is up to the device to set the `$state` to **alarm** but most likely the device is not able to do this because of its alarem condition\n* \n* On the second output the alarm message is branched of to conect to a messaging node\n\nyou can find more about the [homie convention device lifecyle here](https://homieiot.github.io/specification/#device-lifecycle).\n\n## how to use\n- place it in the main plugin list if you like to have a watchdog for every device with the same timeout\n- place it after a translator / data source if only some devices need a watchdog because they do not supprt mqtt LWT or similar techniques to detect offline devices and set the msg.state.$state correcty over the complete lifecycle.\n- place diffent watchdogs in the aquisition area behind translators if you need **individual timeout durations**.\n- edit the `timeout` variable in the code or\n- send msg.state.interval to set individual timeout by message\n\n## do do / issues\n- have to find out if a clearTimeout / setTimeout on every message is the most efficient way.\n- perhaps own code with one interval timer more efficient for a bigger number of devices\n\n## homie features\n- `$state` *string* current state of the device\n- \n\n## extended features\n- `resetReason` *string* description that the device was flaged by the watchdog"},{"id":"710ae3ea.b5244c","type":"subflow:fd36bbc4.fe50d8","z":"9d52d40a.a63668","name":"delete Table?","env":[{"name":"message","value":"Do you realy whant to delete the complete table and all statistics. Cell edits and layout will be preserved.","type":"str"}],"x":1047,"y":1649,"wires":[["edbc167b.5a5748"],["13055b32.2932e5"]]},{"id":"62ece6b.4cfe818","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Kugeln","serviceName":"Lightbulb","topic":"c3f1aab3-d959-4275-fd56-b28b856b6ebf","filter":false,"manufacturer":"Node-RED","model":"milight","serialNo":"1004","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n    \"Brightness\":true,\n    \"Hue\":true,\n    \"Saturation\":true\n}","x":672,"y":697,"wires":[["e8cb2f05.2881"],[]]},{"id":"cb0b65e.a534798","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Kugel","serviceName":"Lightbulb","topic":"8a91a9b8-226f-3c0d-fb37-3e490bc714bc","filter":false,"manufacturer":"Node-RED","model":"milight","serialNo":"1005","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n    \"Brightness\":true,\n    \"Hue\":true,\n    \"Saturation\":true\n}","x":662,"y":748,"wires":[["e8cb2f05.2881"],[]],"info":"# Kugel im Badezimmer\n\n`8a91a9b8-226f-3c0d-fb37-3e490bc714bc`"},{"id":"eb09ea1e.8eb028","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Stehleuchte","serviceName":"Lightbulb","topic":"b4b4025b-9a05-b3a3-6e7b-dd81caa15899","filter":false,"manufacturer":"Node-RED","model":"milight","serialNo":"1006","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n    \"Brightness\":true,\n    \"Hue\":true,\n    \"Saturation\":true\n}","x":682,"y":799,"wires":[["e8cb2f05.2881"],[]]},{"id":"6479f370.46041c","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Thermostat","serviceName":"Thermostat","topic":"320a92fe-bbb8-7e15-ca1d-afa158c9e30b","filter":false,"manufacturer":"homematic","model":"Schlafzimmer","serialNo":"HM-CC-RT-DN.MEQ0447425","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n\"TargetHeatingCoolingState\":1,\t\n\"CurrentHeatingCoolingState\":1,\t\n\"TemperatureDisplayUnits\":0\n}","x":682,"y":935,"wires":[["582b1d92.2a7a54"],[]],"info":"# Thermostat\n\n## Raum\n\nSchlafzimmer\n\n## uuid\n\n320a92fe-bbb8-7e15-ca1d-afa158c9e30b\n\n## Thermostaten\n\nsn MEQ0447425\nuuid 4899c698-363a-217c-8635-83db950c988d"},{"id":"582b1d92.2a7a54","type":"debug","z":"5b6fa421.88b5bc","name":"HomeKit Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":954,"y":901,"wires":[]},{"id":"10578c30.9951e4","type":"change","z":"292ca715.a2db08","name":"ui_control & placeholder","rules":[{"t":"set","p":"ui_control","pt":"msg","to":"{\"customHeight\":20,\"tabulator\":{\"layout\":\"fitColumns\",\"clipboard\":true,\"clipboardCopySelector\":\"table\",\"clipboardCopyStyled\":false,\"clipboardPasteAction\":\"function(rowData){     this.send({ui_control:{callback:'clipboardPasteAction'},payload:rowData});     return this.table.replaceData(rowData); }\",\"columns\":[{\"field\":\"col1\",\"title\":\"Column #1\"},{\"field\":\"col2\",\"title\":\"Column #2\"},{\"field\":\"col3\",\"title\":\"Column #3\"}]}}","tot":"json"},{"t":"set","p":"payload","pt":"msg","to":"[{\"col1\":\"click here & CTRL+v\",\"col2\":\"or click here & CTRL+v\",\"col3\":\"or click here & CTRL+v\"},{\"col1\":\" or on any other cell\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"\",\"col2\":\"\",\"col3\":\"\"},{\"col1\":\"there is a issue with small or empty tables\",\"col2\":\"will be dixed soon\",\"col3\":\"\"},{\"col1\":\"Untill then we have\",\"col2\":\"to fill in some\",\"col3\":\"dummy lines\"}]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1343,"wires":[["6fb2d4f4.eac43c"]]},{"id":"5c86999.9130668","type":"debug","z":"292ca715.a2db08","name":"clipboardPasteAction","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1069,"y":1326,"wires":[]},{"id":"6fb2d4f4.eac43c","type":"ui_table","z":"292ca715.a2db08","group":"113a4af6.0aab85","name":"Copy & Paste","order":1,"width":"17","height":"7","columns":[],"outputs":1,"cts":true,"x":692,"y":1343,"wires":[["f317c99d.59a108"]]},{"id":"bc0947ad.2b9678","type":"function","z":"292ca715.a2db08","name":"clipboardPasteAction Callback","func":"// callback: clipboardPasteAction\n// DO NOT USE IN A FLOW!\n\nclipboardPasteAction = \n// copy from here\nfunction(rowData){\n    this.send({ui_control:{callback:'clipboardPasteAction'},payload:rowData});\n    return this.table.replaceData(rowData);\n}\n// until here\n// use the Visual Editor!\n// paste into ui_table JSON \"clipboardPasteAction\":\"function(....\"\n\n// technical details\n//\n// the example function ends with\n//\n// return this.table.updateData(rows);\n// \n// but that's not updating the data (because it does try to update data through\n// the index field (default \"id\")\n// replaceData simply erase all existing rowData and fills in the pasted data\n// that's what we want","outputs":1,"noerr":0,"x":470,"y":1292,"wires":[[]]},{"id":"81b8cca4.84b34","type":"ui_ui_control","z":"292ca715.a2db08","name":"on tab change","events":"change","x":233,"y":1343,"wires":[["10578c30.9951e4"]]},{"id":"f317c99d.59a108","type":"switch","z":"292ca715.a2db08","name":"","property":"ui_control.callback","propertyType":"msg","rules":[{"t":"eq","v":"clipboardPasteAction","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":866,"y":1343,"wires":[["5c86999.9130668"],["30d6eb93.e18e84"]]},{"id":"b1f43b87.041b68","type":"change","z":"292ca715.a2db08","name":"build replaceData command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t   \"command\":\"replaceData\",\t   \"arguments\":[[msg.payload]]\t\t} \t","tot":"jsonata"},{"t":"delete","p":"ui_control","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":273,"y":1462,"wires":[["48ab9e15.47ef"]]},{"id":"48ab9e15.47ef","type":"debug","z":"292ca715.a2db08","name":"replaceData","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":512,"y":1462,"wires":[]},{"id":"30d6eb93.e18e84","type":"debug","z":"292ca715.a2db08","name":"something else","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1049,"y":1360,"wires":[]},{"id":"4eb0466e.4b6f68","type":"comment","z":"292ca715.a2db08","name":"Copy & Paste (readme)","info":"# copy & paste\n\nYou need only one callback function I included in a separate function note for better readability (do not put this into your flow.\n\nThe change node does the preparation of the table with a `msg.ui_control` object. Because you need minimum one cell to paste into (you can`t paste into an empty table) I put in some dummy data\nIt is not necessary to configure the the table node only tick \"send data on click\" to activate the output.\n\nCTRL-c is working too. It is set to \"table\" (including currently invisble cells) and no styling.\n\n[Detailed documentation of this tabulator feature can be found here.](http://tabulator.info/docs/4.5/clipboard)\n\nBe aware that colum `field` names must match cells of the first row of the pasted data and the is tab \\t and new line \\n formatted, as windows clipboard does. [see here](http://tabulator.info/docs/4.5/clipboard#paste-parser)","x":253,"y":1241,"wires":[]},{"id":"81490ed.dbefcf","type":"ui_toast","z":"292ca715.a2db08","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"OK / Cancel","x":750,"y":1666,"wires":[["75d0de67.72868"]]},{"id":"75d0de67.72868","type":"subflow:fd36bbc4.fe50d8","z":"292ca715.a2db08","name":"dialog helper","env":[{"name":"message","value":"should the message pass?","type":"str"}],"x":563,"y":1717,"wires":[["81490ed.dbefcf"],["1ba5734c.6db50d"]]},{"id":"cbb15f6d.1eacd","type":"inject","z":"292ca715.a2db08","name":"Click and switch to the dashboard","topic":"Let's test this","payload":"Let me pass, please!","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":317,"y":1717,"wires":[["75d0de67.72868"]]},{"id":"1ba5734c.6db50d","type":"debug","z":"292ca715.a2db08","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":1751,"wires":[]},{"id":"a96062f3.3eed5","type":"comment","z":"292ca715.a2db08","name":"OK/Cancel dialog helper (readme)","info":"# OK/Cancel dialog helper\n\n## description\n\nThis is a little helper to make OK/Cancel dialogs easy to implement inside a data stream\n\n## how it works\n\nIf a message arrives at the **imput** a message dialog box is triggered. The original Message is cloned into `msg.dialogHelperOrgMsg`. If the dialog sends `msg.payload` with the **passPayload** the original message is released on the second output.\n\n## configuration\n\n- **Title** ***optional** a string displayed on the title of the dialog\n- **Message** message to be displayed\n- **passPayload** the `msg.payload` expected on the imput to release to original message.","x":293,"y":1649,"wires":[]},{"id":"d2e16b60.d3d4a8","type":"homekit-service","z":"5b6fa421.88b5bc","isParent":true,"bridge":"1f012f45.a13f31","parentService":"","name":"Thermostat","serviceName":"Thermostat","topic":"57ca4364-c304-7274-5ac4-ef21a2e91463","filter":false,"manufacturer":"homematic","model":"Arbeitszimmer","serialNo":"HM-CC-RT-DN.MEQ0451495","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{\n\"TargetHeatingCoolingState\":1,\t\n\"CurrentHeatingCoolingState\":1,\t\n\"TargetTemperature\":true,\n\"CurrentTemperature\":true,\t\n\"TemperatureDisplayUnits\":0\n}","x":682,"y":986,"wires":[["582b1d92.2a7a54"],[]],"info":"# Thermostat\n\n## Raum\n\nArbeitszimmer\n\n## uuid\n\n57ca4364-c304-7274-5ac4-ef21a2e91463\n\n## Thermostaten\n\nsn MEQ0451495\nuuid 399d2e42-6819-98e6-6217-d2952c7c37e1"},{"id":"b01fdb3.2c58d28","type":"subflow:f3635ff.5072da","z":"5b6fa421.88b5bc","name":"","env":[{"name":"path","value":"mySettings.rooms.devices","type":"str"},{"name":"contextStore","value":"{\"mainContext\":\"roomStatus\",\"mainStore\":\"file\"}","type":"json"}],"x":988,"y":969,"wires":[[]]},{"id":"9835e443.367c38","type":"inject","z":"897fdb2a.109f68","name":"on startup","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":138,"y":1156,"wires":[["1730b2a3.663fad"]]},{"id":"66e25acb.666b54","type":"debug","z":"897fdb2a.109f68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":798,"y":1326,"wires":[]},{"id":"1730b2a3.663fad","type":"function","z":"897fdb2a.109f68","name":"add def","func":"msg.homie={\n    \"$name\": \"testThermostat-01\",\n    \"$type\": \"homematic thermostat\",\n    \"$properties\": {\n        \"currentTemperature\":{\n            \"$name\": \"current temperature\",\n            \"$datatype\": \"float\",\n            \"$settable\": false,\n            \"$retained\": false,\n            \"$format\":\"-20:40\",\n            \"$unit\": \"°C\"\n        },\n        \"targetTemperature\":{\n            \"$name\": \"target temperature\",\n            \"$datatype\": \"float\",\n            \"$settable\": true,\n            \"$retained\": true,\n            \"$format\":\"10:28\",\n            \"$unit\": \"°C\"\n        },\n        \"currentValve\":{\n            \"$name\": \"current valve state\",\n            \"$datatype\": \"float\",\n            \"$settable\": false,\n            \"$retained\": false,\n            \"$format\":\"0:100\",\n            \"$unit\": \"%\"\n        }\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"x":383,"y":1156,"wires":[["6dc70796.b65778"]]},{"id":"55c3cda.4436634","type":"inject","z":"897fdb2a.109f68","name":"","topic":"currentTemperature","payload":"18.1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":178,"y":1224,"wires":[["6dc70796.b65778"]]},{"id":"6dc70796.b65778","type":"homie-convention-node","z":"897fdb2a.109f68","broker":"e6a23911.f60378","name":"","nodeId":"testNode","nodeName":"A test Node","nodeType":"Node-RED homie-node","passMsg":true,"autoConfirm":true,"infoHomie":true,"infoError":true,"exposeHomieNodes":true,"homieNodeConfig":"{\n    \"homie\": {\n        \"$name\": \"testNode\",\n        \"$type\": \"A test Node\",\n        \"$properties\": {\n            \"battery\":{\n                \"$name\": \"battery state\",\n                \"$datatype\": \"float\",\n                \"$settable\": false,\n                \"$retained\": true,\n                \"$unit\": \"V\"\n            },\n            \"color\":{\n                \"$name\": \"a color\",\n                \"$datatype\": \"color\",\n                \"$format\": \"hsv\",\n                \"$settable\": true,\n                \"$retained\": true,\n                \"$unit\": \"\"\n            },\n            \"enum\":{\n                \"$name\": \"select\",\n                \"$datatype\": \"enum\",\n                \"$format\": \"Option 1,Option 2,Option 3\",\n                \"$settable\": true,\n                \"$retained\": true,\n                \"$unit\": \"\"\n            }\n            \n        }\n    }\n}","x":631,"y":1326,"wires":[["66e25acb.666b54"]]},{"id":"ef54ff79.e6583","type":"function","z":"ab797823.3396a8","name":"","func":"var currenttime = new Date();\ncurrenttime.setTime((currenttime.getTime()));\nmsg.payload = currenttime.getMinutes();\nvar t1 = currenttime.getMinutes();\nglobal.set('t1',t1);\nreturn msg;\n","outputs":1,"noerr":0,"x":441,"y":204,"wires":[["c4b6bb1.2012048","c5c03b47.5c55b8"]]},{"id":"55925773.d60a28","type":"debug","z":"ab797823.3396a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1158,"y":204,"wires":[]},{"id":"81cf7876.914a98","type":"inject","z":"ab797823.3396a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":291,"y":204,"wires":[["ef54ff79.e6583"]]},{"id":"c4b6bb1.2012048","type":"function","z":"ab797823.3396a8","name":"","func":"var mydate = new Date();\nmydate.setTime(mydate.getTime() + 3*60000);\nmsg.payload = mydate.getMinutes();\nvar t2 = mydate.getMinutes();\nglobal.set('t2',t2);\nreturn msg;","outputs":1,"noerr":0,"x":615,"y":204,"wires":[["8d7d9a02.662068","e62bfa3c.c65aa8"]]},{"id":"8d7d9a02.662068","type":"function","z":"ab797823.3396a8","name":"","func":"var time1 = global.get(\"t1\");\nvar time2 = global.get(\"t2\");\n\n\n    if (time1 < time2) \n\t    {\n\t\tmsg.delay = ((time2 - time1) *60000);\n\t\tmsg.payload = 3;\n\t\treturn msg;\n\t}\n\t//else if (lowerThreshold > upperThreshold) \n\t// {\n\t//\tmsg.payload = \"on\";\n\t//\treturn msg;\n\t//}\n\t//else if (lowerThreshold == upperThreshold) \n\t// {\n\t//\tmsg.payload = \"detener\";\n\t//\treturn msg;\n\t//}","outputs":1,"noerr":0,"x":781,"y":204,"wires":[["40592183.9ec7f","e5f9184d.f7ed48"]]},{"id":"40592183.9ec7f","type":"delay","z":"ab797823.3396a8","name":"Cool down time","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":981,"y":204,"wires":[["55925773.d60a28"]]},{"id":"c5c03b47.5c55b8","type":"debug","z":"ab797823.3396a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":611,"y":255,"wires":[]},{"id":"e62bfa3c.c65aa8","type":"debug","z":"ab797823.3396a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":781,"y":255,"wires":[]},{"id":"e5f9184d.f7ed48","type":"debug","z":"ab797823.3396a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":951,"y":255,"wires":[]},{"id":"5c41d982.f03078","type":"function","z":"ab797823.3396a8","name":"t1=new Date()","func":"msg.t1 = Number(new Date())\nreturn msg;\n","outputs":1,"noerr":0,"x":318,"y":357,"wires":[["7f674d98.9955a4","5f78bcd5.c6b7c4"]]},{"id":"1bbbb5a8.48d48a","type":"debug","z":"ab797823.3396a8","name":"after delay","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1158,"y":357,"wires":[]},{"id":"a8d0ffde.ac8f","type":"inject","z":"ab797823.3396a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":162,"y":357,"wires":[["5c41d982.f03078"]]},{"id":"7f674d98.9955a4","type":"function","z":"ab797823.3396a8","name":"t2=new Date() + 3min","func":"msg.t2 = Number(new Date()) + 3*60000;\nreturn msg;","outputs":1,"noerr":0,"x":559,"y":357,"wires":[["bf03fed1.a94aa","61a6ed69.0b50f4"]]},{"id":"bf03fed1.a94aa","type":"function","z":"ab797823.3396a8","name":"delay t2-t1","func":"    if (msg.t1 < msg.t2) \n\t    {\n\t\tmsg.delay = (msg.t2 - msg.t1);\n\t\tmsg.payload = 3;\n\t\treturn msg;\n\t}\n\t//else if (lowerThreshold > upperThreshold) \n\t// {\n\t//\tmsg.payload = \"on\";\n\t//\treturn msg;\n\t//}\n\t//else if (lowerThreshold == upperThreshold) \n\t// {\n\t//\tmsg.payload = \"detener\";\n\t//\treturn msg;\n\t//}","outputs":1,"noerr":0,"x":801,"y":357,"wires":[["8ae84095.8e3f4","15254258.e0f3ee"]]},{"id":"8ae84095.8e3f4","type":"delay","z":"ab797823.3396a8","name":"Cool down time","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":981,"y":357,"wires":[["1bbbb5a8.48d48a"]]},{"id":"5f78bcd5.c6b7c4","type":"debug","z":"ab797823.3396a8","name":"t1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":509,"y":408,"wires":[]},{"id":"61a6ed69.0b50f4","type":"debug","z":"ab797823.3396a8","name":"t2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":781,"y":408,"wires":[]},{"id":"15254258.e0f3ee","type":"debug","z":"ab797823.3396a8","name":"delay","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":951,"y":408,"wires":[]},{"id":"f5fb62eb.af9b2","type":"inject","z":"897fdb2a.109f68","name":"","topic":"currentTemperature","payload":"19.9","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":178,"y":1258,"wires":[["6dc70796.b65778"]]},{"id":"d895bbc.65eb748","type":"inject","z":"897fdb2a.109f68","name":"","topic":"color","payload":"{\"h\":0,\"s\":0,\"v\":1}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":168,"y":1326,"wires":[["6dc70796.b65778"]]},{"id":"cb876a7a.b34738","type":"inject","z":"897fdb2a.109f68","name":"","topic":"color","payload":"{\"h\":90,\"s\":0,\"v\":1}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":168,"y":1360,"wires":[["6dc70796.b65778"]]},{"id":"76bcd56c.96218c","type":"inject","z":"897fdb2a.109f68","name":"","topic":"enum","payload":"Option 1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":148,"y":1462,"wires":[["6dc70796.b65778"]]},{"id":"a78862f2.37191","type":"inject","z":"897fdb2a.109f68","name":"","topic":"enum","payload":"Option 2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":148,"y":1496,"wires":[["6dc70796.b65778"]]},{"id":"b974c4c9.7635e8","type":"inject","z":"897fdb2a.109f68","name":"","topic":"enum","payload":"Option 3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":148,"y":1530,"wires":[["6dc70796.b65778"]]},{"id":"bfe6e2a.f99012","type":"inject","z":"897fdb2a.109f68","name":"","topic":"enum","payload":"Option 4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":148,"y":1564,"wires":[["6dc70796.b65778"]]},{"id":"2aa95e08.e613b2","type":"inject","z":"897fdb2a.109f68","name":"","topic":"color","payload":"270,50,50","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":148,"y":1394,"wires":[["6dc70796.b65778"]]},{"id":"3c420433.bbc33c","type":"homie-convention-node","z":"897fdb2a.109f68","broker":"e6a23911.f60378","name":"Heizkörper Thermostate","nodeId":"[any]","nodeName":"Heizkörper Thermostate","nodeType":"homematic HM-CC-RT-DN","passMsg":true,"autoConfirm":true,"infoHomie":true,"infoError":true,"exposeHomieNodes":true,"homieNodeConfig":"{}","x":1334,"y":527,"wires":[["f7671ce6.4a2eb"]]},{"id":"70513425.67039c","type":"function","z":"76579ffb.cc4a3","name":"convert Datapoint","func":"var datapointDef=env.get(\"datapointDef\");\nvar datapointProperty=env.get(\"datapointProperty\");\nvar contextStore=env.get(\"contextStore\");\n\nif (!datapointDef.$properties.hasOwnProperty(msg[datapointProperty])) return;\n\nvar datapoint=datapointDef.$properties[msg[datapointProperty]];\nvar nodeId=msg[datapointDef.nodeId]; // msg.device\nvar propertyId=msg[datapointDef.propertyId] //msg.datapoint\n\nvar homieConfig = global.get(contextStore.homieConfig.name,contextStore.homieConfig.provider) || {homie:{}};\nvar msgOut={topic:nodeId+'/'+propertyId};\n\n// initialize new device\nif (!homieConfig.homie.hasOwnProperty(nodeId)) {\n    homieConfig.homie[nodeId]={\n        \"$name\":msg[datapointDef.$name],\n        \"$type\":msg[datapointDef.$type],\n        \"$properties\":{}\n    }\n}\n\n// initialize new property\nif (!homieConfig.homie[nodeId].hasOwnProperty(propertyId)) {\n    homieConfig.homie[nodeId].$properties[propertyId]={\n        \"$name\":msg[datapoint.$name],\n        \"$datatype\": msg[datapoint.$datatype].toLowerCase(),\n        \"$settable\": datapoint.$settable,\n        \"$retained\": datapoint.$retained,\n        \"$unit\": datapoint.$unit\n    }\n    if (datapoint.hasOwnProperty(\"$format\")) {\n        if (datapoint.$format.hasOwnProperty(\"min\") && datapoint.$format.hasOwnProperty(\"max\")) {\n            homieConfig.homie[nodeId].$properties[propertyId].$format=msg[datapoint.$format.min]+\":\"+msg[datapoint.$format.max];\n        }\n    }\n    global.set(contextStore.homieConfig.name,homieConfig,contextStore.homieConfig.provider);\n    msgOut.nodeId=nodeId;\n    msgOut.homie=RED.util.cloneMessage(homieConfig.homie[nodeId]);\n}\n\nmsgOut.payload=msg[datapointDef.value];\nreturn [{fill:\"green\",shape:\"dot\",text:msgOut.topic+\"=\"+msgOut.payload},msgOut];","outputs":2,"noerr":0,"x":192,"y":85,"wires":[[],[]],"info":"# simple device to homie converter\n\nthis node helps to convert datapoints from non homie devices to meet the homie convention\n\n## configuration\n\nthe converter is configured by a json string\n\n```json\n\n```"},{"id":"f7671ce6.4a2eb","type":"debug","z":"897fdb2a.109f68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1529,"y":527,"wires":[]},{"id":"de9df925.480858","type":"debug","z":"897fdb2a.109f68","name":"HMIP-PSM","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":988,"y":731,"wires":[]},{"id":"d81885f6.478168","type":"debug","z":"897fdb2a.109f68","name":"HM-Sec-SCo","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":988,"y":646,"wires":[]},{"id":"af89e711.5e93c8","type":"debug","z":"897fdb2a.109f68","name":"HM-WDS30-OT2-SM","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1018,"y":833,"wires":[]},{"id":"8d504276.777d2","type":"subflow:76579ffb.cc4a3","z":"897fdb2a.109f68","name":"convert HM-CC-RT-DN","env":[{"name":"datapointDef","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"ACTUAL_TEMPERATURE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"°C\"},\"SET_TEMPERATURE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":true,\"$retained\":true,\"$unit\":\"°C\"},\"VALVE_STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"%\"},\"BATTERY_STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"V\"}}}","type":"json"}],"x":1013,"y":527,"wires":[["3c420433.bbc33c"]]},{"id":"f69e57b4.56cef8","type":"subflow:76579ffb.cc4a3","z":"897fdb2a.109f68","name":"convert HM-Sec-SCo","env":[{"name":"homieDef","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$setable\":false,\"$retained\":true,\"$unit\":\"\"},\"LOW_BAT\":{\"$setable\":false,\"$retained\":true,\"$unit\":\"°C\"}}}","type":"json"}],"x":1018,"y":595,"wires":[["636051c4.70be"]]},{"id":"df5b7229.0b5f4","type":"subflow:76579ffb.cc4a3","z":"897fdb2a.109f68","name":"convert HMIP-PSM","env":[{"name":"datapointDef","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"VOLTAGE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"V\"},\"ENERGY_COUNTER\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":true,\"$retained\":true,\"$unit\":\"°C\"},\"FREQUENCY\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"Hz\"},\"STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$setable\":true,\"$retained\":true,\"$unit\":\"\"}}}","type":"json"},{"name":"homieDef","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$setable\":false,\"$retained\":true,\"$unit\":\"\"},\"LOW_BAT\":{\"$setable\":false,\"$retained\":true,\"$unit\":\"°C\"}}}","type":"json"}],"x":1008,"y":680,"wires":[["87e52b6e.7ed6f8"]]},{"id":"b0c02f07.8d349","type":"debug","z":"897fdb2a.109f68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1529,"y":680,"wires":[]},{"id":"87e52b6e.7ed6f8","type":"homie-convention-node","z":"897fdb2a.109f68","broker":"e6a23911.f60378","name":"Schaltsteckdosen (messend)","nodeId":"[any]","nodeName":"Schaltsteckdose messend","nodeType":"homematic HM-PSM","passMsg":true,"autoConfirm":true,"infoHomie":true,"infoError":true,"exposeHomieNodes":true,"homieNodeConfig":"{}","x":1344,"y":680,"wires":[["b0c02f07.8d349"]]},{"id":"636051c4.70be","type":"homie-convention-node","z":"897fdb2a.109f68","broker":"e6a23911.f60378","name":"Fensterkontakte","nodeId":"[any]","nodeName":"Fensterkontakt","nodeType":"homematic HM-Sec-Sco","passMsg":true,"autoConfirm":true,"infoHomie":true,"infoError":true,"exposeHomieNodes":true,"homieNodeConfig":"{}","x":1304,"y":595,"wires":[["9cddbe0f.c49aa"]]},{"id":"b2288398.2c648","type":"subflow:76579ffb.cc4a3","z":"897fdb2a.109f68","name":"convert HM-WDS30-OT2-SM","env":[{"name":"datapointDef","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"VOLTAGE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"V\"},\"ENERGY_COUNTER\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":true,\"$retained\":true,\"$unit\":\"°C\"},\"FREQUENCY\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$format\":{\"min\":\"datapointMin\",\"max\":\"datapointMax\"},\"$setable\":false,\"$retained\":true,\"$unit\":\"Hz\"},\"STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$setable\":true,\"$retained\":true,\"$unit\":\"\"}}}","type":"json"},{"name":"homieDef","value":"{\"nodeId\":\"device\",\"propertyId\":\"datapoint\",\"value\":\"value\",\"$name\":\"deviceName\",\"$type\":\"deviceType\",\"$properties\":{\"STATE\":{\"$name\":\"datapointName\",\"$datatype\":\"datapointType\",\"$setable\":false,\"$retained\":true,\"$unit\":\"\"},\"LOW_BAT\":{\"$setable\":false,\"$retained\":true,\"$unit\":\"°C\"}}}","type":"json"}],"x":1038,"y":782,"wires":[[]]}]